/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,g,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[g]=f.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var g=0;return $jscomp.iteratorPrototype(function(){return g<c.length?{done:!1,value:c[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var g=c[Symbol.iterator];return g?g.call(c):$jscomp.arrayIterator(c)};$jscomp.arrayFromIterator=function(c){for(var g,f=[];!(g=c.next()).done;)f.push(g.value);return f};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.checkStringArgs=function(c,g,f){if(null==c)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return c+""};
$jscomp.polyfill=function(c,g,f,e){if(g){f=$jscomp.global;c=c.split(".");for(e=0;e<c.length-1;e++){var b=c[e];b in f||(f[b]={});f=f[b]}c=c[c.length-1];e=f[c];g=g(e);g!=e&&null!=g&&$jscomp.defineProperty(f,c,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(c,f){var e=$jscomp.checkStringArgs(this,c,"startsWith");c+="";for(var b=e.length,a=c.length,d=Math.max(0,Math.min(f|0,e.length)),h=0;h<a&&d<b;)if(e[d++]!=c[h++])return!1;return h>=a}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(c){return c?c:function(c,f){var e=$jscomp.checkStringArgs(this,c,"endsWith");c+="";void 0===f&&(f=e.length);for(var b=Math.max(0,Math.min(f|0,e.length)),a=c.length;0<a&&0<b;)if(e[--b]!=c[--a])return!1;return 0>=a}},"es6-impl","es3");$jscomp.polyfill("Number.isNaN",function(c){return c?c:function(c){return"number"===typeof c&&isNaN(c)}},"es6-impl","es3");$jscomp.owns=function(c,g){return Object.prototype.hasOwnProperty.call(c,g)};
$jscomp.polyfill("WeakMap",function(c){function g(a){$jscomp.owns(a,e)||$jscomp.defineProperty(a,e,{value:{}})}function f(a){var d=Object[a];d&&(Object[a]=function(a){g(a);return d(a)})}if(function(){if(!c||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),e=new c([[a,2],[b,3]]);if(2!=e.get(a)||3!=e.get(b))return!1;e["delete"](a);e.set(b,4);return!e.has(a)&&4==e.get(b)}catch(m){return!1}}())return c;var e="$jscomp_hidden_"+Math.random().toString().substring(2);f("freeze");f("preventExtensions");
f("seal");var b=0,a=function(a){this.id_=(b+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}};a.prototype.set=function(a,b){g(a);if(!$jscomp.owns(a,e))throw Error("WeakMap key fail: "+a);a[e][this.id_]=b;return this};a.prototype.get=function(a){return $jscomp.owns(a,e)?a[e][this.id_]:void 0};a.prototype.has=function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)};a.prototype["delete"]=
function(a){return $jscomp.owns(a,e)&&$jscomp.owns(a[e],this.id_)?delete a[e][this.id_]:!1};return a},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(c){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),d=new c($jscomp.makeIterator([[a,"s"]]));if("s"!=d.get(a)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var b=d.entries(),e=b.next();if(e.done||e.value[0]!=a||"s"!=e.value[1])return!1;e=b.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!b.next().done?!1:!0}catch(p){return!1}}())return c;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var g=new WeakMap,f=function(d){this.data_={};this.head_=a();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var b;!(b=d.next()).done;)b=b.value,this.set(b[0],b[1])}};f.prototype.set=function(a,d){var b=e(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=d:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:d},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};f.prototype["delete"]=
function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};f.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=a();this.size=0};f.prototype.has=function(a){return!!e(this,a).entry};f.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};f.prototype.entries=function(){return b(this,function(a){return[a.key,
a.value]})};f.prototype.keys=function(){return b(this,function(a){return a.key})};f.prototype.values=function(){return b(this,function(a){return a.value})};f.prototype.forEach=function(a,d){for(var b=this.entries(),e;!(e=b.next()).done;)e=e.value,a.call(d,e[1],e[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var e=function(a,b){var e;e=b&&typeof b;"object"==e||"function"==e?g.has(b)?e=g.get(b):(e=""+ ++d,g.set(b,e)):e="p_"+b;var c=a.data_[e];if(c&&$jscomp.owns(a.data_,e))for(var f=0;f<
c.length;f++){var h=c[f];if(b!==b&&h.key!==h.key||b===h.key)return{id:e,list:c,index:f,entry:h}}return{id:e,list:c,index:-1,entry:void 0}},b=function(a,d){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:d(b)};b=null}return{done:!0,value:void 0}})},a=function(){var a={};return a.previous=a.next=a.head=a},d=0;return f},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(c){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),e=new c($jscomp.makeIterator([f]));if(!e.has(f)||1!=e.size||e.add(f)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var b=e.entries(),a=b.next();if(a.done||a.value[0]!=f||a.value[1]!=f)return!1;a=b.next();return a.done||a.value[0]==f||4!=a.value[0].x||a.value[1]!=a.value[0]?!1:b.next().done}catch(d){return!1}}())return c;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var g=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var e;!(e=c.next()).done;)this.add(e.value)}this.size=this.map_.size};g.prototype.add=function(c){this.map_.set(c,c);this.size=this.map_.size;return this};g.prototype["delete"]=function(c){c=this.map_["delete"](c);this.size=this.map_.size;return c};g.prototype.clear=function(){this.map_.clear();this.size=0};g.prototype.has=function(c){return this.map_.has(c)};g.prototype.entries=
function(){return this.map_.entries()};g.prototype.values=function(){return this.map_.values()};g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(c,e){var b=this;this.map_.forEach(function(a){return c.call(e,a,a,b)})};return g},"es6-impl","es3");$jscomp.polyfill("Object.assign",function(c){return c?c:function(c,f){for(var e=1;e<arguments.length;e++){var b=arguments[e];if(b)for(var a in b)$jscomp.owns(b,a)&&(c[a]=b[a])}return c}},"es6-impl","es3");
$jscomp.findInternal=function(c,g,f){c instanceof String&&(c=String(c));for(var e=c.length,b=0;b<e;b++){var a=c[b];if(g.call(f,a,b,c))return{i:b,v:a}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,f){return $jscomp.findInternal(this,c,f).v}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(c,g){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var f=0,e={next:function(){if(f<c.length){var b=f++;return{value:g(b,c[b]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(c){var f=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var e="";c;)if(c&1&&(e+=f),c>>>=1)f+=f;return e}},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(c){return c?c:function(c,f){return-1!==$jscomp.checkStringArgs(this,c,"includes").indexOf(c,f||0)}},"es6-impl","es3");
$jscomp.polyfill("Array.from",function(c){return c?c:function(c,f,e){$jscomp.initSymbolIterator();f=null!=f?f:function(a){return a};var b=[],a=c[Symbol.iterator];if("function"==typeof a)for(c=a.call(c);!(a=c.next()).done;)b.push(f.call(e,a.value));else for(var a=c.length,d=0;d<a;d++)b.push(f.call(e,c[d]));return b}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(c){return c?c:function(c){return"number"!==typeof c?!1:!isNaN(c)&&Infinity!==c&&-Infinity!==c}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(c){return c?c:function(c){return Number.isFinite(c)?c===Math.floor(c):!1}},"es6-impl","es3");$jscomp.polyfill("Math.sign",function(c){return c?c:function(c){c=Number(c);return 0===c||isNaN(c)?c:0<c?1:-1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.findIndex",function(c){return c?c:function(c,f){return $jscomp.findInternal(this,c,f).i}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.entries",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,f){return[c,f]})}},"es6-impl","es3");$jscomp.polyfill("Math.log10",function(c){return c?c:function(c){return Math.log(c)/Math.LN10}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,f){return f})}},"es6","es3");
$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6-impl","es3");$jscomp.polyfill("Number.isSafeInteger",function(c){return c?c:function(c){return Number.isInteger(c)&&Math.abs(c)<=Number.MAX_SAFE_INTEGER}},"es6-impl","es3");
var jstz=function(){var c={"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],
"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk",
"Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},g=function(a){a=-a.getTimezoneOffset();return null!==a?a:0},f=function(){var a=g(new Date(2014,0,2)),d=g(new Date(2014,5,2)),b=a-d;return 0>b?a+",1":0<b?d+",1,s":a+",0"},e=function(){var a;if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat&&(a=Intl.DateTimeFormat(),"undefined"!==typeof a&&"undefined"!==typeof a.resolvedOptions&&(a=a.resolvedOptions().timeZone)&&(-1<a.indexOf("/")||
"UTC"===a)))return a},b=function m(a,d,b){"undefined"===typeof d&&(d=864E5,b=36E5);var e=(new Date(a.getTime()-d)).getTime();a=a.getTime()+d;for(var c=(new Date(e)).getTimezoneOffset(),f=null;e<a-b;){var h=new Date(e);if(h.getTimezoneOffset()!==c){f=h;break}e+=b}return 864E5===d?m(f,36E5,6E4):36E5===d?m(f,6E4,1E3):f},a=function(a,d,b,e){if("N/A"!==b)return b;if("Asia/Beirut"===d){if("Africa/Cairo"===e.name&&13983768E5===a[6].s&&14116788E5===a[6].e||"Asia/Jerusalem"===e.name&&13959648E5===a[6].s&&
14118588E5===a[6].e)return 0}else if("America/Santiago"===d){if("America/Asuncion"===e.name&&14124816E5===a[6].s&&1397358E6===a[6].e||"America/Campo_Grande"===e.name&&14136912E5===a[6].s&&13925196E5===a[6].e)return 0}else if("America/Montevideo"===d){if("America/Sao_Paulo"===e.name&&14136876E5===a[6].s&&1392516E6===a[6].e)return 0}else if("Pacific/Auckland"===d&&"Pacific/Fiji"===e.name&&14142456E5===a[6].s&&13961016E5===a[6].e)return 0;return b},d=function(d,b){for(var e={},f=jstz.olson.dst_rules.zones,
h=f.length,m=c[b],g=0;g<h;g++){var n=f[g],z;z=f[g];for(var B=0,v=0;v<d.length;v++)if(z.rules[v]&&d[v]){if(d[v].s>=z.rules[v].s&&d[v].e<=z.rules[v].e)B=0,B+=Math.abs(d[v].s-z.rules[v].s),B+=Math.abs(z.rules[v].e-d[v].e);else{B="N/A";break}if(864E6<B){B="N/A";break}}z=B=a(d,b,B,z);"N/A"!==z&&(e[n.name]=z)}for(var E in e)if(e.hasOwnProperty(E))for(f=0;f<m.length;f++)if(m[f]===E)return E;return b},h=function(a){var e=function(){for(var a=[],d=0;d<jstz.olson.dst_rules.years.length;d++){var e;e=jstz.olson.dst_rules.years[d];
var c=(new Date(e,0,1,0,0,1,0)).getTime();e=(new Date(e,12,31,23,59,59)).getTime();for(var f=(new Date(c)).getTimezoneOffset(),h=null,m=null;c<e-864E5;){var g=new Date(c),n=g.getTimezoneOffset();n!==f&&(n<f&&(h=g),n>f&&(m=g),f=n);c+=864E5}e=h&&m?{s:b(h).getTime(),e:b(m).getTime()}:!1;a.push(e)}return a}();return function(a){for(var d=0;d<a.length;d++)if(!1!==a[d])return!0;return!1}(e)?d(e,a):a};return{determine:function(){var a=e();a||(a=jstz.olson.timezones[f()],"undefined"!==typeof c[a]&&(a=h(a)));
return{name:function(){return a}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"Africa/Casablanca",rules:[{e:12202236E5,s:12122784E5},{e:12508092E5,s:12438144E5},{e:1281222E6,s:12727584E5},{e:13120668E5,s:13017888E5},{e:13489704E5,s:1345428E6},{e:13828392E5,s:13761E8},{e:14142888E5,s:14069448E5}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},
{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,
s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,
s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,
s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},{e:1414314E6,s:13967784E5}]},{name:"America/Santiago",rules:[{e:1206846E6,s:1223784E6},{e:1237086E6,s:12552336E5},{e:127035E7,s:12866832E5},{e:13048236E5,s:13138992E5},{e:13356684E5,s:13465584E5},{e:1367118E6,s:13786128E5},{e:13985676E5,s:14100624E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,
s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,
s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:1414098E6,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,
s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,
s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},
{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,
s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},
{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]},{name:"Europe/London",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]}]};(function(c,g){"object"==typeof module&&module.exports?module.exports=g():"function"==typeof define&&define.amd?define(g):c.Spinner=g()})(this,function(){function c(a,d){var b=document.createElement(a||"div"),e;for(e in d)b[e]=d[e];return b}function g(a){for(var d=1,b=arguments.length;d<b;d++)a.appendChild(arguments[d]);return a}function f(a,d,b,e){var c=["opacity",d,~~(100*a),b,e].join("-");b=.01+b/e*100;e=Math.max(1-(1-a)/d*(100-b),a);var f=p.substring(0,p.indexOf("Animation")).toLowerCase();n[c]||
(r.insertRule("@"+(f&&"-"+f+"-"||"")+"keyframes "+c+"{0%{opacity:"+e+"}"+b+"%{opacity:"+a+"}"+(b+.01)+"%{opacity:1}"+(b+d)%100+"%{opacity:"+a+"}100%{opacity:"+e+"}}",r.cssRules.length),n[c]=1);return c}function e(a,d){var b=a.style,e,c;d=d.charAt(0).toUpperCase()+d.slice(1);if(void 0!==b[d])return d;for(c=0;c<m.length;c++)if(e=m[c]+d,void 0!==b[e])return e}function b(a,d){for(var b in d)a.style[e(a,b)||b]=d[b];return a}function a(a){for(var d=1;d<arguments.length;d++){var b=arguments[d],e;for(e in b)void 0===
a[e]&&(a[e]=b[e])}return a}function d(a,d){return"string"==typeof a?a:a[d%a.length]}function h(d){this.opts=a(d||{},h.defaults,u)}function l(){function a(a,d){return c("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',d)}r.addRule(".spin-vml","behavior:url(#default#VML)");h.prototype.lines=function(e,c){function f(){return b(a("group",{coordsize:l+" "+l,coordorigin:-m+" "+-m}),{width:l,height:l})}function h(e,h,l){g(n,g(b(f(),{rotation:360/c.lines*e+"deg",left:~~h}),g(b(a("roundrect",
{arcsize:c.corners}),{width:m,height:c.scale*c.width,left:c.scale*c.radius,top:-c.scale*c.width>>1,filter:l}),a("fill",{color:d(c.color,e),opacity:c.opacity}),a("stroke",{opacity:0}))))}var m=c.scale*(c.length+c.width),l=2*c.scale*m,q=-(c.width+c.length)*c.scale*2+"px",n=b(f(),{position:"absolute",top:q,left:q});if(c.shadow)for(q=1;q<=c.lines;q++)h(q,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(q=1;q<=c.lines;q++)h(q);return g(e,n)};h.prototype.opacity=
function(a,d,b,e){a=a.firstChild;e=e.shadow&&e.lines||0;a&&d+e<a.childNodes.length&&(a=(a=(a=a.childNodes[d+e])&&a.firstChild)&&a.firstChild)&&(a.opacity=b)}}var m=["webkit","Moz","ms","O"],n={},p,r,u={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};h.defaults={};a(h.prototype,{spin:function(a){this.stop();var d=this,e=d.opts,f=
d.el=c(null,{className:e.className});b(f,{position:e.position,width:0,zIndex:e.zIndex,left:e.left,top:e.top});a&&a.insertBefore(f,a.firstChild||null);f.setAttribute("role","progressbar");d.lines(f,d.opts);if(!p){var h=0,m=(e.lines-1)*(1-e.direction)/2,g,l=e.fps,q=l/e.speed,n=(1-e.opacity)/(q*e.trail/100),w=q/e.lines;(function G(){h++;for(var a=0;a<e.lines;a++)g=Math.max(1-(h+(e.lines-a)*w)%q*n,e.opacity),d.opacity(f,a*e.direction+m,g,e);d.timeout=d.el&&setTimeout(G,~~(1E3/l))})()}return d},stop:function(){var a=
this.el;a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0);return this},lines:function(a,e){function h(a,d){return b(c(),{position:"absolute",width:e.scale*(e.length+e.width)+"px",height:e.scale*e.width+"px",background:a,boxShadow:d,transformOrigin:"left",transform:"rotate("+~~(360/e.lines*m+e.rotate)+"deg) translate("+e.scale*e.radius+"px,0)",borderRadius:(e.corners*e.scale*e.width>>1)+"px"})}for(var m=0,l=(e.lines-1)*(1-e.direction)/2,q;m<e.lines;m++)q=b(c(),
{position:"absolute",top:1+~(e.scale*e.width/2)+"px",transform:e.hwaccel?"translate3d(0,0,0)":"",opacity:e.opacity,animation:p&&f(e.opacity,e.trail,l+m*e.direction,e.lines)+" "+1/e.speed+"s linear infinite"}),e.shadow&&g(q,b(h("#000","0 0 4px #000"),{top:"2px"})),g(a,g(q,h(d(e.color,m),"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,d,b){d<a.childNodes.length&&(a.childNodes[d].style.opacity=b)}});if("undefined"!==typeof document){r=function(){var a=c("style",{type:"text/css"});g(document.getElementsByTagName("head")[0],
a);return a.sheet||a.styleSheet}();var w=b(c("group"),{behavior:"url(#default#VML)"});!e(w,"transform")&&w.adj?l():p=e(w,"animation")}return h});var CTATConfig={Options:{},addProperty:function(c,g,f,e){f=f||g[0];Object.defineProperty(CTATConfig,c,{enumerable:!0,configurable:!1,writable:!e,value:f.toLowerCase()});var b={};g.forEach(function(a){b[a]=a.toLowerCase();Object.defineProperty(CTATConfig,c+"_is_"+a,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:c,val:b[a]})})});CTATConfig.Options[c]=b}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","None"],"None");CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file",skills:"skills"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;
void 0===useDebugging&&(useDebugging=!1);var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.4.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,nameTranslator=null,hints=[],hintIndex=0;CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;
var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(c){return document.getElementById(c)};var CTATGlobalFunctions={};function unhighlightall(c){if(CTATShellTools.component_descriptions){c=CTATShellTools.getAllComponents();for(var g=0;g<c.length;g++){var f=c[g];f.setHintHighlight&&f.setHintHighlight(!1,null)}}}CTATGlobalFunctions.stringToBoolean=function(c){switch(String(c).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!c}};
CTATGlobalFunctions.isInstructorMode=function(){var c=flashVars?flashVars.getRawFlashVars():null;return c&&c.deliverymode?"delivery"==c.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(c){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(c,g){CTATGlobalFunctions.isCTATObject(c)?c.setPreviewMode(g):c.previewMode=g};
CTATGlobalFunctions.setCenterTutor=function(c,g){CTATGlobalFunctions.isCTATObject(c)?c.setCenterTutor(g):c.centerTutor=g};CTATGlobalFunctions.setTutorWidth=function(c,g){CTATGlobalFunctions.isCTATObject(c)?c.setTutorWidth(g):c.width=g};CTATGlobalFunctions.setTutorHeight=function(c,g){CTATGlobalFunctions.isCTATObject(c)?c.setTutorHeight(g):c.height=g};CTATGlobalFunctions.setTutorDimensions=function(c,g,f){CTATGlobalFunctions.isCTATObject(c)?c.setTutorDimensions(g,f):(c.width=g,c.height=f)};
CTATGlobalFunctions.setTutorValue=function(c,g,f){CTATGlobalFunctions.isCTATObject(c)?c.setTutorValue(g,f):c[g]=f};CTATGlobalFunctions.setCommunicationMode=function(c,g){CTATGlobalFunctions.isCTATObject(c)?c.setCommunicationMode(g):c.tutoring_service_communication=g};CTATGlobalFunctions.setRemoteSocketURL=function(c,g){CTATGlobalFunctions.isCTATObject(c)?c.setRemoteSocketURL(g):c.remoteSocketURL=g};
CTATGlobalFunctions.setRemoteSocketPort=function(c,g){CTATGlobalFunctions.isCTATObject(c)?c.setRemoteSocketPort(g):c.remoteSocketPort=g};CTATGlobalFunctions.setProblemSummary=function(c){};CTATGlobalFunctions.isCTATObject=function(c){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(c){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(c){return"boolean"===typeof c?c:"string"===typeof c?CTATGlobalFunctions.stringToBoolean(c):"number"===typeof c?0<c:c?!0:!1};function noenter(c){if(CTATConfig.platform_is_Google())return 0;c=c||window.event;return 13!==(c.keyCode||c.charCode)}CTATGlobalFunctions.isBlank=function(c){return!c||/^\s*$/.test(c)};function componentToHex(c){c=c.toString(16);return 1==c.length?"0"+c:c}
function rgbToHex(c,g,f){return"#"+componentToHex(c)+componentToHex(g)+componentToHex(f)}function hexToRgb(c){return(c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c))?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null}
function parseQueryStringArgs(c){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+c);var g="?"==c.charAt(0)?c.substring(1):c;c={};if(g)for(var g=g.split("&"),f=0;f<g.length;f++){var e=g[f].split("=");c[decodeURIComponent(e[0])]=decodeURIComponent(e[1].replace(/\+/g," "))}return c}
function setOrientation(c){ctatdebug("setOrientation ("+c+")");switch(c){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function c(){}return function(g){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");c.prototype=g;return new c}}());
function thisMovie(c){return-1!=navigator.appName.indexOf("Microsoft")?window[c]:document[c]}function introspect(c,g,f,e){f=f||"";"number"!==this.typeOf(e)&&(e=1);var b=this.typeOf(g);c=[f,c," ",b," :"].join("");if("object"===b){if(0<e){f=[f,"  "].join("");for(var a in g)b=this.introspect(a,g[a],f,e-1),c=[c,"\n",b].join("");return c}return[c," ..."].join("")}return"null"===b?[c," null"].join(""):[c," ",g].join("")}
function findPointOfAttachment(c){ctatdebug("findPointOfAttachment ("+c+")");for(var g=0;g<movieclips.length;g++){var f=movieclips[g];ctatdebug("Examining: "+f.getName()+"...");if(!0===f.isRegistered(c))return f}return null}function findMovieClip(c){c=c.trim();ctatdebug("findMovieClip ("+c.trim()+")");for(var g=0;g<movieclips.length;g++){var f=movieclips[g];ctatdebug("Examining: "+f.getName()+"...");if(f.getName()==c)return f}return null}
function colName(c,g){ctatdebug("colName ("+c+")");for(var f="";0<=c;)f=String.fromCharCode(c%26+97)+f,c=Math.floor(c/26)-1;!0===g&&f.toUpperCase();return f}function selectText(c){}function urldecode(c){return decodeURIComponent((""+c).replace(/\+/g,"%20"))}function detectIE(){var c=window.navigator.userAgent,g=c.indexOf("MSIE "),f=c.indexOf("Trident/");return 0<g?parseInt(c.substring(g+5,c.indexOf(".",g)),10):0<f?(g=c.indexOf("rv:"),parseInt(c.substring(g+3,c.indexOf(".",g)),10)):!1}
function listProperties(c){ctatdebug("listProperties (l: "+c.length+")");for(var g in c)ctatdebug("["+g+"]")}function listPropertiesKV(c,g){ctatdebug("listPropertiesKV (size: "+c.length+")");if(1==g)for(var f=0;f<c.length;f++)ctatdebug("["+f+"]: "+c[f]);else for(f in c)ctatdebug("["+f+"]: "+c[f])}function listAllDivAttributes(c){ctatdebug("listAllDivAttributes ()");var g=0;c=c.attributes;for(var f=c.length;g<f;g++)pointer.ctatdebug("Attribute: "+c[g].nodeName+", with value: "+c[g].nodeValue)}
var getBackgroundDimensions=function(c){ctatdebug("Using url: "+$(c).css("background-image"));var g=new Image;g.src=$(c).css("background-image").replace(/url\(|\)$|"/ig,"");return g.width+" "+g.height},getBackgroundWidth=function(c){ctatdebug("Using url: "+$(c).css("background-image"));var g=new Image;g.src=$(c).css("background-image").replace(/url\(|\)$|"/ig,"");return g.width},getBackgroundHeight=function(c){ctatdebug("Using url: "+$(c).css("background-image"));var g=new Image;g.src=$(c).css("background-image").replace(/url\(|\)$|"/ig,
"");return g.height};function getIndicesOf(c,g,f){var e=0,b=c.length,a=[];f||(g=g.toLowerCase(),c=c.toLowerCase());for(;-1<(f=g.indexOf(c,e));)a.push(f),e=f+b;return a}CTATGlobalFunctions.formatColor=function(c){if(/^#[0-9a-f]{6}$/i.test(c))return c;var g=c.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==g)return rgbToHex(Number(g[1]),Number(g[2]),Number(g[3]));g=c.match(/^#?([0-9a-f]{0,6})$/i);if(null!==g){for(c=g[1];6>c.length;)c="0"+c;return"#"+c}return c};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var c="",e=0;return{set_prefix:function(b){c=String(b)},set_index:function(b){e=b},gensym:function(){var b=c+e;e+=1;return b}}};var c=this.make_gensym();c.set_index(2);var g=this.make_gensym();g.set_index(1);g.set_prefix("ctatdiv");return{z_index:c.gensym,div_id:g.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(c,g){function f(a,d,b){null===a&&(a="unknownclass");null===d&&(d="nullinstance");return"["+a+":"+d+"] "+b}var e=c,b=g,a=this,d=!0;"undefined"!=CTATBase.DebuggingFilter[e]&&CTATBase.DebuggingFilter[e]&&(d=!1);this.getClassName=function(){return e};this.getClassname=function(){return e};this.setClassName=function(a){e=a};this.setName=function(a){b=a};this.getName=function(){return b};this.getUseDebugging=function(){return useDebugging};this.setUseDebugging=function(a){useDebugging=
a};this.toHHMMSS=function(a){var d=parseInt(a,10);a=Math.floor(d/3600);var b=Math.floor((d-3600*a)/60),d=d-3600*a-60*b;10>a&&(a="0"+a);10>b&&(b="0"+b);10>d&&(d="0"+d);return a+":"+b+":"+d};this.ctatdebug=function(b){if(d){var e=b;useDebuggingBasic?a.ctatdebugInternal(e,"UnknownClass"):(null===b&&(e="No message provided"),useDebugging&&a.ctatdebugInternal(e,a.getClassName()))}};this.ctatdebugObject=function(a){var d=0,b;for(b in a)this.ctatdebug("("+d+")"+b+": "+a[b]),d++};this.ctatdebugInternal=function(d,
b){var e=d;if(null===e||void 0===e)e="No message!";""===e&&(e="Empty message!");if(useDebuggingBasic)e=f("Unknown","undefined",e),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole?(CTATBase.customconsole.innerHTML+=e+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight):console.log(e);else{null===b&&(b="UndefinedClass");null===e&&(e="No message");e=f(b,a.getName(),e);try{console.trace(e)}catch(n){}"google"==CTATConfig.platform?
Logger.log(e):(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=e+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(d){var b="",e;for(e in d)b+=e+", ";a.ctatdebugInternal("Object: "+b,"Global")};this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.entitiesConvert=function(a){this.ctatdebug("entitiesConvert ()");
return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return a}};function formatLogMessageGoogle(c,g,f){f=(new CTATBase(c,g)).htmlEncode(f);return"["+c+":"+g+"] "+f}function ctatdebug(c){(useDebugging||useDebuggingBasic)&&null!==c&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",c)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(c,"CTATTutor")))}
Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(c){return this.parseXML(c)};this.parseXML=function(c){this.ctatdebug("parseXML ()");var g=null;try{"undefined"!==typeof $?g=$.parseXML(c):"undefined"!==typeof XMLParser?g=(new XMLParser).parseFromString(c):this.ctatdebug("Bottoming out, no parser configured!")}catch(f){return null!=g?this.ctatdebug("JQuery could not process the provided XML: "+f.message+" ("+g.parseError.errorCode+") ("+g.parseError.reason+") ("+
g.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+f.message),null}return null==g?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):g.documentElement};this.getElementName=function(c){return c.nodeName};this.getElementValue=function(c){return c.nodeValue};this.getElementChildren=function(c){for(var g=[],f=0;f<c.childNodes.length;f++)1==c.childNodes[f].nodeType&&g.push(c.childNodes[f]);return g};this.getNodeTextValue=function(c){if(null==
c)return"";if(null==c.childNodes)return c.nodeValue;if(0==c.childNodes.length)return"";for(var g=c.childNodes,f=0;f<g.length;f++){var e=g[f];if("value"==e.nodeName||"Value"==e.nodeName){if(1==e.childNodes.length)return e.childNodes[0].nodeValue;if(0==e.childNodes.length)break;else return e.childNodes[1].nodeValue}}return c.childNodes[0].nodeValue};this.getElementAttr=function(c,g){if(!c.attributes)return this.ctatdebug("Warning: Element "+c.nodeName+" does not have any attributes"),"";for(var f=0;f<
c.attributes.length;f++)if(c.attributes[f].nodeName==g)return c.attributes[f].nodeValue;return""};this.listElementAttr=function(c){this.ctatdebug("Listing "+c.attributes.length+" attributes for element "+c.nodeName+" ...");for(var g=0;g<c.attributes.length;g++)this.ctatdebug(g+" name: "+c.attributes[g].nodeName+", value: "+c.attributes[g].nodeValue)};this.stringify=function(c){return this.xmlToString(c)};this.xmlToString=function(c){this.ctatdebug("xmlToString ()");return null==c?(this.ctatdebug("Error: xml data is null"),
null):(new XMLSerializer).serializeToString(c)}};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATDefaultLanguagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",CONGRATULATIONS_YOU_ARE_DONE:"Congratulations, you are done with this problem.",DONE_WITH_PROBLEM_SET:"You are done with this problem set.",SURE_YOU_ARE_DONE:"Are you sure you are done?",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",
DONE:"Done",HINT:"Hint",NEXT:"Next",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",NO_HINT_AVAILABLE:"No hint is available at this step.",NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",
ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator.",AWAITING_OTHER_COLLABORATORS:"Waiting for other team members...",YOUR_COLLABORATOR:"Your team member ",COLLABORATOR_QUIT_CLICK_OK:"has quit. Please click OK to exit, then restart the problem.",COLLABORATOR_QUIT_CLICK_X:"has quit. Please the red X at top right to exit, then restart the problem."},CTATLanguageManager=function(){CTATBase.call(this,"CTATLanguageManager","theLanguagePack");
var c=this;this.getString=function(g){c.ctatdebug("getString ("+g+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[g])return CTATLanguagePack[g]}else c.ctatdebug("No custom language pack defined, using default...");return CTATDefaultLanguagePack[g]};this.filterString=function(g){c.ctatdebug("filterString ("+g+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[g])return c.ctatdebug("Found tag in provided language pack, returning: "+
CTATLanguagePack[g]),CTATLanguagePack[g]}else c.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLanguagePack&&CTATDefaultLanguagePack[g]?(c.ctatdebug("Found tag in default language pack, returning: "+CTATDefaultLanguagePack[g]),CTATDefaultLanguagePack[g]):g}};CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(c,g){var f=c.toLowerCase(),e="<"+g.toLowerCase()+">",b=f.indexOf(e)+e.length,f=f.indexOf("</"+g.toLowerCase()+">");if(b<e.length||0>f)return null;e={};e.start=b;e.end=f;return e};
CTATMsgType.makeValues=function(c){if(null==c)return"";if("string"==typeof c)return c;if(c.constructor&&"Array"==c.constructor.name){if(!c.length)return"";for(var g=0,f,e="<value>"+(null==(f=c[g++])?"":f.toString());g<c.length;)e+="</value><value>"+(null==(f=c[g++])?"":f.toString());return e+"</value>"}return c.outerHTML?c.outerHTML:c.toString()};
CTATMsgType.setProperty=function(c,g,f){var e=CTATMsgType.findProperty(c,g),b;e?(b=c.slice(0,e.start),b+=CTATMsgType.makeValues(f),b+=c.slice(e.end,c.length)):(e=c.indexOf("</properties>"),b=c.slice(0,e),b+="<"+g+">"+CTATMsgType.makeValues(f)+"</"+g+">",b+=c.slice(e,c.length));return b};CTATMsgType.getProperty=function(c,g){var f=CTATMsgType.findProperty(c,g);return f?c.slice(f.start,f.end):""};
CTATMsgType.valueToArray=function(c){if(!c.startsWith("<value>"))return null;var g=c.substring(7);if(!c.endsWith("</value>"))return null;g=g.substring(0,g.length-8);g=g.split("</value><value>");ctatdebug("valueToArray("+c+") returns "+g);return g};CTATMsgType.getValue=function(c,g){var f=CTATMsgType.valueToArray(c);return!f||f.length<=g?null:f[g]};CTATMsgType.getMessageType=function(c){return CTATMsgType.getProperty(c,"MessageType")};
CTATMsgType.getTransactionID=function(c){return CTATMsgType.getProperty(c,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(c,g){return CTATMsgType.setProperty(c,CTATMessage.TRANSACTION_ID_TAG,g)};CTATMsgType.isCorrectOrIncorrect=function(c){return"string"==typeof c?CTATMsgType.CorrectTypes[c.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(c){return"string"==typeof c?CTATMsgType.TextFeedbackTypes[c.toLowerCase()]?!0:!1:!1};
CTATMsgType.isHintResponse=function(c){return"string"==typeof c?CTATMsgType.HintResponseTypes[c.toLowerCase()]?!0:!1:!1};CTATMsgType.isDoneMessage=function(c){var g=CTATMsgType.getProperty(c,"Selection");c=CTATMsgType.getProperty(c,"Action");if(!g||!c)return!1;g=g.toString().toLowerCase();c=c.toString().toLowerCase();var f=CTATMsgType.DONE.toLowerCase();if(f!=g&&f!=CTATMsgType.getValue(g,0))return!1;g=CTATMsgType.BUTTON_PRESSED.toLowerCase();return g!=c&&g!=CTATMsgType.getValue(c,0)?!1:!0};
CTATMsgType.getSAIArraysFromElement=function(c,g){for(var f={selection:[],action:[],input:[]},e=g.getElementChildren(c),b=0;b<e.length;b++){var a=e[b];switch(g.getElementName(a)){case "Selection":for(var a=g.getElementChildren(a),d=0;d<a.length;d++)f.selection.push(g.getNodeTextValue(a[d]));break;case "Action":a=g.getElementChildren(a);for(d=0;d<a.length;d++)f.action.push(g.getNodeTextValue(a[d]));break;case "Input":a=g.getElementChildren(a);for(d=0;d<a.length;d++)f.input.push(g.getNodeTextValue(a[d]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(a,g)}}return f};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,successmessage:1,buggymessage:1,wrongusermessage:1,nohintmessage:1,highlightmsg:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});
Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});
Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});
Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});Object.defineProperty(CTATMsgType,"TRACE_OUTCOME",{enumerable:!1,configurable:!1,writable:!1,value:"TraceOutcome"});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});
Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});
Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});
Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});
Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});
Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});
Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(c,g){if(null===c||"undefined"===typeof c)return null===g||"undefined"===typeof g?0:-1;if(null===g||"undefined"===typeof g)return 1;var f=0,e=c.split("."),b=g.split("."),a;for(a=0;a<Math.min(e.length,b.length);a++)try{var d=parseInt(e[a]),h=parseInt(b[a]),f=d<h?-1:d>h?1:0;if(0!==f)return f}catch(l){if(f=e[a].toString()<b[a].toString()?-1:e[a].toString()>b[a].toString()?1:0,0!==f)return f}return a<
e.length?1:a<b.length?-1:c.toString()<g.toString()?-1:c.toString()>g.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(c,g,f,e,b,a,d){CTATBase.call(this,"CTATExampleTracerSkill",g);var h=this,l=0,m=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11;this.skillName=null==c||""==c.trim()?g:g+" "+c;this.pGuess=Number(f);Number.isNaN(h.pGuess)&&(h.pGuess=CTATExampleTracerSkill.DEFAULT_P_GUESS);this.pKnown=Number(e);Number.isNaN(h.pKnown)&&(h.pKnown=CTATExampleTracerSkill.DEFAULT_P_KNOWN);this.pLearn=Number(a);Number.isNaN(h.pLearn)&&(h.pLearn=CTATExampleTracerSkill.DEFAULT_P_LEARN);this.pSlip=
Number(b);Number.isNaN(h.pSlip)&&(h.pSlip=CTATExampleTracerSkill.DEFAULT_P_SLIP);this.history=/^0*[xX]([0-9a-fA-F]+)$/.test(d)?parseInt(d,16):/^(\-|\+)?[0-9]+$/.test(d)?parseInt(d,10):CTATExampleTracerSkill.DEFAULT_HISTORY;this.opportunityCount=0;this.masteryThreshold=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD;this.description=this.label=null;var n=function(a,d,b,e,c,f,h){this.skillName=a;this.pGuess=d;this.pKnown=b;this.pLearn=e;this.pSlip=c;this.history=f;this.opportunityCount=h};n.prototype.constructor=
n;var p=[];this.getSkillName=function(){return h.skillName};this.getCategory=function(){var a=h.skillName.indexOf(" ");return 0>a?"":h.skillName.substring(a+1)};this.setTransactionNumber=function(a){l=a};this.getUpdates=function(){return p};this.addUpdate=function(a){p.push(a)};this.recordUpdate=function(a){h.updatePKnown(a);h.updateHistory(a);h.changeOpportunityCount(1);p.push(new n(h.skillName,h.pGuess,h.pKnown,h.pLearn,h.pSlip,h.history,h.opportunityCount))};this.updatePKnown=function(a){h.pKnown=
CTATExampleTracerSkill.updatePKnownStatic(a,h.pGuess,h.pKnown,h.pSlip,h.pLearn);return h.pKnown};this.updateHistory=function(a){h.history=CTATExampleTracerSkill.updateHistoryStatic(a,h.history);return h.history};this.changeOpportunityCount=function(a){h.opportunityCount+=a;return h.opportunityCount};this.getTransactionNumber=function(){return l};this.getSkillBarString=function(a){var d=this.getSkillName(),d=d+this.getSkillBarDelimiter()+h.pKnown,d=d+this.getSkillBarDelimiter()+(this.hasReachedMastery()?
"1":"0");!0===a&&(d=d+this.getSkillBarDelimiter()+this.getLabel());return d.toString()};this.getSkillBarDelimiter=function(){return m};this.toXML=function(a){var d;d=""+(' name="'+CTATExampleTracerSkill.getName(h.skillName)+'"');d+=' category="'+h.getCategory()+'"';d+=' label="'+h.getLabel()+'"';d+=' description="'+h.getDescription()+'"';d+=' pKnown="'+Number(h.pKnown).toString()+'"';d+=' pLearn="'+Number(h.pLearn).toString()+'"';d+=' pGuess="'+Number(h.pGuess).toString()+'"';d+=' pSlip="'+Number(h.pSlip).toString()+
'"';d+=' history="'+h.history+'"';d+=' opportunityCount="'+h.opportunityCount+'"';return a?"&lt;Skill"+d+" /&gt;":"<Skill"+d+" />"};this.getPKnown=function(){return h.pKnown};this.getPLearn=function(){return h.pLearn};this.getPGuess=function(){return h.pGuess};this.getPSlip=function(){return h.pSlip};this.getHistory=function(){return h.history};this.getOpportunityCount=function(){return h.opportunityCount};this.hasReachedMastery=function(){return null===h.pKnown||"undefined"===typeof h.pKnown?!1:
h.pKnown>=h.masteryThreshold};this.getLabel=function(){return!h.label||1>h.label.length?CTATExampleTracerSkill.getName(h.skillName):h.label};this.getDescription=function(){return!h.description||1>h.description.length?h.skillName:h.description};this.setVersion=function(a){null!==a&&"undefined"!==typeof a&&0<a.length&&(m=CTATExampleTracerSkill.versionToSkillBarDelimiter(a))};this.setLabel=function(a){h.label=a};this.setDescription=function(a){h.description=a};CTATExampleTracerSkill.makeStepID=function(a,
d){for(var b="",e=0,c=a;2>e++;c=d)if(!(null===c||"undefined"===typeof c||1>c.length)){for(var f=!1,h=0;h<c.length;h++)if(null!==c[h]&&"undefined"!==typeof c[h]){var g=c[h].toString();1>g.length||c===a&&("hint".toString().toUpperCase()===g.toString().toUpperCase()||"help".toString().toUpperCase()===g.toString().toUpperCase())||c===d&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===g.toString().toUpperCase()||(b=b+(f?",":"[")+g,f=!0)}!0===f&&(b+="]")}return b.toString()};CTATExampleTracerSkill.updateHistoryStatic=
function(a,d){var b,e=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;b=d<<1|(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return b&e?b^e:b};CTATExampleTracerSkill.updatePKnownStatic=function(a,d,b,e,c){var f=0;if(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())a=+(b*(1-e)),f=+(a/(a+ +(d*(1-b))));else if(a.toString().toUpperCase()===CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||a.toString().toUpperCase()===
CTATExampleTracerSkill.HINT.toString().toUpperCase())a=+(b*e),f=+(a/(a+ +((1-b)*(1-d))));return+(f+c*(1-f))};CTATExampleTracerSkill.getName=function(a){var d=a.indexOf(" ");return 0>d?a:a.substring(0,d)};CTATExampleTracerSkill.versionToSkillBarDelimiter=function(a){return null===a||"undefined"===typeof a?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(a,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10}};
CTATExampleTracerSkill.fromJSON=function(c){if(!c)return null;var g=new CTATExampleTracerSkill("",""),f;for(f in c)c.hasOwnProperty(f)&&"function"!=typeof c[f]&&(g[f]=c[f]);return g};Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});
Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var c="",g="",f="tutor",e="",b="",a=[],d=[],h="notstarted";this.setState=function(a){h=a};this.getState=function(){return h};this.setLabel=function(a){c=a};this.getLabel=function(){return c};this.setDescription=function(a){g=a};this.getDescription=function(){return g};this.setTutorFlag=function(a){f=a};this.getTutorFlag=function(){return f};this.setProblemFile=function(a){e=a};this.getProblemFile=function(){return e};this.setStudentInterface=
function(a){b=a};this.getStudentInterface=function(){return b};this.addSkillOpps=function(b){a.push(b);d.push(new CTATExampleTracerSkill(b.category,b.name))};this.getSkillOpps=function(){return a};this.getSkills=function(){return d}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;CTATProblem.prototype.toString=function(){return this.getProblemFile()+" on "+this.getStudentInterface()};var CTATProblemSet=function(){CTATBase.call(this,"CTATProblemSet","problemset");var c=this,g=[];this.addProblem=function(c){g.push(c)};this.getProblems=function(){return g};this.getProblemSize=function(){return g.length};this.getFirstProblem=function(){c.ctatdebug("getFirstProblem () problems.length "+g.length);return 0==g.length?null:g[0]}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var c=this,g=new CTATXML,f="",e="",b="",a=new CTATProblemSet,d=[a],h={};this.init=function(a){c.ctatdebug("init ()");if(null==a)c.ctatdebug("Error: document root to be parsed is null.");else{var d=g.getElementName(a);c.ctatdebug("Root name: "+d);if(!/Package/i.test(d))return a=f.substring(f.lastIndexOf("/")+1),c.addProblem(f,b,a,a,a);a=g.getElementChildren(a);for(d=0;d<a.length;d++){var e=a[d],l=g.getElementName(e);c.ctatdebug("Examining element: "+
g.getElementName(e));switch(l){case "Problems":c.processProblemsElement(e);break;case "ProblemSets":c.processProblemSetsElement(e);break;case "Assets":h=c.processAssetsElement(e,h)}}}};this.processProblemsElement=function(a){a=g.getElementChildren(a);c.ctatdebug("CTATPackage.processProblemsElement ... nChildren="+a.length);for(var d=[],b=0;b<a.length;b++){var e=a[b],f=g.getElementAttr(e,"problem_file"),l=g.getElementAttr(e,"student_interface"),w=g.getElementAttr(e,"name"),q=g.getElementAttr(e,"label"),
y=g.getElementAttr(e,"description");h[f]=f;h[l]=l;c.ctatdebug("Problem ["+b+"] desc: "+y+", ui: "+l+", brd: "+f);f=c.addProblem(f,l,w,q,y);f.setTutorFlag(g.getElementAttr(e,"tutor_flag"));e=g.getElementChildren(e);for(l=0;l<e.length;l++)if("Skills"==g.getElementName(e[l]))for(w=g.getElementChildren(e[l]),q=0;q<w.length;q++){var y=w[q],z=0;f.addSkillOpps({name:g.getElementAttr(y,"name"),category:g.getElementAttr(y,"category"),opportunities:Number.isNaN(z=Number.parseInt(g.getElementAttr(y,"occurrences")),
10)?0:z})}d.push(f)}console.log("CTATPackage.processProblemsElement result",d);return d};this.processProblemSetsElement=function(a){a=g.getElementChildren(a);c.ctatdebug("CTATPackage.processProblemSetsElement ... nChildren="+a.length);for(var d=0;d<a.length;d++);return[]};this.processAssetsElement=function(a,d){var b=g.getElementChildren(a);c.ctatdebug("CTATPackage.processAssetsElement ... nChildren="+b.length);for(var e=0;e<b.length;e++){var f=b[e],h;"Asset"==g.getElementName(f)&&"undefined"!=d[h=
g.getElementAttr(f,"name")]&&(d[h]=g.getElementAttr(f,"asset_locator"))}return d};this.addProblem=function(a,d,b,e,f){var h=new CTATProblem;h.setProblemFile(a);h.setStudentInterface(d);h.setName(b?b:a);h.setLabel(e?e:a);h.setDescription(f?f:a);c.ctatdebug("Adding problem ...");c.getProblemSets()[0].addProblem(h);return h};this.getRelativePath=function(a,d){return d?CTATPackage.makeRelativePath(h[a],h[d]):h[a]};this.setURLPrefix=function(a){e=a};this.getURLPrefix=function(){return e};this.setPackageURL=
function(a){f=a};this.getPackageURL=function(){return f};this.setDefaultStudentInterface=function(a){b=a};this.getDefaultStudentInterface=function(){return b};this.getProblems=function(){return a};this.getProblemSets=function(){return d}};CTATPackage.prototype=Object.create(CTATBase.prototype);CTATPackage.prototype.constructor=CTATPackage;
CTATPackage.makeRelativePath=function(c,g){if(!g)return c;if(!c)return g;for(var f=String(c).split("/"),e=String(g).split("/"),b=0,a=0,d="";b<f.length&&a<e.length&&f[b]==e[a];)a=++b;for(;b++<f.length-1;)d+="../";for(;a<e.length-1;)d=d+e[a++]+"/";return d+e[a]};var CTATConnectionBase=function(c,g){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var f=-1,e="",b="http";this.setURL=function(a){e=a};this.getURL=function(){return e};this.setID=function(a){f=a};this.getID=function(){return f};this.setSocketType=function(a){b=a};this.getSocketType=function(){return b}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(c){function g(){d.ctatdebug("init ()");var a=flashVars?flashVars.getRawFlashVars():f?f:{},a=a.session_id?a.session_id:"dummySession";if(null!==e){"dummySession"==a&&d.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{e.setRequestHeader("Content-type",b.contentType),e.setRequestHeader("ctatsession",a)}catch(m){alert("HTTP object creation error: "+m.message)}}else"undefined"==typeof $?alert("Internal error: http object is null right after creation"):
b.headers.ctatsession=a;d.ctatdebug("init () done")}CTATConnectionBase.call(this,"CTATConnection");var f=c,e=null,b={contentType:"text/plain",data:null,processData:!1,method:"POST",mimeType:"text/html",headers:{}},a=!1,d=this,h=null;d.setSocketType("http");this.setContentType=function(a){b.contentType=a};this.getContentType=function(){return b.contentType};this.setConsumed=function(b){a=b;d.ctatdebug("consumed: "+a)};this.getConsumed=function(){d.ctatdebug("consumed: "+a);return a};this.assignReceiveFunction=
function(a){h=a;e&&"undefined"!=typeof e.onreadystatechange&&(e.onreadystatechange=a)};this.assignFailFunction=function(a){b.error=a;e&&"function"==typeof e.error&&e.error(a)};this.setData=function(a){b.data=a};this.getData=function(){return b.data};this.getHTTPObject=function(){return e};this.getMethod=function(){return b.method};this.setMethod=function(a){b.method=a};this.send=function(){d.ctatdebug("send ()");var a=d.getHTTPObject(),c=function(){d.ctatdebug("Networking error!")};a&&(a.onerror=
c);try{a&&a.open(d.getMethod(),d.getURL(),!0)}catch(n){d.ctatdebug("Error in newConnection.httpObject.open: "+n.message);return}g();try{"undefined"!=typeof $?e=a=$.ajax(d.getURL(),b).done(h).fail(c):b.data?a.send(b.data):a.send()}catch(n){this.ctatdebug("Error in newConnection.httpObject.send: "+n.message)}};this.then=function(a,b){var c=e&&"function"==typeof e.then;d.ctatdebug("CTATConnection.then() supported "+c+", done & fail:\n  "+a+",\n  "+b);return c?e.then(a,b):Promise.resolve("CTATConnection.then() not supported").then(a,
b)};d.ctatdebug("createHTTPObject ()");e=new XMLHttpRequest;if("undefined"!=typeof $)e=null;else if(window.XMLHttpRequest)d.ctatdebug("Creating regular XMLHttpRequest ..."),e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/html");else if(d.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){d.ctatdebug("Detected window.ActiveXObject ...");try{d.ctatdebug("Creating Msxml2.XMLHTTP ..."),e=new ActiveXObject("Msxml2.XMLHTTP")}catch(l){try{d.ctatdebug("Creating Microsoft.XMLHTTP ..."),
e=new ActiveXObject("Microsoft.XMLHTTP")}catch(m){alert("Error: Unable to create HTTP Request Object: "+m.message)}}}else alert("Internal error: an HTTP connection object could not be created")};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var c=this,g={},f=null,e=null,b=null,a=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",
log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"none",problem_state_status:"empty",question_file:"none",refresh_session_url:"none",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"none",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",student_interface:"none",student_problem_id:"none",
study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(a){c.ctatdebug("assignRawFlashVars() raw['session_id'] "+c.raw.session_id+", aData['session_id'] "+a.session_id);c.raw=a;c.preParse()};this.getRawFlashVars=
function(){return c.raw};this.getSingleParameterValues=function(a){var d=[];if(!a)return d;var b=c.getRawFlashVars(),e;for(e in a){var f=a[e];b[f]&&"none"!=b[f]&&d.push(b[f])}return d};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(a){return 0<=a.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(a,b){var d={},e=0,f=0;if(a)for(var h in a)d[h]=a[h],e++;c.ctatdebug("generateDefaultConfiguration() nDefaults "+e+", result['session_id'] "+
d.session_id);if("undefined"!=typeof b&&null!=b)for(h in b)d[h]=b[h],f++;c.ctatdebug("generateDefaultConfiguration() nLocalVars "+f);f=e=null;if(window&&window.frameElement&&(f=window.frameElement.getAttribute("data-params"))){e=jQuery.parseJSON(f);console.log("setting data params from iframe attr");for(var g in e)d[g]=CTATGlobals.EncodedParams[g]?decodeURIComponent(e[g].replace(/\+/g,"%20")):e[g],console.log("set "+g+" to "+d[g])}if(null===e)for(g=$('object param[name="flashvars"]'),c.ctatdebug("generateDefaultConfiguration() objs "+
g),e=0;e<g.length;++e)if(f=$(g[e]).attr("value"),c.ctatdebug("generateDefaultConfiguration() fVarsAsString "+f),f&&(f=parseQueryStringArgs(f))&&f.question_file)for(var u in f)d[u]=f[u];ctatdebug("tutorPrep ("+d+")");u={};if(null===d||void 0===d)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");g=location.search;ctatdebug("Query String: "+g);e="?"==g.charAt(0)?g.substring(1):g;g={};if(e)for(e=e.split("&"),f=0;f<e.length;f++){h=e[f].split("=");ctatdebug("Setting flashvar "+
h[0]+", to: "+decodeURIComponent(h[1].replace(/\+/g," ")));g[decodeURIComponent(h[0])]="";for(var w=1;w<h.length;w++)g[decodeURIComponent(h[0])]+=(1<w?"=":"")+decodeURIComponent(h[w].replace(/\+/g," "));ctatdebug("Decoded args: "+g[decodeURIComponent(h[0])])}null!==g&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),u=g);g=!1;for(var q in u)if(u.hasOwnProperty(q))switch(ctatdebug("Processing external FlashVar "+q+"("+u[q]+")"),q){case "GENERATED":"on"==u[q]&&(d.session_id=CTATGuid.guid(),
g=!0);break;case "BRD":d.question_file=u[q];break;case "BRMODE":d.BehaviorRecorderMode=u[q];break;case "PROBLEM":d.problem_name=u[q];break;case "DATASET":d.dataset_name=u[q];break;case "LEVEL1":d.dataset_level_name1=u[q];break;case "TYPE1":d.dataset_level_type1=u[q];break;case "LEVEL2":d.dataset_level_name2=u[q];break;case "TYPE2":d.dataset_level_type2=u[q];break;case "LEVEL3":d.dataset_level_name3=u[q];break;case "TYPE3":d.dataset_level_type3=u[q];break;case "LEVEL4":d.dataset_level_name4=u[q];break;
case "TYPE4":d.dataset_level_type4=u[q];break;case "USER":d.user_guid=u[q];break;case "SESSION":!1===g&&(d.session_id=u[q]);break;case "SOURCE":d.source_id=u[q];break;case "LOGTYPE":d.Logging=u[q];break;case "PORT":d.remoteSocketPort=u[q];break;case "REMOTEURL":d.remoteSocketURL=u[q];break;case "DISKDIR":d.log_to_disk_directory=u[q];break;case "log_service_url":d.log_service_url=u[q];break;case "URL":d.log_service_url=u[q];break;case "LOGURL":d.log_service_url=u[q];break;case "CONNECTION":d.tutoring_service_communication=
u[q];break;case "SUI":d.sui=u[q];break;case "VAR1":d.var1=u[q];break;case "VAL1":d.val1=u[q];break;case "VAR2":d.var2=u[q];break;case "VAL2":d.val2=u[q];break;case "VAR3":d.var3=u[q];break;case "VAL3":d.val3=u[q];break;case "VAR4":d.var4=u[q];break;case "VAL4":d.val4=u[q];break;case "SLOG":case "SessionLog":d.SessionLog=u[q];break;case "KEYBOARDGROUP":"Disabled"==u[q]&&(d.keyboard="disabled");"Auto"==u[q]&&(d.keyboard="auto");"On"==u[q]&&(d.keyboard="on");break;default:d[q]=u[q]}}return d};this.getCustomFields=
function(){return g};this.setTimeZone=function(a){c.ctatdebug("setTimeZone ("+a+")");null==a||""==a||void 0==a?(a=jstz.determine(),c.ctatdebug("Assigning detected timezone: "+a.name()),a=a.name()):(50<a.length&&(a=a.substr(0,50)),3!=a.length&&4!=a.length||c.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=c.raw&&(c.raw.timezone=a)};this.getTimeZone=function(){return null!=c.raw&&c.raw.timezone?c.raw.timezone:"UTC"};this.listWithAmpersands=
function(){var a="",b;for(b in c.raw)var e=b+"="+encodeURIComponent(c.raw[b]),a=""!=a?a+"&"+e:e;c.ctatdebug("CTATConfiguration.listWithAmpersands() result "+a.substring(0,25)+"...");return a};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var a in c.raw)ctatdebug("["+a+"]: "+c.raw[a])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==c.raw.dataset_name||void 0==c.raw.dataset_name)c.raw.dataset_name="DefaultDataset";var a=0,b;for(b in c.raw){if("VAR"==b||"var"==b)g[b]=
c.raw[b];a++}c.ctatdebug("preParse() nRaw "+a);a=0;for(b=!0;1==b;){b=!1;var e="custom_field_name"+(a+1),f="custom_field_value"+(a+1);c.ctatdebug("Trying : "+c.raw[e]+","+c.raw[f]);null!=c.raw[e]&&(c.ctatdebug("Adding: "+e+","+c.raw[f]),g[c.raw[e]]=c.raw[f],b=!0,a++)}};this.getDatasetNames=function(){c.ctatdebug("getDatasetNames ()");if(null!=f)return f;f={};f=[];for(var a=0,b=!0;1==b;){var b=!1,e="dataset_level_name"+(a+1);null!=c.raw[e]&&(c.ctatdebug("Adding: "+e+","+c.raw[e]),f[a]=c.raw[e],b=!0,
a++)}return f};this.getDatasetTypes=function(){c.ctatdebug("getDatasetTypes ()");if(null!=e)return e;e=[];for(var a=0,b=!0;1==b;){var b=!1,f="dataset_level_type"+(a+1);null!=c.raw[f]&&(c.ctatdebug("Adding: "+f+","+c.raw[f]),e[a]=c.raw[f],b=!0,a++)}return e};this.getConditionNames=function(){var a=[],b=0;void 0!=c.raw.study_condition_name&&""!=c.raw.study_condition_name&&(a.push(c.raw.study_condition_name),b++);for(var e=0,f=!0;1==f;){var f=!1,g="study_condition_name"+(e+1);null!=c.raw[g]&&(c.ctatdebug("Adding: "+
g+","+c.raw[g]),a[e+b]=c.raw[g],f=!0,e++)}return a};this.getConditionTypes=function(){b=[];var a=0;void 0!=c.raw.study_condition_type&&""!=c.raw.study_condition_type&&(b.push(c.raw.study_condition_type),a++);for(var e=0,f=!0;1==f;){var f=!1,g="study_condition_type"+(e+1);null!=c.raw[g]&&(c.ctatdebug("Adding: "+g+","+c.raw[g]),b[e+a]=c.raw[g],f=!0,e++)}return b};this.getConditionDescriptions=function(){c.ctatdebug("getConditionDescriptions ()");a=[];var d=0;c.raw.study_condition_description&&""!==
c.raw.study_condition_description&&(c.ctatdebug("Adding study_condition_description: "+c.raw.study_condition_description),a.push(c.raw.study_condition_description),d++);for(var b=0,e=!0;!0===e;){var e=!1,f="study_condition_description"+(b+1);null!=c.raw[f]&&(c.ctatdebug("Adding: "+f+","+c.raw[f]),a[b+d]=c.raw[f],e=!0,b++)}return a};this.get=function(a){return c.raw[a]};this.set=function(a,b){a&&(c.raw[a]=b)};this.setParams=function(a){if(a)for(var d in a)c.set(d,a[d])};this.isInstructorMode=function(){var a=
this.getRawFlashVars();return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=function(a,b){c.raw.previewMode=b};this.setCenterTutor=function(a,b){c.raw.centerTutor=b};this.setTutorWidth=function(a,b){c.raw.width=b};this.setTutorHeight=function(a,b){c.raw.height=b};this.setTutorDimensions=function(a,b,e){c.raw.width=b;c.raw.height=e};this.setTutorValue=
function(a,b,e){c.raw[b]=e};this.setCommunicationMode=function(a,b){c.raw.tutoring_service_communication=b};this.setRemoteSocketURL=function(a,b){c.raw.remoteSocketURL=b};this.setRemoteSocketPort=function(a,b){c.raw.remoteSocketPort=b}};CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(c,g){if(!CTATConfiguration.theConfObject){CTATConfiguration.theConfObject=new CTATConfiguration;var f=CTATConfiguration.theConfObject.generateDefaultConfiguration(CTATConfiguration.theConfObject.raw,c);CTATConfiguration.theConfObject.assignRawFlashVars(f);"none"==CTATConfiguration.theConfObject.get("session_id")&&CTATConfiguration.theConfObject.set("session_id",CTATGuid.guid());flashVars=CTATConfiguration.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}"Default"!=g&&"OLI"!=g||CTATConfiguration.theConfObject.setParams(c);return CTATConfiguration.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};
CTATConfiguration.get=function(c){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(c)};CTATConfiguration.set=function(c,g){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(c,g)};CTATConfiguration.getCustomFields=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getCustomFields()};
CTATConfiguration.setParams=function(c){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(c)};CTATConfiguration.getSingleParameterValues=function(c){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(c)};CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;
CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATWSConnection=function(c){CTATConnectionBase.call(this,"CTATWSConnection");var g="",f=!1,e=this,b=null,a=[],d=!1,h=0,l=0,m=null,n=null;e.setSocketType("ws");this.setConsumed=function(a){f=a;e.ctatdebug("consumed: "+f)};this.getConsumed=function(){e.ctatdebug("consumed: "+f);return f};this.assignReceiveFunction=function(a){m=a};this.assignCloseFunction=function(a){n=a};this.setData=function(a){g=a};this.getData=function(){return g};this.init=function(){ctatdebug("init ("+e.getURL()+"); websocket "+
b);null==b&&(b=new WebSocket(e.getURL()),b.addEventListener("open",function(e){ctatdebug("STATUS: open");d=!0;ctatdebug("Connection open, flushing outgoing queue ...");h=(new Date).getTime();if(0<a.length){for(e=0;e<a.length;e++)b.send(a[e]);a=[]}}),b.addEventListener("message",function(a){l=(new Date).getTime();ctatdebug("STATUS: message after "+(l-h)+" ms");ctatdebug("Received: "+a.data);m?m(a.data):ctatdebug("Error: no processing function provided")}),b.addEventListener("close",function(a){ctatdebug("STATUS: close; "+
(a?"code "+a.code+", reason "+a.reason:"no event"));d=!1;b.close(1E3,a?a.reason?a.reason:"received close code "+a.code:"no close event received");n&&n(a)}),b.addEventListener("error",function(a){ctatdebug("STATUS: error; "+(a?a.type:"no event"));d=!1;b.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");e.init();!1===d?(ctatdebug("Connection not ready yet, storing ..."),a.push(g)):(ctatdebug("Connection ready, sending data ..."),
h=(new Date).getTime(),b.send(g))};this.getWebSocket=function(){return b};this.close=function(a,e){d=!1;n=e||n;b.close(1E3,a||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(c){var g=this,f=[];this.addShape=function(e){f.push(e)};this.hideShape=function(e){for(var b=0;b<f.length;b++)if(f[b].getName()==e){f[b].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(e){for(var b=0;b<f.length;b++)if(f[b].getName()==e){f[b].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var e=0;e<f.length;e++)f[e].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var e=0;e<f.length;e++)f[e].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(e,b,a){for(var d=0;d<f.length;d++)if(f[d].getName()==e){f[d].modifyCanvasCSS("left",b+"px");f[d].modifyCanvasCSS("top",a+"px");break}};this.moveComponent=function(e,b){for(var a=0;a<f.length;a++)f[a].modifyCanvasCSS("left",e+"px"),f[a].modifyCanvasCSS("top",b+"px")};this.removeShape=function(e){for(var b=0,a=0;a<f.length;a++)if(f[a].getName()==e){b=a;break}f[b].detatchCanvas();f.splice(b,1)};this.removeComponent=function(){for(;0<f.length;)g.removeShape(f[0].getName())}};var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function c(){warnScrim=!1;q.scrimDown()}function g(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&q.scrimDownForced(),q.ctatdebug("errScrimUp ("+a+")"),!0===errorScrim?!0===d&&(d=!1,getSafeElementById(ctatcontainer).removeChild(u)):!0===warnScrim&&(d=!0),q.scrimUp(a))}function f(a,d){q.ctatdebug("makeHTMLButton ()");var b=document.createElement("input");b.type="button";
b.value=d;a?(q.ctatdebug("clickHandle!=null"),b.onclick=a):(q.ctatdebug("clickHandle==null"),b.onclick=q.defaultClickHandler);b.id=d;b.setAttribute("class","scrimButton");return b}CTATBase.call(this,"CTATScrim","__undefined__");var e="",b=!1,a=!1,d=!1,h=null,l=null,m=new CTATCanvasComponent("CTAT Scrim"),n=[],p=null,r=null,u=null,w=null,q=this;this.scrimUp=function(g){if("google"!=CTATConfig.platform)if(q.ctatdebug("scrimUp ()"),g=CTATGlobals.languageManager.filterString(g),q.ctatdebug("Message: "+
g),!0===scrimIsUp?(e=!0===waitScrim?g:e+(" \n "+g),m.removeComponent(),q.removeHTMLElements()):(e=g,scrimIsUp=!0),q.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp),q.ctatdebug("drawScrim ()"),"google"==CTATConfig.platform)q.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel">CTAT Info Panel</h4><div id="scrimpanel" class="inhalt"><br>'+
e+"<br><br></div></div></div>"),!0===d&&(waitScrim=!1,u=f(c,"close"),$(u).appendTo("#scrimpanel")),!0===b&&(waitScrim=!1,p=f(h,"yes"),$(p).appendTo("#scrimpanel"),b=!1),!0===a&&(waitScrim=!1,r=f(l,"no"),$(r).appendTo("#scrimpanel"),a=!1),!0===waitScrim)){q.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");g=$('<div id="scrim_spin">');g.css("width","100%");g.css("position","relative");$("#scrimpanel").append(g);try{var n=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(n.el)}catch(B){(B instanceof
ReferenceError||B instanceof TypeError)&&q.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',B,typeof B)}}};this.waitScrimUp=function(){q.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&q.scrimDownForced(),waitScrim=!0,q.scrimUp(CTATGlobals.languageManager.getString("LOADING")),q.ctatdebug("return from waitScrimUp(): scrimIsUp "+
scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&q.scrimDownForced(),q.ctatdebug("nextProblemScrimUp ()"),q.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(e,c){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&q.scrimDownForced(),q.ctatdebug("OKScrimUp ("+e+","+c+")"),waitScrim=a=b=d=warnScrim=errorScrim=!1,q.scrimUp(e),w=f(c,"OK"),$(w).appendTo("#scrimpanel"))};this.confirmScrimUp=function(d,e,c){"google"!=CTATConfig.platform&&
(!0===scrimIsUp&&q.scrimDownForced(),q.ctatdebug("confirmScrimUp ("+d+","+e+","+c+")"),a=b=!0,l=c,h=e,q.scrimUp(d))};this.errorScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&q.scrimDownForced(),!1===authorTimeSet?(q.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),n.push("ERROR: "+a),errorScrim=!0):!1===inAuthorTime?q.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,g("ERROR: "+
a)))};this.warningScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&q.scrimDownForced(),!1===authorTimeSet?(q.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),n.push("WARNING: "+a),warnScrim=!0):!1===inAuthorTime?q.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(warnScrim=!0,g("WARNING: "+a)))};this.handleTSDisconnect=function(){connectionScrim=!0;q.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};
this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?q.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?q.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?q.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===connectionScrim?q.ctatdebug("The scrim is up for a connection issue leave it up!"):q.scrimDownForced())};this.scrimDownForced=function(){q.ctatdebug("enter scrimDownForced() scrimIsUp "+
scrimIsUp);$("#scrim").remove();m.removeComponent();q.removeHTMLElements();waitScrim=scrimIsUp=!1;e="";q.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){q.ctatdebug("defaultClickHandler ()");q.scrimDown()};this.setInAuthorTime=function(a){q.ctatdebug("setting inAuthorTime = "+a);authorTimeSet=!0;inAuthorTime=a;if(!a)warnScrim=errorScrim=!1,d&&null.removeChild(u);else if(errorScrim||warnScrim)for(var b in n)g(b)};this.getInAuthorTime=function(){return inAuthorTime}};
CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var CTAT=function(){};"undefined"!=typeof window&&null!=window&&(window.CTAT=CTAT);"undefined"!==typeof module&&(module.exports=CTAT);CTAT.ToolTutor={interfaceMessages:[],tutorMessages:[]};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(c){window.hasOwnProperty("interfaceObject")?window.interfaceObject=c:this._interface=c;return c}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(c){window.hasOwnProperty("tutorObject")?window.tutorObject=c:this._tutor=c;return c}});
CTAT.ToolTutor.registerTutor=function(c){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(c);if(this.tutor=c)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(c){ctatdebug("CTAT.ToolTutor.sendToInterface()\n  "+c);return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(c):commMessageHandler?commMessageHandler.processMessage(c):this.interfaceMessages.push(c)};
CTAT.ToolTutor.registerInterfaceMessageHandler=function(c){ctatdebug("CTAT.ToolTutor.registerInterfaceMessageHandler("+c+")");"string"===typeof c&&(c=document.getElementById(c));if(this.message_handler=c)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};CTAT.ToolTutor.registerInterface=function(c){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(c);this.registerInterfaceMessageHandler(c)};
CTAT.ToolTutor.sendToTutor=function(c){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(c):this.tutor?this.tutor.receiveFromInterface(c):this.tutorMessages.push(c)};
CTAT.ToolTutor.reboot=function(c){(c="undefined"!=typeof location&&location&&location.href?location.href:null)&&console.log("ToolTutor.reboot(), setting location to "+c);return c&&!CTATConfiguration.get("editorMode")?("function"==typeof setTimeout?setTimeout(location.replace.bind(location),600,c):location.replace(c),!0):!1};var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(c){return null===c||"undefined"===typeof c?!1:0===c.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(c){if(null===c||"undefined"===typeof c)return!1;c=c.toString().toLowerCase();return 0===c.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===c.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(c,g){this.ctatdebug("createInCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+g);f+=g.toXMLString(!1);return f+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(c,g){this.ctatdebug("createCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+g.toXMLString(!1);return f+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(c,g,f,e,b,a,d,h,l){d=void 0==d?c.length:d;h=void 0==h?1:h;g="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+(g?g:new CTATSAI("","","")).toXMLString();g+="<TutorAdvice>";for(var m=0;m<c.length;m++)g+="<value><![CDATA["+c[m]+"]]\x3e</value>";g=g+("</TutorAdvice><TotalHintsAvailable>"+d+"</TotalHintsAvailable><CurrentHintNumber>"+h+"</CurrentHintNumber>")+
("<Actor>"+f+"</Actor>")+this.fmtSkillBarVector(e);g+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";if(b||0===b)g+="<StepID>"+b+"</StepID>";g+="<transaction_id>"+a+"</transaction_id>";g+="<LogAsResult>true</LogAsResult>";g+=this.formatCustomFields(l);return g+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(c,g,f,e,b,a,d,h,l,m,n){this.ctatdebug("TMB.createAssociatedRulesMessageForAction(indicator "+c+", sai "+g+", actor "+f+", studentSAI "+e+",\n  skillBarVector "+b+", stepID "+a+", transactionID "+d+",\n  tutorAdvice "+h+", outOfOrder "+l+", traceOutcome "+n);c="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>"+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(c)?"Correct":"InCorrect")+
"</Indicator>");c+=(g?g:new CTATSAI("","","")).toXMLString();g=e.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");g=g.replace("</Selection>","</StudentSelection>").replace("</Action>","</StudentAction>").replace("</Input>","</StudentInput>");c=c+g+("<Actor>"+f+"</Actor>")+this.fmtSkillBarVector(b);c+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";c+="<StepID>"+a+"</StepID>";c+="<transaction_id>"+d+"</transaction_id>";
h&&(c+="<TutorAdvice><![CDATA["+h+"]]\x3e</TutorAdvice>");c+="<LogAsResult>true</LogAsResult>";c+="<end_of_transaction>"+(h?!1:!0)+"</end_of_transaction>";c+="undefined"!=typeof l&&l?"<OutOfOrder>true</OutOfOrder>":"";c+=n?"<"+CTATMsgType.TRACE_OUTCOME+">"+n+"</"+CTATMsgType.TRACE_OUTCOME+">":"";c+=this.formatCustomFields(m);return c+="</properties></message>"};
CTATTutorMessageBuilder.prototype.formatCustomFields=function(c){var g="";if(c)for(var f in c)c.hasOwnProperty(f)&&(g+="<custom_field><name>"+f+"</name><value>"+(null==c[f]?"":c[f].toString())+"</value></custom_field>");return g?"<custom_fields>"+g+"</custom_fields>":""};
CTATTutorMessageBuilder.prototype.isDoneStep=function(c,g){g[0]=!1;var f=c.getIndicator();if(!f)return!1;var e=c.getStudentSelection();e||(e=c.getProperty("tool_selection"));g[0]=CTATTutorMessageBuilder.isCorrect(indicator);var b="done"==e;this.ctatdebug("isDoneStep() indicatorObj "+f+", selectionObj "+e+", correct[0] "+g[0]+", result "+b);return b};
CTATTutorMessageBuilder.prototype.createHintMessage=function(c,g,f,e){f="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var b=0;b<c.length;b++)f+="<value><![CDATA["+c[b]+"]]\x3e</value>";f+="</HintsMessage>";g&&g.toXMLString&&(f+=g.toXMLString());return f+("<transaction_id>"+e+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(c,g){var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+c+"</ErrorType><Details>"+(g?g:"");return f+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(c,g){var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>"+("<SuccessMsg><![CDATA["+g+"]]\x3e</SuccessMsg>")+("<transaction_id>"+c+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(c,g){var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>"+("<BuggyMsg><![CDATA["+g+"]]\x3e</BuggyMsg>")+("<transaction_id>"+c+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(c){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+c+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(c,g){var f="<message><verb>SendNoteProperty</verb><properties><MessageType>"+c+"</MessageType>";if(g)for(var e in g)f+="<"+e+">"+g[e]+"</"+e+">";f+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+c+", "+g+") returns "+f);return f};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(c,g,f,e,b,a,d){c="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+c+"</caseInsensitive>")+("<unordered>"+g+"</unordered>")+("<lockWidget>"+f+"</lockWidget>");c+="<suppressStudentFeedback>"+e+"</suppressStudentFeedback>";c+="<highlightRightSelection>"+b+"</highlightRightSelection>";c+="<confirmDone>"+a+"</confirmDone>";c+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
c+=this.fmtSkillBarVector(d);return c+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(c){var g="";if(void 0!==c&&null!==c&&0<c.length){for(var g=g+"<Skills>",f=0;f<c.length;f++)g+="<value><![CDATA["+c[f]+"]]\x3e</value>";g+="</Skills>"}return g};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(c,g,f,e){c="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+f+"</HighlightMsgText>")+("<Selection><value>"+c+"</value></Selection>")+("<Action><value>"+g+"</value></Action>");c+="<transaction_id>"+e+"</transaction_id>";c+="<end_of_transaction>true</end_of_transaction>";return c+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTATLMS={identifier:null,initLMSConnection:function(){},closeLMSConnection:function(){},setValue:function(c,g){},getValue:function(c){return null},saveProblemState:function(c){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){var g=[],f;for(f in c)g.push(f+"="+encodeURIComponent(c[f]));$.post(CTATConfiguration.get("curriculum_service_url"),g.join("&"),null,"application/x-www-form-urlencoded")}},getProblemState:function(c){CTATConfiguration.get("restoreProblemUrl")?
$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(g){c(g)}).fail(function(g,f,e){c(null);g=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",f+" "+e);CTAT.ToolTutor.sendToInterface(g,!0)}):c(null)},gradeStudent:function(c,g){},logEvent:function(c){},processProblemSummary:function(c){},is:{},init:{}};
CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(c){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(c){return c(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){}};CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var c=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==c){window.parent.doLMSInitialize();var g=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",g);"not attempted"==g&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==g&&CTATConfiguration.set("problem_state_status","completed");"failed"==g&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==g&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");c=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(c){};CTATLMS.saveProblemState=function(c){return CTATLMS.setValue("cmi.suspend_data",c.problem_state)};CTATLMS.getProblemState=function(c){var f=CTATLMS.getValue("cmi.suspend_data");if(!f&&window.parent&&"function"==
typeof window.parent.doLMSGetLastError){var e=window.parent.doLMSGetLastError();if(0!=e)return console.log("Empty result with error "+e+" from LMS.getValue('cmi.suspend_data'):",window.parent.doLMSGetErrorString?window.parent.doLMSGetErrorString(e):""),c(null)}return c(f)};CTATLMS.gradeStudent=function(c,f){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((c/f).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=
function(c){["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(c){var e=this.getElementsByTagName(c);CTATLMS.setValue(c,$("<div>").html(e[0].innerHTML).text())},c);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var c=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(c,f){};CTATLMS.getValue=function(c){return null};CTATLMS.saveProblemState=function(g){parent.postMessage({action:"save_problem_state",input:window.btoa(g.problem_state)},c)};CTATLMS.getProblemState=function(c){return c(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(g,f){parent.postMessage({action:"grade",input:{value:g,max:f}},c)};CTATLMS.logEvent=function(g){parent.postMessage({action:"log",input:g},c)};CTATLMS.processProblemSummary=function(c){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.ToolsListener=function(){return window.location.search&&/[?&;]mode=ctatAsListener/i.test(window.location.search)};
CTATLMS.is.OLI=function(){return window.frameElement&&window.frameElement.getAttribute("data-superactivityserver")||"undefined"!=typeof CTATTarget&&"OLI"==CTATTarget};CTATLMS.is.TutorShop=function(){return window.frameElement&&/"LMS":\s*"TutorShop"/i.test(window.frameElement.getAttribute("data-params"))};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(c,g){};CTATLMS.getValue=function(c){return null};CTATLMS.logEvent=function(c){};CTATLMS.saveProblemState=function(c){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){c.session_id=c.session_id?c.session_id:"dummySession";var g=[],f;for(f in c)g.push(f+"="+encodeURIComponent(c[f]));
$.post(CTATConfiguration.get("curriculum_service_url"),g.join("&"),null,"application/x-www-form-urlencoded")}};CTATLMS.getProblemState=function(c){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(g){c(g)}).fail(function(g,f,e){c(null);g=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",f+" "+e);CTAT.ToolTutor.sendToInterface(g,!0)}):c(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=
function(){}};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var evt=new Event("ctatlms");console.log("CTATLMS.js dispatch send evt",evt);parent.dispatchEvent(evt);useDebuggingBasic=!0;console.log("CTATLMS.js dispatch return from evt",evt);var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(c,g){CTATBase.call(this,"CTATCommLibrary",c);var f=authenticityToken="",e=0,b=[],a=null,d=c?c:null,h=null==g?!0:g,l=!0,m=null,n=this,p="http",r="ERROR_CONN_TS",u="";this.teamMembers={};this.setUseCommSettings=function(a){l=a};this.getUseCommSettings=function(){return l};this.setConnectionRefusedMessage=function(a){r=a};this.sendTutorReady=function(a){var d=CTATConfiguration.get("collaborators"),b=CTATConfiguration.get("user_guid"),
e=CTATCommShell.commShell.getGotProblemRestoreEnd();console.log("sendTutorReady collaborators",d,"otm",a,"teamMembers",this.teamMembers,"gotProblemRestoreEnd",e);if(a&&a[b]&&-1!=a[b].subscribed||!e)return a;d=this.teamMembers[b]||{};d.subscribed||(d.subscribed=Date.now(),this.teamMembers[b]=d);for(var c in this.teamMembers)if(-1==this.teamMembers[c].subscribed)return a;parent.postMessage({command:"tutorready",username:CTATConfiguration.get("user_guid"),teamMembers:this.teamMembers},"*");return a};
this.interpretCollab=function(a){ctatdebug("Interpret collab:",a.command,a);var d=null;if("tutorready"==a.command&&a.username!=CTATConfiguration.get("user_guid")){var b=CTATConfiguration.get("collaborators"),e=0,c=(b||"").split(",");for(console.log("interpretCollab",b,"teamMembers",this.teamMembers,"cNames",c);e<c.length;++e){b=this.teamMembers[c[e]]||{};if(-1==b.subscribed){console.log("collaborator quit:",c[e],b,new Date);break}a.username==c[e]&&(b.subscribed=Date.now(),this.teamMembers[c[e]]=b);
if(!b.subscribed){console.log("collaborator still missing:",c[e],b,new Date);break}}this.sendTutorReady(a.teamMembers);e>=c.length&&CTATScrim.scrim.scrimDown()}else"message"==a.command?a.user_guid!=CTATConfiguration.get("user_guid")?d=a.data:ctatdebug("Own message echoed "+a.data):"unsubscribed"==a.command?(e=this.teamMembers[a.from||","])&&-1!=e.subscribed&&(e.subscribed=-1,e=CTATGlobals.languageManager.filterString("YOUR_COLLABORATOR")+(a.from||"")+" ","function"==typeof exitTutor?(e+=CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_OK"),
console.log("scrimUp("+e+")",new Date,exitTutor),CTATScrim.scrim.OKScrimUp(e,exitTutor)):(e+=CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_X"),console.log("scrimUp("+e+")",new Date,typeof exitTutor),CTATScrim.scrim.scrimUp(e))):"subscribed"==a.command&&(a.team_members?console.log("subscribed from "+a.from+": teamMembers",this.teamMembers,"data.team_members",a.team_members):console.log("interpretCollab: team_members property missing",a));"function"==typeof document.dispatchEvent&&
document.dispatchEvent(new CustomEvent("receiveFromCollaborator",{detail:a}));return d};this.setSocketType=function(a){p=a;if(n.hasWebSocket()||n.hasPostMessage())$(window).on("message",function(a){if(a.originalEvent.origin===window.location.origin&&(a=a.originalEvent?a.originalEvent.data:null,console.log("message from "+a.from+":",a),a))if(d){if(a=n.interpretCollab(a))d.processMessage(a),n.hasPostMessage()||CTAT.ToolTutor.sendToTutor(a)}else console.log("No http handler defined for websocket listener.")})};
this.hasSecureSocket=function(){return/https/i.test(p)||/wss/i.test(p)};this.hasJavaScriptConnection=function(){return/javascript/i.test(p)};this.hasWebSocket=function(){return/websocket/i.test(p)};this.hasPostMessage=function(){return/postmessage/i.test(p)};this.assignHandler=function(a){d=a};this.assignMessageListener=function(a){m=a};this.encodeVariables=function(a){n.ctatdebug("encodeVariables ()");for(var d="",b=0;b<a.length;b++){var e=a[b];0<b&&(d+="&");d+=e.name;d+="=";d+=encodeURIComponent(e.value)}return d};
this.encodeVariablesOLI=function(a){n.ctatdebug("encodeVariablesOLI ()");for(var d="",b=0;b<a.length;b++){var e=a[b];0<b&&(d+="&");d+=e.name;d+="=";d+=encodeURIComponent(e.value)}return d};this.createConnection=function(d,c,f){n.ctatdebug("createConnection () canBeWebSocket "+f);f="undefined"==typeof f?!0:!1!==f;if(!c)return new CTATConnection(d);if(f&&n.hasWebSocket())return f=this.findWSConnection(c),f||(f=new CTATWSConnection(d),f.setID(e),f.setURL(c),f.assignReceiveFunction(this.processWSReply),
f.assignCloseFunction(this.processWSClose),b.push(f),e++),f;f=new CTATConnection(d);f.setID(e);f.setURL(c);f.assignReceiveFunction(n.processReply);b.push(f);e++;return a=f};this.findWSConnection=function(a){ctatdebug("findWSConnection( "+a+" )");a=n.editSocketURLForHTTPS(a);for(var d=0;d<b.length;d++){var e=b[d];ctatdebug("checking: socketType = "+e.getSocketType()+" URL = "+e.getURL());if("ws"==e.getSocketType()&&e.getURL()==a)return e}return null};this.startBundle=function(){n.ctatdebug("startBundle ()");
!1===useBundling?this.ctatdebug("Not using bundling, bump"):(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',inBundle=!0)};this.endBundle=function(){n.ctatdebug("endBundle ()");!1===useBundling?n.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+="</messages></properties></message>",n.sendXML(bundleFormatter))};this.setFixedURL=function(a){f=a};this.getURL=function(){n.ctatdebug("getURL ()");if(""!==
f)return n.ctatdebug("Returning fixedURL: "+f),f;var a=flashVars.getRawFlashVars(),d="http://";n.hasSecureSocket()&&(d="https://");d=d+a.remoteSocketURL+":"+a.remoteSocketPort;a.remoteSocketURL&&-1!=a.remoteSocketURL.indexOf("http")&&(d=a.remoteSocketURL+":"+a.remoteSocketPort);return d};this.sendXML=function(a,b){n.ctatdebug("Sending: "+a);n.ctatdebug("sendXML ("+a+")");d.updateLastActionTimestamp&&d.updateLastActionTimestamp();if(!0===useBundling&&!0===inBundle)n.ctatdebug("Bundling ..."),bundleFormatter+=
a;else{bundleFormatter=a;flashVars.getRawFlashVars();var e=this.getURL(),c=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);n.getUseCommSettings()&&n.hasJavaScriptConnection()?(n.sendToToolsOrCollaborators(e,c,b),CTATConfiguration.get("noLocalTrace")||CTAT.ToolTutor.sendToTutor(c)):n.send_post(e,c)}};this.sendToToolsOrCollaborators=function(a,d,b){return!n.hasWebSocket()||"ctatAsListener"!=CTATConfiguration.get("mode")&&"undefined"!=
typeof b&&!1===b?!1:(this.send_post(a,d),!0)};this.sendXMLNoBundle=function(a){n.ctatdebug("sendXMLNoBundle ("+a+")");bundleFormatter=a;d.updateLastActionTimestamp&&d.updateLastActionTimestamp();var b=this.getURL(),e=a;-1==a.indexOf("<?xml")&&(e='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();n.getUseCommSettings()&&n.hasJavaScriptConnection()?(n.sendToToolsOrCollaborators(b,e),CTAT.ToolTutor.sendToTutor(e)):this.send_post(b,e)};this.sendXMLURL=function(a,b,e){ctatdebug("sendXMLURL ("+
b+", "+e+")");var c=a;-1==a.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();n.ctatdebug("Sending: "+c);d.updateLastActionTimestamp&&d.updateLastActionTimestamp();this.getUseCommSettings()&&n.hasJavaScriptConnection()?(n.sendToToolsOrCollaborators(b,c),e||CTAT.ToolTutor.sendToTutor(c)):this.send_post(b,c)};this.send_post_variables=function(a,b){n.ctatdebug("send_post_variables ("+a+")");flashVars.getRawFlashVars();var e;e=!1===useOLIEncoding?this.encodeVariables(b):
this.encodeVariablesOLI(b);this.ctatdebug("Sending: "+e);d.updateLastActionTimestamp&&d.updateLastActionTimestamp();if(!0===CTATGlobals.CommDisabled)n.ctatdebug("Communications globally disabled, please check your settings");else{var c=n.createConnection(CTATConfiguration.getRawFlashVars(),a,!1);c.setContentType("application/x-www-form-urlencoded");n.ctatdebug("CTATCommLibrary.send_post_variables() data to send:\n  "+e);null!==m&&m.processOutgoing(e);c.setURL(a);c.setData(e);c.assignReceiveFunction(n.processReply);
c.send()}};this.formPostMessage=function(a){return{command:"message",user_guid:CTATConfiguration.get("user_guid"),data:a}};this.send_post=function(a,d){var b;ctatdebug("send_post ("+a+")");if(!0===CTATGlobals.CommDisabled)n.ctatdebug("Communications globally disabled, please check your settings");else{ctatdebug("Outgoing on wire, "+(n.hasPostMessage()?"to post":"no post")+"; data "+d);b=flashVars.getRawFlashVars();var e=a;if(n.hasPostMessage())b=n.formPostMessage(d),b.dest="sendToTutor",parent.postMessage(b,
parent.location.origin);else{if(n.hasWebSocket()){if(CTATCommShell.commShell.hasTutorShopCable()){parent.postMessage(n.formPostMessage(d),"*");return}a&&(ctatdebug("opening websocket connection: url "+a),e=a.replace(/https?:/,"ws:"),e=n.editSocketURLForHTTPS(e),ctatdebug("opening websocket connection to "+e))}b=n.createConnection(b,e);b.setData(d);null!==m&&m.processOutgoing(d);b.send()}}};this.processReply=function(a,e,c){n.ctatdebug("processReply ("+b.length+","+a+", ...)");"undefined"==typeof c&&
"function"==typeof this.getHTTPObject&&this.getHTTPObject();e=0;a=[];var f;for(f=0;f<b.length;f++){var g=b[f];if(g&&"function"==typeof g.getHTTPObject){var l=g.getHTTPObject();n.ctatdebug("Testing connection entry["+f+"]: readyState & status: "+(l?l.readyState+" & "+l.status:"null")+", consumed: "+g.getConsumed());l&&(4==l.readyState&&!1===g.getConsumed()?(n.ctatdebug("Investigating request response: "+e+" -> "+l.status+", for: "+g.getURL()),c=!1,0===l.status&&(c=!0,n.ctatdebug("Received message (status 0): ("+
l.responseText+"), status: "+l.status),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(r))),408==l.status&&(c=!0,n.ctatdebug("Received message (status 408): "+l.responseText),h&&CTATScrim.scrim.scrimDown()),502==l.status&&(c=!0,n.ctatdebug("Received message (status 502): "+l.responseText),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),200==l.status?(c=!0,n.ctatdebug("Processing 200 response ..."),null!==d?(a.push(l.responseText),null!==
m&&m.processIncoming(l.responseText)):n.ctatdebug("Error: httphandler is null, can't process response!")):d&&d.processError&&(c=!0,n.ctatdebug("Processing non-200 response, status "+l.status),d.processError(l.status,l.responseText)),!1===c&&n.ctatdebug("Error: status not handled for: "+l.status),n.ctatdebug("Marking connection as consumed ..."),g.setConsumed(!0)):(0===l.readyState&&n.ctatdebug("Received message (status 0, request not initialized)"),1===l.readyState&&n.ctatdebug("Received message (status 1, server connection established)"),
2===l.readyState&&n.ctatdebug("Received message (status 2, request received)"),3===l.readyState&&n.ctatdebug("Received message (status 3, processing request)")),e++)}}n.cleanup();for(e=0;e<a.length;e++)n.ctatdebug("Processing incoming message: "+e),c=a[e],-1!=c.indexOf("status=success")?n.ctatdebug("Info: logging success message received, not propagating to message handler"):(n.ctatdebug("Processing incoming message: "+c),d.processMessage(c))};this.processWSReply=function(a){n.ctatdebug("processWSReply() length "+
(null===a?null:a.toString().length));"string"==typeof a&&(null!==m&&m.processIncoming(a),-1!=a.indexOf("status=success")?n.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+a):(n.ctatdebug("Processing incoming message: "+a),d.processMessage(a)))};this.processWSClose=function(a){n.ctatdebug("processWSClose("+a+")");a instanceof CloseEvent&&n.ctatdebug("CloseEvent: code "+a.code+", reason "+a.reason+", wasClean "+a.wasClean);CTATLMS.is.Authoring()||
CTATLMS.is.ToolsListener()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):CTATScrim.scrim.handleTSDisconnect()};this.cleanup=function(){n.ctatdebug("cleanup ()");n.ctatdebug("checkEntries() httprequests.length "+b.length);for(var a=0,d=b.length-1;0<=d;d--){var e=b[d];if(e)if(!0===e.getConsumed())n.ctatdebug("checkEntries() removing["+d+"] ID: "+e.getID()),b.splice(d,1),a++;else if("function"==typeof e.getHTTPObject){var c=e.getHTTPObject();n.ctatdebug("checkEntries() checking["+
d+"], readyState: "+(c?c.readyState:"null")+", consumed: "+e.getConsumed())}}n.ctatdebug("Removed "+a+" entries")};this.retrieveProblemFile=function(a,d,b){"function"==typeof CTATScrim&&CTATScrim.scrim&&CTATScrim.scrim.waitScrimUp();var e=/\.([A-z]*)$/.exec(a);e&&e[1]&&"nools"===e[1].toLowerCase()?(console.log("got a nools file:",a),b.processNools(a)):(console.log("got an xml file, maybe:",a),n.retrieveXMLFile(a,d,b))};this.getFileRequest=function(a,d,b){var e=-1!=(location.href?location.href:a).indexOf("file://")?
!0:!1;location.href||n.ctatdebug("We can't check location.href in the current configuration");if(e)b=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),n.ctatdebug("onerror GET for fileName "+b),CTAT.ToolTutor.sendToInterface(b,!0);else return u=a,a=new CTATConnection,a.assignReceiveFunction(function(a,b,e){"undefined"==typeof e&&(e="function"==typeof this.getHTTPObject&&this.getHTTPObject());
n.ctatdebug("onready... GET for xmlFile xmlhttp "+e+", .readyState & .status "+(e?e.readyState+" & "+e.status:""));e&&4!=e.readyState||(e&&200==e.status&&d(e),e&&404==e.status&&(a=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file","("+u+") not found"),n.ctatdebug("Error loading xmlFile "+u+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)))}),a.assignFailFunction(b),a};this.retrieveXMLFile=function(a,d,b){n.ctatdebug("retrieveXMLFile ("+a+")");d=this.getFileRequest(a,function(a){a.responseXML?
(n.ctatdebug("parsing brd xml using something else"),a=a.responseXML.documentElement):(n.ctatdebug("parsing brd xml using node"),a=(new CTATXML).parseXML(a.responseText));null===a?(a=(new CTATTutorMessageBuilder).createErrorMessage("Error parsing xmlFile "+u),n.ctatdebug("Error parsing xmlFile "+u+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)):b.processXML(a)},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+u+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
n.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0);b.processXML(null)});d.setMethod("GET");d.setURL(a);d.setContentType("text/plain");d.send()};this.retrieveJSONFile=function(a,d){n.ctatdebug("retrieveJSONFile ("+a+")");var b=this.getFileRequest(a,function(){4==b.readyState&&200==b.status&&(n.ctatdebug("Successfully retrieved file: "+a),d(JSON.parse(b.responseText)))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+u+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
n.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});b.open("GET",a,!0);b.setRequestHeader("Content-type","text/plain");b.send()};this.retrieveFile=function(a,d){n.ctatdebug("retrieveFile ("+a+")");var b=this.getFileRequest(a,function(){4==b.readyState&&200==b.status&&(n.ctatdebug("Successfully retrieved file: "+a),d(b.responseText))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+u+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
n.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});b.open("GET",a,!0);b.setRequestHeader("Content-type","text/plain");b.send()};this.then=function(d,b){return a&&"function"==typeof a.then?a.then(d,b):Promise.resolve("CTATCommLibrary.then() not supported").then(d,b)}};CTATCommLibrary.setAuthenticityToken=function(c){Array.isArray(c)&&(c=0<c.length?c[0]:"");c&&(CTATCommLibrary.authenticityToken=decodeURIComponent(c))};CTATCommLibrary.getAuthenticityToken=function(c){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(c){return CTATCommLibrary.authenticityToken&&(""===c||0>c.search(/authenticity_token=/)&&0<=c.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+c+(c?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):c};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(c){if(c&&!/[^0-9]127[.]0[.]0[.]1[^0-9]/.test(c)&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");c=c.replace("ws:","wss:");var g=CTATConfiguration.get("remoteSocketSecurePort");g&&(c=c.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+g));ctatdebug("url after replace: "+c)}return c};var CTATArgument=function(){var c="",g="Undefined",f="String",e="text";this.setValue=function(b){g=b};this.getValue=function(){return g};this.setName=function(b){c=b};this.getName=function(){return c};this.setType=function(b){f=b};this.getType=function(){return f};this.setFormat=function(b){e=b};this.getFormat=function(){return e}};CTATArgument.prototype.clone=function(){var c=new CTATArgument;c.setValue(this.getValue());c.setType(this.getType());c.setFormat(this.getFormat());return c};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATHTMLManager=function(){var c=null,g="";this.urldecode=function(c){return decodeURIComponent((c+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var f,e=0;e<c.length;e++)f=c[e],ctatdebug(f)};this.initEntities=function(){null==c&&(c=[],c["&amp;"]="*!*",c["&nbsp;"]="\u00a0",c["&iexcl;"]="\u00a1",c["&cent;"]="\u00a2",c["&pound;"]="\u00a3",c["&curren;"]="\u00a4",c["&yen;"]="\u00a5",c["&brvbar;"]="\u00a6",c["&sect;"]="\u00a7",c["&uml;"]="\u00a8",c["&copy;"]=
"\u00a9",c["&reg;"]="\u00ae",c["&deg;"]="\u00b0",c["&plusmn;"]="\u00b1",c["&sup1;"]="\u00b9",c["&sup2;"]="\u00b2",c["&sup3;"]="\u00b3",c["&acute;"]="\u00b4",c["&micro;"]="\u00b5",c["&frac14;"]="\u00bc",c["&frac12;"]="\u00bd",c["&frac34;"]="\u00be",c["&iquest;"]="\u00bf",c["&Agrave;"]="\u00c0",c["&Aacute;"]="\u00c1",c["&Acirc;"]="\u00c2",c["&Atilde;"]="\u00c3",c["&Auml;"]="\u00c4",c["&Aring;"]="\u00c5",c["&AElig;"]="\u00c6",c["&Ccedil;"]="\u00c7",c["&Egrave;"]="\u00c8",c["&Eacute;"]="\u00c9",c["&Ecirc;"]=
"\u00ca",c["&Euml;"]="\u00cb",c["&Igrave;"]="\u00cc",c["&Iacute;"]="\u00cd",c["&Icirc;"]="\u00ce",c["&Iuml;"]="\u00cf",c["&ETH;"]="\u00d0",c["&Ntilde;"]="\u00d1",c["&Ograve;"]="\u00d2",c["&Oacute;"]="\u00d3",c["&Ocirc;"]="\u00d4",c["&Otilde;"]="\u00d5",c["&Ouml;"]="\u00d6",c["&Oslash;"]="\u00d8",c["&Ugrave;"]="\u00d9",c["&Uacute;"]="\u00da",c["&Ucirc;"]="\u00db",c["&Uuml;"]="\u00dc",c["&Yacute;"]="\u00dd",c["&THORN;"]="\u00de",c["&szlig;"]="\u00df",c["&agrave;"]="\u00e0",c["&aacute;"]="\u00e1",c["&acirc;"]=
"\u00e2",c["&atilde;"]="\u00e3",c["&auml;"]="\u00e4",c["&aring;"]="\u00e5",c["&aelig;"]="\u00e6",c["&ccedil;"]="\u00e7",c["&egrave;"]="\u00e8",c["&eacute;"]="\u00e9",c["&ecirc;"]="\u00ea",c["&euml;"]="\u00eb",c["&igrave;"]="\u00ec",c["&iacute;"]="\u00ed",c["&icirc;"]="\u00ee",c["&iuml;"]="\u00ef",c["&eth;"]="\u00f0",c["&ntilde;"]="\u00f1",c["&ograve;"]="\u00f2",c["&oacute;"]="\u00f3",c["&ocirc;"]="\u00f4",c["&otilde;"]="\u00f5",c["&ouml;"]="\u00f6",c["&oslash;"]="\u00f8",c["&ugrave;"]="\u00f9",c["&uacute;"]=
"\u00fa",c["&ucirc;"]="\u00fb",c["&uuml;"]="\u00fc",c["&yacute;"]="\u00fd",c["&thorn;"]="\u00fe",c["&yuml;"]="\u00ff",c["&gt;"]=">",c["&lt;"]="<",c["&#61;"]="=",c["&361;"]="=",c["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");c["&apos;"]="\\'"};this.entitiesConvert=function(c){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(c))};this.entitiesGenerate=function(c){return g=c};this.htmlEncode=function(c){return c};this.htmlDecode=function(c){return"undefined"!==
typeof $?$("<div/>").html(c).text():"undefined"!==typeof Entities?(new Entities).decode(c):c}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATStringUtil=function(){this.String2Boolean=function(c){switch(c){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(c,g,f){return c.replace(g,f)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(c,g,f,e){CTATBase.call(this,"CTATSAI","sai");var b=new CTATStringUtil,a="undefined",d=[],h=[],l=[],m=[],n=null,p=this,n="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return l};this.getArgument=function(a){if(0==l.length){var d=new CTATArgument;l.push(d)}return l[a]};this.getArgumentsTyped=function(){p.ctatdebug("getArgumentsTyped");var a,d=[];for(a=0;a<l.length;a++){var e=l[a];"Boolean"===e.getType()?(p.ctatdebug("Adding Boolean argument ("+
e.getValue()+") ..."),d.push(b.String2Boolean(e.getValue()))):"Number"===e.getType()?(p.ctatdebug("Adding Number argument ("+e.getValue()+") ..."),d.push(Number(e.getValue()))):"String"===e.getType()?"No_Value"===e.getValue()?(p.ctatdebug("Detected default argument ("+e.getValue()+"), setting contents to null instead"),d.push(null)):d.push(String(e.getValue())):p.ctatdebug("Unrecognized argument type: "+e.getType()+" in "+p.toSerializedString()+" IGNORING IT!!!")}p.ctatdebug("Resulting arguments: "+
d);return d};this.addSelection=function(a,b){var e=new CTATArgument;e.setValue(a);void 0!=b&&null!=b&&e.setType(b);d.push(e)};this.addAction=function(a){h.push(a)};this.checkDefaultArgument=function(){p.ctatdebug("checkDefaultArgument ()");if(0===l.length){p.ctatdebug("Adding default argument ...");var a=new CTATArgument;l.push(a)}};this.setArgument=function(a,d){p.checkDefaultArgument();for(var b=l.length;b<=a;++b)l.push(new CTATArgument);b=l[a];b.setValue(d);return b};this.addArgument=function(a,
d,b){this.ctatdebug("addArgument ("+a+","+d+","+b+")");var e=new CTATArgument;e.setValue(a);e.setType(d);e.setFormat(b);l.push(e);return e};this.addExistingArgument=function(a){l.push(a);return a};this.setSAI=function(d,b,e,c,f){p.setSelection(Array.isArray(d)?0<d.length?d[0]:"":d);p.setAction(Array.isArray(b)?0<b.length?b[0]:"":b);p.setInput(Array.isArray(e)?0<e.length?e[0]:"":e);p.setType(c);a=f};this.setInput=function(a){p.ctatdebug("setInput("+a+")");p.checkDefaultArgument();p.getArgument(0).setValue(a)};
this.getInputObject=function(){return 0===l.length?null:l[0]};this.getInput=function(){return 0===l.length?"":p.getArgument(0).getValue()};this.setType=function(a){p.checkDefaultArgument();p.getArgument(0).type=a};this.getType=function(){return 0===l.length?"":p.getArgument(0).type};this.setFormat=function(a){p.checkDefaultArgument();p.getArgument(0).setFormat(a)};this.getFormat=function(){return 0===l.length?"":p.getArgument(0).getFormat()};this.toString=function(){return"["+String(p.getSelection())+
","+String(p.getAction())+","+String(p.getInput())+"]"};this.setSelection=function(a,b){var e=p.getSelectionObject();null==e?(e=new CTATArgument,e.setValue(a),void 0!=b&&null!=b&&e.setType(b),d.push(e)):e.setValue(a)};this.getSelectionObject=function(){return 0==d.length?null:d[0]};this.getSelection=function(){if(0==d.length)return null;var a=d[0];return"object"===typeof a?a.getValue():a};this.setAction=function(a){0<h.length?h[0]=a:h.push(a)};this.getAction=function(){return 0==h.length?null:h[0]};
this.appendToSelectionArray=function(a,b){var e=new CTATArgument;e.setValue(String(a));void 0!=b&&null!=b&&e.setType(b);d.push(e)};this.setSelectionArray=function(a){d=[];for(var b=0;b<a.length;b++)p.appendToSelectionArray(a[b],"String")};this.getSelectionArray=function(){for(var a=[],b=0;b<d.length;b++){var e=d[b];"object"===typeof e?a.push(d[b].getValue()):a.push(e)}return a};this.appendToActionArray=function(a){null==a?h.push(""):h.push(String(a))};this.setActionArray=function(a){h=null==a?[]:
Array.isArray(a)?a.slice():[String(a)]};this.getActionArray=function(){return h};this.appendToInputArray=function(a){p.ctatdebug("appendToInputArray ("+a+")");null==a?p.addArgument("","String","text"):p.addArgument(a,"String","text")};this.setInputArray=function(a){l=[];if(null!=a)for(var d=0;d<a.length;d++)p.appendToInputArray(a[d])};this.getInputArray=function(){p.ctatdebug("getInputArray ("+l.length+")");m=[];for(var a=0;a<l.length;a++){var d=l[a];"object"===typeof d?(p.ctatdebug("Adding object value ("+
d.getValue()+") to temp input array"),m.push(d.getValue())):(p.ctatdebug("Adding string value ("+d+") to temp input array"),m.push(d))}return m};this.setPrompt=function(d){a=d};this.getPrompt=function(){return a};this.propagate=function(a){p.ctatdebug("propagate ()");a=a.getArguments();for(var d=0;d<a.length;d++){var b=a[d],e=l[d];if(null===b||null===e){p.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}e.setValue(b.getValue())}};this.fromString=function(a){a=
n.parse(a);p.fromXML(a)};this.fromXML=function(a){p.ctatdebug("fromXML ()");l=[];a=n.getElementChildren(a);for(var d,b=0;b<a.length;b++){var e=a[b];if("selection"==n.getElementName(e)||"Selection"==n.getElementName(e)){for(var c=n.getElementChildren(e),f=!1,h=0;h<c.length;h++)d=c[h],"value"==n.getElementName(d)&&(d=n.getNodeTextValue(d),1>h?p.setSelectionArray(d):p.appendToSelectionArray(d),f=!0,p.setSelection(d));!1===f&&(d=n.getNodeTextValue(e),p.setSelectionArray(d),p.setSelection(d))}if("action"==
n.getElementName(e)||"Action"==n.getElementName(e)){c=n.getElementChildren(e);f=!1;for(h=0;h<c.length;h++)d=c[h],"value"==n.getElementName(d)&&(d=n.getNodeTextValue(d),1>h?p.setActionArray(d):p.appendToActionArray(d),f=!0,p.setAction(d));!1===f&&(d=n.getNodeTextValue(e),p.setActionArray(d),p.setAction(d))}if("inputArray"==n.getElementName(e)||"value"==n.getElementName(e)||"Input"==n.getElementName(e)){d=n.getElementChildren(e);var g;l=[];c=new CTATHTMLManager;f=new CTATArgument;h=0;l.push(f);for(var m=
0;m<d.length;m++){var r=d[m];"value"==n.getElementName(r)&&(g=n.getElementChildren(r),null!==g?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+g.length),1===g.length?(g=c.htmlDecode(n.getNodeTextValue(r)),p.ctatdebug("Setting new value to: "+g),f.setValue(g)):(g=c.htmlDecode(n.getNodeTextValue(r)),p.ctatdebug("Setting new value to: "+g),f.setValue(g),f.setName(r.attributes.getNamedItem("name").value),f.setType(r.attributes.getNamedItem("type").value),f.setFormat(r.attributes.getNamedItem("format").value),
h++),1>m?p.setInputArray(g):p.appendToInputArray(g)):(r=c.htmlDecode(n.getNodeTextValue(r)),p.ctatdebug("Setting new value to: "+r),f.setValue(r),1>m?p.setInputArray(r):p.appendToInputArray(r)))}}if("prompt"==n.getElementName(e)||"Prompt"==n.getElementName(e))p.ctatdebug("Parsing prompt ..."),p.setPrompt(n.getNodeTextValue(e))}p.checkDefaultArgument()};this.appendFromElement=function w(a,d,b,e,c){p.ctatdebug("appendFromElement ()");e=String(n.getElementName(d)).toLowerCase();if(e==a||"value"==e)if(e=
n.getElementChildren(d),!Array.isArray(e)||1>e.length)0==c?b.push(n.getNodeTextValue(d)):p.appendToInputArray(n.getNodeTextValue(d));else for(d=0;d<e.length;++d)w(a,e[d],b,d,c)};this.setArrayFromElements=function(a){p.ctatdebug("setArrayFromElements ()");if(!a||!Array.isArray(a)||1>a.length)p.ctatdebug("can't get name: don't know whether selection, action or input");else{var b,e=String(n.getElementName(a[0])).toLowerCase();switch(e){case "selection":p.ctatdebug("Processing selection field ...");d=
[];for(b=0;b<a.length;++b)p.appendFromElement(e,a[b],d,b,!1);break;case "action":p.ctatdebug("Processing action field ...");h=[];for(b=0;b<a.length;++b)p.appendFromElement(e,a[b],h,b,!1);break;case "input":p.ctatdebug("Processing input field ...");l=[];for(b=0;b<a.length;++b)p.appendFromElement(e,a[b],l,b,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+e+'"');return}p.ctatdebug("CTATSAI.setArrayFromElements() eltName "+e+", length "+b+", selectionArray "+
p.getSelectionArray()+", actionArray "+p.getActionArray()+", inputArray "+p.getInputArray())}};this.fromXMLInternal=function(a){p.ctatdebug("fromXMLInternal ()");new CTATXML;l=[];a=n.getElementChildren(a);for(var d,b=0;b<a.length;b++){var e=a[b];if("selection"==n.getElementName(e)||"Selection"==n.getElementName(e)){for(var c=n.getElementChildren(e),f=!1,h=0;h<c.length;h++)d=c[h],"value"==n.getElementName(d)&&(d=n.getNodeTextValue(d),1>h?p.setSelectionArray(d):p.appendToSelectionArray(d),f=!0,p.setSelection(d));
!1===f&&(d=n.getNodeTextValue(e),p.setSelectionArray(d),p.setSelection(d))}if("action"==n.getElementName(e)||"Action"==n.getElementName(e)){c=e.childNodes;f=!1;for(h=0;h<c.length;h++)d=c[h],"value"==n.getElementName(d)&&(d=n.getNodeTextValue(d),1>h?p.setActionArray(d):p.appendToActionArray(d),f=!0,p.setAction(d));!1===f&&(d=n.getNodeTextValue(e),p.setActionArray(d),p.setAction(d))}if("inputArray"==n.getElementName(e)||"Input"==n.getElementName(e)){d=e.childNodes;l=[];var c=new CTATHTMLManager,f=new CTATArgument,
h=0,g;l.push(f);for(var m=0;m<d.length;m++)if(g=d[m],"value"==n.getElementName(g)){var w=n.getElementChildren(g);null!==w?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+w.length),1===w.length?(g=c.htmlDecode(n.getNodeTextValue(g)),p.ctatdebug("Setting new value to: "+g),f.setValue(g)):(g=c.htmlDecode(n.getNodeTextValue(g)),p.ctatdebug("Setting new value to: "+g),f.setValue(g),f.setName(n.getElementAttr("name")),f.setType(n.getElementAttr("type")),f.setFormat(n.getElementAttr("format")),
h++)):(g=c.htmlDecode(n.getNodeTextValue(g)),p.ctatdebug("Setting new value to: "+g),f.setValue(g));1>m?p.setInputArray(g):p.appendToInputArray(g)}}if("prompt"==n.getElementName(e)||"Prompt"==n.getElementName(e))p.ctatdebug("Parsing prompt ..."),p.setPrompt(n.getNodeTextValue(e))}p.checkDefaultArgument()};this.toXMLString=function(a){p.ctatdebug("toXMLString ()");return a?p.toLSxmlString():p.toTSxmlString()};this.toLSxmlString=function(){p.ctatdebug("toLSxmlString ()");for(var a="",b=0;b<d.length;b++){var e=
d[b];"object"===typeof e?(a="String"!=e.getType()?a+('<selection type="'+e.getType()+'">'):a+"<selection>",a+=e.getValue()+"</selection>"):a+="<selection>"+e+"</selection>"}a+="<action>"+p.getAction();for(b=1;b<h.length;b++)a+="</action><action>"+h[b];a+="</action>";for(b=0;b<l.length;b++)e=l[b],a="object"===typeof e?"String"!=e.getType()?a+('<input type="'+e.getType()+'"><![CDATA['+e.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+e.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+e+"]]\x3e</input>");
return a};this.toTSxmlString=function(){p.ctatdebug("toTSxmlString ()");var a;a="<Selection><value>"+p.getSelection();for(var b=1;b<d.length;b++){var e=d[b];a="object"===typeof e?a+("</value><value>"+e.getValue()):a+("</value><value>"+e)}a+="</value></Selection><Action><value>"+p.getAction();for(b=1;b<h.length;b++)a+="</value><value>"+h[b];a+="</value></Action><Input>";if(1<l.length)for(b=0;b<l.length;b++)e=l[b],a+='<value fmt="text" name="'+e.getName()+'" type="'+e.getType()+'"><![CDATA['+e.getValue()+
"]]\x3e</value>";else a+="<value><![CDATA["+p.getInput()+"]]\x3e</value>";return a+"</Input>"};this.toSerializedString=function(){var a;a=""+("<selection>"+p.getSelection()+"</selection><action>"+p.getAction()+"</action><inputArray>");for(var d=0;d<l.length;d++){var b=l[d];a+='<value fmt="text" name="'+b.getName()+'" type="'+b.getType()+'">'+b.getValue()+"</value>"}return a+"</inputArray>"};this.clone=function(){p.ctatdebug("clone ()");for(var a=new CTATSAI(p.getSelection(),p.getAction(),p.getInput(),
p.getPrompt()),d=0;d<p.getArguments().length;++d)a.setArgument(d,p.getArgument(d).clone());a.setSelectionArray(p.getSelectionArray().slice());a.setActionArray(p.getActionArray().slice());a.setInputArray(p.getInputArray().slice());p.ctatdebug("CTATSAI.clone() this "+p+", clone "+a+", clone inputArray "+a.getInputArray());return a};this.isDone=function(){var a=p.getSelection(),d=p.getAction();return null==a||null==d?!1:"done"==a.toString().toLowerCase()&&"buttonpressed"==d.toString().toLowerCase()};
var r=!1;if(Array.isArray(c)&&Array.isArray(g)&&(Array.isArray(f)||null==f)&&(p.setSelectionArray(c),p.setActionArray(g),p.setInputArray(f),r=!0,0<c.length&&0<g.length)){p.setSAI(c[0],g[0],null==f?null:f[0],"String",e);return}null!==c&&""!==c&&p.setSelection(c);null!==c&&(p.setSAI(c,g,f,"String",e),r||(p.setSelectionArray(Array.isArray(c)?c:[c]),p.setActionArray(Array.isArray(g)?g:[g]),p.setInputArray(Array.isArray(f)?f:[f]),r=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);
CTATSAI.prototype.constructor=CTATSAI;CTATSAI.delayedActionRegExp=/^([^:]+):([0-9]+)$/;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var c="",g="",f="",e="",b=0,a="",d=!1,h="",l="",m="",n="",p="";this.setSkillName=function(a){c=a};this.setDisplayName=function(a){g=a};this.setModelName=function(a){e=a};this.setCategory=function(a){f=a};this.setLevel=function(a){!0===isNaN(a)?ctatdebug("Error: attempting to set a level to NaN"):(b=a,this.setPKnown(String(b)))};this.setDescription=function(d){a=d};this.getSkillName=function(){return c};this.getDisplayName=function(){return g};
this.hasDisplayName=function(){return""!==g&&null!==g};this.getModelName=function(){return e};this.hasCategory=function(){return""!==f};this.hasModelName=function(){return""!==e};this.getCategory=function(){return f};this.getLevel=function(){return b};this.getDescription=function(){return a};this.setTouched=function(a){d=a};this.getTouched=function(){return d};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){var d='<skill label="'+g+'" pSlip="'+l+'" description="'+a;
return d+='" pKnown="'+m+'" category="'+f+'" pLearn="'+n+'" name="'+c+'" pGuess="'+h+'" history="'+p+'" />'};this.setPGuess=function(a){h=a};this.getPGuess=function(){return h};this.setPSlip=function(a){l=a};this.getPSlip=function(){return l};this.setPLearn=function(a){n=a};this.getPLearn=function(){return n};this.setPKnown=function(a){m=a};this.getPKnown=function(){return m};this.setSkillHistory=function(a){p=a};this.getSkillHistory=function(){return p}};CTATSkill.prototype=Object.create(CTATBase.prototype);
CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var c=this;this.fromXMLString=function(c,f){this.ctatdebug("fromXMLString ()");this.ctatdebug("Skills string: "+c);if(null===c)this.ctatdebug("Warning: skill object is null");else if(""===c)this.ctatdebug("Info: empty skill string provided, bump");else if(c){this.ctatdebug("CTATSkillSet.fromXMLString() Raw:     "+c);var e=f?c:decodeURIComponent(c.replace(/\+/g," "));this.ctatdebug("CTATSkillSet.fromXMLString() Decoded: "+
e);if(null!==/\/<value>.+<\/value>/.exec(e))this.parseByValue(e);else{var b=(new CTATXML).parseXML(e);this.parseByAttributes(b,e)}this.ctatdebug("fromXMLString () done")}else this.ctatdebug("Warning: skill object is undefined or otherwise empty.")};this.fromXMLData=function(c,f){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(f)?this.parseByValue(f):this.parseByAttributes(c);this.ctatdebug("fromXMLData () done")};this.parseByValue=function(g){this.ctatdebug("parseByValue()");if(g){g=
g.childNodes;for(var f=new CTATXML,e=0;e<g.length;e++){var b=f.getNodeTextValue(g[e]).split("`"),a=b[0].split(" ");4==b.length?this.addSkill(a[0],b[1],b[2],b[3],b[3],a[1]):this.addSkill(a[0],b[1],b[2],b[3],b[4],a[1])}}else c.ctatdebug("Error: aSkills is null")};this.parseDOM=function(c){this.ctatdebug("parseDOM()");var f=new CTATXML;c=f.getElementChildren(c);for(var e=0;e<c.length;e++){var b=f.getNodeTextValue(c[e]).split("`"),a=b[0].split(" ");4==b.length?this.addSkill(a[0],b[1],b[2],b[3],b[3],a[1]):
this.addSkill(a[0],b[1],b[2],b[3],b[4],a[1])}};this.parseByAttributes=function(g){this.ctatdebug("parseByAttributes()");if(g)if(g=g.childNodes)for(var f=0;f<g.length;f++){var e=g[f];if("Skill"==e.nodeName||"skill"==e.nodeName){this.ctatdebug("Parsing node ("+f+"): "+e.nodeName+" -> "+e.nodeValue);var b=e.attributes.getNamedItem("name");if(b=b?b.value:""){var a=e.attributes.getNamedItem("pKnown"),a=a?a.value:"",d=e.attributes.getNamedItem("description"),d=d?d.value:"",h=e.attributes.getNamedItem("label"),
h=h?h.value:"",l=e.attributes.getNamedItem("category"),l=l?l.value:"",m=e.attributes.getNamedItem("pGuess"),m=m?m.value:"",n=e.attributes.getNamedItem("pLearn"),n=n?n.value:"",p=e.attributes.getNamedItem("pSlip"),p=p?p.value:"",e=(e=e.attributes.getNamedItem("history"))?e.value:"";this.addSkill(b,a,.95,d,h,l,m,n,p,e)}}}else this.ctatdebug("Error: list of skill xml elements is null");else c.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};this.getSize=
function(){return this.internalSkillSet.length};this.addSkill=function(c,f,e,b,a,d,h,l,m,n){this.ctatdebug("addSkill() name = "+c+" level = "+f+" mastery = "+e+" aDescription = "+b+" adisplayName = "+a+" aCategory = "+d+" pguess= "+h+" plearn = "+l+" pslip = "+m+" history = "+n);c=this.setSkillLevel(c,f,e);this.ctatdebug("Configuring "+c.getDisplayName());b&&c.setDescription(b);a&&c.setDisplayName(a);d&&c.setCategory(d);(h||0===h)&&c.setPGuess(h);(l||0===l)&&c.setPLearn(l);(m||0===m)&&c.setPSlip(m);
""!==n&&c.setSkillHistory(n);return c};this.addSkillAsObject=function(c){this.addSkill(c.name,c.level,c.mastery,c.description,c.label,c.category,c.pGuess,c.pLearn,c.pSlip,"")};this.setSkillLevel=function(c,f,e){this.ctatdebug("setSkillLevel ("+c+","+f+","+e+")");e=this.getSkill(c);null===e?(this.ctatdebug("Skill not found, creating new one ..."),e=new CTATSkill,e.setSkillName(c),e.setLevel(f),this.internalSkillSet.push(e)):(this.ctatdebug("Skill found, adjusting ..."),e.setLevel(1),e.setLevel(f));
e.setTouched(!0);return e};this.getSkill=function(c){this.ctatdebug("getSkill ("+c+") -> "+this.internalSkillSet.length);if(!c)return null;for(var f=0;f<this.internalSkillSet.length;f++){var e=this.internalSkillSet[f];if(e.getSkillName()==c)return this.ctatdebug("Returning: "+f),e}return null};this.getSkillLevel=function(c){if(!c)return-1;for(var f in this.internalSkillSet)if(f.getSkillName()==c)return f.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");for(var c=[],
f=0;f<this.internalSkillSet.length;f++){var e=this.internalSkillSet[f];!0===e.getTouched()&&(this.ctatdebug("Adding touched skill: "+e.getSkillName()),c.push(e))}return c};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");for(var c=0;c<this.internalSkillSet.length;c++)this.internalSkillSet[c].setTouched(!1)};this.toSetPreferencesXMLString=function(){this.ctatdebug("toSetPreferencesXMLString ()");for(var c="<skills>",f=0;f<this.internalSkillSet.length;f++)c+=this.internalSkillSet[f].toSetPreferencesXMLString();
return c+"</skills>"};this.toLogString=function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var c="",f=0;f<this.internalSkillSet.length;f++){var e=this.internalSkillSet[f],c=c+('<skill probability="'+e.getLevel()+'"><name>'+e.getSkillName()+"</name>");e.hasCategory()&&(c+="<category>"+e.getCategory()+"</category>");e.hasModelName()&&(c+="<model_name>"+e.getModelName()+"</model_name>");c+="</skill>"}return c}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);
CTATSkillSet.prototype.constructor=CTATSkillSet;CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(c,g){this.name=c||"";this.value=g||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var c=null,g=0;this.isJSONObject=function(c){return c.ctat?!0:!1};this.parse=function(c){return this.parseJSON(c)};this.parseJSON=function(f){this.ctatdebug("parseJSON ()");c=null;if("string"==typeof f){this.ctatdebug("Parsing JSON as a string ... ");try{c=JSON.parse(f)}catch(b){return this.ctatdebug("Error parsing JSON message: "+b.message),c=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var e in c)return this.ctatdebug("Creating internal JSON object with name: "+
e),f=new CTATJSONObject,f.name=e,f.value=c[e],f;return null};this.getElementName=function(c){return"object"!=typeof c?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof c),null):c.name};this.getElementValue=function(c){return null==c?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof c?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof c),null):c.value};this.getElementChildren=
function(c){if(null==c)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof c)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof c),null;var e=c.value,b=[],a;for(a in e){var d=e[a];if("string"==typeof d)c=new CTATJSONObject,c.name=a,c.value=d,b.push(c);else if(null==d[0]||void 0==d[0])c=new CTATJSONObject,c.name=a,c.value=d,b.push(c);else for(var f in d)c=new CTATJSONObject,c.name=a,c.value=d[f],b.push(c)}return b};
this.getNodeTextValue=function(c){if("string"!=typeof c.value){var e=null;for(e in c.value)if("content"==e)return c.value[e].toString();for(e in c.value)if("value"==e)return c.value[e].toString()}return c.value};this.getElementAttr=function(c,e){var b=c.value,a;for(a in b)if(a==e)return b[a];return null};this.isArray=function(c){return"[object Array]"===Object.prototype.toString.call(c)};this.walkDOM=function(c){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");g=0;this.walk(c);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(c){g++;if(!(5<g)){var e=0,b;for(b in c){var a=c[b];this.ctatdebug("("+e+") typeof (key): "+typeof b+" -> typeof(value): "+typeof a+"("+a.length+")");"string"!=typeof a?(this.ctatdebug("walk ("+b+")"),this.walk(a)):this.ctatdebug("walk ("+b+") : "+a);e++}}};this.stringify=function(c){return this.toJSONString(c)};this.toJSONString=function(c){return JSON.stringify(c,null,2)};this.syntaxHighlight=function(c){"string"!=typeof c&&(c=JSON.stringify(c,void 0,2));c=c.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return c.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var b="number";/^"/.test(e)?b=/:$/.test(e)?"key":"string":/true|false/.test(e)?b="boolean":/null/.test(e)&&(b="null");return'<span class="'+b+'">'+e+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(c){function g(d){var b=[],e=a.getElementChildren(d);this.ctatdebug("CTATMessage.parseCustomFields("+a.stringify(d)+"): valueElts.length "+e.length);for(d=0;d<e.length;++d){var c=e[d];"value"!=a.getElementName(c)?console.log("CTATMessage.parseRules(): unexpected element name "+a.getElementName(c)+" at custom_fields["+d+"]"):(c=a.getNodeTextValue(c))&&b.push(c)}return b}function f(d){var b={},e=a.getElementChildren(d);this.ctatdebug("CTATMessage.parseCustomFields("+a.stringify(d)+
"): cfElts.length "+e.length);for(d=0;d<e.length;++d){var c=e[d];if("custom_field"==a.getElementName(c)){for(var f=null,h=null,c=a.getElementChildren(c),g=0,m=0;g<c.length&&2>m;++g){var l=c[g];switch(a.getElementName(l)){case "name":f=a.getNodeTextValue(l);m++;break;case "value":h=a.getNodeTextValue(l),m++}}f&&(b[f]=h?h:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+f+"]="+b[f]+";"))}}return b}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};
var e=c,b=null,a=null;void 0==c&&(e=null);a="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;e&&(this.ctatdebug("messageParser "+a+", messageObj "+e),e.children&&this.ctatdebug(e.children));var d="ungraded",h=!1,l=!1,m=new CTATSkillSet,n="",p="",r="",u="",w="",q=!0,y,z=null,B=null,v=null,E=!1;this.setURL=function(a){y=a};this.getURL=function(){return y};this.assignSAI=function(a){l=!0;z=a};this.setTransactionID=function(a){p=a};this.getTransactionID=function(){return p};this.setGradeResult=function(a){d=
a};this.getGradeResult=function(){return d};this.getXMLObject=function(){return e};this.getSkillsObject=function(){return m};this.getCustomFields=function(){return B};this.getRules=function(){return v};this.getSuccessMessage=function(){return r};this.getBuggyMsg=function(){return u};this.getHighlightMsg=function(){return w};this.parse=function(){this.ctatdebug("parse ()");if(null!==e){this.ctatdebug("messageParser: "+a);this.ctatdebug("Root name: "+a.getElementName(e));"tool_message"==a.getElementName(e)?
(this.ctatdebug("Detected tool message"),n="tool_message"):"message"!=a.getElementName(e)?(this.ctatdebug("Detected log message"),h=!0,n=a.getElementName(e)):(this.ctatdebug("Detected regular message"),h=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var d=a.getElementChildren(e),c=0;c<d.length;c++){var f=d[c];"properties"==a.getElementName(f)&&(ctatdebug("Found a 'properties' element ... "),b=a.getElementChildren(f))}this.ctatdebug("Message "+n+", with transaction id: "+
p)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var d="",b="",c="",q="",p=[],x=[],G=[];if("tool_message"==n){this.ctatdebug("Parsing s, a and i");d=a.getElementChildren(e);for(b=0;b<d.length;b++)if(c=d[b],"tool_message"==a.getElementName(c))for(c=a.getElementChildren(c),q=0;q<c.length;q++)p=c[q],"event_descriptor"==a.getElementName(p)&&(z=new CTATSAI,z.fromXMLInternal(p));l=!0}else{if(h){this.ctatdebug("isLogMessage ...");for(var I=a.getElementChildren(e),E=0;E<I.length;E++){var Q=I[E];
if("event_descriptor"==a.getElementName(Q))for(var Q=a.getElementChildren(Q),L=0;L<Q.length;L++){var D=Q[L];"selection"==a.getElementName(D)&&(d=a.getNodeTextValue(D),p.push(D));"action"==a.getElementName(D)&&(b=a.getNodeTextValue(D),x.push(D));"input"==a.getElementName(D)&&(c=a.getNodeTextValue(D),G.push(D));"prompt"==a.getElementName(D)&&(q=a.getNodeTextValue(D))}}}else for(this.ctatdebug("!isLogMessage ..."),I=a.getElementChildren(e),E=0;E<I.length;E++)if(Q=I[E],"properties"==a.getElementName(Q))for(Q=
a.getElementChildren(Q),L=0;L<Q.length;L++){var D=Q[L],N=a.getElementName(D);this.ctatdebug("Nodename: "+N);switch(N){case "URL":y=a.getNodeTextValue(D);break;case "Skills":m.parseByValue(D);break;case "SuccessMsg":r=d=a.getNodeTextValue(D);break;case "BuggyMsg":u=a.getNodeTextValue(D);break;case "Selection":d=a.getNodeTextValue(D);p.push(D);break;case "Action":b=a.getNodeTextValue(D);x.push(D);break;case "Input":c=a.getNodeTextValue(D);G.push(D);break;case "prompt":q=a.getNodeTextValue(D);break;
case "HighlightMsgText":w=a.getNodeTextValue(D);break;case "custom_fields":B=f(D);break;case "Rules":v=g(D)}}this.ctatdebug("SAI: "+d+","+b+","+c);""!==d&&null!==d?(z=new CTATSAI(d,b,c,q),z.setArrayFromElements(p),z.setArrayFromElements(x),z.setArrayFromElements(G),l=!0):(this.ctatdebug("No SAI found"),l=!1);this.ctatdebug("parseSAI () done, hassai: "+l+", ("+d+","+b+","+c+","+q+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=n){if(!h)for(var d=
a.getElementChildren(e),b=0;b<d.length;b++){var c=d[b];if("properties"==a.getElementName(c))for(var c=a.getElementChildren(c),f=0;f<c.length;f++){var g=c[f];"transaction_id"==a.getElementName(g)&&(p=a.getNodeTextValue(g))}}this.ctatdebug("parseTransactionID() done, id: "+p)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var d=a.getElementChildren(e),b=0;b<d.length;b++){var c=d[b];if("properties"==a.getElementName(c))for(var c=a.getElementChildren(c),f=0;f<c.length;f++){var h=
c[f];"MessageType"==a.getElementName(h)&&(n=a.getNodeTextValue(h))}}this.ctatdebug("parseMessageType() -> "+n)};this.getMessageType=function(){return n};this.getTransactionID=function(){return p};this.getSAI=function(){return l?z:new CTATSAI};this.getSelection=function(){return l?z.getSelection():""};this.getAction=function(){return l?z.getAction():""};this.getInput=function(){return l?z.getInput():""};this.getSelectionArray=function(){return l?z.getSelectionArray():[]};this.getActionArray=function(){return l?
z.getActionArray():[]};this.getInputArray=function(){return l?z.getInputArray():[]};this.getXML=function(){return e};this.getXMLString=function(a){if(e.xml)return e.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(e);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=n?"":this.getProperty("Indicator")};this.getIndicatorSub=function(){return"AssociatedRules"!=n?"":this.getProperty("IndicatorSub")};this.setProperty=function(d,e){this.ctatdebug("setProperty ("+
d+","+e+")");if(null!==b)for(var c=0;c<b.length;c++)a.getElementName(b[c]);else this.ctatdebug("Internal error: no messageProperties object available")};this.getProperty=function(d){if(!h)if(null!==b)for(var e=0;e<b.length;e++){var c=b[e];if(a.getElementName(c)==d)return a.getNodeTextValue(c)}else this.ctatdebug("Internal error: no messageProperties object available");return""};this.hasProperty=function(a){a=this.getProperty(a);return!h&&""!==a};this.hasSAI=function(){return l};this.isEndOfTransaction=
function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return h};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};this.getToolSelection=function(){return""};p=CTATMessage.makeTransactionId();this.parse();this.init=function(a){this.setMessageType(a)};
this.setSelection=function(a){z&&z.setSelection(a);this.setProperty("SELECTION",a)};this.setAction=function(a){z&&z.setAction(a);this.setProperty("ACTION",a)};this.setInput=function(a){z&&z.setInput(a);this.setProperty("INPUT",a)};this.lockTransactionId=function(a){if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("lockTranactionId() argument "+a+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a);E=!0};this.setMessageType=function(a){this.setProperty(CTATMessage.MESSAGE_TYPE,
a);n=a};this.setTransactionId=function(a){if(!E){if(null===a||"undefined"===typeof a||1>a.length)a=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a)}};this.suppressLogging=function(){q=!1};this.isLoggingSuppressed=function(){return!q};CTATMessage.create=function(a,d){var b=new CTATMessage;b.init(a);return b}};Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});
Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});CTATMessage.prototype=Object.create(CTATBase.prototype);CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATSkills=function(c){CTATBase.call(this,"CTATSkills",c?String(c.length):"");var g={},f=0;c.forEach(function(a){g[a.getSkillName().toLowerCase()]=a});var e=new Set,b=this;this.toXML=function(a,d){d||(d="");var b=a?"&lt;Skills&gt;":"<Skills>",e=b.length,c;for(c in g)g.hasOwnProperty(c)&&g[c]&&(b+=d+g[c].toXML(a));b+=d&&b.length>e?"\n":"";return b+(a?"&lt;/Skills&gt;":"</Skills>")};this.getAllSkills=function(){var a=[],d;for(d in g)g.hasOwnProperty(d)&&g[d]&&a.push(g[d]);return a};this.addSkill=
function(a,d){if(!b.getSkill(a.getSkillName())||d)g[a.getSkillName().toLowerCase()]=a};this.updateSkill=function(a,d,c){var h=null,g=b.getSkill(d);null!==g&&"undefined"!==typeof g&&(g.setTransactionNumber(f),d=c+" "+d,e.has(d)||(e.add(d),g.recordUpdate(a)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===a.toString().toUpperCase()&&e["delete"](d),h=g);return h};this.startTransaction=function(){++f};this.getSkill=function(a){var d=null===a||"undefined"===typeof a?null:a.toLowerCase(),d=g[d];
b.ctatdebug("CTATSkills.getSkill("+a+") returns "+d);return d};this.getSkillBarVector=function(a,d){var b=[],e;for(e in g)!0===g.hasOwnProperty(e)&&(!0!==d&&g[e].getTransactionNumber()!==f||b.push(g[e].getSkillBarString(a)));return b};this.setExternallyDefined=function(a){};this.setVersion=function(a){for(var d in g)!0===g.hasOwnProperty(d)&&g[d].setVersion(a)};this.toJSON=function(a){b.ctatdebug("CTATSkills.toJSON("+a+") to return "+("pSummarySkills"==a?b.getAllSkills():b[a]));if(!a)return b;switch(a){case "pSummarySkills":return b.getAllSkills();
case "pSummaryUpdates":return b.getAllUpdates();default:return b[a]}};this.getSkillUpdates=function(a){var d=b.getSkill(a),d=d?d.getUpdates():[];b.ctatdebug("CTATSkills.getSkillUpdates("+a+") returns length "+d.length);return d};this.getAllUpdates=function(){var a=[];b.getAllSkills().forEach(function(d){return a=a.concat(d.getUpdates())});b.ctatdebug("CTATSkills.getAllUpdates() returns length "+a.length);return a};this.restoreUpdates=function(a){a&&a.forEach(function(a){var d=b.getSkill(a.skillName);
d&&d.addUpdate(a)})}};CTATSkills.fromJSON=function(c){return Array.isArray(c)?new CTATSkills(c.map(function(c){return CTATExampleTracerSkill.fromJSON(c)})):null};
CTATSkills.parseSkills=function(c,g){var f=[];g||(g=new CTATXML);try{for(var e=g.getElementChildren(c),b=0;b<e.length;b++){var a=g.getElementName(e[b]);if(a&&"skill"==a.toLowerCase()){var d=g.getElementAttr(e[b],"name");if(d&&""!=d.trim()){var h=g.getElementAttr(e[b],"label"),l=g.getElementAttr(e[b],"pSlip"),m=g.getElementAttr(e[b],"description"),n=g.getElementAttr(e[b],"pKnown"),p=g.getElementAttr(e[b],"category"),r=g.getElementAttr(e[b],"pLearn"),u=g.getElementAttr(e[b],"pGuess"),w=g.getElementAttr(e[b],
"history"),q=new CTATExampleTracerSkill(p,d,u,n,l,r,w);q.setLabel(h);q.setDescription(m);f.push(q)}}}}catch(y){console.log("Error in CTATSkills.parseSkills",y,"\n skillsElt",c)}return f};CTATSkills.prototype=Object.create(CTATBase.prototype);CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var CTATSequencer=function(c,g){CTATBase.call(this,"CTATSequencer","sequencer");"undefined"!=typeof location&&"basic"==location.search.replace(/.*[?&]show_debug_traces=([^&]*)&?.*/,"$1")&&(useDebuggingBasic=!0);CTATLMS.is.OLI()&&(useDebuggingBasic=!0);var f=this,e=new CTATPackage,b=new CTATXML,a=null,d="sequential",h=null,l=g||function(a){console.log("CTATSequencer default CTATLMSListener",a)},m=new CTATSkills([]);this.currentIndex=-1;this.iframeId="ctat_inner_frame";this.setAlgorithm=function(a){d=
a};this.getAlgorithm=function(){return d};this.handlePackageRetrieval=function(a){f.ctatdebug("handlePackageRetrieval ()");e.init(a);null!=h&&h(e,f.currentIndex+1)};this.processXML=function(a){f.ctatdebug("parseXML ()");e.init(a);null!=h&&h(e,f.currentIndex+1)};this.init=function(d,c,g,m,l,q){f.ctatdebug("CTATSequencer.init ("+d+", "+c+", "+g+", "+m+", "+l+", "+q+")");!Number.isNaN(q=Number(q))&&0<=q&&(f.currentIndex=q-1);f.iframeId=m||f.iframeId;e.setPackageURL(d);e.setURLPrefix(g);e.setDefaultStudentInterface(l);
h=c||f.runNextProblem.bind(f);a=new CTATCommLibrary(null,!1);a.retrieveXMLFile(d,b,this);addEventListener("message",function(a){var d=document.getElementById(f.iframeId);f.ctatdebug("CTATSequencer.init() iframe "+d+", evt.data "+a.data);if(a.data&&/tutorready/i.test(a.data.command))try{d.contentWindow.CTATCommShell.commShell.assignDoneProcessor(f.advanceToNextProblem.bind(f))}catch(B){throw Error("CTATSequencer.init() error adding listener to iframe '"+f.iframeId+": "+B);}})};this.getSequenceType=
function(){return"fixed"};this.getCurrentIndex=function(){return f.currentIndex};this.advanceToNextProblem=function(a){f.ctatdebug("advanceToNextProblem()\n psResp "+a);f.processProblemSummaryResponse(a);f.runNextProblem()};this.processProblemSummaryResponse=function(a){try{var d=(new CTATMessage(b.parse(a))).getProperty("ProblemSummary");f.ctatdebug("processProblemSummaryResponse typeof(ps)"+typeof d+", ps "+d);for(var e=b.parse(d),c=b.getElementChildren(e),d=0;d<c.length;++d)if(/^skills$/i.test(b.getElementName(c[d]))){var h=
CTATSkills.parseSkills(c[d],b);f.ctatdebug("processProblemSummaryResponse skillList.length "+(h?h.length:null));h.forEach(function(a){m.addSkill(a,!0)});break}}catch(q){console.log("Error in processProblemSummaryResponse",q,"\n psResp",a)}};this.getProblemSetSize=function(){f.ctatdebug("getProblemSetSize ()");var a=e.getProblemSets();return 0==a.length?(f.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),e.getProblems().getProblemSize()):a[0].getProblemSize()};this.getFirstProblem=
function(){f.ctatdebug("getFirstProblem(): currentIndex "+f.currentIndex);f.currentIndex=-1;return getNextProblem()};this.getProblemList=function(){f.ctatdebug("getProblemList ()");var a=e.getProblemSets();return 0==a.length?(f.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),e.getProblems()):a[0].getProblems()};this.runNextProblem=function(){var a=f.getNextProblem();f.ctatdebug("CTATSequencer.runNextProblem() "+a);return f.runProblem(a)||CTATScrim.scrim.scrimUp(CTATLanguageManager.theSingleton.filterString("DONE_WITH_PROBLEM_SET"))||
null};this.runProblem=function(a){if(!a)return null;var d=document.getElementById(f.iframeId);f.ctatdebug("CTATSequencer.runProblem("+a+") iframe "+d);if(!d)throw Error("CTATSequencer.runProblem("+a+"): iframe '"+f.iframeId+"' not found");var b={};Object.assign(b,CTATConfiguration.getRawFlashVars());b.dataset_level_name1||(b.dataset_level_name1=a.getProblemFile(),b.dataset_level_type1="Activity");b.problem_name=a.getProblemFile();b.question_file=e.getRelativePath(a.getStudentInterface(),a.getProblemFile());
b.student_interface=a.getStudentInterface();b.skills=encodeURIComponent(f.getRevisedSkills(a.getSkills()).toXML());d.setAttribute("data-params",JSON.stringify(b));d.src=e.getURLPrefix()+e.getRelativePath(a.getStudentInterface())+(b.mode?"?MODE="+b.mode:"");return a};this.getRevisedSkills=function(a,d){a.forEach(function(a){m.addSkill(a,d)});return m};this.getNextProblem=function(){f.ctatdebug("getNextProblem(): currentIndex "+f.currentIndex);var a=e.getProblemSets();return 0==a.length?(f.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),
e.getProblems()[++f.currentIndex]):a[0].getProblems()[++f.currentIndex]};this.addProblem=function(a,d,b,c,f){e.addProblem(a,d,b,c,f)};CTATConfiguration.generateDefaultConfigurationObject(c,"undefined"==typeof CTATTarget?void 0:CTATTarget);addEventListener("ctatlms",function(a){console.log("CTATSequencer ctatlms listener evt",a);l(a)})};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;
Object.defineProperty(CTATSequencer,"PackageListURI",{enumerable:!1,configurable:!1,writable:!1,value:/^([^?]*\/)?package[.]xml$/i});var CTATActionEvaluationData=function(c){CTATBase.call(this,"CTATActionEvaluationData","actionevaluation");var g=0,f=0,e="",b=c;this.setClassification=function(a){this.classification=a};this.isHint=function(){return"HINT"==b};this.hasClassification=function(){return!0};this.setCurrentHintNumber=function(a){g=a};this.setTotalHintsAvailable=function(a){f=a};this.setHintID=function(a){e=a};this.getClassification=function(){return""};this.setEvaluation=function(a){b=a};this.getEvaluation=function(){return b};
this.getAttributeString=function(){var a="";if(!this.isHint())return a;a+='current_hint_number="'+g+'" ';a+='total_hints_available="'+f+'" ';""!==e&&(a+='hint_id="'+e+'" ');return a}};CTATActionEvaluationData.prototype=Object.create(CTATBase.prototype);CTATActionEvaluationData.prototype.constructor=CTATActionEvaluationData;var CTATVariable=function(){this.value=this.name=""};var CTATCurriculumService=function(c){CTATBase.call(this,"CTATCurriculumService","curriculum_service");var g=[],f=this;this.reset=function(){g=[]};this.addVariable=function(e,b){var a=new CTATVariable;a.name=e;a.value=b;g.push(a)};this.sendSummary=function(e){f.ctatdebug("sendSummary ()");var b=e.getXMLObject(),a=b.getElementsByTagName("ProblemSummary"),a=$("<div>").html(a[0].innerHTML).text(),d=CTATConfiguration.getRawFlashVars();e=d.curriculum_service_url;var h=new CTATXML,l=h.parse(a),h=h.getElementAttr(l,
"CompletionStatus");if(e)CTATLMS.is.TutorShop()&&(a=b.getElementsByTagName("ProblemSummaryJSON"),a=a[0].textContent),h&&h.toLowerCase().startsWith("complete")&&(CTATScrim.scrim.nextProblemScrimUp(),c.assignMessageListener(f),c.assignHandler(f)),g=[],this.addVariable("user_guid",d.user_guid),this.addVariable("session_id",d.session_id),this.addVariable("authenticity_token",d.authenticity_token),this.addVariable("school_name",d.school_name),this.addVariable("summary",a),b=d.target_frame,a=d.reuse_swf,
d=d.run_problem_url,this.addVariable("targetFrame",b),this.addVariable("reuseSWF",a),f.ctatdebug("CTATCurriculumService.sendSummary about to send targetFrame = "+b+", reuseSwf "+a+", runProblemUrl "+d),c.send_post_variables(e,g);else if("complete"==h){var m=CTATGlobals.languageManager.getString("CONGRATULATIONS_YOU_ARE_DONE");CTATScrim.scrim.OKScrimUp(m,function(){var a=CTATShellTools.getAllComponents(),d=a.find(function(a){return"CTATHintWindow"===a.getClassName()});d&&d.showFeedback(m);a.forEach(function(a){return a.lock()});
CTATScrim.scrim.scrimDown()})}};this.processOutgoing=function(e){f.ctatdebug('CTATCurriculumService.processOutgoing("'+e+'")')};this.processIncoming=function(e){var b=flashVars.getRawFlashVars().run_problem_url;f.ctatdebug("CTATCurriculumService.processIncoming("+(e?e.substring(0,12)+"...":"")+") parent.location.replace "+parent.location.replace+', runProblemUrl "'+b+'"');if(b&&parent&&parent.location){var a=CTATCommShell.commShell.getLoggingLibrary();a&&a.then(function(){parent.location.replace(b)},
function(){console.log("CTATCurriculumService: cannot chain to logging lib "+a)})}};this.processMessage=function(e){this.ctatdebug("CTATCurriculumService.processMessage("+(e?e.substring(0,30)+"...":"")+")")};this.updateFlashVars=function(e){f.ctatdebug("UpdateFlashVars ()")};this.checkProtocol=function(e){return"localhost"==e||"127.0.0.1"==e?!0:null===/^http[s]?:\/\/([^\/]+)\//.exec(e)||4096<=e.length?!1:!0}};CTATCurriculumService.prototype=Object.create(CTATBase.prototype);
CTATCurriculumService.prototype.constructor=CTATCurriculumService;var CTATLogMessageBuilder=function(){CTATBase.call(this,"CTATLogMessageBuilder","logmessagebuilder");var c=this,g=[],f=[],e="";this.getStepID=function(){return e};this.setContextName=function(b){CTATLogMessageBuilder.contextGUID=b};this.getContextName=function(){return CTATLogMessageBuilder.contextGUID};this.makeSessionElement=function(){var b=flashVars.getRawFlashVars();return void 0!=b.log_session_id&&null!=b.log_session_id?"<session_id>"+b.log_session_id+"</session_id>":"<session_id>"+b.session_id+
"</session_id>"};this.createContextMessage=function(b){c.ctatdebug("createContextMessage()");var a=new Date,d=flashVars.getRawFlashVars(),e='<context_message context_message_id="'+this.getContextName()+'" name="START_PROBLEM">';b||(e+=this.makeMetaElement(a));void 0!=d.class_name?""!=d.class_name?(b="<class>"+("<name>"+d.class_name+"</name>"),void 0!=d.school_name&&(b+="<school>"+d.school_name+"</school>"),void 0!=d.period_name&&(b+="<period>"+d.period_name+"</period>"),void 0!=d.class_description&&
(b+="<description>"+d.class_description+"</description>"),void 0!=d.instructor_name&&(b+="<instructor>"+d.instructor_name+"</instructor>"),b+="</class>"):b="<class />":b="<class />";e+=b;b=flashVars.getDatasetTypes();var f=flashVars.getDatasetNames();c.ctatdebug("Check: "+b.length+", "+f.length);if(null!=b&&null!=f){c.ctatdebug("We have valid data set names and types, adding to message ...");for(var a="<dataset>"+("<name>"+d.dataset_name+"</name>"),g=0;g<b.length;g++)c.ctatdebug("Adding ..."),a+=
'<level type="'+b[g]+'">',a+="<name>"+f[g]+"</name>";a+="<problem ";c.ctatdebug('Checking vars ["problem_tutorflag"]: '+d.problem_tutorflag);c.ctatdebug('Checking vars ["problem_otherproblemflag"]: '+d.problem_otherproblemflag);if(void 0!=d.problem_tutorflag||void 0!=d.problem_otherproblemflag)void 0!=d.problem_tutorflag?a+=' tutorFlag="'+d.problem_tutorflag+'"':void 0!=d.problem_otherproblemflag&&(a+='tutorFlag="'+d.problem_otherproblemflag+'"');a=a+">"+("<name>"+d.problem_name+"</name>");a=void 0!=
d.problem_context?a+("<context>"+d.problem_context+"</context>"):a+"<context />";a+="</problem>";for(d=0;d<b.length;d++)a+="</level>";e+=a+"</dataset>"}d="";b=flashVars.getConditionNames();a=flashVars.getConditionTypes();f=flashVars.getConditionDescriptions();if(0<b.length)for(g=0;g<b.length;g++)d+="<condition><name>"+b[g]+"</name>",d+=""==a[g]?"":"<type>"+a[g]+"</type>",d+=""==f[g]?"":"<desc>"+f[g]+"</desc>",d+="</condition>";var e=e+d,d=flashVars.getCustomFields(),n;for(n in d)d.hasOwnProperty(n)&&
(b=String(d[n]),b=0>b.indexOf("<![CDATA[")?"<![CDATA["+b+"]]\x3e":b,e+="<custom_field>",e+="<name>"+n+"</name>",e+="<value>"+b+"</value>",e+="</custom_field>");e+="</context_message>";c.ctatdebug("messageString = "+e);return e};this.createSemanticEventToolMessage=function(b,a,d,e,l,m){c.ctatdebug("createSemanticEventToolMessage("+m+")");var h=new Date;flashVars.getRawFlashVars();var p='<tool_message context_message_id="'+this.getContextName()+'">';l||(p+=this.makeMetaElement(h));a='<semantic_event transaction_id="'+
a+'" name="'+d+'"';""!=e&&(a+=' subtype="'+e+'"');void 0!=m&&""!=m&&(a+=' trigger="'+m+'"');p+=a+"/>";e="<event_descriptor>";b=b.toXMLString(!0);p+=e+b+"</event_descriptor>";p+=this.createCustomFields(g,f);p+="</tool_message>";c.ctatdebug("messageString = "+p);return p};this.createUIEventToolMessage=function(b,a,d,e){c.ctatdebug("createUIEventToolMessage()");var h=new Date;flashVars.getRawFlashVars();var m='<tool_message context_message_id="'+this.getContextName()+'">';e||(m+=this.makeMetaElement(h));
m+='<ui_event name="'+a+'">'+d+"</ui_event>";b="<event_descriptor>"+b.toSerializedString();m=m+(b+"</event_descriptor>")+this.createCustomFields(g,f);m+="</tool_message>";c.ctatdebug("messageString = "+m);return m};this.createTutorMessage=function(b,a,d,e,l,m,n,p){c.ctatdebug("createTutorMessage()");var h=new Date;flashVars.getRawFlashVars();var u='<tutor_message context_message_id="'+this.getContextName()+'">';p||(u+=this.makeMetaElement(h));a='<semantic_event transaction_id="'+a+'" name="'+d+'"';
""!==m&&(a+=' subtype="'+m+'"');u+=a+"/>";b="<event_descriptor>"+b.toXMLString(!0);u+=b+"</event_descriptor>";b="<action_evaluation ";e.hasClassification()&&null!=e.getAttributeString()&&(b+=e.getAttributeString());b+=">"+e.getEvaluation()+"</action_evaluation>";u+=b;""!=l&&(u+="<tutor_advice>"+l+"</tutor_advice>");null!=n&&(c.ctatdebug("Adding skills to log message ..."),u+=n.toLogString());u+=this.createCustomFields(g,f);u+="</tutor_message>";c.ctatdebug("messageString = "+u);return u};this.createGenericMessage=
function(b,a){c.ctatdebug("createGenericMessage()");flashVars.getRawFlashVars();var d='<message context_message_id="'+this.getContextName()+'">',d=d+b+"</message>";c.ctatdebug("messageString = "+d);return d};this.makeMetaElement=function(b){c.ctatdebug("makeMetaElement ()");var a=flashVars.getRawFlashVars(),d;d="<meta>"+("<user_id>"+a.user_guid+"</user_id>");d+="<session_id>"+a.session_id+"</session_id>";d+="<time>"+this.formatTimeStamp(b)+"</time>";return d+="<time_zone>"+flashVars.getTimeZone()+
"</time_zone></meta>"};this.createLogSessionStart=function(){c.ctatdebug("createLogSessionStart ()");var b=new Date;c.ctatdebug("Date: "+b);var a='<log_session_start timezone="'+flashVars.getTimeZone()+'" ',d=flashVars.getRawFlashVars(),a=a+('date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(b)+'" '),a=a+('auth_token="'+d.auth_token+'" '),a=a+('session_id="'+d.session_id+'" '),a=a+('user_guid="'+d.user_guid+'" ');return a+'class_id="" treatment_id="" assignment_id="" info_type="tutor_message.dtd"/>'};
this.formatTimeStamp=function(b){c.ctatdebug("formatTimeStamp ("+b+")");var a="",d=b.getUTCFullYear(),a=a+(d+"-"),d=b.getUTCMonth();d++;a+=(10>d?"0"+d:d)+"-";d=b.getUTCDate();a+=(10>d?"0"+d:d)+" ";d=b.getUTCHours();a+=(10>d?"0"+d:d)+":";d=b.getUTCMinutes();a+=(10>d?"0"+d:d)+":";d=b.getUTCSeconds();a+=10>d?"0"+d:d;b=b.getUTCMilliseconds();return a+"."+b};this.resetCustomFields=function(){c.ctatdebug("resetCustomFields ()");g=[];f=[]};this.createCustomFields=function(b,a){c.ctatdebug("createCustomFields ()");
if(null==b||null==a)return c.ctatdebug("No custom fields provided"),"";c.ctatdebug("Processing "+b.length+" custom fields ...");for(var d="",f=0;f<b.length;f++){c.ctatdebug("Adding custom field: ["+b[f]+"],["+a[f]+"]");var g=String(a[f]);/step[-_.]?id/i.test(b[f])&&(e=g);g=0>g.indexOf("<![CDATA[")?"<![CDATA["+g+"]]\x3e":g;d+="<custom_field>";d+="<name>"+b[f]+"</name>";d+="<value>"+g+"</value>";d+="</custom_field>"}return d};this.addCustomFields=function(b,a){c.ctatdebug("addCustomFields () "+(b?b.length:
"null"));if(void 0!=b)for(var d=0;d<b.length;d++)g.push(b[d]),f.push(a[d])};this.addCustomField=function(b,a){c.ctatdebug("addCustomfield ("+b+","+a+")");g.push(b);f.push(a)};this.getCustomFieldNames=function(){return g};this.getCustomFieldValues=function(){return f}};CTATLogMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATLogMessageBuilder.prototype.constructor=CTATLogMessageBuilder;CTATLogMessageBuilder.contextGUID="";
CTATLogMessageBuilder.formatTimeStampOLI=function(c){ctatdebug("formatTimeStampOLI ("+c+")");var g="",f=c.getUTCFullYear(),g=g+(f+"/"),f=c.getUTCMonth();f++;g+=(10>f?"0"+f:f)+"/";f=c.getUTCDate();g+=(10>f?"0"+f:f)+" ";f=c.getUTCHours();g+=(10>f?"0"+f:f)+":";f=c.getUTCMinutes();g+=(10>f?"0"+f:f)+":";f=c.getUTCSeconds();g+=10>f?"0"+f:f;c=c.getUTCMilliseconds();return g+"."+c};
CTATLogMessageBuilder.wrapForOLI=function(c){ctatdebug("wrapForOLI ()");var g=new Date,f=flashVars.getRawFlashVars();c=encodeURIComponent(c);var e;e='<?xml version="1.0" encoding="UTF-8"?><log_action '+('auth_token="'+encodeURIComponent(f.auth_token)+'" ');e=void 0!=f.log_session_id&&null!=f.session_id?e+('session_id="'+f.log_session_id+'" '):e+('session_id="'+f.session_id+'" ');e=e+'action_id="EVALUATE_QUESTION" '+('user_guid="'+f.user_guid+'" ');e+='date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(g)+
'" ';e+='timezone="'+flashVars.getTimeZone()+'" ';e+='source_id="'+f.source_id+'" ';e=f.activity_context_guid?e+('external_object_id="'+f.activity_context_guid+'" info_type="tutor_message.dtd">'):e+'external_object_id="" info_type="tutor_message.dtd">';return e+c+"</log_action>"};var CTATCustomLogElementObject=function(){this.reset=function(){};this.addCustomLogElement=function(c,g){customElementsNames.push(c);customElementsTypes.push(c)};this.getCustomElementNames=function(){return customElementsNames};this.getCustomElementTypes=function(){return customElementsTypes}};var loggingDisabled=!1,CTATLoggingLibrary=function(c,g){CTATBase.call(this,"CTATLoggingLibrary","logginglibrary");var f=this,e=!0,b="undefined"==typeof c?!0:c,a=!1,d=[],h="undefined",l="undefined",m="undefined",n="undefined",p="undefined",r="undefined",u="undefined",w="undefined",q="UnassignedDataset",y="UnassignedLevelName",z="UnassignedLevelType",B=null,v=null,E=null,w=CTATGuid.guid(),C=new CTATCommLibrary;C.setName("commLoggingLibrary");C.setUseCommSettings(!1);C.setConnectionRefusedMessage("ERROR_CONN_LS");
C.assignHandler(this);C.setFixedURL(CTATConfiguration.get("log_service_url"));this.extCommLogMessageBuilder=g;this.getLastSAI=function(){return v};this.assignLogListener=function(a){B=a};this.generateSession=function(){d.session_id="ctat_session_"+CTATGuid.guid();return d.session_id};this.setLogClassName=function(a){h=a};this.setDatasetName=function(a){q=a};this.setDatasetLevelName=function(a){y=a};this.setDatasetLevelType=function(a){z=a};this.setSchool=function(a){l=a};this.setPeriod=function(a){m=
a};this.setDescription=function(a){n=a};this.setInstructor=function(a){p=a};this.setProblemName=function(a){r=a};this.setProblemContext=function(a){u=a};this.setUserID=function(a){w=a};this.getLoggingCommLibrary=function(){return C};this.setUseSessionLog=function(a){e=a};this.setLoggingURL=function(a){f.getLoggingCommLibrary().setFixedURL(a)};this.getSessionIdentifierBundle=function(){var a=[];a.class_name=h;a.school_name=l;a.period_name=m;a.class_description=n;a.instructor_name=p;a.dataset_name=
q;a.problem_name=r;a.problem_context=u;a.auth_token="";a.user_guid=w;a.session_id=d.session_id;a.source_id="tutor";a.dataset_level_name1=y;a.dataset_level_type1=z;return a};this.setupExternalLibraryUsage=function(){f.ctatdebug("setupExternalLibraryUsage ()");d.class_name=h;d.school_name=l;d.period_name=m;d.class_description=n;d.instructor_name=p;d.dataset_name=q;d.problem_name=r;d.problem_context=u;d.auth_token="";d.user_guid=w;d.session_id="ctat_session_"+CTATGuid.guid();d.source_id="tutor";d.dataset_level_name1=
y;d.dataset_level_type1=z;flashVars=CTATConfiguration.generateDefaultConfigurationObject();flashVars.assignRawFlashVars(d)};this.initCheck=function(){f.ctatdebug("initCheck ()");0==b&&0==a&&(f.setupExternalLibraryUsage(),a=!0)};this.sendMessage=function(a,d){f.ctatdebug("sendMessage ()");f.ctatdebug("Raw log message to send (info "+d+"): "+a);this.sendMessageInternal(a,d);null!=B&&B(a)};this.sendMessageInternal=function(a,d){f.ctatdebug("sendMessageInternal ()");if(!0===loggingDisabled)f.ctatdebug("Warning: loggingDisabled==true");
else if(1==b){var e=CTATConfiguration.get("Logging");if("ClientToService"!=e&&"ClientToLogServer"!=e)f.ctatdebug("Logging is turned off, as per: "+e);else{var c=CTATConfiguration.get("tutoring_service_communication");"ClientToService"!=e||"http"!=c&&"https"!=c||(e=CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),f.setLoggingURL(e),f.ctatdebug("Reconfigured the logging url to be: "+e));f.ctatdebug("Pre encoded log message: "+a);e=a;0>a.indexOf("<log_session_start")&&
(e=CTATLogMessageBuilder.wrapForOLI('<?xml version="1.0" encoding="UTF-8"?><tutor_related_message_sequence version_number="4">'+a+"</tutor_related_message_sequence>"));f.ctatdebug("Encoded log message: "+e);E=CTATLMS.logEvent(e,a,d);CTATConfiguration.get("log_service_url")&&C.sendXMLNoBundle(e)}}else f.ctatdebug("Use internal: "+b)};this.startProblem=function(){f.ctatdebug("startProblem ()");f.initCheck();f.logSessionStart();var a=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;f.sendMessage(a.createContextMessage(!0),
{datashopType:"context"})};this.logSessionStart=function(){f.ctatdebug("logSessionStart ()");f.initCheck();var a=CTATConfiguration.getRawFlashVars();void 0!=a.SessionLog&&("false"==a.SessionLog||"boolean"==typeof a.SessionLog&&!1===a.SessionLog?(f.ctatdebug("Turning SessionLog off ..."),e=!1):(f.ctatdebug("Turning SessionLog on ..."),e=!0));!0===e&&(a=f.extCommLogMessageBuilder||new CTATLogMessageBuilder,this.sendMessage(a.createLogSessionStart(),{datashopType:"sessionStart"}))};this.logSemanticEvent=
function(a,d,b,e,c,h,g){f.ctatdebug("logSemanticEvent ("+g+")");f.initCheck();v=d;var m=new Date,l=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;l.resetCustomFields();l.addCustomFields(c,h);l.addCustomField("tool_event_time",l.formatTimeStamp(m)+" UTC");a=l.createSemanticEventToolMessage(d,a,b,e,!0,g);this.sendMessage(a,{datashopType:"tool",semanticName:b,sai:d})};this.logTutorResponse=function(a,d,b,e,c,h,g,m,l){f.ctatdebug("logTutorResponse ()");f.initCheck();v=d;var n=new Date,q=f.extCommLogMessageBuilder||
new CTATLogMessageBuilder;q.resetCustomFields();q.addCustomFields(m,l);q.addCustomField("tutor_event_time",q.formatTimeStamp(n)+" UTC");f.ctatdebug("Formatting feedback ...");void 0!=h&&null!=h?h="<![CDATA["+CTATGlobals.languageManager.filterString(h)+"]]\x3e":(f.ctatdebug("No feedback provided, using empty string"),h="");f.ctatdebug("Creating tutor message ...");a=q.createTutorMessage(d,a,b,c,h,e,g,!0);this.sendMessage(a,{datashopType:"tutor",semanticName:b,stepID:q.getStepID(),sai:d,evaluation:c&&
c.getEvaluation?c.getEvaluation():"",tutorAdvice:h});return a};this.processMessage=function(a){f.ctatdebug("processMessage ()");f.ctatdebug("Response from log server: "+a)};this.start=function(){f.ctatdebug("start ()");var a=f.generateSession();f.startProblem();return a};this.logInterfaceAttempt=function(a,d,b,e){f.ctatdebug("logInterfaceAttempt ()");e=CTATGuid.guid();a=new CTATSAI(a,d,b);a.setInput(b);v=a;this.logSemanticEvent(e,a,"ATTEMPT","");return e};this.logInterfaceAttemptSAI=function(a,d){f.ctatdebug("logInterfaceAttemptSAI ()");
v=a;var b=CTATGuid.guid();this.logSemanticEvent(b,a,"ATTEMPT","");return b};this.logResponse=function(a,d,b,e,c,h,g,m){f.ctatdebug("logResponse ()");d=new CTATSAI(d,b,e);d.setInput(e);e=new CTATActionEvaluationData("");e.setEvaluation(h);void 0==m?this.logTutorResponse(a,d,c,"",e,g):this.logTutorResponse(a,d,c,"",e,g,null,m.getCustomElementNames(),m.getCustomElementTypes())};this.logResponseSAI=function(a,d,b,e,c,h){f.ctatdebug("logResponse ()");var g=new CTATActionEvaluationData("");g.setEvaluation(e);
void 0==h?this.logTutorResponse(a,d,b,"",g,c):this.logTutorResponse(a,d,b,"",g,c,null,h.getCustomElementNames(),h.getCustomElementTypes())};this.endSession=function(){this.generateSession()};this.then=function(a,d){var b=[];C&&"function"==typeof C.then&&b.push(C);E&&"function"==typeof E.then&&b.push(E);return Promise.allSettled(b).then(a,d)}};CTATLoggingLibrary.prototype=Object.create(CTATBase.prototype);CTATLoggingLibrary.prototype.constructor=CTATLoggingLibrary;var CTATComponentDescription=function(){CTATBase.call(this,"CTATComponentDescription","");this.groupName=this.name=this.type="Unknown";this.height=this.width=this.y=this.x=0;this.tabIndex=this.zIndex=-1;this.styles={};this.params={};this.componentPointer=null;this.setComponentPointer=function(c){this.componentPointer=c};this.getComponentPointer=function(){return this.componentPointer};this.setGenericDefaults=function(){this.name="Generic name";this.styles={BackgroundColor:null,BorderColor:null,FontName:null,
FontSize:null,FontColor:null,FontBold:null,FontItalic:!1,FontUnderlined:!1,TextAlign:null,ShowHintHighlight:!1,blockOnCorrect:!1,disabledBackgroundColor:"#999999",disabledTextColor:"#999999",tutorComponent:null};return this}};CTATComponentDescription.prototype=Object.create(CTATBase.prototype);CTATComponentDescription.prototype.constructor=CTATComponentDescription;var CTATShellTools={ctat_base:new CTATBase("CTATShellTools","shelltools"),component_descriptions:{},registerComponentDescription:function(c){CTATShellTools.ctat_base.ctatdebug("registerComponentDescription ("+c.name+","+c.type+")");CTATShellTools.component_descriptions[c.name]=c},listComponents:function(){CTATShellTools.ctat_base.ctatdebug("listComponents ()");var c=CTATShellTools.component_descriptions,g;for(g in c){var f=c[g];CTATShellTools.ctat_base.ctatdebug("Obtaining component for "+f.name+
" with type: "+f.type);f=f.getComponentPointer();null!==f?CTATShellTools.ctat_base.ctatdebug("Component: "+f.getName()+" of instance: "+f.getClassName()):CTATShellTools.ctat_base.ctatdebug("Error: component pointer is null")}},feedback_components:[],registerFeedbackComponent:function(c,g,f,e,b){CTATShellTools.feedback_components.push({component:c,next:g,prev:f,showHints:e,showFeedback:b})},showNextHint:function(){CTATShellTools.feedback_components.forEach(function(c){c.next&&c.next.bind(c.component)()})},
showPrevHint:function(){CTATShellTools.feedback_components.forEach(function(c){c.prev&&c.prev.bind(c.component)()})},showFeedback:function(c){0==CTATShellTools.feedback_components.length?CTATScrim.scrim.OKScrimUp(c,null):CTATShellTools.feedback_components.forEach(function(g){g.showFeedback&&g.showFeedback.bind(g.component)(c)})},showHints:function(c){CTATShellTools.feedback_components.forEach(function(g){g.showHints&&g.showHints.bind(g.component)(c)})},getCurrentMs:function(){return(new Date).valueOf()},
getAllComponents:function(){var c=[];$(".CTATComponent").each(function(){c.push($(this).data("CTATComponent"))});return c},getNameFromGroup:function(c){CTATShellTools.ctat_base.ctatdebug("getNameFromGroup ("+c+")");var g=c.split(" ");return 1==g.length?c:g[0].substring(0,g[0].length-1)},findComponent:function(c){var g=CTATShellTools.component_descriptions,f=[],e=null;CTATShellTools.ctat_base.ctatdebug("findComponent("+c+")");if(!c)return[];for(var b=['div[data-ctat-component]:has(input[name="'+c+
'"])',"done"==c.toLowerCase()?".CTATDoneButton":"","hint"==c.toLowerCase()||"help"==c.toLowerCase()?".CTATHintButton":""],e=$('[id="'+c+'"]'),a=0;0===e.length&&a<b.length;a++)e=$(b[a]);if(0<e.length&&(e.each(function(){$(this).data("CTATComponent")&&f.push($(this).data("CTATComponent"))}),0<f.length))return f;CTATShellTools.ctat_base.ctatdebug("JQuery couldn't find the component, let's try our internal list ...");for(var d in g){e=g[d];if(!e||!e.name||!e.getComponentPointer())return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+
d+(e?e.name?"(no component pointer)":"(no name attribute)":"")),null;CTATShellTools.ctat_base.ctatdebug("Comparing "+e.name+" to: "+c);if(e.name==c)return CTATShellTools.ctat_base.ctatdebug("Found a component description for ["+e.name+"], returning pointer ("+e.getComponentPointer()+") ..."),f.push(e.getComponentPointer()),f;e.groupName==c&&(CTATShellTools.ctat_base.ctatdebug("Found the component group ("+e.groupName+"), adding component instance for "+e.name+" ..."),f.push(e.getComponentPointer()))}return 0===
f.length&&(CTATShellTools.ctat_base.ctatdebug("Info (groupArray.length==0), no appropriate component found, perhaps this is a group component"),-1!=c.indexOf("."))?(c=c.split("."),this.findComponent(c[0])):f},findComponentInstance:function(c,g){var f=CTATShellTools.findComponent(c,g);return 1==f.length?f[0]:f},findComponentByClass:function(c){var g=CTATShellTools.component_descriptions,f;for(f in g){var e=g[f];if(null===e)return null;if(null!==e.getComponentPointer()&&e.getComponentPointer().getClassName()==
c)return e.getComponentPointer()}c=$("."+c);return 0<c.length?c.first().data("CTATComponent"):null}};var CTATTutoringServiceMessageBuilder=function(){CTATBase.call(this,"CTATTutoringServiceMessageBuilder","__undefined__");this.createStartProblemMessage=function(c){this.ctatdebug("createStartProblemMessage ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>StartProblem</MessageType><ProblemName>"+c+"</ProblemName></properties></message>"};this.createInterfaceIdentificationMessage=function(c){this.ctatdebug("createInterfaceIdentificationMessage ("+c+")");return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceIdentification</MessageType><Guid>"+
c+"</Guid></properties></message>"};this.createInterfaceDescriptionMessage=function(c){this.ctatdebug("createInterfaceDescriptionMessage ()");message="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceDescription</MessageType>";message+="<WidgetType>"+c.getClassName()+"</WidgetType>";message+="<CommName>"+c.getName()+"</CommName>";message+="<UpdateEachCycle>false</UpdateEachCycle>";message+="<serialized>";message+="<"+c.getClassName()+' name="'+c.getName()+'" x="0" y="0" width="50" height="30" scaleX="1" scaleY="1" originalWidth="50" originalHeight="30" zIndex="-1" tabIndex="-1">';
message+="<Parameters><selection>";if("CTATRadioButton"==c.getClassName()||"CTATCheckBox"==c.getClassName())message+="<CTATComponentParameter>",message+="<name>group</name>",message+='<value fmt="text" name="Group Name" type="String" includein="sparse">'+c.getComponentGroup()+"</value>",message+="</CTATComponentParameter>";message+="</selection></Parameters>";message+="</"+c.getClassName()+">";message+="</serialized>";return message+="</properties></message>"};this.createSetPreferencesMessage=function(c,
g){this.ctatdebug("createSetPreferencesMessage ()");var f=CTATConfiguration.getRawFlashVars(),e;e="<message><verb>NotePropertySet</verb><properties><MessageType>SetPreferences</MessageType>"+("<log_service_url>"+f.log_service_url+"</log_service_url>");var b=!1,a=!1,d=f.Logging;this.ctatdebug("Parsing and processing logMethod: "+d);switch(d){case "ServiceToLogServer":b=!0;break;case "ServiceToDisk":a=!0;break;case "ServiceToDiskAndLogServer":a=b=!0;break;case "ClientToLogServer":a=b=!1;break;case "ClientToService":a=
b=!0}e=e+("<log_to_remote_server>"+b+"</log_to_remote_server><log_to_disk>"+a+"</log_to_disk>")+("<log_to_disk_directory>"+f.log_to_disk_directory+"</log_to_disk_directory>");e+="<logging>"+f.Logging+"</logging>";e+="<user_guid>"+f.user_guid+"</user_guid>";e+="<problem_name>"+f.problem_name+"</problem_name>";e+="<question_file><![CDATA["+f.question_file+"]]\x3e</question_file>";e+="<class_name>"+f.class_name+"</class_name>";e+="<school_name>"+f.school_name+"</school_name>";e+="<instructor_name>"+
f.instructor_name+"</instructor_name>";e+="<session_id>"+f.session_id+"</session_id>";e+="<source_id>"+f.source_id+"</source_id>";e+="<sui><![CDATA["+f.sui+"]]\x3e</sui>";e+="<problem_state_status>"+f.problem_state_status+"</problem_state_status>";e+="<curriculum_service_url>"+f.curriculum_service_url+"</curriculum_service_url>";e+="<restore_problem_url>"+f.restore_problem_url+"</restore_problem_url>";e+="<tutoring_service_communication>"+f.tutoring_service_communication+"</tutoring_service_communication>";
e+="<mode>"+f.mode+"</mode>";e+="<collaborators>"+f.collaborators+"</collaborators>";null!==CTATSkillSet.skills&&(e+=CTATSkillSet.skills.toSetPreferencesXMLString());e+="<CommShellVersion>"+c+"</CommShellVersion>";g&&(e+=g);return""+(e+"</properties></message>")};this.createTracerActionMessage=function(c,g){this.ctatdebug("createTracerActionMessage ()");var f;f="<message><verb>NotePropertySet</verb><properties><MessageType>TracerAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+g.toXMLString(!1);
return""+(f+"</properties></message>")};this.createInterfaceActionMessage=function(c,g){this.ctatdebug("createInterfaceActionMessage ()");var f;f="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")};this.createUntutoredActionMessage=function(c,g){this.ctatdebug("createUntutoredActionMessage ("+c+")");var f;f="<message><verb>NotePropertySet</verb><properties><MessageType>UntutoredAction</MessageType>"+
("<transaction_id>"+c+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")};this.createProblemSummaryRequestMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemSummaryRequest</MessageType></properties></message>"};this.createProblemRestoreEndMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemRestoreEnd</MessageType></properties></message>"};this.createInterfaceConfigurationEnd=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceConfigurationEnd</MessageType></properties></message>"};
this.createInCorrectActionMessage=function(c,g){this.ctatdebug("createInCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")};this.createURLResponse=function(c,g){CTATGlobal.debug(classType,"createURLResponse ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+
c+" ]]\x3e</URL><content><![CDATA[ "+btoa(g)+" ]]\x3e</content></properties></message>"};this.createCorrectActionMessage=function(c,g){this.ctatdebug("createCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")}};CTATTutoringServiceMessageBuilder.prototype=Object.create(CTATBase.prototype);
CTATTutoringServiceMessageBuilder.prototype.constructor=CTATTutoringServiceMessageBuilder;var CTATMessageHandler=function(c){function g(){var a=!1,d,c=[],f="";for(d=b.length-1;0<=d;--d)if("SendWidgetLock"==b[d].getMessageType())switch(c=b.splice(d,1),f=c[0].getProperty("WidgetLockFlag"),String(f).toLowerCase()){case "no":case "off":case "false":a=!1;break;default:a=!0}e.ctatdebug("checkForSendWidgetLock() found "+c.length+" msg, wlFlag "+f+", result"+a);return a}CTATBase.call(this,"CTATMessageHandler","messagehandler");var f=null,e=this,b=[],a=null,d=0,a=CTATConfig.parserType_is_XML()?
new CTATXML:new CTATJSON;this.assignHandler=function(a){e.ctatdebug("assignHandler ()");f=a};this.reset=function(){e.ctatdebug("reset ()");b=[]};this.getInStartState=function(){return CTATMessageHandler.inStartState};var h=!1;this.receiveFromTutor=function(a){this.processMessage(a)};this.processMessage=function(d){e.ctatdebug("Incoming message: "+d);if(!0!==h)if(CTATConfig.parserType_is_JSON()&&-1!=d.indexOf("<?xml"))alert("Error: CTAT is configured to parse JSON but it received an XML message, disabling comm capabilities ..."),
h=!0;else if(CTATConfig.parserType_is_XML()&&0===d.indexOf("{"))alert("Error: CTAT is configured to parse XML but it received a JSON message, disabling comm capabilities ..."),h=!0;else{var b;e.ctatdebug("Attempting parse ...");b=a.parse(d);null===b?e.ctatdebug("Error parsing message: "+d):this.parseElement(b,d)}};this.parseElement=function(d,b){var c=a.getElementName(d);e.ctatdebug("parseElement ("+c+")");"CTATResponseMessages"!=c&&"StartStateMessages"!=c&&"MessageBundle"!=c||this.processMessageBundle(d);
"message"==c&&this.processSingleMessage(d,b)};this.processMessageBundle=function(d,b){var c=a.getElementName(d);e.ctatdebug("processMessageBundle ("+c+")");c=a.getElementChildren(d);if(null===c)e.ctatdebug("Error parsing bundle");else{ctatdebug("Processing "+c.length+" objects in bundle");for(var f=0;f<c.length;f++)this.parseElement(c[f])}};this.processSingleMessage=function(h,g){e.ctatdebug("processSingleMessage ("+a.getElementName(h)+")");c.sendToTools(g);g=new CTATMessage(h);var m=g.getProperty("subtype"),
m=!m||/tutor/i.test(m)?"tutor":m;f.updateLastActionTimestamp&&f.updateLastActionTimestamp();var l=a.getElementChildren(h);e.ctatdebug("Generated CTATMessage, now doing regular processing ...");for(var r=0;r<l.length;r++){var u=l[r];if("properties"==a.getElementName(u)){e.ctatdebug("Parsing properties ...");for(var w=a.getElementChildren(u),q=0;q<w.length;q++){var y=w[q];if("MessageType"==a.getElementName(y)){y=a.getNodeTextValue(y);e.ctatdebug("MessageType: "+y);switch(y){case "StateGraph":ctatdebug("Setting inStartState to true");
CTATMessageHandler.inStartState=!0;c.setGotProblemRestoreEnd(!1);this.processStateGraph(u);c.propagateShellEvent("StateGraph",g);break;case "StartProblem":e.ctatdebug("Setting inStartState to true");CTATMessageHandler.inStartState=!0;c.setGotProblemRestoreEnd(!1);this.processStartProblem(w);c.propagateShellEvent("StartProblem",g);break;case "InterfaceIdentification":this.processInterfaceIdentification(w);c.propagateShellEvent("InterfaceIdentification",g);break;case "InterfaceDescription":this.processInterfaceDescription(w);
c.propagateShellEvent("InterfaceDescription",g);break;case "GetAllInterfaceDescriptions":c.sendInterfaceDescriptionMessages();c.propagateShellEvent("GetAllInterfaceDescriptions",g);break;case "SendWidgetLock":e.ctatdebug("Found: SendWidgetLock");!0===this.getInStartState()&&b.push(g);c.propagateShellEvent("SendWidgetLock",g);break;case "CorrectAction":e.ctatdebug("Found: CorrectAction");!0===this.getInStartState()?b.push(g):f.processCorrectAction(g);c.propagateShellEvent("CorrectAction",g);break;
case "InCorrectAction":e.ctatdebug("Found: InCorrectAction");!0===CTATMessageHandler.inStartState?b.push(g):(e.ctatdebug("Handing incorrect message to messagehandler ..."),f.processInCorrectAction(g));c.propagateShellEvent("InCorrectAction",g);break;case "HighlightMsg":e.ctatdebug("Found: HighlightMsg");f.processHighlightMsg(g);c.propagateShellEvent("HighlightMsg",g);break;case "UnHighlightMsg":e.ctatdebug("Found: UnHighlightMsg");f.processUnHighlightMsg(g);c.propagateShellEvent("UnHighlightMsg",
g);break;case "AssociatedRules":e.ctatdebug("Found: AssociatedRules ("+w.length+")");for(var z=y="",B="",v=0;v<w.length;v++){var E=w[v];switch(a.getElementName(E)){case "TutorAdvice":y=a.getNodeTextValue(E);break;case "Actor":m=a.getNodeTextValue(E);break;case "Indicator":z=a.getNodeTextValue(E);break;case "StepID":a.getNodeTextValue(E);break;case "LogAsResult":a.getNodeTextValue(E);break;case "tool_selection":case "StudentSelection":B=a.getNodeTextValue(E);break;case "Skills":e.ctatdebug("Processing skills ..."),
null===CTATSkillSet.skills&&(e.ctatdebug("Interesting, there isn't a skillSet object yet. Creating ..."),CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(E)}}f.processAssociatedRules(g,z,y,B);c.propagateShellEvent("AssociatedRules",g,m);break;case "BuggyMessage":e.ctatdebug("Found: BuggyMessage");f.processBuggyMessage(g);c.propagateShellEvent("BuggyMessage",g);break;case "SuccessMessage":e.ctatdebug("Found: SuccessMessage");f.processSuccessMessage(g);c.propagateShellEvent("SuccessMessage",
g);break;case "InterfaceAction":e.ctatdebug("Found: InterfaceAction");y=g.getSAI();-1!=y.getAction().indexOf(":")?(e.ctatdebug("Processing and storing timed interface action : "+y.getAction()),z=parseInt(y.getAction().substring(y.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+z),y.setAction(y.getAction().substring(0,y.getAction().indexOf(":"))),e.ctatdebug("Timing ..."),setTimeout(f.processInterfaceAction,z,g),setTimeout(c.propagateShellEvent,z,"InterfaceAction",g,m)):(e.ctatdebug("Processing regular (non-timed) interface action"),
!0===CTATMessageHandler.inStartState?(e.ctatdebug("inStartState==true => storing for later playback ..."),b.push(g)):(f.processInterfaceAction(g),c.propagateShellEvent("InterfaceAction",g,m)));break;case "UntutoredAction":e.ctatdebug("Found: UntutoredAction");y=g.getSAI();-1!=y.getAction().indexOf(":")?(e.ctatdebug("Processing and storing timed interface action : "+y.getAction()),z=parseInt(y.getAction().substring(y.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+z),y.setAction(y.getAction().substring(0,
y.getAction().indexOf(":"))),e.ctatdebug("Timing ..."),setTimeout(f.processUntutoredAction,z,g),setTimeout(c.propagateShellEvent,z,"UntutoredAction",g,m)):(e.ctatdebug("Processing regular (non-timed) interface action"),!0===CTATMessageHandler.inStartState?(e.ctatdebug("inStartState==true => storing for later playback ..."),b.push(g)):(f.processUntutoredAction(g),c.propagateShellEvent("UntutoredAction",g,m)));break;case "InterfaceIdentification":e.ctatdebug("Found: InterfaceIdentification");c.propagateShellEvent("InterfaceIdentification",
g);break;case "AuthorModeChange":e.ctatdebug("Found: AuthorModeChange");f.globalReset();c.propagateShellEvent("AuthorModeChange",g);break;case "ResetAction":e.ctatdebug("Found: ResetAction");f.globalReset();c.propagateShellEvent("ResetAction",g);break;case "ShowHintsMessage":e.ctatdebug("Found: ShowHintsMessage");y=!1;z=[];for(B=0;B<w.length;B++)if(v=w[B],"HintsMessage"==a.getElementName(v))for(v=a.getElementChildren(v),E=0;E<v.length;E++){var C=v[E];"value"==a.getElementName(C)&&(z.push(a.getNodeTextValue(C)),
y=!0)}!0===y?f.processHintResponse(g,z):e.ctatdebug("Error: incomplete hint message received");c.propagateShellEvent("ShowHintsMessage",g);break;case "ConfirmDone":e.ctatdebug("Found: ConfirmDone");f.processConfirmDone(g);c.propagateShellEvent("ConfirmDone",g);break;case "VersionInfo":e.ctatdebug("Found: VersionInfo");f.processVersionInfo(w);c.propagateShellEvent("VersionInfo",g);break;case "TutoringServiceAlert":e.ctatdebug("Found: TutoringServiceAlert");f.processTutoringServiceAlert(w);c.propagateShellEvent("TutoringServiceAlert",
g);break;case "TutoringServiceError":y=g.getProperty("Action");e.ctatdebug("Found: TutoringServiceError - actor "+m+", action "+y);var A;y&&(A=CTATSAI.delayedActionRegExp.exec(y))&&2<A.length&&1<A[2]?(z=parseInt(A[2]),g.setProperty("Action",A[1]),e.ctatdebug("Delaying TutoringServiceError by "+z+" ..."),setTimeout(f.processTutoringServiceError,z,g),setTimeout(c.propagateShellEvent,z,"TutoringServiceError",g,m)):(f.processTutoringServiceError(g),c.propagateShellEvent("TutoringServiceError",g,m));break;
case "ProblemSummaryResponse":e.ctatdebug("Found: ProblemSummaryResponse");f.processProblemSummaryResponse(g);c.propagateShellEvent("ProblemSummaryResponse",g);break;case "StartStateEnd":e.ctatdebug("Found: StartStateEnd");CTATShellTools.listComponents();null!==f?f.processStartState():this.ctatdebug("Error: no message handler object available to process start state");try{e.processStartStateActions()}catch(F){e.ctatdebug("Caught in the act: "+F.message)}CTATMessageHandler.inStartState=!1;c.propagateShellEvent("StartStateEnd",
g);break;case "ProblemRestoreEnd":e.ctatdebug("Found: ProblemRestoreEnd");f.processProblemRestoreEnd(g);c.propagateShellEvent("ProblemRestoreEnd",g);break;case "GetURL":e.ctatdebug("Found: GetURL");f.processGetURL(g);c.propagateShellEvent("GetURL",g);break;case "SetPreferences":f.forwardToTutor(g);return;case "InterfaceReboot":d++;ctatdebug("Found: InterfaceReboot #"+d+" -- href "+(location?location.href:"(no location)"));1<d&&!CTAT.ToolTutor.reboot("InterfaceReboot from CTATMessageHandler")&&(y=
"ws://"+CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),ctatdebug("closing connection w/ url: "+y),c.closeWSConnection(y,function(){var a=window.frameElement.getAttribute("id");"function"==typeof CustomEvent&&(a=new CustomEvent("refreshIframe",{detail:a}),window.parent.document.dispatchEvent(a))},"interfaceReboot"));break;case "NoOp":m=g&&g.getTransactionID();l=g&&g.getSAI();ctatdebug("NoOp transactionID "+m+", SAI "+l);return}(y=/student[0-9]+/i.exec(m))&&y[0]==
m&&f.forwardToTutor(g)}}}}};this.processStateGraph=function(d){e.ctatdebug("processStateGraph ()");if(void 0===d||null===d)e.ctatdebug("Error: state graph property list is undefined");else if(e.ctatdebug("Processing node: "+d.nodeName),null===a.getElementChildren(d))e.ctatdebug("Error: state graph property list is undefined");else{d=a.getElementChildren(d);for(var b=0;b<d.length;b++){var c=d[b],g=a.getElementName(c),h=a.getNodeTextValue(c);e.ctatdebug("State graph attribute: "+g+" = "+h);"suppressStudentFeedback"==
g&&(CTATGlobals.suppressStudentFeedback="false"==h?!1:!0);"confirmDone"==g&&(e.ctatdebug("Confirm done: "+h),CTATGlobals.confirmDone="true"==h?!0:!1);"Skills"==g&&(null===CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(c),f.updateSkillWindow())}}};this.processStartProblem=function(a){e.ctatdebug("processStartProblem ()");f.processStartProblem()};this.processInterfaceIdentification=function(a){};this.processInterfaceDescription=function(d){e.ctatdebug("processInterfaceDescription ("+
d.length+")");for(var b="Unknown",c="Unknown",f=null,g=0;g<d.length;g++){var h=d[g];e.ctatdebug("Inspecting element: "+a.getElementName(h));"WidgetType"==a.getElementName(h)&&(e.ctatdebug("Widget type: "+a.getNodeTextValue(h)),b=a.getNodeTextValue(h));"CommName"==a.getElementName(h)&&(e.ctatdebug("Instance name: "+a.getNodeTextValue(h)),c=a.getNodeTextValue(h));if("serialized"==a.getElementName(h)){e.ctatdebug("Prepareing to de-serialize component ...");for(var l=a.getElementChildren(h),q=0;q<l.length;q++){var y=
l[q];-1!=a.getElementName(y).indexOf("CTAT")&&(f=y)}}"interface"==a.getElementName(h)&&(e.ctatdebug("Storing interface for post start-state reconstruction ..."),CTATGlobals.interfaceElement=h);"script"==a.getElementName(h)&&(e.ctatdebug("Storing and loading main javascript code as defined by the BRD ..."),scriptElement=a.getNodeTextValue(h))}null!==f?this.deserializeComponent(b,c,f):e.ctatdebug("Error: unable to find CTAT serialization point of attachement");e.ctatdebug("processInterfaceDescription () done")};
this.deserializeComponent=function(d,b,c){e.ctatdebug("deserializeComponent ("+d+","+b+")");if(!0===CTATGlobals.ignoreInterfaceDescriptions)e.ctatdebug("ignoreInterfaceDescriptions==true");else if(null===a.getElementAttr(c,"x"))e.ctatdebug("Warning: this component does not have x,y information. Probably an older component");else{var f=a.getElementAttr(c,"x"),g=a.getElementAttr(c,"y"),h=a.getElementAttr(c,"width"),m=a.getElementAttr(c,"height"),l=a.getElementAttr(c,"tabIndex"),n=a.getElementAttr(c,
"zIndex");null===l&&(l=-1);null===n&&(n=0);var z=new CTATComponentDescription;z.type=d;z.name=b;z.x=Math.floor(f);z.y=Math.floor(g);z.tabIndex=l;z.zIndex=n;z.width=Math.floor(h);z.height=Math.floor(m);CTATShellTools.registerComponentDescription(z);c=a.getElementChildren(c);for(f=0;f<c.length;f++){g=c[f];a.getElementName(g);if("Parameters"==a.getElementName(g))for(this.ctatdebug("Processing component parameters ..."),h=a.getElementChildren(g)[0],h=a.getElementChildren(h),m=0;m<h.length;m++){var B=
h[m];if("CTATComponentParameter"==a.getElementName(B)){this.ctatdebug("Processing parameter property (CTATComponentParameter) ...");for(var n=l=void 0,B=a.getElementChildren(B),v=0;v<B.length;v++){var E=B[v];"name"==a.getElementName(E)&&(this.ctatdebug("Found parameter name: "+a.getNodeTextValue(E)),l=a.getNodeTextValue(E));"value"==a.getElementName(E)&&(this.ctatdebug("Found parameter value: "+a.getNodeTextValue(E)),n=a.getNodeTextValue(E).trim())}this.ctatdebug("Parameter name: "+l+", value: "+
n);void 0!==l&&(z.params[l]=n,"group"==l&&(z.groupName=n))}}if("Styles"==a.getElementName(g))for(this.ctatdebug("Processing component styles ..."),g=a.getElementChildren(g)[0],g=a.getElementChildren(g),h=0;h<g.length;h++)if(n=g[h],"CTATStyleProperty"==a.getElementName(n)){this.ctatdebug("Processing style property (CTATStyleProperty) ...");l=m="";n=a.getElementChildren(n);for(B=0;B<n.length;B++)v=n[B],"name"==a.getElementName(v)&&(m=a.getNodeTextValue(v)),"value"==a.getElementName(v)&&(l=a.getNodeTextValue(v).trim());
this.ctatdebug("Style (name: "+m+", value: "+l+")");""!==m&&(z.styles[m]=l)}}e.ctatdebug("deserializeComponent ("+d+","+b+") done")}};this.processStartStateActions=function(){e.ctatdebug("processStartStateActions ("+b.length+")");if(0===b.length)e.ctatdebug("No start state messages, bump");else if(0<CTATMessageHandler.startStateHandlers.length)for(var a=0;a<CTATMessageHandler.startStateHandlers.length;a++)CTATMessageHandler.startStateHandlers[a].processStartStateActions(b);else{for(var a=g(),d=0;d<
b.length;d++){var h=b[d];e.ctatdebug("Processing startstate message["+d+"] type: "+h.getMessageType());switch(h.getMessageType()){case "InterfaceAction":f.processInterfaceAction(h,a);c.propagateShellEvent("InterfaceAction",h,h&&h.getProperty?h.getProperty("Actor"):"");break;case "UntutoredAction":f.processUntutoredAction(h,a);c.propagateShellEvent("UntutoredAction",h,h&&h.getProperty?h.getProperty("Actor"):"");break;case "CorrectAction":f.processCorrectAction(h);break;case "InCorrectAction":f.processInCorrectAction(h)}}if(""!==
CTATMessageHandler.scriptElement)try{eval(CTATMessageHandler.scriptElement)}catch(p){alert("Error executing script from BRD: "+p.message)}}};this.sleep=function(a){e.ctatdebug("sleep ("+a+")")}};CTATMessageHandler.prototype=Object.create(CTATBase.prototype);CTATMessageHandler.prototype.constructor=CTATMessageHandler;CTATMessageHandler.startStateHandlers=[];CTATMessageHandler.inStartState=!1;CTATMessageHandler.scriptElement="";CTAT.SAI={};
function createSteps(){CTAT.SAI={help:"Enter steps.list() to see the list of steps;\n      steps.next() to do the next step;\n      steps.rest() to do the remaining steps;\n      steps.all() to do all\n      steps.send(n) to send the nth step\n",nStored:0,msgs:[],storeForReplay:function(e){if(e&&"string"==typeof e){try{sessionStorage&&"function"==typeof sessionStorage.setItem&&(sessionStorage.setItem("CTAT.SAI."+CTAT.SAI.nStored,e),sessionStorage.setItem("CTAT.SAI.length",String(++CTAT.SAI.nStored)))}catch(b){console.log("CTAT.SAI.storeForReplay() error ",b,
"\n  msg",e)}return CTAT.SAI.nStored}},format:function(e){var b=useDebuggingBasic;useDebuggingBasic=!1;var a=useDebugging;useDebugging=!1;e=(new CTATXML).parseXML(e);e=new CTATMessage(e);useDebuggingBasic=b;useDebugging=a;return sprintf("s: %-16s, a: %-16s, i: %s",e.getSelection(),e.getAction(),e.getInput())},list:function(){for(var e="",b=0;b<CTAT.SAI.msgs.length;++b)var a=CTAT.SAI.format(CTAT.SAI.msgs[b]),e=sprintf("%s\n[%2d] %s",e,b,a);return"Number of steps: "+CTAT.SAI.msgs.length+e+"\n"},send:function(e){if(e>=
CTAT.SAI.msgs.length)return"Already past last step "+e;e=CTAT.SAI.msgs[e];CTATCommShell.commShell.propagateShellEvent(CTATMsgType.getMessageType(e),e);CTATCommShell.commShell.getCommLibrary().sendXML(e);CTAT.SAI.storeForReplay(e)},last:-1,next:function(){return CTAT.SAI.send(++CTAT.SAI.last)},rest:function(){for(;CTAT.SAI.last<CTAT.SAI.msgs.length-2;)CTAT.SAI.next();return CTAT.SAI.next()},all:function(){CTAT.SAI.last=-1;return CTAT.SAI.rest()}};try{for(var c=sessionStorage.getItem("CTAT.SAI.length"),
c=c?Number(c):0,g=0;g<c;++g){var f="CTAT.SAI."+g;CTAT.SAI.msgs.push(sessionStorage.getItem(f));sessionStorage.removeItem(f)}sessionStorage.setItem("CTAT.SAI.length",String(c-g))}catch(e){console.log("CTAT.SAI load error ",e)}return CTAT.SAI}window.steps=createSteps();console.log("***To replay steps:","\n"+steps.help);var CTATSessionExpiry=function(c,g,f,e){function b(){var a=r&&r.getHTTPObject?r.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processInactivityReply() refreshConnection "+r+", getHTTPObject "+a);r&&a&&h.ctatdebug("CTATSessionExpiry.processInactivityReply() readyState "+a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))}function a(){try{if(50>m)throw"No-op: time interval "+m+" too short: less than 50 ms";u=setInterval(function(){r.send.apply(r,[])},m);
return"ok"}catch(q){return q.toString()}}function d(){try{if(50>n)throw"No-op: time interval "+n+" too short: less than 50 ms";w=setInterval(function(){h.checkInactivity.apply(h,[])},n);return"ok"}catch(q){return q.toString()}}CTATBase.call(this,"CTATSessionExpiry",g);var h=this,l=1E3*g,m=1E3*(g-60),n=6E4,p=Date.now(),r=null,u=0,w=0;this.checkInactivity=function(){var a=Date.now(),d=p;h.ctatdebug("CTATSessionExpiry.checkInactivity() elapsed "+(a-d)+", limit "+l+",\n                 now "+Date(a)+
",\n lastActionTimestamp "+h.getLastActionTimestamp());if(!(a<d+l))try{h.cancelTimers();var e=new CTATConnection(CTATConfiguration.getRawFlashVars());e.setMethod("GET");e.setURL(f);e.assignReceiveFunction(b);e.send();return"ok"}catch(B){return B.toString()}};this.updateLastActionTimestamp=function(){p=Date.now()};this.getLastActionTimestamp=function(){return new Date(p)};this.toString=function(){return"CTATSessionExpiry sessionTimeoutMS "+l+", refreshIntervalMS "+m+", refreshTimer "+u+", inactivityTimer "+
w+",\n  expireLogoutURL "+f+",\n  refreshSessionURL "+e};this.getRefreshConnection=function(){return r};this.getSessionTimeoutMS=function(){return l};this.getRefreshIntervalMS=function(){return m};this.getInactivityIntervalMS=function(){return n};this.setSessionTimeoutMS=function(a){l=a};this.setRefreshIntervalMS=function(d){m=d;h.cancelRefreshTimer();a()};this.setInactivityIntervalMS=function(a){n=a;h.cancelInactivityTimer();d()};this.cancelRefreshTimer=function(){0!==u&&clearInterval(u);u=0};this.cancelInactivityTimer=
function(){0!==w&&clearInterval(w);w=0};this.cancelTimers=function(){h.cancelRefreshTimer();h.cancelInactivityTimer()};this.getRefreshTimer=function(){return u};this.getInactivityTimer=function(){return w};r=new CTATConnection(c);r.setMethod("GET");r.setURL(e);r.assignReceiveFunction(function(){var a=r&&r.getHTTPObject?r.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processRefreshReply() refreshConnection "+r+", getHTTPObject "+a);r&&a&&h.ctatdebug("CTATSessionExpiry.processRefreshReply() readyState "+
a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))});a();d()};CTATSessionExpiry.prototype=Object.create(CTATBase.prototype);CTATSessionExpiry.prototype.constructor=CTATSessionExpiry;
CTATSessionExpiry.factory=function(c){var g=Number(c.session_timeout)||0,f=c.expire_logout_url,e=c.refresh_session_url;ctatdebug("CTATSessionExpiry.init() session_timeout "+g+", expire_logout_url "+f+", refresh_session_url "+e);return 60>=g||!f||!e?null:new CTATSessionExpiry(c,g,f,e)};"undefined"!==typeof module&&(module.exports=CTATSessionExpiry);var sprintf={};
!function(){function c(b){var a;a=b;if(e[a])a=e[a];else{for(var d=a,h,g=[],m=0;d;){if(null!==(h=f.text.exec(d)))g.push(h[0]);else if(null!==(h=f.modulo.exec(d)))g.push("%");else if(null!==(h=f.placeholder.exec(d))){if(h[2]){var m=m|1,n=[],p=h[2],r;if(null!==(r=f.key.exec(p)))for(n.push(r[1]);""!==(p=p.substring(r[0].length));)if(null!==(r=f.key_access.exec(p)))n.push(r[1]);else if(null!==(r=f.index_access.exec(p)))n.push(r[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");
h[2]=n}else m|=2;if(3===m)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");g.push({placeholder:h[0],param_no:h[1],keys:h[2],sign:h[3],pad_char:h[4],align:h[5],width:h[6],precision:h[7],type:h[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");d=d.substring(h[0].length)}a=e[a]=g}d=arguments;h=1;for(var g=a.length,n="",u,w,q,y,p=0;p<g;p++)if("string"===typeof a[p])n+=a[p];else if("object"===typeof a[p]){r=a[p];if(r.keys)for(m=d[h],u=0;u<r.keys.length;u++){if(void 0==
m)throw Error(c('[sprintf] Cannot access property "%s" of undefined value "%s"',r.keys[u],r.keys[u-1]));m=m[r.keys[u]]}else m=r.param_no?d[r.param_no]:d[h++];f.not_type.test(r.type)&&f.not_primitive.test(r.type)&&m instanceof Function&&(m=m());if(f.numeric_arg.test(r.type)&&"number"!==typeof m&&isNaN(m))throw new TypeError(c("[sprintf] expecting number but found %T",m));f.number.test(r.type)&&(q=0<=m);switch(r.type){case "b":m=parseInt(m,10).toString(2);break;case "c":m=String.fromCharCode(parseInt(m,
10));break;case "d":case "i":m=parseInt(m,10);break;case "j":m=JSON.stringify(m,null,r.width?parseInt(r.width):0);break;case "e":m=r.precision?parseFloat(m).toExponential(r.precision):parseFloat(m).toExponential();break;case "f":m=r.precision?parseFloat(m).toFixed(r.precision):parseFloat(m);break;case "g":m=r.precision?String(Number(m.toPrecision(r.precision))):parseFloat(m);break;case "o":m=(parseInt(m,10)>>>0).toString(8);break;case "s":m=String(m);m=r.precision?m.substring(0,r.precision):m;break;
case "t":m=String(!!m);m=r.precision?m.substring(0,r.precision):m;break;case "T":m=Object.prototype.toString.call(m).slice(8,-1).toLowerCase();m=r.precision?m.substring(0,r.precision):m;break;case "u":m=parseInt(m,10)>>>0;break;case "v":m=m.valueOf();m=r.precision?m.substring(0,r.precision):m;break;case "x":m=(parseInt(m,10)>>>0).toString(16);break;case "X":m=(parseInt(m,10)>>>0).toString(16).toUpperCase()}f.json.test(r.type)?n+=m:(!f.number.test(r.type)||q&&!r.sign?y="":(y=q?"+":"-",m=m.toString().replace(f.sign,
"")),u=r.pad_char?"0"===r.pad_char?"0":r.pad_char.charAt(1):" ",w=r.width-(y+m).length,w=r.width?0<w?u.repeat(w):"":"",n+=r.align?y+m+w:"0"===u?y+w+m:w+y+m)}return n}function g(b,a){return c.apply(null,[b].concat(a||[]))}var f={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,
key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},e=Object.create(null);"undefined"!==typeof exports&&(exports.sprintf=c,exports.vsprintf=g);"undefined"!==typeof window&&(window.sprintf=c,window.vsprintf=g,"function"===typeof define&&define.amd&&define(function(){return{sprintf:c,vsprintf:g}}))}();var CTATTransactionListener=function(c){function g(){if("undefined"!=typeof TransactionMailerUsers&&"function"==typeof TransactionMailerUsers.create){var a=TransactionMailerUsers.create("Assets",n,CTATConfiguration.get("process_detectors_url"),CTATConfiguration.get("authenticity_token"),CTATConfiguration.get("detectors"),CTATConfiguration.get("provider_key"),JSON.stringify(CTAT.ToolTutor.tutor.getProblemSummary().getSkills().toJSON("pSummarySkills")));try{return p=a}catch(z){return console.trace("Error creating transaction mailer: "+
z),p=null}}}function f(a){return a&&"function"==typeof a.getTransactionID?a.getTransactionID():null}function e(a){m.ctatdebug("formatTimeStamp ("+a+")");return sprintf("%04d-%02d-%02d %02d:%02d:%02d.%03d UTC",a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())}function b(a,d){for(var b,e,c=1;;++c){var f=d+"_type"+c,h=d+"_name"+c;b=CTATConfiguration.get(f);e=CTATConfiguration.get(h);if(!b||!e)break;a[f]=b;a[h]=e}1==c&&(b=CTATConfiguration.get(d+
"_type"),e=CTATConfiguration.get(d+"_name"),a[f]=b?b:"",a[h]=e?e:"");return a}function a(){m.ctatdebug("CTATTransactionListener.createContextMessage()");var a={},d=new Date;m.ctatdebug("TX.makeMetaElement ()");var c={};c.date_time=e(d);c.session_id=CTATConfiguration.get("session_id");c.user_guid=CTATConfiguration.get("user_guid");a.meta=c;a.context={};d=a.context;c=CTATLogMessageBuilder.contextGUID;if(!c)throw Error("Context message ID not yet defined");d.context_message_id=c;d=a.context;c=CTATConfiguration.get("class_name");
d.class_name=c?c:"";c=CTATConfiguration.get("school_name");d.class_school=c?c:"";c=CTATConfiguration.get("period_name");d.class_period_name=c?c:"";c=CTATConfiguration.get("class_description");d.class_description=c?c:"";c=CTATConfiguration.get("instructor_name");d.class_instructor_name=c?c:"";d=a.context;c=CTATConfiguration.get("dataset_name");d.dataset_name=c?c:"";b(d,"dataset_level");prop=CTATConfiguration.get("problem_name");d.problem_name=prop?prop:"";prop=CTATConfiguration.get("problem_context");
d.problem_context=prop?prop:"";prop=CTATConfiguration.get("problem_tutorflag");d.problem_tutorFlag=prop?prop:"";b(d,"study_condition");var d=a.context,c=0,f=CTATConfiguration.getCustomFields();if(f){d.custom_fields={};for(var h in f)f.hasOwnProperty(h)&&(d.custom_fields[h]=f[h],++c)}m.ctatdebug("CTATTransactionListener.createCustomFields() nAdded "+c+", cfs "+f);return a}function d(a,d){if(a&&"function"==typeof a.toLowerCase&&0<=a.toLowerCase().indexOf("hint"))return!0;if(!d)return!1;if(0<=d.getMessageType().toLowerCase().indexOf("hint"))return!0;
var b=d.getSelection().toLowerCase();return 0<=d.getAction().toLowerCase().indexOf("buttonpress")&&(0<=b.indexOf("hint")||0<=b.indexOf("help"))}function h(a,d){var b=a.getProperty(d),e=b?b.split(CTATTransactionListener.valueDelimiter):[];m.ctatdebug("CTATTransactionListener.getPropertyAsArray("+d+") withValues "+b+", result "+e);return e}function l(a,d){for(var b=h(a,d),e="",c=0;c<b.length;++c)e+=b[c];m.ctatdebug("CTATTransactionListener.getProperty("+d+") valueElts "+b+", result "+e);return e}CTATBase.call(this,
"CTATTransactionListener","");var m=this,n=c,p=null,r=null,u={},w=0,q=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.getMailer=function(){return p};this.onmessage=function(a){m.ctatdebug("CTATTransactionListener.onmessage("+a.toString()+")");(a=a.data&&3<=a.data.length?new CTATSAI(a.data[0],a.data[1],a.data[2]):null)&&CTATCommShell.shell.processComponentAction(a,!1,!0,null,"ATTEMPT","Detector")};p||(p=g());this.isReady=function(){return null!=m.mailerProxy};this.toString=function(){return"transactions sent to ["+
m.process_transactions_url+":]"};this.processCommShellEvent=function(b,c,g){m.ctatdebug("CTATTransactionListener.processCommShellEvent("+b+", "+c+", "+g+")");try{var n=null;switch(b){case "InterfaceAction":case "AssociatedRules":case "UntutoredAction":case "NextPressed":case "PreviousPressed":var y=c;c&&c.constructor!=CTATMessage&&(y=c.constructor!=Element?q.parse(y):y,y=new CTATMessage(y));m.ctatdebug("CTATTransactionListener.makeOrCompleteTransaction("+b+") pointer "+m+", problemInfo "+r);var z=
c=null,B=!1;if(z=f(y)){!r&&(r=a());var F,K;b:switch(b){case "UntutoredAction":K=!1;break b;case "InterfaceAction":K="tutor-performed"!=l(y,"subtype").toLowerCase();break b;default:K=!0}if(F=!(B=!K)){var H;K=z;var x=u[K];x?(delete u[K],--w,m.ctatdebug("CTATTransactionListener.removeIncompleteTransaction("+K+") count now "+w),H=x):H=null;F=(c=H)&&(B=!0)}F||(c={meta:r.meta,context:r.context});switch(b){case "AssociatedRules":case "NextPressed":case "PreviousPressed":g=c;g.tutor_data&&console.log("Warning: CTATTransactionListener.addTutorInfo("+
b+") tx has tutor_data with time "+g.tutor_data.tutor_event_time);g.tutor_data={};g.tutor_data.tutor_event_time=e(new Date);g.tutor_data.selection=l(y,"Selection");g.tutor_data.action=l(y,"Action");g.tutor_data.input=l(y,"Input");g.tutor_data.action_evaluation=y.getIndicator();0<=g.tutor_data.action_evaluation.toLowerCase().indexOf("hint")&&(g.tutor_data.current_hint_number=l(y,"CurrentHintNumber"),g.tutor_data.total_hints_available=l(y,"TotalHintsAvailable"));g.tutor_data.tutor_advice=l(y,"TutorAdvice");
var G=g.tutor_data;F=[];var I=CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemSummary()?CTAT.ToolTutor.tutor.getProblemSummary().getSkills():null,S=y.getSkillsObject().getSkillSet();for(H=0;H<S.length;++H){var Q=S[H],L=CTATSkillSet.skills?CTATSkillSet.skills.getSkill(Q.getSkillName()):null;if(L){x={};x.name=L.getSkillName();x.category=L.getCategory();var D=null==x.category||""==x.category.trim()?x.name:x.name+" "+x.category,N=I?I.getSkill(D):null,P;N?(x.pKnown=isNaN(P=N.getPKnown())?"":P,x.pGuess=
isNaN(P=N.getPGuess())?"":P,x.pSlip=isNaN(P=N.getPSlip())?"":P,x.pLearn=isNaN(P=N.getPLearn())?"":P,x.history=isNaN(P=N.getHistory())?"":P,x.opportunityCount=isNaN(P=N.getOpportunityCount())?"":P):(x.pKnown=isNaN(P=L.getPKnown())?"":P,x.pGuess=isNaN(P=L.getPGuess())?"":P,x.pSlip=isNaN(P=L.getPSlip())?"":P,x.pLearn=isNaN(P=L.getPLearn())?"":P);m.ctatdebug("CTATTransactionListener.createSkills() ssSk "+L+", tracerSk "+N+", skElt "+x);F.push(x)}}G.skills=F;g.tutor_data.step_id=l(y,"StepID");g.tutor_data.rule_names=
h(y,"Rules");var V=g.tutor_data,R=y.getCustomFields();m.ctatdebug("CTATTransactionListener.createCustomFields() result "+R);V.custom_fields=R;break;default:c.meta.date_time=e(new Date);G=c;if(!(G.transaction_id=f(y)))throw Error("Message has no transaction_id: eventType "+b+", msg\n  "+y);G.semantic_event="UntutoredAction"==b?"UNTUTORED-ACTION":d(b,y)?"HINT-REQUEST-HINTS":"ATTEMPT-RESULT";G.actor=g?g:"student";G.tool_data&&console.log("Warning: CTATTransactionListener.addToolInfo("+b+") tx has tool_data with time "+
G.tool_data.tool_event_time);G.tool_data={};G.tool_data.tool_event_time=e(new Date);G.tool_data.selection=l(y,"Selection");G.tool_data.action=l(y,"Action");G.tool_data.input=l(y,"Input")}var T;if(B)T=c;else{var G=z,O=u[G];O&&(console.log("Warning: CTATTransactionListener.storeIncompleteTransaction() found tx with ID "+G,O),--w);u[G]=c;++w;m.ctatdebug("CTATTransactionListener.storeIncompleteTransaction("+G+") count now "+w);T=null}n=T}else n=null;break;case "StateGraph":case "StartProblem":r=a();break;
case "ProblemRestoreEnd":m.initializing=!1}n&&!m.initializing&&p.sendTransaction(n)}catch(U){console.log("Error in CTATTransactionListener.processCommShellEvent("+b+"): "+U,U.stack)}};ctatdebug("**<end of CTATTransactionListener constructor, process_transactions_url "+n+", mailerProxy "+p)};Object.defineProperty(CTATTransactionListener,"scriptParam",{enumerable:!1,configurable:!1,writable:!1,value:"process_transactions_url"});
Object.defineProperty(CTATTransactionListener,"valueDelimiter",{enumerable:!1,configurable:!1,writable:!1,value:/<\/?value>/});CTATTransactionListener.prototype=Object.create(CTATBase.prototype);CTATTransactionListener.prototype.constructor=CTATTransactionListener;"undefined"!==typeof module&&(module.exports=CTATTransactionListener);
CTATTransactionListener.create=function(c){var g=null;if(!c&&("undefined"==typeof TransactionMailerUsers||"function"!=typeof TransactionMailerUsers.create))return null;try{if(g=new CTATTransactionListener(c),!g.getMailer())throw Error("Transaction listener postMessage() not defined.");}catch(f){console.trace("Error creating or connecting to transaction listener",f),g=null}return g};var CTATNameTranslator=function(){CTATBase.call(this,"CTATNameTranslator","translator");var c=!1,g=this;this.setPassthrough=function(f){c=CTATGlobalFunctions.toBoolean(f)};this.getPassthrough=function(){return c};this.manufactorJSON=function(c,e){g.ctatdebug("manufactorJSON ("+c+","+e+")");var b=c.split(":");if(1==b.length)return g.ctatdebug("No range in aRange, returning basic JSON ..."),"";var a=this.getA1Row(b[0]),d=this.getA1Col(b[0]),f=this.getA1Row(b[1]),l=this.getA1Col(b[1]);g.ctatdebug("Manufacturing json from: ["+
a+","+d+"] to: ["+f+","+l+"]");b="[";a=parseInt(f)-parseInt(a);d=parseInt(l)-parseInt(d);a++;d++;g.ctatdebug("X range: "+a+", Y range: "+d);for(f=0;f<a;f++){0<f&&(b+=",");b+="[";for(l=0;l<d;l++)0<l&&(b+=","),b+='"',b+=e,b+='"';b+="]"}return b+"]"};this.translateFromCTAT=function(f,e){if(!0===c)return f;var b=f.toLowerCase();g.ctatdebug("translateFromCTAT ("+b+")");var a;if(-1!=b.indexOf(".r")){var d=b.split(".");a=d[1].split("r");0>=a.length&&(a=d[1].split("c"));0>=a.length?g.ctatdebug("Info: incoming name does not need translation"):
(b=a[1],a=a[0].substr(1),g.ctatdebug("Original row (1st format): "+a+" original col: "+b),b=!0===e?colName(b,!1)+a:d[0]+"."+colName(b,!1)+a,g.ctatdebug("Translated: "+b))}else{if(0===b.indexOf("r")){var d=b.indexOf("c"),h=parseInt(b.substr(1,d-1)),l=parseInt(b.substr(d+1));a=h+1;b=l;g.ctatdebug("Original row (2nd format) (columnindex: "+d+"): "+h+" -> "+a+", original col: "+l+" -> "+b);b=colName(b,!1)+a;g.ctatdebug("Translated: "+b);return b}g.ctatdebug("Info: incoming name does not need translation")}return b};
this.translateToCTAT=function(f){if(!0===c)return f;var e=this.letterToColumn(f.substr(0,1))-1;return"R"+(parseInt(f.substr(1))-1)+"C"+e};this.columnToLetter=function(c){for(var e,b="";0<c;)e=(c-1)%26,b=String.fromCharCode(e+65)+b,c=(c-e-1)/26;return b};this.letterToColumn=function(c){for(var e=0,b=c.length,a=0;a<b;a++)e+=(c.charCodeAt(a)-64)*Math.pow(26,b-a-1);return e};this.getA1Row=function(c){return parseInt(c.substr(1))-1};this.getA1Col=function(c){return this.letterToColumn(c.substr(0,1))-1}};
CTATNameTranslator.prototype=Object.create(CTATBase.prototype);CTATNameTranslator.prototype.constructor=CTATNameTranslator;var CTATCommShell=function(){CTATBase.call(this,"CTATCommShell","theShell");var c=null,g=null,f=null,e=null,b=null,a=this,d=null,h=null,l={},m=null,n=null,p=null,r=null,u=[],w=!1,h="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.init=function(d){this.ctatdebug("init () tutoring_service_communication "+CTATConfiguration.get("tutoring_service_communication")+" is.Authoring "+CTATLMS.is.Authoring());CTATLMS.is.Authoring()&&(CTATConfiguration.set("tutoring_service_communication","websocket"),
CTATConfiguration.set("question_file",""));var h=CTATConfiguration.getRawFlashVars(),m="http://";"https"==h.tutoring_service_communication&&(m="https://");var l=h.remoteSocketURL;l&&(l=String(l).toLowerCase(),0==l.indexOf("http")||0==l.indexOf("ws"))&&(m="");b=d;CTATLogMessageBuilder.contextGUID=CTATGuid.guid();a.ctatdebug("processSkills ()");CTATSkillSet.skills=new CTATSkillSet;d=flashVars.getRawFlashVars();null!=d.skills&&CTATSkillSet.skills.fromXMLString(d.skills,!0);a.updateSkillWindow(null);
null==commMessageHandler&&(commMessageHandler=new CTATMessageHandler(this),CTAT.ToolTutor.registerInterface(commMessageHandler));commMessageHandler.assignHandler(this);e=new CTATTutoringServiceMessageBuilder;h.deliverymode&&"review"==h.deliverymode&&(h.Logging="None");g=CTATSessionExpiry.factory(h);c=new CTATCommLibrary;c.setConnectionRefusedMessage("ERROR_CONN_TS");c.setSocketType(h.tutoring_service_communication+(h.collaborators||CTATLMS.is.ToolsListener()?" websocket":""));c.assignHandler(this);
f=new CTATCurriculumService(c);null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));commLoggingLibrary.getLoggingCommLibrary().setFixedURL(flashVars.getRawFlashVars().log_service_url);flashVars.setTimeZone(null);new CTATHTMLManager;this.ctatdebug("CTATCommShell.init() FlashVar info: "+h.info);if(null!=h.info)try{parent.javaScriptInfo&&parent.javaScriptInfo(decodeURIComponent(h.info))}catch(v){}else this.ctatdebug("There is no info flash var");console.log("Connecting to: "+m+h.remoteSocketURL+
":"+h.remoteSocketPort);d=e.createSetPreferencesMessage(version,this.getAllInterfaceDescriptions());a.hasTutorShopCable()?CTAT.ToolTutor.sendToTutor(d):c.sendXMLURL(d,m+h.remoteSocketURL+":"+h.remoteSocketPort,CTATConfiguration.get("collaborators"));(m=CTATConfiguration.get("collaborators"))&&1<m.length&&(CTATScrim.scrim.scrimDown(),CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("AWAITING_OTHER_COLLABORATORS")));a.addGlobalEventListener(CTATTransactionListener.create(h[CTATTransactionListener.scriptParam]))};
this.getCommLibrary=function(){return c};this.forwardToTutor=function(a){c&&c.hasJavaScriptConnection()&&CTAT.ToolTutor.sendToTutor(a.getXMLString())};this.getLoggingLibrary=function(){return commLoggingLibrary};this.propagateShellEvent=function(a,d,b,e){ctatdebug("propagateShellEvent ("+a+", "+typeof d+", logmsg len "+("string"==typeof e?e.length:e)+")");for(var c=0;c<u.length;c++)u[c].processCommShellEvent(a,d,b,e)};this.reset=function(){a.ctatdebug("reset ()");CTATGlobals.interfaceElement=null;
commMessageHandler.reset()};this.getSessionExpiry=function(){return g};this.getMessageHandler=function(){return this.commMessageHandler};this.addStartStateHandler=function(d){a.ctatdebug("addStartStateHandler ()");null==CTATMessageHandler.startStateHandlers&&(CTATMessageHandler.startStateHandlers=[]);CTATMessageHandler.startStateHandlers.push(d)};this.gradeComponent=function(d){this.ctatdebug("gradeComponent ("+d.getName()+","+d.getClassName()+")");var b=CTATShellTools.findComponentByClass("CTATDoneButton");
null!=b&&b!=d?b.moveHintHighlight(!1,null):a.ctatdebug("Info: no done button available to reset");a.clearFeedbackComponents();null!=nameTranslator?nameTranslator.translateFromCTAT(d.getName()):this.ctatdebug("Info: no name translator provided, using as-is");null==d?this.ctatdebug("Internal error, provided component is null"):(this.ctatdebug("Info: we have a valid component, grading ..."),"Do not tutor"==d.getTutorComponent()?a.processComponentAction(d.getSAI(),!1):(this.ctatdebug("Checking for back grading: "+
d.getName()),"CTATTextArea"==d.getClassName()||"CTATTextInput"==d.getClassName()||"CTATTextField"==d.getClassName()?(this.ctatdebug("Backgrading ..."),this.ctatdebug("Grading "+d.getClassName()+" with value: "+d.getValue()),!0===CTATGlobalFunctions.isBlank(d.getValue())?this.ctatdebug("Empty component, nothing to grade"):(d.updateSAI(),d=d.getSAI(),a.processComponentAction(d))):(d="CTATTableGoogle"==d.getClassName()?new CTATSAI(d.getCurrentSelection(),"UpdateTextArea",d.getCurrentValue()):d.getSAI(),
a.processComponentAction(d))))};this.processMessage=function(a){this.ctatdebug("processMessage ()");commMessageHandler.processMessage(a);this.ctatdebug("processMessage () done")};this.processStartProblem=function(){this.ctatdebug("processStartProblem ()");"google"==CTATConfig.external&&this.showFeedback("The tutor is starting, please wait ...");CTATLMS.initLMSConnection&&CTATLMS.initLMSConnection()};this.processStartState=function(){this.ctatdebug("processStartState ()");CTATMessageHandler.inStartState=
!0;null!=b?(this.ctatdebug("Calling tutor.createInterface () ..."),b.createInterface()):(this.ctatdebug("Error: no tutor object available, calling createInterface globally ..."),window.hasOwnProperty("createInterface")&&window.createInterface());this.ctatdebug("Logging start of problem ...");null!=commLoggingLibrary?commLoggingLibrary.startProblem():this.ctatdebug("Info: no logging library available!");a.propagateShellEvent("StartProblem",null);this.ctatdebug("End of start state, inspecting suppressStudentFeedback ...");
if(!0===CTATGlobals.suppressStudentFeedback){this.ctatdebug("Hiding hint button ...");var d=CTATShellTools.findComponentByClass("CTATHintButton");null!=d&&d.SetVisible(!1)}"google"==CTATConfig.external?(a.ctatdebug("Calling google app script hint request driver ..."),addCall(new RPCObject("resetOnEditQueue","dummy","dummy"))):this.ctatdebug("processStartState () done")};this.sendStartProblemMessage=function(){a.ctatdebug("sendStartProblemMessage()")};this.sendProblemSummaryRequest=function(d){a.ctatdebug("sendProblemSummaryRequest()");
p=d;d=(new CTATTutoringServiceMessageBuilder).createProblemSummaryRequestMessage();c.sendXML(d,!1)};this.getAllInterfaceDescriptions=function(){a.ctatdebug("getAllInterfaceDescriptions ()");for(var d="<messages>",b=new CTATTutoringServiceMessageBuilder,e=CTATShellTools.getAllComponents(),c=0;c<e.length;c++){var f=e[c];a.ctatdebug("Getting component interface description message for: "+f.getName());d+=b.createInterfaceDescriptionMessage(f);f.getConfigurationActions&&f.getConfigurationActions().forEach(function(a){d+=
b.createInterfaceActionMessage(CTATGuid.guid(),a)})}return d+="</messages>"};this.sendInterfaceDescriptionMessages=function(){a.ctatdebug("sendInterfaceDescriptionMessages ()");var d;d='<?xml version="1.0" encoding="UTF-8"?><message><verb>NotePropertySet</verb><properties><MessageType>MessageBundle</MessageType>'+a.getAllInterfaceDescriptions();d+="</properties></message>";a.ctatdebug("Final bundle: "+d);c.sendXMLNoBundle(d)};this.processSerialization=function(){a.ctatdebug("processSerialization()");
a.setText(this.label)};this.processComponentAction=function(d,b,e,f,g,h){a.ctatdebug("processComponentAction("+d.getName()+" -> "+d.getSelection()+","+d.getAction()+","+d.getInput()+")");this.showFeedback("");e=CTATGuid.guid();null!=commLoggingLibrary?w&&(a.ctatdebug("We're not in the start state, logging the action ..."),"scrim"==d.getSelection()?ctatdebug("Not logging any scrim actions (for now)"):void 0!=g?commLoggingLibrary.logSemanticEvent(e,d,g,"","","",h):"hint"==d.getSelection()||"null.nextButton"==
d.getSelection()||"null.previousButton"==d.getSelection()?commLoggingLibrary.logSemanticEvent(e,d,"HINT_REQUEST","","","",h):commLoggingLibrary.logSemanticEvent(e,d,"ATTEMPT","","","",h)):this.ctatdebug("Info: no logging library available!");g=new CTATTutoringServiceMessageBuilder;!1!==b&&b!==CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR?(d=g.createInterfaceActionMessage(e,d),a.propagateShellEvent("InterfaceAction",d)):(d=g.createUntutoredActionMessage(e,d),a.propagateShellEvent("UntutoredAction",
d));c.sendXML(d);CTAT.SAI&&"function"==typeof CTAT.SAI.storeForReplay&&CTAT.SAI.storeForReplay(d)};this.onEditSuccess=function(d){a.ctatdebug("onEditSuccess ("+d+")");null==nameTranslator?a.ctatdebug("Error: CTAT name translator not available"):-1!=d.indexOf(":")?(a.ctatdebug("Bump"),a.showFeedback("You're asking for a hint for multiple cells, please select only a single cell.")):(d=nameTranslator.translateToCTAT(d),a.ctatdebug("Info A1 notiation mapped to (if needed): "+d),d=new CTATSAI("hint","ButtonPressed",
d),a.processComponentAction(d),a.propagateShellEvent("REQUESTHINT",null),a.ctatdebug("onEditSuccess () done"))};this.onFailure=function(d){a.ctatdebug("onFailure ("+d.message+")")};this.onNOPEditSuccess=function(d){a.ctatdebug("onNOPEditSuccess ("+d+")")};this.onNOPFailure=function(d){a.ctatdebug("onNOPFailure ("+d.message+")")};this.requestHint=function(){a.ctatdebug("requestHint(external -> "+CTATConfig.external+")");var d;if("none"==CTATConfig.external)a.ctatdebug("Calling built-in hint request driver ..."),
CTATGlobals.Tab.previousFocus?(d=new CTATSAI("hint","ButtonPressed","hint request"),CTATGlobals.Tab.previousFocus.getSAI?(d.addSelection(CTATGlobals.Tab.previousFocus.getSAI().getSelection()),d.addAction("PreviousFocus")):a.ctatdebug("Current focus is not a CTAT component, can't ask for a hint yet")):(a.ctatdebug("CTATGlobals.Tab.previousFocus===null"),d=new CTATSAI("hint","ButtonPressed","hint request")),this.processComponentAction(d),this.propagateShellEvent("RequestHint",null);else if(a.clearFeedbackComponents(),
"google"==CTATConfig.external){a.ctatdebug("Calling google app script hint request driver ...");try{google.script.run.withSuccessHandler(a.onEditSuccess).withFailureHandler(a.onFailure).getSheetSelectedRange()}catch(y){a.ctatdebug("google.script.run: "+y.message)}}else a.ctatdebug("'external' has configuration that doesn't match anything: "+CTATConfig.external)};this.processDone=function(d){a.ctatdebug("processDone()");!0===CTATGlobals.confirmDone?CTATScrim.scrim.confirmScrimUp(CTATGlobals.languageManager.getString("SURE_YOU_ARE_DONE"),
this.processDoneContinue,this.processDoneCancel):(d=new CTATSAI("done","ButtonPressed",d&&"string"==typeof d?d:"-1"),a.processComponentAction(d))};this.processDoneContinue=function(d){a.ctatdebug("processDoneContinue()");CTATScrim.scrim.scrimDown();d=new CTATSAI("done","ButtonPressed",d&&"string"==typeof d?d:"-1");a.processComponentAction(d);a.propagateShellEvent("DonePressed",null)};this.processDoneCancel=function(d){a.ctatdebug("processDoneCancel()");CTATScrim.scrim.scrimDown();d=CTATGuid.guid();
var b=new CTATSAI("ConfirmDone","ButtonPressed","no");commLoggingLibrary.logSemanticEvent(d,b,"ATTEMPT","")};this.processGetURL=function(d){a.ctatdebug("processGetURL()");-1!=d.getURL().indexOf("http://")?c.retrieveFile(d.getURL().substring(7),a.processClientBRDLoad):c.retrieveFile(d.getURL(),a.processClientBRDLoad)};this.processClientBRDLoad=function(d){a.ctatdebug("processClientBRDLoad()");var b=c.getURL();c.sendXML("<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+
b+" ]]\x3e</URL><content><![CDATA[ "+window.btoa(d)+" ]]\x3e</content></properties></message>")};this.processCorrectAction=function(d){a.ctatdebug("processCorrectAction()");d.setGradeResult("correct");a.clearFeedbackComponents();null!=r&&(ctatdebug("Calling custom grading processor ..."),r("CORRECT",d));var b=d.getSelection();if(l[b]&&null!=m)m("CORRECT",d),this.propagateShellEvent("CORRECT",d);else{var e=CTATShellTools.findComponent(b);if(null!=e)for(ctatdebug("Processing "+e.length+" components ..."),
b=0;b<e.length;b++)ctatdebug("Check "+e[b].getName()),e[b]?e[b].setCorrect&&e[b].setCorrect(d):a.ctatdebug("Internal error, component pointer is null");else a.ctatdebug("Error: component is null for selection "+b)}};this.processInCorrectAction=function(d){a.ctatdebug("processInCorrectAction()");d.setGradeResult("incorrect");null!=r&&(ctatdebug("Calling custom grading processor ..."),r("INCORRECT",d));var b=d.getSelection();if(l[b]&&null!=m)m("INCORRECT",d);else{var e=CTATShellTools.findComponent(b);
if(null!==e)for(b=0;b<e.length;b++)ctatdebug("Calling setIncorrect on component ("+e[b].getClassName()+")..."),e[b].setIncorrect&&e[b].setIncorrect(d);else a.ctatdebug("Error: component is null for selection "+b)}};this.processHighlightMsg=function(d){a.ctatdebug("processHighlightMsg()");var b=d.getSelection(),e=CTATShellTools.findComponent(b);if(null!=e)for(b=0;b<e.length;b++)"function"==typeof e[b].setHintHighlight&&e[b].setHintHighlight(!0,d);else a.ctatdebug("Error: component is null for selection "+
b);this.showFeedback(d.getHighlightMsg())};this.processUnHighlightMsg=function(d){a.ctatdebug("processUnHighlightMsg()");var b=d.getSelection(),e=CTATShellTools.findComponent(b);if(null!=e)for(b=0;b<e.length;b++)"function"==typeof e[b].setHintHighlight&&e[b].setHintHighlight(!1,null,d);else a.ctatdebug("Error: component is null for selection "+b)};this.processAssociatedRules=function(d,b,f,g){var h="";a.ctatdebug("processAssociatedRules()");if(0==commMessageHandler.getInStartState()){logHintSAI=d.getSAI();
var m,l=new CTATActionEvaluationData("");a.ctatdebug("Found tutor advice: "+f);"Hint"==b||"HintWindow"==b?(ctatdebug("Preparing log message to indicate a hint response","commShell"),l.setCurrentHintNumber(hintIndex+1),l.setTotalHintsAvailable(hints.length),l.setEvaluation("HINT"),m="HINT_MSG",hints[hintIndex]&&(f=hints[hintIndex])):("Correct"==d.getIndicator()?l.setEvaluation("CORRECT"):l.setEvaluation("INCORRECT"),m="RESULT");ctatdebug("Adding custom field names ...");var n=[],q=[];n.push("step_id");
q.push(d.getProperty("StepID"));var p=d.getInput();ctatdebug("CTATCommShell.processAssociatedRules() tutorInput: "+p);p&&(n.push("tutor_input"),q.push(p.toString()));if(p=d.getRules())n.push("rule_names"),q.push(p.toString());var p=d.getCustomFields(),y;for(y in p)n.push(y),q.push(p[y]);y=d.getSkillsObject();a.updateSkillWindow(y);ctatdebug("Sending log message ...");null!=commLoggingLibrary?w?h=commLoggingLibrary.logTutorResponse(d.getTransactionID(),logHintSAI,m,"",l,f,y,n,q):d.suppressLogging():
this.ctatdebug("Info: no logging library available!");"done"==logHintSAI.getSelection()&&"ButtonPressed"==logHintSAI.getAction()&&"Correct"==d.getIndicator()&&(m=e.createProblemSummaryRequestMessage(),c.sendXML(m,!1))}else a.updateSkillWindow(null);if((g=g&&CTATShellTools.findComponent(g))&&g.length)for(m=0;m<g.length;m++)ctatdebug("Calling processAssociatedRules on component ("+g[m].getClassName()+")..."),g[m].processAssociatedRules&&g[m].processAssociatedRules(d,b,f,h);a.ctatdebug("processAssociatedRules() done");
return h};this.processBuggyMessage=function(d){a.ctatdebug("processBuggyMessage()");this.showFeedback(d.getBuggyMsg())};this.processSuccessMessage=function(d){a.ctatdebug("processSuccessMessage()");this.showFeedback(d.getSuccessMessage())};this.processUntutoredAction=function(d,b){a.processInterfaceAction(d,b)};this.processInterfaceAction=function(d,b){a.ctatdebug('CTATCommShell.processInterfaceAction ("'+d.getMessageType()+'")');var e=d.getProperty("trigger"),e=d.getProperty("subtype")||(e&&"data"==
e.toLowerCase()?"tutor-performed":"");null!=commLoggingLibrary?w&&commLoggingLibrary.logSemanticEvent(d.getTransactionID(),d.getSAI(),"ATTEMPT",e):this.ctatdebug("Info: no logging library available!");if("root"==d.getSelection()||"_root"==d.getSelection()){a.ctatdebug("Info: selection is 'root', we'll call the function straight up ...");for(var e=[window,CTATCommShell.commShell],c=d.getAction(),f=d.getInput(),g=0;g<e.length&&"function"!=typeof e[g][c];++g);if(g>=e.length)a.ctatdebug("Internal error: unable to find function: "+
c);else{a.ctatdebug("Calling as: "+c+"("+f+")");try{e[g][c](f)}catch(A){a.ctatdebug("Internal error: unable to execute function: "+A.message)}}}else if(e=CTATShellTools.findComponent(d.getSelection()),console.log("here, targetComponent is ",e),null===e)a.ctatdebug("Internal error: unable to find pointer to component object");else if(0==e.length)a.ctatdebug("Error: no component found to call interface action on");else{c=e.length;a.ctatdebug("Call the action on the component(s) -> ("+c+")...");for(f=
0;f<c;f++)if(a.ctatdebug("About to call "+d.getAction()+" ("+d.getInput()+") on: "+d.getSelection()),g=e[f],"function"==typeof g.executeSAI&&g.executeSAI(d),a.ctatdebug("Method executed, continuing with post-processing ..."),1==commMessageHandler.getInStartState()){var h=d.getAction()||"";/^(updatetext|updatecombobox|updatecheckbox)/i.test(h)&&!g.getDivWrap().className.includes("CTATTextField")&&g.setEnabled(!b)}a.ctatdebug("processInterfaceAction() Done")}};this.removeComponent=function(a){CTATTutor.removeComponent(a)};
this.processInterfaceIdentification=function(d){a.ctatdebug("processInterfaceIdentification()")};this.processAuthorModeChange=function(d){a.ctatdebug("processAuthorModeChange()")};this.processShowHintsMessage=function(d){a.ctatdebug("processShowHintsMessage()")};this.processConfirmDone=function(d){a.ctatdebug("processConfirmDone()")};this.processVersionInfo=function(d){a.ctatdebug("processVersionInfo()")};this.updateLastActionTimestamp=function(){g&&g.updateLastActionTimestamp()};this.processTutoringServiceAlert=
function(d){a.ctatdebug("processTutoringServiceAlert()");for(var b="",e=0;e<d.length;e++){var c=d[e];"ErrorType"==h.getElementName(c)&&h.getNodeTextValue(c);"Details"==h.getElementName(c)&&(b=h.getNodeTextValue(c))}CTATScrim.scrim.scrimUp(b)};this.processTutoringServiceError=function(d){a.ctatdebug("processTutoringServiceError()");var b=d.getProperty("ErrorType");d=d.getProperty("Details");CTATScrim.scrim.scrimDown();CTATScrim.scrim.errorScrimUp(b+" - "+d)};this.processProblemSummaryResponse=function(b,
e){a.ctatdebug("processProblemSummaryResponse() iscb "+e);if(commLoggingLibrary&&!e)commLoggingLibrary.then(a.processProblemSummaryResponse(b,!0));else if(CTATLMS.processProblemSummary&&CTATLMS.processProblemSummary(b.getXMLObject()),CTATLMS.closeLMSConnection&&CTATLMS.closeLMSConnection(),null!=p){var c=b.getXMLObject(),g=c.getElementsByTagName("ProblemSummary"),h=c.getElementsByTagName("cmi.core.lesson_status"),m=c.getElementsByTagName("cmi.core.score.raw"),l=c.getElementsByTagName("cmi.core.exit"),
c=c.getElementsByTagName("cmi.core.session_time"),g=$("<div>").html(g[0].innerHTML).text(),h="<cmi.core.lesson_status>"+$("<div>").html(h[0].innerHTML).text()+"</cmi.core.lesson_status>",m="<cmi.core.score.raw>"+$("<div>").html(m[0].innerHTML).text()+"</cmi.core.score.raw>",l="<cmi.core.exit>"+$("<div>").html(l[0].innerHTML).text()+"</cmi.core.exit>",c="<cmi.core.session_time>"+$("<div>").html(c[0].innerHTML).text()+"</cmi.core.session_time>";p(g,"<scorm>"+h+m+l+c+"</scorm>");p=null}else l=new CTATXML,
null!=d?d(l.xmlToString(b.getXMLObject()),f.sendSummary.bind(f,b)):f.sendSummary(b)};this.setGotProblemRestoreEnd=function(a){w=a};this.getGotProblemRestoreEnd=function(){return w};this.processProblemRestoreEnd=function(d){a.ctatdebug("processProblemRestoreEnd() scrimIsUp "+scrimIsUp);w=!0;a.getCommLibrary()&&a.getCommLibrary().sendTutorReady();a.hasTutorShopCable()||CTATScrim.scrim.scrimDown()};this.hasTutorShopCable=function(){var a=CTATConfiguration.getCustomFields();return CTATLMS.is.TutorShop()&&
a&&a["Team ID"]};this.clearFeedbackComponents=function(){a.ctatdebug("clearFeedbackComponents ()");CTATShellTools.showHints(null)};this.processHintResponse=function(d,b){a.ctatdebug("processHintResponse()");unhighlightall();CTATShellTools.showHints(b);var e=d.getSAI();if(null!=e)if(e=e.getSelection(),null!=e)if(a.ctatdebug("Highlighting selection for hint: "+e),e=CTATShellTools.findComponent(e),null!=e)for(var c=0;c<e.length;c++)1==CTATCommShell.detailedFeedback&&"function"==typeof e[c].setHintHighlight&&
e[c].setHintHighlight(!0,d);else a.ctatdebug("Unable to find component name in list: "+e);else a.ctatdebug("Error: no highlight selection present in SAI");else a.ctatdebug("Warning: no SAI found in highlight message");CTATCommShell.detailedFeedback=!0;a.ctatdebug("processHintResponse() done")};this.showHighlightSelection=function(d,b){a.ctatdebug("showHighlightSelection ("+d+")");var e=CTATShellTools.findComponent(d);if(null!=e)for(var c=0;c<e.length;c++)1==CTATCommShell.detailedFeedback&&(0===c?
e[c].moveHintHightlight&&e[c].moveHintHighlight(!0,b):e[c].setHintHighlight&&e[c].setHintHighlight(!0,b));else a.ctatdebug("Unable to find component name in list: "+e)};this.globalReset=function(){a.ctatdebug("globalReset ()");CTATMessageHandler.scriptElement=""};this.nextProblem=function(d){a.ctatdebug("nextProblem ()");if(CTATGlobalFunctions.isBlank(d))a.ctatdebug("Message is blank, requesting next problem ..."),d=flashVars.getRawFlashVars().run_problem_url,c.send(d);else{a.ctatdebug("Message contains html data, writing ...");
try{document.close()}catch(y){alert("Error closing document: "+y.message)}try{document.write(d)}catch(y){alert("Error writing document: "+y.message)}}};this.updateSkillWindow=function(d){a.ctatdebug("updateSkillWindow()");CTATSkillSet.skills.untouchSkills();var b=CTATShellTools.findComponentByClass("CTATSkillWindow");null!==b?null!=d?b.updateSkillSet(d):b.drawComponent():a.ctatdebug("Info: no skill window available")};this.processComponentFocus=function(d){a.ctatdebug("processComponentFocus("+d.getName()+
","+d.getClassName()+")");"CTATTextInput"==d.getClassName()||"CTATTextField"==d.getClassName()||"CTATTextArea"==d.getClassName()?(CTATGlobals.selectedTextInput=d,null!==mobileAPI&&!0===mobileAPI.getEnabled()&&mobileAPI.processTextFocus(d.getX(),d.getY(),d.getWidth(),d.getHeight())):CTATGlobals.selectedTextInput=null;a.ctatdebug("processComponentFocus() done")};this.showFeedback=function(d){null!=d&&void 0!=d&&/\S/.test(d)&&" "!=d?(a.ctatdebug("showFeedback("+d+") -> l: "+d.length),CTATShellTools.showFeedback(d),
null!=n&&n(d)):a.ctatdebug("showFeedback(): False alarm: empty message. This can happen when the commshell is trying to clear the hint window and there is no hint window.")};this.assignFeedbackHandler=function(d){a.ctatdebug("assignFeedbackHandler()");n=d};this.gradeSAI=function(d,b,e){a.ctatdebug("gradeSAI()");l[d]=e;d=new CTATSAI(d,b,e);a.processComponentAction(d,!0,!0)};this.assignGradingHandler=function(d){a.ctatdebug("assignGradingHandler()");m=d};this.assignAnonymousGradingProcessor=function(a){r=
a};this.assignDoneProcessor=function(a){d=a};this.addEventListener=function(a,d){};this.addGlobalEventListener=function(d){a.ctatdebug("addGlobalEventListener( "+d+")");d&&u.push(d)};this.sendToTools=function(a){c&&c.sendToToolsOrCollaborators(c.getURL(),a,!1)};this.closeWSConnection=function(a,d,b){(a=c.findWSConnection(a))?a.close(b,d):console.warn("connection not found")}};CTATCommShell.prototype=Object.create(CTATBase.prototype);CTATCommShell.prototype.constructor=CTATCommShell;
CTATCommShell.commShell=null;CTATCommShell.detailedFeedback=!0;function enableDetailedFeedback(c){CTATCommShell.detailedFeedback=c};var CTATComponentReference=function(c,g){var f=c,e=g;this.setElement=function(b){f=b};this.getElement=function(){return f};this.setDiv=function(b){e=b};this.getDiv=function(){return e}};CTATComponentReference.components={};CTATComponentReference.list=function(){for(var c in CTATComponentReference.components){var g=CTATComponentReference.components[c];ctatdebug("Component: "+g.getElement().getName()+", with div: "+g.getDiv().id)}};
CTATComponentReference.getComponentFromID=function(c){var g=CTATComponentReference.components;return g.hasOwnProperty(c)?(c=g[c],c.getElement()?c.getElement():null):null};CTATComponentReference.add=function(c,g){var f=new CTATComponentReference(c,g);return CTATComponentReference.components[f.getDiv().getAttribute("id")]=f};var CTATCompBase=function(c,g,f,e,b,a){CTATBase.call(this,c,g);var d=f||0,h=e||0,l=b||-2,m=a||-2,n=50,p=25,r=!1,u=!1,w="",q=!1,y=!0,z=null,B="",v=null;this.isTabIndexable=!0;var E=0,C=null,A=this,F=null,K="hidden",H=CTATGlobalFunctions.gensym.z_index(),x=CTATGlobalFunctions.gensym.div_id(),G=CTATGlobalFunctions.gensym.z_index(),I=CTATGlobalFunctions.gensym.div_id();this.setIsAbstractComponent=function(a){r=a};this.isAbstractComponent=function(){return r};this.setIsFeedbackComponent=function(a){u=
a};this.isFeedbackComponent=function(){return u};this.setTabIndex=function(a){!0===this.isTabIndexable?(v=a,0>v?(v=CTATGlobals.Tab.Tracker,CTATGlobals.Tab.Tracker++):CTATGlobals.Tab.Tracker=v):v=-1};this.getTabIndex=function(){return v||this.getComponent().getAttribute("tabindex")};this.setZIndex=function(a){A.ctatdebug("Setting z index to: "+a);E=a;null!==z&&(z.style.zIndex=a)};this.getZIndex=function(){return E};this.setDefaultWidth=function(a){n=a};this.getDefaultWidth=function(){return n};this.setDefaultHeight=
function(a){p=a};this.getDefaultHeight=function(){return p};this.processCommShellEvent=function(a,d){A.ctatdebug("processCommShellEvent ("+a+")")};this.makeDivWrapper=function(a){z=document.createElement("div");z.id=this.getName();z.setAttribute("onkeypress","return noenter(event)");z.setAttribute("data-ctat-component",this.getClassName());z.style.position="absolute";z.style.left=d+"px";z.style.top=h+"px";z.style.zIndex=H;z.style.width=A.getWidth()+"px";z.style.height=A.getHeight()+"px";$(z).data("CTATComponent",
this);a.appendChild(z)};this.setDivWrapper=function(a){(z=a)&&z.setAttribute("data-ctat-component",this.getClassName())};var S=this.setClassName;this.setClassName=function(a){S(a);z&&z.setAttribute("data-ctat-component",this.getClassName())};this.wrapComponent=function(a){A.ctatdebug("wrapComponent ()");A.makeDivWrapper(a);A.ctatdebug("wrapComponent () done")};this.createCanvas=function(){A.ctatdebug("createCanvas ()");F=document.createElement("canvas");F.setAttribute("id",I);F.setAttribute("onkeypress",
"return noenter(event)");F.setAttribute("width",l+canvasCalibrate+"px");F.setAttribute("height",m+canvasCalibrate+"px");F.setAttribute("style","border: 1px "+this.borderColor+" solid; "+("hidden"==K?"visibility: hidden; ":"")+"z-index:"+G+";");z.firstChild?z.insertBefore(F,z.firstChild):z.appendChild(F);return F};this.redraw=function(){var a=z.style.display;z.style.display="none";z.style.display=a};this.setCanvasVisibility=function(a){K=a};this.getSubCanvasCtx=function(){if(F)return F.getContext("2d")};
this.getSubCanvas=function(){return F};this.getX=function(){return d};this.getY=function(){return h};this.getWidth=function(){if(0>=l){var a;C?a=window.getComputedStyle(C):z&&(a=window.getComputedStyle(z));if(a)return parseFloat(a.width)}return l};this.getHeight=function(){if(0>=m&&z){var a=window.getComputedStyle(z);return parseFloat(a.getPropertyValue("height"))}return m};this.getText=function(){return w};this.getEnabled=function(){return y};this.assignEnabled=function(a){y=a;z.setAttribute("data-ctat-enabled",
y)};this.setEnabled=function(a){A.ctatdebug("setEnabled ("+a+")");A.assignEnabled(a);C?C.disabled=!y:A.ctatdebug("Error: component pointer is null")};this.lock=function(){this.setEnabled(!1)};this.unlock=function(){this.setEnabled(!0)};this.getDivWrap=function(){return z};this.getComponent=function(){return C};this.component=null;Object.defineProperty(this,"component",{get:function(){return C}});this.getCanvasZIndex=function(){return G};this.getComponentGroup=function(){return B};this.setComponent=
function(a){C=a;this.setEnabled(this.getEnabled())};this.getTopDivZIndex=function(){return H};this.getTopDivID=function(){return x};this.setComponentGroup=function(a){B=a;C&&(C.name=a)};this.assignText=function(a){w=a};this.init=function(){A.ctatdebug("THIS IS THE BASE INIT METHOD")};this.initialize=function(){A.ctatdebug("initialize ()");A.configFromDescription();A.init();A.processSerialization();A.render();A.processTabOrder();A.ctatdebug("initialize () done")};this.getInitialized=function(){return q};
this.setInitialized=function(a){A.ctatdebug("setInitialized ("+a+")");q=a;!0!==q||z?A.ctatdebug("Not wrapping, initialized="+q+", divWrapper = "+z):(A.ctatdebug("Wrapping a component and appending it to the top container div if one was never set ..."),(a=findPointOfAttachment(this.getName()))?(A.ctatdebug("Attaching component to existing MovieClip ..."),A.wrapComponent(a.getDivWrapper())):(A.ctatdebug("Attaching component to main div ..."),0<$("#"+ctatcontainer).length&&A.wrapComponent(getSafeElementById(ctatcontainer))));
A.getDivWrap().classList.add("CTATComponent");A.ctatdebug("setInitialized () done")};this.addSafeEventListener=function(a,d,b){A.ctatdebug("addSafeEventListener ("+a+")");A.ctatdebug("Adding event listener to: "+b);b?b.addEventListener(a,d):(C?(A.ctatdebug("Adding eventlistener to component instead of target"),C.addEventListener(a,d)):A.ctatdebug("Error: pointer to component is null, can't add event listener"),A.ctatdebug("addSafeEventListener () done"))};this.drawComponent=function(){};this.addComponentReference=
function(a,d){A.ctatdebug("addComponentReference ("+a.getName()+" -> "+d.getAttribute("id")+")");CTATComponentReference.add(a,d);A.ctatdebug("addComponentReference ()")};this.getComponentFromID=function(a){return CTATComponentReference.getComponentFromID(a)};this.processSerialization=function(){A.ctatdebug("processSerialization()");A.ctatdebug("implement in child class")};this.move=function(a,b){d=Number(a);h=Number(b);if(void 0===b||null===b||isNaN(h))if(0<=a.indexOf(",")){var e=a.split(",");d=Number(e[0]);
h=Number(e[1])}else h=0;d=isNaN(d)?0:d;h=isNaN(h)?0:h;z&&(z.style.left=d+"px",z.style.top=h+"px")};this.setSize=function(a,d){var b=Number(a),e=Number(d);(void 0===d||null===d||isNaN(e))&&0<=a.indexOf(",")&&(e=a.split(","),b=Number(e[0]),e=Number(e[1]));A.ctatdebug("setSize ("+b+","+e+")");isNaN(b)||A.setWidth(b);isNaN(e)||A.setHeight(e)};this.SetVisible=this.setVisible=function(a){a=CTATGlobalFunctions.toBoolean(a);K=!0===a?"block":"hidden";F&&F.setAttribute("style","border: 0px; position: absolute; "+
(a?"":"visibility:hidden; ")+"; left:"+d+"px; top:"+h+"px; z-index:"+G+";");z.style.visibility=!0===a?"unset":"hidden"};this.FadeIn=function(a){A.SetVisible(!0)};this.FadeOut=function(a){A.SetVisible(!1)};this.reset=function(){};this.setX=function(a){this.x=a;z.style.left=this.x+"px";!0===q&&this.render()};this.setY=function(a){this.y=a;z.style.top=this.y+"px";!0===q&&this.render()};this.setWidth=function(a){A.ctatdebug("setWidth ("+a+")");l=a;z?z.style.width=l+"px":A.ctatdebug("Internal error: no div wrapper available to set width")};
this.setHeight=function(a){A.ctatdebug("setHeight ("+a+")");m=a;z?z.style.height=m+"px":A.ctatdebug("Internal error: no div wrapper available to set height")};this.setText=function(a){w=a;return this};this.getValue=function(){return C?C.value:""};this.backgrade=!1;this.unHighlightAll=function(){$(".CTAT--hint").each(function(){for(var a=$(this),d=null;0<a.length&&null===d;)a.data("CTATComponent")?d=a.data("CTATComponent"):a=a.parent();d&&d.setHintHighlight&&d.setHintHighlight(!1,null)})};this.processOnFocus=
function(){A.ctatdebug("processOnFocus ("+A.getName()+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus!=A?(A.ctatdebug("CTATGlobals.Tab.Focus!=pointer, updating CTATGlobals.Tab.Focus ..."),CTATGlobals.Tab.Focus=A):A.ctatdebug("CTATGlobals.Tab.Focus==pointer");A.ctatdebug("processOnFocus () done")};this.processFocus=function(a){A.ctatdebug("processFocus ()");A.ctatdebug("***processFocus(",a,"): comp.getName ",A&&"function"==typeof A.getName?A.getName():A,"\n  CTATGlobals.Tab.Focus ",
CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getName?CTATGlobals.Tab.Focus.getName():CTATGlobals.Tab.Focus,"\n  CTATGlobals.Tab.Focus.isCorrect ",CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.isCorrect?CTATGlobals.Tab.Focus.isCorrect():"no isCorrect","\n  CTATGlobals.Tab.Focus == comp ",CTATGlobals.Tab.Focus==A,"\n  CTATGlobals.Tab.Focus.backgrade ",CTATGlobals.Tab.Focus&&"undefined"!=typeof CTATGlobals.Tab.Focus.backgrade?CTATGlobals.Tab.Focus.backgrade:"no backgrade",
"\n  comp.getClassName ",A&&"function"==typeof A.getClassName?A.getClassName():A,"\n  CTATGlobals.Tab.previousFocus ",CTATGlobals.Tab.previousFocus);if(A){mobileAPI&&!0===mobileAPI.getEnabled()&&A.hideKeyboard();CTATCommShell.commShell&&CTATCommShell.commShell.processComponentFocus(A);if(CTATGlobals.Tab.Focus){A.ctatdebug("old focus: "+CTATGlobals.Tab.Focus.getName()+", new focus:"+A.getName()+", correct: "+CTATGlobals.Tab.Focus.isCorrect());if(1==CTATGlobals.Tab.Focus.isCorrect()){A.ctatdebug("Previous focus is a correct component, don't backgrade!");
return}if(CTATGlobals.Tab.Focus==A){A.ctatdebug("We're already there!");return}CTATGlobals.Tab.Focus.backgrade&&CTATGlobals.Tab.Focus.processAction()}else A.ctatdebug("No previously focused component yet, can't grade");"hint"==A.getClassName()||"CTATHintButton"==A.getClassName()?A.ctatdebug("Info: focus moved to hint, bump"):(CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus,CTATGlobals.Tab.Focus=A,A.ctatdebug("processFocus () done"))}else A.ctatdebug("Error: component reference is null")};this.processTabOrder=
function(){A.ctatdebug("processTabOrder ("+v+")");!0===r?A.ctatdebug("Component is an abstract component, bump"):C?(A.ctatdebug("We have a component, actually assigning to html component ..."),null!==v&&(C.tabIndex=v),C.onfocus=A.processOnFocus):A.ctatdebug("Error: we don't have an html component yet, can't assign tab index")};this.hideKeyboard=function(){document.activeElement.blur();$("input").blur()}};CTATCompBase.prototype=Object.create(CTATBase.prototype);CTATCompBase.prototype.constructor=CTATCompBase;var CTATCSS=function(){var c=0,g=[],f=0,e=[],b=0,a=[];this.resetSelectors=function(){f=0;e=[];e[f]=[]};this.resetCSSStringArray=function(){a=[];b=0};this.clearCSS=function(){this.resetSelectors();this.resetCSSStringArray();g=[];c=0};this.addStringCSS=function(d){a[b]=d;b++};this.addCSSAttribute=function(a,b){g[c]=a;g[c+1]=b;c+=2};this.removeStringCSS=function(d){d=a.indexOf(d);0<=d&&a.splice(d,1)};this.removeCSSAttribute=function(a){a=g.indexOf(a);0<=a&&g.splice(a,2)};this.modifyCSSAttribute=function(a,
b){var d=g.indexOf(a);-1==d?this.addCSSAttribute(a,b):g[d+1]=b};this.addSelector=function(a){e[f]=[];e[f][0]=a;f++};this.addSelectorAttribute=function(a,b,c){var d=1;a:if(0===f)a=0;else{for(var g=0;g<e.length&&null!==e[g][0];g++)if(e[g][0]==a){a=g;break a}a=-1}for(;void 0!==e[a][d];)d++;e[a][d]=b;e[a][d+1]=c};this.toCSSString=function(){for(var d="",b=0;b<e.length;b++){for(var d=d+(e[b][0]+" { "),c=1;c<e[b].length;c++)d+=e[b][c],d=0===c%2?d+"; ":d+": ";d+=" }; "}for(b=0;b<g.length;b++)d+=g[b],d=0===
b%2?d+": ":d+"; ";for(b=0;b<a.length;b++)d+=a[b]+" ";return d}};CTAT.Component={};CTAT.Component.Base={};
CTAT.Component.Base.Style=function(c,g,f,e,b,a){CTATCompBase.call(this,c,g,f,e,b,a);var d=new CTATCSS;this.addCSSAttribute=function(a,b){d.addCSSAttribute(a,b);this.render()};this.removeCSSAttribute=function(a){d.removeCSSAttribute(a);this.render()};this.addStringCSS=function(a){d.addStringCSS(a);this.render()};this.removeStringCSS=function(a){d.removeStringCSS(a);this.render()};this.modifyCSSAttribute=function(a,b){d.modifyCSSAttribute(a,b);this.render()};this.getCSS=function(){return d.toCSSString()};
this.render=function(){!0===this.isAbstractComponent()?this.ctatdebug("Component is an abstract component, bump"):this.getInitialized()&&(this.getComponent()?this.ctatdebug(d.toCSSString()):this.ctatdebug("Internal error, html component not available for rendering"))};this.setStyleAll=function(a,d){this.getSubCanvas()&&this.getSubCanvas().setAttribute(a,d);this.modifyCSSAttribute(a,d)}};CTAT.Component.Base.Style.prototype=Object.create(CTATCompBase.prototype);
CTAT.Component.Base.Style.prototype.constructor=CTAT.Component.Base.Style;CTAT.Component.Base.Graphical=function(c,g,f,e,b,a,d){CTAT.Component.Base.Style.call(this,c,g,e,b,a,d);var h=f||(new CTATComponentDescription).setGenericDefaults();this.getGrDescription=function(){return h};this.setGrDescription=function(a){h=a;this.processDescription(h)};var l={},m={};this.getDisplay=function(){return $(this.getDivWrap()).css("display")};this.getdisplay=this.getDisplay.bind(this);this.GetDisplay=this.getDisplay.bind(this);this.setDisplay=function(a){a=String(a);switch(a.toLowerCase()){case "false":a=
"none";break;case "true":case "null":case "undefined":a=""}$(this.getDivWrap()).css("display",a);return this};this.setdisplay=this.setDisplay.bind(this);this.SetDisplay=this.setDisplay.bind(this);this.getAlign=function(){return this.component?$(this.component).css("text-align"):$(this.getDivWrap()).css("text-align")};this.setAlign=function(a){this.component&&(this.component.style.textAlign=a);return this};this.getBackgroundColor=function(){return $(this.getComponent()).css("background-color")};this.setBackgroundColor=
function(a){a=a?CTATGlobalFunctions.formatColor(a):null;this.component&&(this.component.style.backgroundColor=a);return this};this.setDisabledBGColor=function(a){return this};this.setDisabledTextColor=function(a){return this};this.getBorderColor=function(){return $(this.getComponent()).css("border-color")};this.setBorderColor=function(a){a&&(a=CTATGlobalFunctions.formatColor(a),this.getComponent()?$(this.getComponent()).css("border-color",a):this.getDivWrap().style.borderColor=a);return this};this.getBorderRoundness=
function(){return $(this.getComponent()).css("border-radius")};this.setBorderRoundness=function(a){a=parseInt(a,10);isNaN(a)?a=l.roundness=0:l.roundness=a;a+="px";this.component&&this.getBorderRoundness()!==a&&($(this.component).css("border-radius",a),this.component.style.borderRadius=l.roundness);return this};this.getBorderStyle=function(){return $(this.getComponent()).css("borderStyle")};this.setBorderStyle=function(a){this.component&&(this.component.style.borderStyle=a);return this};this.getBorderWidth=
function(){return this.getComponent()?$(this.getComponent()).css("borderWidth"):l.width};this.setBorderWidth=function(a){l.width=a;/(\d*(px)? ?){1,3}(\d*(px)? ?)?/.test(a)||(a="0px",console.log("invalid width string"));this.component&&this.getBorderWidth()!==a&&$(this.component).css("borderWidth",a);return this};this.setPadding=function(a){a=parseInt(a);isNaN(a)&&(a=0);this.component&&(this.component.style.padding=a+"px");return this};this.getFontColor=function(){if(this.component)return $(this.component).css("color")};
this.setFontColor=function(a){console.log("setFontColor( )");m.color=CTATGlobalFunctions.formatColor(a);this.component&&(console.log("got comp"),this.getFontColor()!==m.color&&$(this.component).css("color",m.color));return m.color};this.setFontFamily=function(a){this.component&&(this.component.style.fontFamily=a);return this};this.getFontFamily=function(){if(this.component)return this.component.style.fontFamily;console.warn("component not found");return null};this.setFontSize=function(a){a=parseInt(a);
isNaN(a)?this.component.style.fontSize=null:(m.size=a,this.component&&(this.component.style.fontSize=a+"pt"));return this};this.setShowBorder=function(a){a=CTATGlobalFunctions.toBoolean(a);this.component&&(a?this.setBorderStyle("solid"):this.setBorderStyle("none"));return this};this.setUnderlined=function(a){p_underlined=CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.textDecoration=p_underlined?"underline":null);return this};this.setBolded=function(a){a=CTATGlobalFunctions.stringToBoolean(a);
this.component&&(this.component.style.fontWeight=a?"bold":null);return this};this.setItalicized=function(a){CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.fontStyle=m.italicized?"italic":null);return this};var n=this;c=function(a){var d=a||{};return{setHandler:function(a,b){d[a]=b},set:function(a){if(d.hasOwnProperty(a)){if(d[a]){var b=Array.prototype.slice.call(arguments,1);return d[a].apply(n,b)}n.ctatdebug("Error: NULL handler for "+a)}else n.ctatdebug("Error: No handler set for "+
a)}}};this.style_handlers=c({BackgroundColor:this.setBackgroundColor,BorderColor:this.setBorderColor,borderRoundness:this.setBorderRoundness,DrawBorder:this.setShowBorder,FontFace:this.setFontFamily,FontSize:this.setFontSize,FontBold:this.setBolded,FontItalic:this.setItalicized,FontUnderlined:this.setUnderlined,labelText:this.setText,padding:this.setPadding,showBorder:this.setShowBorder,TextAlign:this.setAlign,TextColor:this.setFontColor});this.setStyle=function(a,d){this.style_handlers.set(a,d)};
this.setStyleHandler=function(a,d){this.style_handlers.setHandler(a,d)};this.parameter_handlers=c({group:this.setComponentGroup});this.setParameter=function(a,d){this.parameter_handlers.set(a,d)};this.setParameterHandler=function(a,d){this.parameter_handlers.setHandler(a,d)};this.data_ctat_handlers={};this.processAttributes=function(){if(this.getDivWrap()){var a=$(this.getDivWrap());this.disableTextAlterations(a);var d=parseInt(a.attr("tabindex"),10)||parseInt(a.attr("data-ctat-tabindex"),10);isNaN(d)||
(this.setTabIndex(d),a.attr("tabindex",null));d=a.attr("name");void 0!==d&&this.setComponentGroup(d);for(var b in this.data_ctat_handlers)d=a.data("ctat-"+b),void 0!==d&&this.data_ctat_handlers[b].apply(this,[d])}};this.data_ctat_handlers.enabled=function(a){this.setEnabled(CTATGlobalFunctions.toBoolean(a))};this.disableTextAlterations=function(a){for(var d="autocomplete off autocapitalize off autocorrect off spellcheck false".split(" "),b=0;b<d.length;b+=2){var e=d[b],c=a.attr(e);c||"false"===String(c).toLowerCase()||
a.attr(e,c=d[b+1]);d[b+1]=c}this.ctatdebug("'#"+a.attr("id")+"'.processAttributes("+d+")");return d};this.processParameters=function(a){if(a)if(a instanceof CTATComponentDescription){n.setName(a.name);a=a.params;for(var d in a)this.setParameter(d,a[d])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+a)};this.processStyles=function(a){if(a)if(a instanceof CTATComponentDescription){a=a.styles;for(var d in a)this.setStyle(d,a[d])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+
a)};this.processDescription=function(a){this.processParameters(a);this.processStyles(a)};this.configFromDescription=function(){this.processParameters(h)};this.processSerialization=function(){this.processStyles(h)};this.addClass=function(a){this.getDivWrap()&&null!=this.getDivWrap()&&this.getDivWrap().classList.add(a)};this.removeClass=function(a){this.getDivWrap()&&null!=this.getDivWrap().classList&&this.getDivWrap().classList.remove(a)}};CTAT.Component.Base.Graphical.prototype=Object.create(CTAT.Component.Base.Style.prototype);
CTAT.Component.Base.Graphical.prototype.constructor=CTAT.Component.Base.Graphical;CTAT.Component.Base.SAIHandler=function(c,g,f,e,b,a,d){CTAT.Component.Base.Graphical.call(this,c,g,f,e,b,a,d);var h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt),l=this.setName;this.setName=function(a){l(a);h.setSelection(this.getName())};this.getSAI=function(){return h};this.setSAI=function(a,d,b){a instanceof CTATSAI?h=a:(a=null===a||void 0===a?this.getName():a,h=new CTATSAI(a,d,b,
CTAT.Component.Base.SAIHandler.DefaultPrompt));return this};this.setInput=function(a){h instanceof CTATSAI?h.setInput(a):h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,a,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setAction=function(a){h instanceof CTATSAI?h.setAction(a):h=new CTATSAI(this.getName(),a,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setActionInput=function(a,d){this.setAction(a);
this.setInput(d);return this};this.setSelection=function(a){h instanceof CTATSAI?h.setSelection(a):h=new CTATSAI(a,CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt)};this.updateSAI=function(){};this.executeSAI=function(a){this.ctatdebug("executeSAI ()");var d;d=a instanceof CTATMessage?a.getSAI():a;if(d instanceof CTATSAI){var b=d.getAction();this.ctatdebug("Processing "+b+"("+d.getInput()+") on: "+d.getSelection());
if("function"==typeof this[b]){d=d.getArgumentsTyped();this.ctatdebug("JSON args: "+JSON.stringify(d));try{this.ctatdebug("Executing "+b+"("+d+","+typeof a+")..."),d.push(a),this[b].apply(this,d)}catch(r){return this.ctatdebug("ERROR: failed to execute action: "+r.message),!1}this.component&&(a=new CustomEvent("CTAT_EXECUTE_SAI",{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(a));return!0}this.ctatdebug("ERROR: Unsupported action: "+b+" from "+d.toLSxmlString());
return!1}this.ctatdebug("ERROR: Non-SAI sent to executeSAI("+typeof a+")");return!1}};CTAT.Component.Base.SAIHandler.DefaultAction="ButtonPressed";CTAT.Component.Base.SAIHandler.DefaultInput="-1";CTAT.Component.Base.SAIHandler.DefaultPrompt="";CTAT.Component.Base.SAIHandler.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTAT.Component.Base.SAIHandler.prototype.constructor=CTAT.Component.Base.SAIHandler;CTAT.Component.Base.Tutorable=function(c,g,f,e,b,a,d){CTAT.Component.Base.SAIHandler.call(this,c,g,f,e,b,a,d);var h=!0,l=!0,m=!0,n=CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR,p=this,r=!1;this.setTutorComponent=function(a){n=a;a=CTAT.Component.Base.Tutorable.Options.TutorComponent;switch(n){case a.TUTOR:m=h=l=!0;break;case a.TUTOR_NO_FEEDBACK:h=l=!0;m=!1;break;case a.DO_NOT_TUTOR:h=!1,l=!0}};this.setParameterHandler("tutorComponent",this.setTutorComponent);this.data_ctat_handlers.tutor=
function(a){h=CTATGlobalFunctions.toBoolean(a)};this.data_ctat_handlers["show-feedback"]=function(a){m=CTATGlobalFunctions.toBoolean(a)};this.getTutorComponent=function(){var a=CTAT.Component.Base.Tutorable.Options.TutorComponent;return h&&l&&m?a.TUTOR:h&&l&&!m?a.TUTOR_NO_FEEDBACK:!h&&l?a.DO_NOT_TUTOR:n};this.getDisableOnCorrect=function(){var a=$(this.getDivWrap()).attr("data-ctat-disable-on-correct");return a?CTATGlobalFunctions.toBoolean(a):!0};this.setDisableOnCorrect=function(a){$(this.getDivWrap()).attr("data-ctat-disable-on-correct",
a)};this.setParameterHandler("DisableOnCorrect",this.setDisableOnCorrect);var u=!0;this.getShowHintHighlight=function(){return u};this.setShowHintHighlight=function(a){u=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("ShowHintHighlight",this.setShowHintHighlight);this.data_ctat_handlers["show-hint-highlight"]=function(a){u=CTATGlobalFunctions.toBoolean(a)};var w=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED;this.getComponentStatus=function(){return w};this.setComponentStatus=
function(a){w=a};this.isCorrect=function(){return w===CTAT.Component.Base.Tutorable.Options.Status.CORRECT};this.isIncorrect=function(){return w===CTAT.Component.Base.Tutorable.Options.Status.INCORRECT};this.isNotGraded=function(){return w===CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.setCorrect=function(a){this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);w=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;!0===this.getDisableOnCorrect()&&this.setEnabled(!1);
!1===CTATGlobals.suppressStudentFeedback&&m&&this.showCorrect(a);this.ctatdebug("setCorrect() post showCorrect");this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setIncorrect=function(a){this.ctatdebug("setIncorrect()");this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);w=CTAT.Component.Base.Tutorable.Options.Status.INCORRECT;!1===CTATGlobals.suppressStudentFeedback&&
m&&this.showInCorrect(a);this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.incorrect,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setNotGraded=function(){this.ctatdebug("setNotGraded ()");this.setHintHighlight(!1);if(!this.isNotGraded()&&(w=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED,this.removeCorrect(),this.removeInCorrect(),this.component)){var a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.ungrade,
{detail:{component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(a)}};this.showHintHighlight=function(a,d){this.component.classList.remove("CTAT--correct");this.component.classList.remove("CTAT--incorrect");a?this.component.classList.add("CTAT--hint"):this.component.classList.remove("CTAT--hint")};this.setHintHighlight=function(a,d){this.ctatdebug("setHintHighlight ("+a+")");if(u){var b=CTATGlobalFunctions.toBoolean(a);if(this.component){var e=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:b,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(e)}b!==r&&(r=b,this.showHintHighlight(b,d))}};this.moveHintHighlight=function(a,d){this.ctatdebug("moveHintHighlight ("+a+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus=p;p.component.focus?CTATGlobals.Tab.Focus.getComponent().focus():CTATGlobals.Tab.Focus.getDivWrap().focus();if(u){var b=CTATGlobalFunctions.toBoolean(a);if(this.component){var e=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:b,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(e)}b!==r&&(r=b,this.showHintHighlight(b,d))}};this.highlight=function(a){ctatdebug("highlight ()");this.component.classList.add("CTAT--highlight")};this.unhighlight=function(a){ctatdebug("unhighlight ()");this.component.classList.remove("CTAT--highlight")};this.showCorrect=function(a){this.ctatdebug("showCorrect("+a+")");this.getComponent().classList.remove("CTAT--incorrect");this.getComponent().classList.remove("CTAT--hint");
this.getComponent().classList.add("CTAT--correct")};this.removeCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--correct")};this.showInCorrect=function(a){this.ctatdebug("showInCorrect("+a+")");this.getComponent().classList.remove("CTAT--correct");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--incorrect")};this.removeInCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--incorrect")};this.resetTutoring=
function(){this.showHintHighlight(!1);this.removeCorrect();this.removeInCorrect();w=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.grade=function(){this.updateSAI();this.processAction(!0)};this.processAction=function(a,d){this.ctatdebug("processAction("+a+","+d+")");p.unHighlightAll();var b=CTATShellTools.findComponentByClass("CTATDoneButton");b&&b instanceof CTAT.Component.Base.Tutorable&&b!=this&&b.setNotGraded();this.ctatdebug("processAction() finished checking doneButton");ctatdebug("Clearing hint window ...");
CTATCommShell.commShell&&CTATCommShell.commShell.clearFeedbackComponents();a=void 0===a||null===a?!1:a;d=void 0===d||null===d?!1:d;""!==this.getComponentGroup()?CTATShellTools.findComponent(this.getComponentGroup()).forEach(function(a){a.setNotGraded&&a.setNotGraded()}):this.setNotGraded();this.ctatdebug("processAction() finished setNotGraded");CTATCommShell.commShell&&(a?CTATCommShell.commShell.processComponentAction(this.getSAI(),!0,!0):d?CTATCommShell.commShell.processComponentAction(this.getSAI(),
!1,!0):CTATCommShell.commShell.processComponentAction(this.getSAI(),h,l));this.ctatdebug("processAction() finished call to commShell.processComponentAction");this.component&&(b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.action,{detail:{sai:this.getSAI(),component:this,graded:a||h},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(b))};this.addEventScreen=function(a){var d=document.createElement("div");d.style.position="absolute";d.style.top="0";d.style.left="0";d.style.bottom="0";
d.style.right="0";a&&d.addEventListener("dblclick",function(){setTimeout(function(){var a=p.getDivWrap().getAttribute("data-ctat-enabled");p.setEnabled(!0);var d=p.getComponent();d.hasEditListeners||(d.addEventListener("blur",function(){p.setEnabled(!1);p.getDivWrap().setAttribute("data-ctat-enabled",a);p.getDivWrap().setAttribute("value",d.value)}),"CTATTextArea"===p.getClassName()&&d.addEventListener("keydown",function(a){13==(a.keyCode||a.charCode)&&(a.preventDefault(),this.value+="\n")}),d.hasEditListeners=
!0);d.focus()},410)});this.getDivWrap().appendChild(d)}};CTAT.Component.Base.Tutorable.Options={TutorComponent:{TUTOR:"Tutor",TUTOR_NO_FEEDBACK:"Tutor but no visual feedback",DO_NOT_TUTOR:"Do not tutor"},Status:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",NOTGRADED:"NOTGRADED"}};CTAT.Component.Base.Tutorable.EventType={correct:"CTAT_CORRECT",incorrect:"CTAT_INCORRECT",highlight:"CTAT_HIGHLIGHT",ungrade:"CTAT_NOTGRADED",action:"CTAT_ACTION"};CTAT.Component.Base.Tutorable.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTAT.Component.Base.Tutorable.prototype.constructor=CTAT.Component.Base.Tutorable;CTAT.Component.Base.Clickable=function(c,g,f,e,b,a,d){CTAT.Component.Base.Tutorable.call(this,c,g,f,e,b,a,d);var h=this;this.processClick=function(a){h.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===h.getEnabled()?h.processAction():h.ctatdebug("Component is disabled, not grading")};this.setClickable=function(a){h.setEnabled(a)}};CTAT.Component.Base.Clickable.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTAT.Component.Base.Clickable.prototype.constructor=CTAT.Component.Base.Clickable;var CTATButtonBasedComponent=function(c,g,f,e,b,a,d){CTAT.Component.Base.Clickable.call(this,c,g,f,e,b,a,d);var h=this,l="",m="black";this.setActionInput("ButtonPressed","-1");this.setImage=function(a){h.ctatdebug("assignImage ("+a+")");h.getDivWrap().setAttribute("data-ctat-img",a);a&&(a="url('"+a+"')");$(h.getComponent()).css("background-image",a);$(h.getComponent()).css("background-size","cover")};this.assignImage=function(a){h.ctatdebug("assignImage ()");h.assignImages(a,a,a,a)};this.assignImageURL=
function(a){h.ctatdebug("assignImageURL ()");h.assignImages(a,a,a,a)};this.assignImages=function(a,d,b,e){h.ctatdebug("assignImages ()");h.getDivWrap().setAttribute("data-ctat-image-hover",a);h.getDivWrap().setAttribute("data-ctat-image-clicked",d);h.getDivWrap().setAttribute("data-ctat-image-default",b);h.getDivWrap().setAttribute("data-ctat-image-disabled",e);this.setImage(b)};this.processBaseMousedown=function(){h.ctatdebug("processMousedown ()");h.component.classList.add("CTAT-button--clicked");
var a=h.getDivWrap().getAttribute("data-ctat-image-clicked");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseup=function(){h.ctatdebug("processMouseup ()");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseover=function(){h.ctatdebug("processBaseMouseover ()");
h.component.classList.add("CTAT-button--hover");var a=h.getDivWrap().getAttribute("data-ctat-image-hover");h.getEnabled()&&a&&void 0!==a&&""!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseout=function(){h.ctatdebug("processBaseMouseout ()");h.component.classList.remove("CTAT-button--hover");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&(h.getComponent().style.backgroundImage=
"url('"+a+"')")};this.setText=function(a){h.ctatdebug("setText ("+a+")");l=a;null!==h.getComponent()&&(h.getComponent().innerHTML=l)};this.setFontColor=function(a){m=a;$(h.getComponent()).css("color",a)};this.getFontColor=function(){return m};this.setStyleHandler("labelText",this.setText);this.getText=function(){return l};this.processClick=function(a){h.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===h.getEnabled()?(null!==CTATGlobals.Tab.Focus&&("CTATTextArea"==
CTATGlobals.Tab.Focus.getClassName()||"CTATTextInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextField"==CTATGlobals.Tab.Focus.getClassName()?CTATGlobals.Tab.Focus.processAction():h.ctatdebug("Info: CTATGlobals.Tab.Focus==null")),a=$(h.getDivWrap()).attr("value"),h.setInput(a?a:"-1"),h.processAction()):h.ctatdebug("Component is disabled, not grading")};this.ButtonPressed=function(){}};CTATButtonBasedComponent.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATButtonBasedComponent.prototype.constructor=CTATButtonBasedComponent;CTAT.ComponentRegistry={};CTAT.ComponentRegistry.addComponentType=function(){};Object.defineProperty(CTAT.ComponentRegistry,"addComponentType",{enumerable:!1,value:function(c,g){"string"==typeof c&&(this.hasOwnProperty(c)?alert(c+" is already a registered component"):this[c]=g)}});var CTATAudioButton=function(c,g,f,e,b){CTATButtonBasedComponent.call(this,"CTATAudioButton","audiobutton",c,g,f,e,b);var a=this;a.setActionInput("play","-1");var d=null,h="",l=CTATConfiguration.get("previewMode");this.setSource=function(a){this.getDivWrap().setAttribute("data-ctat-src",a);return this};this.getSource=function(){return this.getDivWrap().getAttribute("data-ctat-src")};this.setParameterHandler("SoundFile",this.setSource);this.init=function(){var b=document.createElement("button");b.value=
"-1";b.name=a.getName();b.setAttribute("id",CTATGlobalFunctions.gensym.div_id());b.setAttribute("onkeypress","return noenter(event)");b.classList.add("CTAT-button");if(this.getDivWrap().getAttribute("data-ctat-label"))b.textContent=this.getDivWrap().getAttribute("data-ctat-label");else if(a.getText())b.textContent=a.getText();else if(a.getDivWrap()&&a.getDivWrap().innerHTML&&!l){var e=a.getDivWrap().innerHTML;a.getDivWrap().innerHTML="";b.innerHTML=e}a.setInitialized(!0);a.setComponent(b);a.addComponentReference(a,
b);a.getDivWrap().appendChild(b);a.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());l||(b.addEventListener("click",a.processClick),b.addEventListener("focus",a.processFocus));d=document.createElement("audio");d.addEventListener("canplay",function(){a.ctatdebug("Audio loaded and ready for play");""!==h&&(a.logAudioEvent(h),h="")},!0);d.onended=function(){a.ctatdebug("Audio ended");a.logAudioEvent("end")};this.getDivWrap().appendChild(d)};this.getConfigurationActions=function(){var a=
[],d;0<this.component.innerHTML.trim().length&&(d=new CTATSAI,d.setSelection(this.getName()),d.setInput(this.component.innerHTML.toString()),d.setAction("setText"),a.push(d));0<this.getSource().trim().length&&(d=new CTATSAI,d.setSelection(this.getName()),d.setInput(this.getSource()),d.setAction("setSource"),a.push(d));return a};this.reset=function(){a.configFromDescription();a.processSerialization();a.setEnabled(!0);h="reset"};this.logAudioEvent=function(b){a.ctatdebug("logAudioEvent ("+b+")");if(void 0!==
d.duration)if(null!==CTATCommShell.commShell){b=new CTATSAI(a.getName(),b,a.toHHMMSS(d.currentTime)+".000","");b.addSelection(encodeURIComponent(d.currentSrc),"media_file");b.addSelection(a.toHHMMSS(d.duration)+".000","clip_length");var e=b.getInputObject();null!==e&&e.setType("time");CTATCommShell.commShell.processComponentAction(b,!1,!0,a,"AUDIO_ACTION","USER")}else a.ctatdebug("Error: commShell is null, can't send untutored tool message");else a.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};
this.processClick=function(b){a.ctatdebug("processClick ("+b.currentTarget.getAttribute("id")+" -> "+b.eventPhase+")");!0===a.getEnabled()?(b=this.getSource(),a.ctatdebug("Playing audio file: "+b),d.setAttribute("src",b),d.play(),h="play",a.processAction()):a.ctatdebug("Component is disabled, not grading")}.bind(this);this.play=function(){a.ctatdebug("play");var b=this.getSource();d.setAttribute("src",b);d.load();d.play();h="play"};this.playClip=function(b){a.ctatdebug("playClip");d.setAttribute("src",
b);d.load();d.play();h="play"};this.pause=function(){a.ctatdebug("pause");d.pause();h="pause"}};CTATAudioButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATAudioButton.prototype.constructor=CTATAudioButton;CTAT.ComponentRegistry.addComponentType("CTATAudioButton",CTATAudioButton);var CTATButton=function(c,g,f,e,b){CTATButtonBasedComponent.call(this,"CTATButton","aButton",c,g,f,e,b);var a=this,d=null,h=CTATConfiguration.get("previewMode");this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setActionInput("ButtonPressed","-1");d=document.createElement("button");d.type="button";d.name=a.getName();d.value=$(this.getDivWrap()).attr("value")||"-1";this.setInput(d.value);d.id=CTATGlobalFunctions.gensym.div_id();d.setAttribute("onkeypress","return noenter(event)");d.classList.add("CTAT-button");
a.setInitialized(!0);if(a.getDivWrap().getAttribute("data-ctat-label"))d.innerHTML=a.getDivWrap().getAttribute("data-ctat-label");else if(a.getText())d.innerHTML=a.getText();else if(a.getDivWrap()&&a.getDivWrap().innerHTML&&!h){var b=a.getDivWrap().innerHTML;a.getDivWrap().innerHTML="";d.innerHTML=b}a.setComponent(d);a.addComponentReference(a,d);a.getDivWrap().appendChild(d);d.addEventListener("click",a.processClick);d.addEventListener("focus",a.processFocus);d.addEventListener("mousedown",this.processBaseMousedown);
d.addEventListener("mouseup",this.processBaseMouseup);d.addEventListener("mouseover",a.processBaseMouseover);d.addEventListener("mouseout",a.processBaseMouseout)}.bind(this);this.render=function(){};this.getConfigurationActions=function(){var a=[],b;0<d.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(d.innerHTML.toString()),b.setAction("setText"),a.push(b));return a};this.reset=function(){a.configFromDescription();a.processSerialization();a.setEnabled(!0)}};
CTATButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATButton.prototype.constructor=CTATButton;CTAT.ComponentRegistry.addComponentType("CTATButton",CTATButton);var CTATTextBasedComponent=function(c,g,f,e,b,a,d){CTAT.Component.Base.Tutorable.call(this,c,g,f,e,b,a,d);var h=this,l="",m="#000000",n=16,p=!0,r=255,u=!0;this.setAction("UpdateTextField");this.backgrade=!0;this.setFontColor=function(a){m=a;$(h.getComponent()).css("color",a)};this.getFontColor=function(){return m};this.setFontSize=function(a){a.includes("px")||(a+="px");n=a;$(h.getComponent()).css("font-size",a)};this.getFontSize=function(){return n};this.assignText=function(a){l=a;this.setInput(a)};
this.UpdateTextArea=this.UpdateTextField=function(a){this.setText(a)};this.setTabOnEnter=function(a){p=CTATGlobalFunctions.toBoolean(a)};this.setStyleHandler("TabOnEnter",this.setTabOnEnter);this.data_ctat_handlers["tab-on-enter"]=this.setTabOnEnter;this.assignEditable=function(a){u=a};this.setMaxCharacters=function(a){r=a};this.setStyleHandler("MaxCharacters",this.setMaxCharacters);this.getText=function(){return l};this.getEditable=function(){return u};this.getTabOnEnter=function(){return p};this.getMaxCharacters=
function(){return r};this.setEditable=function(a){h.assignEditable(CTATGlobalFunctions.toBoolean(a));null!==h.getComponent()&&(!0===h.getEditable()?h.getComponent().contentEditable="true":h.getComponent().contentEditable="false")};this.setStyleHandler("Enabled",this.setEditable);this.setEnabled=function(a){h.assignEnabled(a);null!==h.getComponent()&&(h.getComponent().disabled=!a,this.setEditable(a))};var w=this.processAction.bind(this);this.processAction=function(a,d){h.ctatdebug("processAction ()");
this.updateSAI();CTATGlobalFunctions.isBlank(this.getValue())||w(a,d)};this.processKeypress=function(a){h.ctatdebug("processKeypress ()");var d=a.target.getAttribute("id");h.ctatdebug(d);var b=h.getComponentFromID(d);if(null===b)h.ctatdebug("Error: component reference is null");else switch(h.ctatdebug(b.getName()+" keydown ("+("google"==CTATConfig.platform?0:window.event?window.event.keyCode:a.which)+" -> "+a.eventPhase+") ID: "+d),a.which){case 37:h.ctatdebug("left arrow key pressed!");break;case 39:h.ctatdebug("right arrow key pressed!");
break;case 13:return p?(h.component.blur(),CTATGlobals.Tab.Focus=null,h.processAction(),!1):!0;case 0:h.component.blur();CTATGlobals.Tab.Focus=null;h.processAction();break;default:h.ctatdebug('Key pressed! "'+a.which+'"')}};this.updateSAI=function(){h.ctatdebug("updateSAI ()");this.setInput(this.getValue());var a=this.getSAI();h.ctatdebug("SAI: "+a.toTSxmlString())}};CTATTextBasedComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATTextBasedComponent.prototype.constructor=CTATTextBasedComponent;var CTATTextArea=function(c,g,f,e,b){CTATTextBasedComponent.call(this,"CTATTextArea","__undefined__",c,g,f,e,b);this.setDefaultWidth(100);this.setDefaultHeight(44);var a=this,d=null,h=null,l=CTATConfiguration.get("previewMode");this.setAction("UpdateTextArea");this.init=function(b){d=document.createElement("textarea");c&&(d.name=c.name);d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());(b=this.getDivWrap())&&$(b).attr("maxlength")&&(d.maxlength=$(b).attr("maxlength"));b&&$(b).attr("rows")&&
(d.rows=$(b).attr("rows"));b&&$(b).attr("cols")&&(d.cols=$(b).attr("cols"));a.setComponent(d);b&&$(b).attr("value")?this.setText($(b).attr("value")):d.value=this.getText();a.setInitialized(!0);a.addComponentReference(a,d);b.appendChild(d);$(d).keypress(a.processKeypress);d.addEventListener("focus",a.processFocus);$(d).on("input",function(d){a.setNotGraded()});l&&this.addEventScreen(!1)};this.processBlur=function(d){a.processAction()};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};
this.setText=function(b){a.ctatdebug("setText ("+b+")");a.assignText(b);d.value=b};this.getValue=function(){return d.value};this.reset=function(){a.configFromDescription();a.processSerialization();d.value=""}};CTATTextArea.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextArea.prototype.constructor=CTATTextArea;CTAT.ComponentRegistry.addComponentType("CTATTextArea",CTATTextArea);var CTATChatPanel=function(c,g,f,e,b){CTAT.Component.Base.Tutorable.call(this,"CTATChatPanel","__undefined__",c,g,f,e,b);var a=this,d=null,h=null,l=null,m=null,n=null,p=CTATConfiguration.get("previewMode"),r=0,u=0;this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);a.setInitialized(!0);var b=a.getDivWrap();a.setComponent(b);a.addComponentReference(a,b);a.ctatdebug("chat name = "+this.getName());a.checkTime();
d=document.createElement("div");d.id="chatArea";d.classList.add("CTATChatPanel--chat-area");h=document.createElement("div");h.id="inputDiv";h.classList.add("CTATChatPanel--input-div");l=document.createElement("div");l.style.color="black";l.style.paddingTop="5px";l.style.paddingLeft="5px";content=document.createTextNode("Your chat is being monitored and will be saved after the session");warningImg=document.createElement("img");warningImg.src="../../CTATCode/HTML5/skindata/caution.png";l.appendChild(warningImg);
l.appendChild(content);lineBreak=document.createElement("br");m=document.createElement("textarea");m.id=b.id+"_input";m.classList.add("CTATChatPanel--message-box");m.placeholder="Type a message";m.style.width="95%";m.style.height="40%";m.style.border="2px solid #D3D3D3";m.style["float"]="center";m.style.resize="none";m.style.marginTop="20px";m.style.marginLeft="2%";m.style.fontFamily="Verdana";m.addEventListener("keydown",this.typingIndicator);h.appendChild(l);h.appendChild(m);n=document.createElement("button");
n.innerText="Send";n.classList.add("CTATChatPanel--send-button");n.style.width="20%";n.style.border="2px solid #9096a0";n.style.borderRadius="10px";n.style.marginTop="5px";n.addEventListener("click",this.sendText);a.setComponent(d);a.setComponent(h);a.setComponent(m);a.addComponentReference(a,d);a.addComponentReference(a,h);a.addComponentReference(a,l);a.addComponentReference(a,m);b.appendChild(d);b.appendChild(h);a.render();p&&this.addEventScreen(!1)};this.updateSAISend=function(d){a.ctatdebug("updateSAISend ()");
console.log("updateSAISend ()",d);var b=a.getDivWrap();this.setSelection(b.id);this.setAction("sendMessage");b=CTATConfiguration.get("user_guid");this.setInput(b+": "+d);d=this.getSAI();a.ctatdebug("SAI: "+d.toTSxmlString())};var w=this.processAction.bind(this);this.processSend=function(d,b,e){a.ctatdebug("processSend ()");a.updateSAISend(d);d="computer"===d.split("_").pop();CTATGlobalFunctions.isBlank(m.value)&&!d||w(b,e)};this.addOwnMessage=function(a){var b=document.createElement("div");b.innerText=
a;b.style.borderRadius="5px";b.style.backgroundColor="white";b.style.border="1px solid #9096a0";b.style.boxShadow="2px 2px #9096a0";b.style.marginBottom="5px";b.style.marginTop="2px";b.style.maxWidth="90%";b.style.wordWrap="break-word";b.style.padding="5px 8px";b.style.display="flex";b.style.cssFloat="right";b.style.clear="both";b.style.fontFamily="Verdana";var e=new Date;a=12<e.getHours()?e.getHours()-12:e.getHours();var c;c=10>e.getMinutes()?"0"+e.getMinutes():12<e.getHours()?e.getMinutes()+"PM":
e.getMinutes()+"AM";e=document.createElement("div");e.innerText=""+a+":"+c;e.style.fontSize=".8em";e.style.color="grey";e.style.paddingRight="3px";c=document.createElement("br");e.style.cssFloat="right";var f=document.createElement("br");a=document.createElement("div");a.style.display="block";a.style.padding="5px";a.appendChild(b);a.appendChild(c);a.appendChild(e);a.appendChild(f);b=d.children;1<=b.length&&(b=b[b.length-1],e=b.children,"Typing..."==e[e.length-4].innerText&&(d.removeChild(b),d.appendChild(a),
d.scrollTop=d.scrollHeight));d.appendChild(a);d.scrollTop=d.scrollHeight};this.addOtherMessage=function(a){var b=a.indexOf(":"),e=a.substr(0,b)+" ",b=a.substr(b+2);a=document.createElement("div");a.innerHTML=e.bold()+b;a.style.borderRadius="5px";a.style.position="relative";a.style.backgroundColor="#c7edfc";a.style.marginBottom="5px";a.style.marginTop="2px";a.style.maxWidth="90%";a.style.wordWrap="break-word";a.style.padding="5px 8px";a.style.display="inline-block";a.style.fontFamily="Verdana";e=document.createElement("br");
d.appendChild(a);d.appendChild(e);d.scrollTop=d.scrollHeight};this.sendCompMessage=function(a){var b=document.createElement("div");b.innerHTML="computer: ".bold()+a;b.style.borderRadius="5px";b.style.position="relative";b.style.backgroundColor="#d5dde8";b.style.marginBottom="5px";b.style.marginTop="2px";b.style.maxWidth="90%";b.style.wordWrap="break-word";b.style.padding="5px 8px";b.style.display="inline-block";b.style.fontFamily="Verdana";a=document.createElement("br");d.appendChild(b);d.appendChild(a);
d.scrollTop=d.scrollHeight};this.sendCompMessageBroadcast=function(d){if(""!==d){a.processSend(d+"_computer");var b=CTAT.Component.Base.Tutorable.Options.TutorComponent;a.getTutorComponent()===b.DO_NOT_TUTOR&&a.sendCompMessage(d)}};this.checkTime=function(a){if(2<=u){if(a=d.children,1<=a.length){a=a[a.length-1];var b=a.children;"Typing..."==b[b.length-4].innerText&&d.removeChild(a)}}else u++,r=setInterval(this.checkTime,1E3)};this.resetTimer=function(a){clearInterval(r);u=0};this.typingIndicator=
function(b){a.resetTimer();b=d.children;0!=b.length?(b=b[b.length-1].children,"Typing..."!=b[b.length-4].innerText&&(a.processSend("Typing..."),a.addOwnMessage("Typing..."))):(a.processSend("Typing..."),a.addOwnMessage("Typing..."))};this.sendText=function(d){var b=m.value;""!==b&&(b=d+": "+b,a.processSend(b),d=CTAT.Component.Base.Tutorable.Options.TutorComponent,a.getTutorComponent()===d.DO_NOT_TUTOR&&a.addOwnMessage(b));m.value="";n.classList.remove("CTAT--incorrect")};this.sendMessage=function(d){if("computer"===
d.split("_").pop()){var b=d.indexOf(":"),e=d.lastIndexOf("_");d=d.slice(b+2,e);a.sendCompMessage(d)}else a.addOtherMessage(d);n.classList.remove("CTAT--incorrect")}};CTATChatPanel.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATChatPanel.prototype.constructor=CTATChatPanel;CTAT.ComponentRegistry.addComponentType("CTATChatPanel",CTATChatPanel);var CTATCheckBox=function(c,g,f,e,b){CTAT.Component.Base.Clickable.call(this,"CTATCheckBox","__undefined__",c,g,f,e,b);var a=null,d=null,h=CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var l=this;this.setSelection(this.getComponentGroup());this.setAction("UpdateCheckBox");
this.getCheckBox=function(){return a};this.setStyleHandler("labelPlacement",null);var m=function(a){this.updateSAI();this.processClick(a)};this.init=function(){l.setInitialized(!0);a=document.createElement("input");a.type="checkbox";a.setAttribute("id",this.getName()+"_check");a.classList.add("CTATCheckBox--button");this.getText()?a.value=l.getText():this.getDivWrap()&&this.getDivWrap().textContent?a.value=this.getDivWrap().textContent:a.value=a.id;this.getComponentGroup()?a.name=l.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?a.name=$(this.getDivWrap()).attr("name"):a.name="checkBoxGroup";!0===l.getEnabled()?a.disabled=!1:a.disabled=!0;l.ctatdebug("Final location: "+l.getX()+","+l.getY()+" with text: "+l.getText());l.addComponentReference(l,a);if(!h){var b=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML=""}$(l.getDivWrap()).append(a);d=document.createElement("label");d.htmlFor=a.id;d.classList.add("CTATCheckBox--label");this.getText()?d.textContent=this.getText():
b&&!h?d.innerHTML=b:this.getDivWrap().getAttribute("data-ctat-label")&&this.setText(this.getDivWrap().getAttribute("data-ctat-label"));$(this.getDivWrap()).append(d);l.setComponent(a);a.addEventListener("click",m.bind(this));a.addEventListener("focus",l.processFocus);a.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup())};this.resize=function(){var a=$(this.getDivWrap()).height();$(d).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",
a-10+"px")};this.getConfigurationActions=function(){var a=[],b;0<d.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(d.innerHTML.toString()),b.setAction("setText"),a.push(b));return a};var n=this.setText;this.setText=function(b){l.ctatdebug("setText ("+b+")");n(b);a&&(a.value=b,d.innerHTML=b)};this.setStyleHandler("labelText",this.setText);var p=this.setEnabled;this.setEnabled=function(d){p(d);a&&(a.disabled=!this.getEnabled())};this.getCheckBoxInput=function(){return d.innerHTML+
": "+a.checked};this.reset=function(){a.checked=!1;l.setEnabled(!0)};this.UpdateCheckBox=function(d){var b=new RegExp("(^|;)"+CTATCheckBox.escape(a.value)+"\\s*:\\s*true");a.checked=0<=d.search(b)};this.SetSelected=function(d){d=CTATGlobalFunctions.toBoolean(d);a.checked=d};this.updateSAI=function(){var d=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="checkbox"][name="'+a.name+'"])').sort(function(a,d){var b=a.id,e=d.id;return b>e?1:b<e?-1:0}),d=$.map(d,function(a){a=$(a).data("CTATComponent").getCheckBox();
return a.value+": "+a.checked});this.setSelection(a.name);this.setAction("UpdateCheckBox");this.setInput(d.join(";"))};var r=function(b){d.classList.add(b);a.classList.add(b)},u=function(b){d.classList.remove(b);a.classList.remove(b)};this.showCorrect=function(a){u("CTAT--incorrect");u("CTAT--hint");r("CTAT--correct")};this.removeCorrect=u.bind(this,"CTAT--correct");this.showInCorrect=function(a){u("CTAT--correct");u("CTAT--hint");r("CTAT--incorrect")};this.removeInCorrect=u.bind(this,"CTAT--incorrect");
this.showHintHighlight=function(a){u("CTAT--incorrect");u("CTAT--correct");a?r("CTAT--hint"):u("CTAT--hint")}};CTATCheckBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATCheckBox.prototype.constructor=CTATCheckBox;CTATCheckBox.escape=function(c){return c.replace(/[-[\]{}()*+?.,\\^$|#\s\/]/g,"\\$&")};CTAT.ComponentRegistry.addComponentType("CTATCheckBox",CTATCheckBox);var CTATComboBox=function(c,g,f,e,b){CTAT.Component.Base.Clickable.call(this,"CTATComboBox","__undefined__",c,g,f,e,b);var a=this,d=null;this.component=null;var h="",l=CTATConfiguration.get("previewMode");this.setAction("UpdateComboBox");var m=",";c=function(a){m=a;d&&(d.innerHTML="",this.addLabels(n,m))}.bind(this);this.setStyleHandler("SplitCharacter",c);this.data_ctat_handlers["split-on"]=c;var n=null;this.setLabels=function(a){n=a;d&&(d.innerHTML="",this.addLabels(n,m))}.bind(this);this.setStyleHandler("Labels",
this.setLabels);this.data_ctat_handlers.labels=this.setLabels;var p=null;c=function(a){a=parseInt(a);p=isNaN(a)?null:a;d&&d.setAttribute("size",p)};this.setStyleHandler("DropDownSize",c);this.data_ctat_handlers.size=c;this.setStyleHandler("DropDownWidth",null);this.setNumOptions=c;this.setGradeOnNextClick=function(d){a.ctatdebug("CTATComboBox["+a.getName()+"].setGradeOnNextClick("+d+")");h=d};this.getGradeOnNextClick=function(){a.ctatdebug("CTATComboBox["+a.getName()+"].getGradeOnNextClick() to return "+
h);return h};this.processAssociatedRules=function(d,b,e){d=d.getProperty("OutOfOrder");a.ctatdebug("CB["+a.getName()+"] processAssociatedRules indicator "+b+", outOfOrder "+d+", tutorAdvice '"+e+"'");b&&"incorrect"==b.toString().toLowerCase()&&(d||e&&e.toString().toLowerCase().includes(" the step you "))&&a.setGradeOnNextClick("at "+(new Date).toString()+": sai "+a.getSAI().toString())};this.init=function(){a.setInitialized(!0);d=document.createElement("select");d.name=a.getName();d.setAttribute("id",
CTATGlobalFunctions.gensym.div_id());d.setAttribute("onkeypress","return noenter(event)");d.onchange=this.processComboSelection;d.addEventListener("click",function(d){a.ctatdebug("CB["+a.getName()+"].onclick() "+d+", gradeOnNextClickInfo "+a.getGradeOnNextClick());a.getGradeOnNextClick()&&a.processComboSelection()});d.classList.add("CTAT-combobox");p&&!l&&d.setAttribute("size",p);if(!l){var b=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML="";b.trim()&&(d.innerHTML=b)}n&&this.addLabels(n,
m);!0===a.getEnabled()?d.disabled=!1:d.disabled=!0;a.addComponentReference(a,d);a.setComponent(d);a.getDivWrap().appendChild(d);this.component=d;d.addEventListener("focus",a.processFocus)};this.getConfigurationActions=function(){var a=[];if(n){var d=new CTATSAI;d.setSelection(this.getName());d.setInput(n);d.setAction("setLabels");a.push(d)}return a};this.getHTMLComponent=function(){return d};this.addLabels=function(a,d){for(var b=a.split(d?d:m),e=0;e<b.length;e++)this.addItem(b[e])};this.addBlank=
function(a){for(var d=0;d<a;d++)this.addItem("")};this.addItem=function(b){a.ctatdebug("addItem ("+b+")");var e=document.createElement("option");e.setAttribute("value",b);e.textContent=b;d.appendChild(e)};this.setFontSize=function(a){isNaN(a)||($(this.getComponent()).css("font-size",a+"px"),this.getDivWrap().setAttribute("data-ctat-font-size",a))};this.valid_selection=function(){return 0<=d.selectedIndex&&!CTATGlobalFunctions.isBlank(d.value)};this.processComboSelection=function(){a.ctatdebug("processComboSelection ()");
a.setGradeOnNextClick("");a.setInput(d.options[d.selectedIndex].value);a.valid_selection()?a.processAction():this.ctatdebug("Empty component, nothing to grade")};this.UpdateComboBox=function(a){d.value=a};this.updateSAI=function(){a.setInput(d.value)}};CTATComboBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATComboBox.prototype.constructor=CTATComboBox;CTAT.ComponentRegistry.addComponentType("CTATComboBox",CTATComboBox);var CTATDoneButton=function(c,g,f,e,b){CTAT.Component.Base.Clickable.call(this,"done","CTATDoneButton",c,g,f,e,b);this.setName("done");this.setClassName("CTATDoneButton");this.setText(CTATGlobals.languageManager.getString("DONE"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);var a=this;this.init=function(){this.setInitialized(!0);var a=document.createElement("button");a.classList.add("CTAT-done-button");this.setComponent(a);var b=document.createElement("div");
b.classList.add("CTAT-done-button--content");a.appendChild(b);var e=document.createElement("div");e.textContent="\u2714";e.classList.add("CTAT-done-button--icon");b.appendChild(e);this.getText()&&(e=document.createElement("div"),e.classList.add("CTAT-done-button--text"),e.textContent=this.getText(),b.appendChild(e));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-done-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-done-button--hover");
a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-done-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",this.processClick);a.addEventListener("focus",this.processFocus)};this.processClick=function(d){a.getEnabled()&&CTATCommShell.commShell&&
(d=new FocusEvent(a.getName(),{currentTarget:a,relatedTarget:CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getComponent?CTATGlobals.Tab.Focus.getComponent():null}),a.processFocus(d),CTATCommShell.commShell.processDone(a.getCompletionStatus()))};this.getCompletionStatus=function(){return this.getDivWrap()?this.getDivWrap().getAttribute("data-ctat-completion-status"):""};this.setCompletionStatus=function(a){this.getDivWrap()&&this.getDivWrap().setAttribute("data-ctat-completion-status",
String(a));return this}};CTATDoneButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATDoneButton.prototype.constructor=CTATDoneButton;CTAT.ComponentRegistry.addComponentType("CTATDoneButton",CTATDoneButton);var CTATDragNDrop=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragNDrop","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};var c=function(a){return a.split("").reduce(function(a,
d){a=(a<<5)-a+d.charCodeAt(0);return a&a},0)},g=function(a){var d=$(this).parent().attr("name"),b=$(this).parent().attr("id");a.dataTransfer.setData("ctat/group",d);a.dataTransfer.setData("ctat/source",b);a.dataTransfer.setData("text",this.id);var e=c(this.id);CTATDragNDrop.dragging[e]={id:this.id,group:d,source:b};a.dataTransfer.setData("ctat/id/"+e,e)},f=function(a){for(var d,b=0;b<a.dataTransfer.types.length;b++)if(d=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))d=d[1],CTATDragNDrop.dragging.hasOwnProperty(d)&&
delete CTATDragNDrop.dragging[d]},e=null;this.init=function(){e=this.getDivWrap();if(!$(e).attr("name")){var a=CTATDragNDrop.default_groupname;this.getComponentGroup()&&(a=this.getComponentGroup());$(e).attr("name",a)}this.setComponent(e);CTATComponentReference.add(this,e);CTATConfiguration.get("previewMode")||$(e).children().addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",
g,!1);this.addEventListener("dragend",f,!1)});this.component.addEventListener("dragover",function(a){var d=!1;if($(this).data("CTATComponent").getEnabled()){var b=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(b)||0>b||$(this).children().length<b)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(d=!0);else for(var e,b=0;b<a.dataTransfer.types.length;b++)if(e=
/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))e=e[1],CTATDragNDrop.dragging.hasOwnProperty(e)&&CTATDragNDrop.dragging[e].group===$(this).attr("name")&&CTATDragNDrop.dragging[e].source!==this.id&&(d=!0)}d&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragNDrop--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragNDrop--valid-drop");var d=$(this).data("CTATComponent");
if(d.getEnabled()){var b=a.dataTransfer.getData("text");a.dataTransfer.getData("ctat/source");a=document.getElementById(b);this.appendChild(a);$("#"+b).removeClass("CTAT--correct CTAT--incorrect CTAT--hint");d.setActionInput("Add",b);d.processAction()}},!1);this.component.addEventListener("dragleave",function(a){this.classList.remove("CTATDragNDrop--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],d=[];$(this.component).children().each(function(){d.push($(this).attr("id"))});
if(0<d.length){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("SetChildren");b.setInput(d.sort().join(";"));a.push(b)}return a};var b=this.setEnabled;this.setEnabled=function(a){b(a);e&&($(e).children().attr("draggable",a),this.getDisableOnCorrect()&&$(e).find(".CTAT--correct").attr("draggable",!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragNDrop--item")||($(a).addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}),
a.addEventListener("dragstart",g,!1),a.addEventListener("dragend",f,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};var a=this.showCorrect.bind(this);this.showCorrect=function(d){switch(d.getAction()){case "Add":this.setEnabled(!0);d=d.getInput();$("#"+d).addClass("CTAT--correct");this.getDisableOnCorrect()&&
$("#"+d).attr("draggable",!1);break;default:a(d)}};var d=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:d(a)}}};CTATDragNDrop.dragging={};CTATDragNDrop.default_groupname="DragNDropGroup";CTATDragNDrop.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragNDrop.prototype.constructor=CTATDragNDrop;CTAT.ComponentRegistry.addComponentType("CTATDragNDrop",CTATDragNDrop);var CTATDragSource=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragSource","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};this.set_child_overflow=
function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-overflow",a)};this.setParameterHandler("MaxOverflow",this.set_child_overflow);this.get_child_overflow=function(){var a=parseInt($(this.component).attr("data-ctat-max-overflow"));return isNaN(a)?-1:a};this.set_purpose=function(a){a?$(this.component).attr("data-ctat-purpose",a):$(this.component).attr("data-ctat-purpose","destination")};this.setParameterHandler("Purpose",this.set_purpose);this.get_purpose=function(){return $(this.component).attr("data-ctat-purpose")?
$(this.component).attr("data-ctat-purpose"):"destination"};var c=function(a){return a.split("").reduce(function(a,d){a=(a<<5)-a+d.charCodeAt(0);return a&a},0)},g=function(a){var d=$(this).parent().attr("name"),b=$(this).parent().attr("id");a.dataTransfer.setData("ctat/group",d);a.dataTransfer.setData("ctat/source",b);a.dataTransfer.setData("original",this.id);if("source"===$("#"+b).attr("data-ctat-purpose")){var e=this.id+"--"+CTATGlobalFunctions.gensym.div_id().slice(7);a.dataTransfer.setData("text",
e);var f=c(e);a.dataTransfer.setData("ctat/id/"+f,f);CTATDragSource.dragging[f]={id:e,group:d,source:b}}else a.dataTransfer.setData("text",this.id),f=c(this.id),a.dataTransfer.setData("ctat/id/"+f,f),CTATDragSource.dragging[f]={id:this.id,group:d,source:b}},f=function(a){for(var d,b=0;b<a.dataTransfer.types.length;b++)if(d=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))d=d[1],CTATDragSource.dragging.hasOwnProperty(d)&&delete CTATDragSource.dragging[d]},e=this;e.setDisabled=function(a){try{if("button"!==
a.type&&(a.disabled=!0),0<a.children.length)for(var d=0;d<a.children.length;d++)e.setDisabled(a.children[d])}catch(n){}};e.removeDisabled=function(a){a.disabled=!1;if(0<a.children.length)for(var d=0;d<a.children.length;d++)e.removeDisabled(a.children[d])};e.animatedRemove=function(a){$("#"+a).animate({opacity:.1,zoom:1.3},500,"swing",function(){var d=document.getElementById(a);d.parentNode.removeChild(d)})};var b=null;this.init=function(){b=this.getDivWrap();if(!$(b).attr("name")){var a=CTATDragSource.default_groupname;
this.getComponentGroup()&&(a=this.getComponentGroup());$(b).attr("name",a)}this.setComponent(b);CTATComponentReference.add(this,b);CTATConfiguration.get("previewMode")||$(b).children().addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",g,!1);this.addEventListener("dragend",f,!1)});"source"===b.getAttribute("data-ctat-purpose")&&(window.onload=function(){e.setDisabled(b)});
this.component.addEventListener("dragover",function(a){var d=!1;if($(this).data("CTATComponent").getEnabled()){var b=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(b)||0>b||$(this).children().length<b)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(d=!0);else for(var e,b=0;b<a.dataTransfer.types.length;b++)if(e=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[b]))e=
e[1],CTATDragSource.dragging.hasOwnProperty(e)&&CTATDragSource.dragging[e].group===$(this).attr("name")&&CTATDragSource.dragging[e].source!==this.id&&(d=!0)}"source"===$(a.target).attr("data-ctat-purpose")&&(d=!1);d&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragSource--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragSource--valid-drop");var d=$(this).data("CTATComponent");
if(d.getEnabled()){var b=a.dataTransfer.getData("text"),c;document.getElementById(b)&&(c=document.getElementById(b),this.appendChild(c));if(!document.getElementById(b)){a=document.getElementById(a.dataTransfer.getData("original"));c=a.cloneNode(!1);this.append(c);c.id=b;c.addEventListener("dragstart",g,!1);c.addEventListener("dragend",f,!1);var h,m=/(CTAT[A-z]*)(\s|$)/g.exec(c.className);if(m)for(var l=0;l<m.length;l++)CTAT.ComponentRegistry[m[l]]&&(h=m[l]);h&&CTATTutor.initializeHTMLComponent(c,
h);c.setAttribute("draggable",!0);c.setAttribute("unselectable","on");h=a.childNodes.length;m=c.childNodes.length;a.classList.remove("CTAT--correct");a.classList.remove("CTAT--incorrect");a.classList.remove("CTAT--hint");if(m===h)for(l=0;l<m;l++)c.childNodes[l].setAttribute("class",a.childNodes[l].className),c.childNodes[l].setAttribute("value",a.childNodes[l].value),c.childNodes[l].innerHTML=a.childNodes[l].innerHTML;if(h!==m){for(;c.hasChildNodes();)c.removeChild(c.lastChild);for(l=0;l<h;l++)c.appendChild(a.childNodes[l].cloneNode(!0))}}"trashcan"===
$(this).attr("data-ctat-purpose")&&this.removeChild(c);"source"===$(this).attr("data-ctat-purpose")&&this.removeChild(c);"destination"!==$(this).attr("data-ctat-purpose")&&$(this).attr("data-ctat-purpose")||($("#"+c.id).removeClass("CTAT--correct CTAT--incorrect CTAT--hint"),e.removeDisabled(c),d.setActionInput("Add",b),d.processAction(),null!==$(this).attr("data-ctat-max-overflow")&&this.childNodes.length>$(this).attr("data-ctat-max-overflow")&&e.animatedRemove(this.firstChild.id))}},!1);this.component.addEventListener("dragleave",
function(a){this.classList.remove("CTATDragSource--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],d=[];$(this.component).children().each(function(){d.push($(this).attr("id"))});if(0<d.length){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("SetChildren");b.setInput(d.sort().join(";"));a.push(b)}return a};var a=this.setEnabled;this.setEnabled=function(d){a(d);b&&($(b).children().attr("draggable",d),this.getDisableOnCorrect()&&$(b).find(".CTAT--correct").attr("draggable",
!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragSource--item")||($(a).addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}),a.addEventListener("dragstart",g,!1),a.addEventListener("dragend",f,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};
var d=this.showCorrect.bind(this);this.showCorrect=function(a){switch(a.getAction()){case "Add":this.setEnabled(!0);a=a.getInput();$("#"+a).addClass("CTAT--correct");this.getDisableOnCorrect()&&$("#"+a).attr("draggable",!1);break;default:d(a)}};var h=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:h(a)}}};CTATDragSource.dragging={};CTATDragSource.default_groupname="DragNDropGroup";
CTATDragSource.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragSource.prototype.constructor=CTATDragSource;CTAT.ComponentRegistry.addComponentType("CTATDragSource",CTATDragSource);var CTATElement=function(c,g,f,e,b){CTAT.Component.Base.SAIHandler.call(this,"CTATElement","__undefined__",c,g,f,e,b);CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var a=this;this.setStyleHandler("labelPlacement",null);this.init=function(){a.setInitialized(!0);
console.log("CTATElement.init() typeof getDivWrap()",typeof a.getDivWrap(),a.getDivWrap());a.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());a.addComponentReference(a,a.getDivWrap())};this.resize=function(){var a=$(this.getDivWrap()).height();$(label).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};this.getConfigurationActions=function(){return[]}};CTATElement.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTATElement.prototype.constructor=CTATElement;CTAT.ComponentRegistry.addComponentType("CTATElement",CTATElement);CTAT.Math={LeastCommonMultiple:function(c,g){return c*g/CTAT.Math.GreatestCommonDivisor(c,g)},GreatestCommonDivisor:function(c,g){if(0>c||0>g)return CTAT.Math.GreatestCommonDivisor(Math.abs(c),Math.abs(g));if(1===c||1===g)return 1;if(0===c)return g;if(0===g)return c;var f=function(e,b){return b?f(b,e%b):e};return f(c,g)},round10:function(c,g){if("undefined"===typeof g||0===Number(g))return Math.round(c);c=Number(c);g=Number(g);if(isNaN(c)||"number"!==typeof g||0!==g%1)return NaN;c=c.toString().split("e");
c=Math.round(Number(c[0])+"e"+(c[1]?Number(c[1])-g:-g));c=c.toString().split("e");return Number(c[0]+"e"+(c[1]?Number(c[1])+g:g))},precision:4,round:function(c){return CTAT.Math.round10(c,-CTAT.Math.precision)},rad2deg:function(c){return CTAT.Math.round(180*c/Math.PI)},deg2rad:function(c){return c*Math.PI/180}};CTAT.Math.Fraction=function(c,g){this._numerator=0;this._denominator=1;this.set(c,g)};
CTAT.Math.Fraction.prototype=Object.create(CTAT.Math.Fraction.prototype,{numerator:{get:function(){return this._numerator},set:function(c){this._numerator=c}},denominator:{get:function(){return this._denominator},set:function(c){this._denominator=c}},toString:{value:function(){return 1===this.denominator?String(this._numerator):String(this._numerator)+"/"+String(this._denominator)}},valueOf:{value:function(){return this.numerator/this.denominator}},fromString:{value:function(c){var g=c.match(/(\d*\.?\d*)\s*\/\s*(\d*\.?\d*)/);
g?(this._numerator=Number(g[1]),this._denominator=Number(g[2])):this.fromValue(c)}},fromValue:{value:function(c){this._numerator=Number(c.valueOf());this._denominator=1}},toMathML:{value:function(){var c=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),g=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");g.textContent=this.numerator;if(1==this.denominator)c.appendChild(g);else{var f=document.createElementNS("http://www.w3.org/1998/Math/MathML","mfrac"),e=document.createElementNS("http://www.w3.org/1998/Math/MathML",
"mrow");e.appendChild(g);f.appendChild(e);g=document.createElementNS("http://www.w3.org/1998/Math/MathML","mrow");e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");e.textContent=this.denominator;g.appendChild(e);f.appendChild(g);c.appendChild(f)}return c}},is_proper:{get:function(){return Math.abs(this._numerator)<Math.abs(this._denominator)}},whole_part:{get:function(){return Math.floor(this.valueOf())}},remainder_part:{get:function(){return new CTAT.Math.Fraction(this._numerator%
this._denominator,this._denominator)}},set_denominator:{value:function(c){this._numerator=this.numerator*c/this.denominator;1E-9>Math.abs(this.numerator-Math.round(this.numerator))&&(this.numerator=Math.round(this.numerator));this._denominator=c;return this}},scale:{value:function(c){this._numerator*=c;this._denominator=0===c?1:Math.abs(this._denominator*c)}},set:{value:function(c,g){this._numerator=0;this._denominator=1;"undefined"!==typeof c&&g?(this.numerator="number"===typeof c?c:"string"===typeof c?
Number(c):c?c.valueOf():0,this.denominator="number"===typeof g?g:"string"===typeof g?Number(g):g.valueOf()):c&&(c instanceof CTAT.Math.Fraction?(this.numerator=c.numerator,this.denominator=c.denominator):"number"===typeof c?(this.numerator=c,this.denominator=1):"string"===typeof c?this.fromString(c):(this.numerator=c?c.valueOf():0,this.denominator=1));isNaN(this._numerator)&&(this._numerator=0);isNaN(this._denominator)&&(this._denominator=1);return this}},reduce:{value:function(){var c=CTAT.Math.GreatestCommonDivisor(this.numerator,
this.denominator);this._numerator/=c;this._denominator/=c;return this}},reduced:{value:function(){var c=new CTAT.Math.Fraction(this);c.reduce();return c}},reciprocal:{value:function(){return new CTAT.Math.Fraction(this.denominator,this.numerator)}},negative:{value:function(){return new CTAT.Math.Fraction(-this.numerator,this.denominator)}},add:{value:function(c){var g=new CTAT.Math.Fraction;c instanceof CTAT.Math.Fraction?0===this.numerator||isNaN(this.numerator)?g.set(c.numerator,c.denominator):
0===c.numerator||isNaN(c.numerator)?g.set(this.numerator,this.denominator):this.denominator==c.denominator?g.set(this.numerator+c.numerator,this.denominator):(g.set(this.numerator*c.denominator+c.numerator*this.denominator,this.denominator*c.denominator),g.reduce()):"string"===typeof c?(c=new CTAT.Math.Fraction(c),g=this.add(c)):g.set(c.valueOf()*this.denominator+this.numerator,this.denominator);return g}},subtract:{value:function(c){return c instanceof CTAT.Math.Fraction?this.add(c.negative()):"string"===
typeof c?(c=new CTAT.Math.Fraction(c),this.add(c.negative())):this.add(-c.valueOf())}},multiply:{value:function(c){c instanceof CTAT.Math.Fraction?(c=new CTAT.Math.Fraction(this.numerator*c.numerator,this.denominator*c.denominator),c.reduce()):"string"===typeof c?(c=new CTAT.Math.Fraction(c),c=this.multiply(c)):(c=new CTAT.Math.Fraction(c.valueOf()*this.numerator,this.denominator),c.reduce());return c}},divide:{value:function(c){return c instanceof CTAT.Math.Fraction?this.multiply(c.reciprocal()):
"string"===typeof c?(c=new CTAT.Math.Fraction(c),this.multiply(c.reciprocal())):this.multiply(new CTAT.Math.Fraction(1,c.valueOf()))}},equals:{value:function(c){return CTAT.Math.round(this.valueOf())===CTAT.Math.round(c.valueOf())}},deepEquals:{value:function(c){return c instanceof CTAT.Math.Fraction&&this.numerator===c.numerator&&this.denominator===c.denominator}},clone:{value:function(){return new CTAT.Math.Fraction(this.numerator,this.denominator)}}});
CTAT.Math.Fraction.FromString=function(c){var g=new CTAT.Math.Fraction;g.setFromString(String(c));return g};CTAT.Math.Fraction.FromNumber=function(c){c=new CTAT.Math.Fraction(c);c.reduce();return c};CTAT.Math.Fraction.Sum=function(){for(var c=new CTAT.Math.Fraction,g=0;g<arguments.length;g++)c=c.add(arguments[g]);return c};CTAT.Math.Fraction.Product=function(){for(var c=new CTAT.Math.Fraction(1,1),g=0;g<arguments.length;g++)c=c.multiply(arguments[g]);return c};CTAT.Component.Base.SVG=function(c,g,f,e,b,a,d){CTAT.Component.Base.Clickable.call(this,c,g,f,e,b,a,d);var h=null;this.initSVG=function(){this.setInitialized(!0);var a=CTATGlobals.NameSpace.svg,d=CTATGlobals.NameSpace.xml,b=CTATGlobals.NameSpace.xlink,e=CTATGlobals.NameSpace.ev,c=document.createDocumentFragment();h=document.createElementNS(a,"svg");c.appendChild(h);h.classList.add("CTAT-gen-component");h.classList.add("CTAT-svg");h.classList.add("unselectable");h.setAttributeNS(d,"xmlns",a);h.setAttributeNS(d,
"xmlns:xlink",b);h.setAttributeNS(d,"xmlns:ev",e);a=document.createElementNS(a,"defs");h.appendChild(a);this.getDivWrap().appendChild(c);this.setComponent(h)};this.genName=function(a){return this.getName()+"_"+a};this.getBoundingBox=function(){var a=new DOMRect(0,0,this.getWidth(),this.getHeight()),d=this.getComponent(),b=window.getComputedStyle(d),d=parseInt(b.getPropertyValue("padding-left")),e=parseInt(b.getPropertyValue("padding-right")),c=parseInt(b.getPropertyValue("padding-bottom")),f=parseInt(b.getPropertyValue("padding-right")),
g=parseInt(b.getPropertyValue("border-left-width")),h=parseInt(b.getPropertyValue("border-right-width")),y=parseInt(b.getPropertyValue("border-bottom-width")),b=parseInt(b.getPropertyValue("border-right-width"));a.width-=d+f+g+b;a.height-=e+c+h+y;return a}};CTAT.Component.Base.SVG.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTAT.Component.Base.SVG.prototype.constructor=CTAT.Component.Base.SVG;CTAT.Component.Base.UnitDisplay=function(c,g,f,e,b,a,d){CTAT.Component.Base.SVG.call(this,c,g,f,e,b,a,d);var h="1/2+1/4+(0*1/8)";this.setActionInput("SetPieces",h);var l="#800080";this.color=l;var m=1;this.colorAlpha=m;var n="#800080";this.deselectedColor=n;var p=.3;this.deselectedColorAlpha=p;var r="black";this.piece_border_color=r;this.piece_border_thickness=1;this.getPieceBorderColor=function(){return r};this.setPieceBorderColor=function(a){r=CTATGlobalFunctions.formatColor(a);return this};var u=
[],w=this;this.generateClassname=function(){return this.getName()+" UnitPart"};this.getPieces=function(){return u};var q=function(a){if(a.hasAttributeNS(null,"data-selected"))return CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));a.setAttributeNS(null,"data-selected",!0);return!0};this.getPiecesBySelected=function(a){for(var d=this.getPieces(),b=[],e,c=0;c<d.length;c++)e=d[c],q(e)===a&&b.push(e);return b};this.getSelectedPieces=this.getPiecesBySelected.bind(this,!0);this.getDeselectedPieces=
this.getPiecesBySelected.bind(this,!1);this.getColor=function(){return l};this.getColorAlpha=function(){return m};this.getDeselectedColor=function(){return n};this.getDeselectedColorAlpha=function(){return p};this.setColor=function(a){this.color=l=CTATGlobalFunctions.formatColor(a);a=this.getSelectedPieces();for(var d=0;d<a.length;d++)$(a[d]).css("fill",l)};this.setColorAlpha=function(a){m=Number(a);this.colorAlpha=m=isNaN(m)?1:m;a=this.getSelectedPieces();for(var d=0;d<a.length;d++)$(a[d]).css("fill-opacity",
m)};this.setDeselectedColor=function(a){this.deselectedColor=n=CTATGlobalFunctions.formatColor(a);a=this.getDeselectedPieces();for(var d=0;d<a.length;d++)$(a[d]).css("fill",l)};this.setDeselectedColorAlpha=function(a){p=Number(a);isNaN(p)&&(p=.3);this.deselectedColorAlpha=p;a=this.getDeselectedPieces();for(var d=0;d<a.length;d++)$(a[d]).css("fill-opacity",p)};this.valueOf=function(){return this.evaluate()};this.getValue=function(){return h};this.setValue=function(a){h=String(a);this.setInput(h);this.clear();
this.drawPieces();return h};this.setParameterHandler("Value",this.setValue);this.data_ctat_handlers.value=function(a){this.setValue(a)};this.drawPieces=function(){};this.evaluate=function(){return this.parseValue().reduce(function(a,d){return d.selected?a.add(d):a},new CTAT.Math.Fraction)};this.numActive=function(){return this.getSelectedPieces().length};this.parseValue=function(){var a=[];h.split("+").forEach(function(d){var b=!0;-1!=d.search(/(\(\s*0\s*\*)|(\*\s*0\s*\))/)&&(b=!1,d=d.replace(/(\(\s*0\s*\*)|(\*\s*0\s*\))/,
""),d=d.replace(/[() ]/g,""));d=new CTAT.Math.Fraction(d);d.selected=b;0<d&&a.push(d);return d});return a};this.updateValue=function(){return h=this.getPieces().map(function(a){return B(a.getAttributeNS(null,"data-value"),CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected")))}).join("+")};var y=function(a,d){var b=CTATGlobalFunctions.toBoolean(d);CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));!0===b?(a.setAttributeNS(null,"data-selected",!0),$(a).css("fill",
w.color),$(a).css("fill-opacity",w.colorAlpha)):($(a).css("fill",w.deselectedColor),$(a).css("fill-opacity",w.deselectedColorAlpha),a.setAttributeNS(null,"data-selected",!1))};this.clickHandler=function(a){!0===w.getEnabled()&&(a=CTATGlobalFunctions.toBoolean(this.getAttributeNS(null,"data-selected")),y(this,!a),w.setActionInput("SetPieces",w.updateValue()),w.processAction())};this.updateSAI=function(){w.setActionInput("SetPieces",w.updateValue())};this.addPieceElem=function(a,d,b){a.setAttributeNS(null,
"data-selected",b);a.setAttributeNS(null,"data-value",d.toString());a.dataValue=d;this.getEnabled()&&(a.style.cursor="pointer");a.addEventListener("click",this.clickHandler);u.push(a)};var z=this.setEnabled;this.setEnabled=function(a){z(a);u.forEach(function(d){d.style.cursor=a?"pointer":"default"})};this.clear=function(){u=[]};var B=function(a,d){var b=a.toString();!1===d&&(b="(0*"+b+")");return b};this.AddPiece=function(a,d){if(a){var b=new CTAT.Math.Fraction(a);if(0<CTAT.Math.round(b.valueOf())){var e=
h.split("+");e.push(B(b,d));w.setValue(e.join("+"))}}};this.AddToValue=function(a,d){if(a){var b=new CTAT.Math.Fraction(a);if(0<CTAT.Math.round(b.valueOf())){var e=h.split("+");e.push(B(b,d));h=e.join("+")}}return h};var v=-1,E=function(a){isNaN(a)&&this.get_denominator();a=Math.max(a,1);1<v&&(a=Math.min(a,v));return a}.bind(this);this.set_max_denominator=function(a){a=parseInt(a);isNaN(a)||(v=a)};this.set_denominator=function(a){w.setHintHighlight(!1);var d="string"===typeof a?parseInt(a):a;if(!isNaN(d)&&
(d=E(d),this.get_denominator()!=a)){var b=w.evaluate();w.clear();a=[];b.set_denominator(d);for(var e=new CTAT.Math.Fraction(1,d),c=Math.floor(b.numerator),f=d-c,g=0;g<c;g++)a.push(B(e,!0));d=new CTAT.Math.Fraction(b.numerator-c,d);d.equals(0)||(a.push(B(d,!0)),a.push(B(e.subtract(d),!1)),f--);for(d=0;d<f;d++)a.push(B(e,!1));this.setValue(a.join("+"));w.setActionInput("SetPieces",h);w.processAction();return h}};this.get_denominator=function(){return u.reduce(function(a,d,b,e){return Math.min(a,d.dataValue.denominator)},
Infinity)};this.change_denominator=function(a){return this.set_denominator(this.get_denominator()+Number(a))};this.set_number_pieces=function(a){w.setHintHighlight(!1);a="string"===typeof a?parseInt(a):a;if(!isNaN(a)){a=E(a);var d=w.numActive();w.clear();for(var b=[],e=new CTAT.Math.Fraction(1,a),c=0;c<a;c++)b.push(B(e,0<d)),d--;this.setValue(b.join("+"));w.setActionInput("SetPieces",h);w.processAction();return h}};this.change_number_pieces=function(a){this.set_number_pieces(u.length+a)};this.set_numerator=
function(a){return this.change_numerator(a-this.getSelectedPieces().length)};this.change_numerator=function(a){0!==a&&(0<a?u.every(function(d){!1===q(d)&&(y(d,!0),a--);return 0<a}):(u.reverse(),u.every(function(d){!0===q(d)&&(y(d,!1),a++);return 0>a}),u.reverse()))};this.SetPieces=function(a){w.setValue(a)};f=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};c=f.bind(this,"data-ctat-ctrl-denominator");g=f.bind(this,"data-ctat-ctrl-partition");
f=f.bind(this,"data-ctat-ctrl-numerator");e=function(a,d){return 0<=a().indexOf(d)};var C=e.bind(null,c),A=e.bind(null,g),F=e.bind(null,f),K=function(a){var d=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=this&&(d=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=w.getName()&&(d=a.getSelection());else if(a instanceof String)a!=w.getName()&&(d=a);else if(a instanceof Element)a!=w.getComponent()&&(d=a.id);else return null;if(d){if(C(d))return H.bind(this,this.change_denominator,this.set_denominator);
if(F(d))return H.bind(this,this.change_numerator,this.set_numerator);if(A(d))return H.bind(this,this.change_number_pieces,this.set_number_pieces)}return null}.bind(this);c=CTAT.Component.Base.Tutorable.EventType;CTATConfiguration.get("previewMode")||document.addEventListener(c.action,function(a){var d=a.detail.sai;a=K(a.detail.component);d&&null!==a&&a(d)},!1);var H=function(a,d,b){var e=parseInt(b.getInput());if(!isNaN(e)){switch(b.getAction()){case "ButtonPressed":a.call(this,e);break;case "Update":case "UpdateTextField":case "UpdateTextArea":d.call(this,
e)}this.updateSAI();this.processAction()}};this.setNumeratorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-numerator",a);return this};this.setParameterHandler("NumeratorControllers",this.setNumeratorControllers);this.setDenominatorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-denominator",a);return this};this.setParameterHandler("DenominatorControllers",this.setDenominatorControllers);this.setPartitionControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-partition",
a);return this};this.setParameterHandler("PartitionControllers",this.setPartitionControllers);this.getConfigurationActions=function(){var a=this.getDivWrap().getAttribute("data-ctat-value");if(a){var d=new CTATSAI;d.setSelection(this.getName());d.setAction("SetPieces");d.setInput(a);return[d]}this.updateSAI();return[this.getSAI()]}};CTAT.Component.Base.UnitDisplay.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTAT.Component.Base.UnitDisplay.prototype.constructor=CTAT.Component.Base.UnitDisplay;var CTATFractionBar=function(c,g,f,e,b){CTAT.Component.Base.UnitDisplay.call(this,"CTATFractionBar","aFractionBar",c,g,f,e,b);var a=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(a,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATFractionBar--container");this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};
this.drawPieces=function(){if(this.baseGroup){this.clear();for(var d=this.parseValue(),b=0,e=document.createDocumentFragment(),c=0;c<d.length;c++){var f=d[c],g=100*f,r=document.createElementNS(a,"rect");r.classList.add("CTATFractionBar--piece");r.setAttributeNS(null,"height","100%");r.setAttributeNS(null,"width",g+"%");r.setAttributeNS(null,"y",0);r.setAttributeNS(null,"x",b+"%");this.addPieceElem(r,f,f.selected);e.appendChild(r);var u=document.createElementNS(a,"text");u.classList.add("CTATFractionBar--label");
u.setAttributeNS(null,"text-anchor","middle");u.setAttributeNS(null,"dominant-baseline","middle");e.appendChild(u);var r=""+String(f.numerator),f=""+String(f.denominator),w=document.createElementNS(a,"tspan"),q=document.createElementNS(a,"tspan");w.appendChild(document.createTextNode(r));q.appendChild(document.createTextNode(f));u.appendChild(w);u.appendChild(q);u=b+g/2;w.setAttributeNS(null,"x",u+"%");w.setAttributeNS(null,"y","60%");w.setAttributeNS(null,"dy","-1em");q.setAttributeNS(null,"x",u+
"%");q.setAttributeNS(null,"y","60%");r.length>f.length?w.style.textDecoration="underline":q.style.textDecoration="overline";b+=g}this.baseGroup.innerHTML="";this.baseGroup.appendChild(e);var y=this.baseGroup.getBBox().width-1;Array.prototype.slice.call(this.baseGroup.childNodes).forEach(function(a){if("rect"==a.nodeName){var d=window.getComputedStyle(a),b=parseFloat(d.getPropertyValue("padding-left")),e=parseFloat(d.getPropertyValue("stroke-width")),d=a.getBBox();a.setAttributeNS(null,"y",d.y+e/
2);a.setAttributeNS(null,"height",d.height-e);var c=d.x+e/2,e=d.width-e;1>d.x?e-=b/2:(c+=b/2,e=d.x+d.width>=y?e-b/2:e-b);a.setAttributeNS(null,"x",c);a.setAttributeNS(null,"width",e)}})}};this.setShowFractionLabel=function(a){};this.setStyleHandler("showFractionLabel",this.setShowFractionLabel)};CTATFractionBar.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);CTATFractionBar.prototype.constructor=CTATFractionBar;CTAT.ComponentRegistry.addComponentType("CTATFractionBar",CTATFractionBar);var CTATFS={writeFile:function(c,g){return new Promise(function(f,e){return $.post(location.origin+"/writeFile?path="+c,g).done(function(b){return f(b)}).fail(function(b){return e(b)})})}};var CTATGroupingComponent=function(c,g,f,e,b){CTAT.Component.Base.SAIHandler.call(this,"CTATGroupingComponent","__undefined__",c,g,f,e,b);var a=this,d=a.executeSAI;this.isTabIndexable=!1;this.getComponentList=function(){var d=[],b=a.getDivWrap().getAttribute("data-ctat-componentlist");b&&(d=b.split(/\s*[,;]\s*/).map(function(a){return $("#"+a.trim()).data("CTATComponent")}));$(a.getDivWrap()).children(".CTATComponent").each(function(){d.push($(this).data("CTATComponent"))});return[].concat($jscomp.arrayFromIterable(new Set(d)))};
this.init=function(){a.setInitialized(!0)};this.executeSAI=function(b){a.getComponentList().forEach(function(d){d&&"function"==typeof d.executeSAI?d.executeSAI(b):a.ctatdebug("CTATGroupingComponent "+a.getName()+".executeSAI: comp doesn't implement executeSAI: "+d)});d.call(a,b)}};CTATGroupingComponent.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);CTATGroupingComponent.prototype.constructor=CTATGroupingComponent;CTAT.ComponentRegistry.addComponentType("CTATGroupingComponent",CTATGroupingComponent);var CTATHintButton=function(c,g,f,e,b){CTAT.Component.Base.Clickable.call(this,"hint","CTATHintButton",c,g,f,e,b);this.setName("hint");this.setClassName("CTATHintButton");this.isTabIndexable=!1;this.setText(CTATGlobals.languageManager.getString("HINT"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("FontFace",null);this.setStyleHandler("TextColor",null);this.init=function(){this.setInitialized(!0);
var a=document.createElement("button");this.setComponent(a);a.classList.add("unselectable");a.classList.add("CTAT-hint-button");var b=document.createElement("div");b.classList.add("CTAT-hint-button--icon");b.textContent="?";a.appendChild(b);this.getText()&&(b=document.createElement("div"),b.textContent=this.getText(),a.appendChild(b));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");
a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",this.processClick)};var a=this;this.processClick=function(d){a.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.requestHint()}};
CTATHintButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATHintButton.prototype.constructor=CTATHintButton;CTAT.ComponentRegistry.addComponentType("CTATHintButton",CTATHintButton);var CTATHintWindow=function(c,g,f,e,b){CTAT.Component.Base.Graphical.call(this,"CTATHintWindow","__undefined__",c,g,f,e,b);var a=this;a.isTabIndexable=!1;var d=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON,h=new CTATTutorMessageBuilder,l=null,m=null,n=null,p=null,r=null,u=CTATGlobals.languageManager.getString("NEXT"),w=CTATGlobals.languageManager.getString("PREVIOUS"),q=null;this.data_ctat_handlers["next-content"]=function(a){q=a;p&&(p.innerHTML=a)};var y=null;this.data_ctat_handlers["previous-content"]=
function(a){y=a;n&&(n.innerHTML=a)};this.getCurrentHint=function(){return l.innerHTML};this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setInitialized(!0);a.setIsAbstractComponent(!0);r=this.getDivWrap();r.id||r.setAttribute("id",CTATGlobalFunctions.gensym.div_id());r.setAttribute("onkeypress","return noenter(event)");a.setComponent(r);a.addComponentReference(a,r);l=document.createElement("div");r.appendChild(l);l.classList.add("CTATHintWindow--hint-content");var d=document.createElement("div");
d.classList.add("CTATHintWindow--hint-button-area");r.appendChild(d);if(y)n=document.createElement("button"),n.classList.add("CTATHintWindow--previous"),n.innerHTML=y;else{n=document.createElement("button");n.classList.add("CTATHintWindow--previous");var b=document.createElement("span");b.classList.add("CTATHintWindow--button-icon");b.textContent="\u25c0";n.appendChild(b);w&&(b.style.cssFloat="left",n.appendChild(document.createTextNode(w)))}n.addEventListener("click",function(a){CTATShellTools.showPrevHint()},
!1);d.appendChild(n);m=document.createElement("div");m.classList.add("CTATHintWindow--hint-indicator");d.appendChild(m);q?(p=document.createElement("button"),p.classList.add("CTATHintWindow--next"),p.innerHTML=q):(p=document.createElement("button"),p.classList.add("CTATHintWindow--next"),b=document.createElement("span"),b.classList.add("CTATHintWindow--button-icon"),b.textContent="\u25b6",u&&(b.style.cssFloat="right",p.appendChild(document.createTextNode(u))),p.appendChild(b));p.addEventListener("click",
function(a){CTATShellTools.showNextHint()},!1);d.appendChild(p);var e=function(a){this.disabled=!a;a||(this.classList.remove("CTAT-hint-button--hover"),this.classList.remove("CTAT-hint-button--clicked"))};[n,p].forEach(function(a){a.setEnabled=e.bind(a);a.classList.add("CTATHintWindow--button");a.classList.add("CTAT-hint-button");a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");
a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")})});CTATShellTools.registerFeedbackComponent(this,this.goNext,this.goPrevious,this.showHint,this.showFeedback);a.ctatdebug("Disabling previous and next ...");
n.setEnabled(!1);p.setEnabled(!1)};this.setStyleHandler("OuterBorderColor",this.setBorderColor);this.SetText=this.showFeedback=function(d){a.ctatdebug("showFeedback ("+d+")");l&&(l.innerHTML=CTATGlobals.languageManager.filterString(d));n.setEnabled(!1);p.setEnabled(!1);m.innerHTML=""};this.showHint=function(d){a.ctatdebug("showHint ()");m.innerHTML="";hints=d||[];hintIndex=0;n.setEnabled(!1);p.setEnabled(!1);hints=hints.filter(function(a){return""!==a});if(!hints||0>=hints.length)hints=[],l.innerHTML=
"";else for(this.setEnabled(!0),l.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]),1<hints.length?(a.ctatdebug("We have more than one hint, enabling next button"),p.setEnabled(!0)):a.ctatdebug("We only have one hint, leaving next button disabled"),d=0;d<hints.length;d++){var b=document.createElement("span");b.classList.add("CTATHintWindow--hint-indicator-bullet");b.innerHTML=0===d?"&#9679;":"&#9675;";m.appendChild(b)}};this.setEnabled=function(d){a.assignEnabled(d);null===a.getComponent()?
a.ctatdebug("Error pointer.getComponent()==null"):a.getComponent().disabled=!d};this.goPrevious=function(){a.ctatdebug("goPrevious ()");hintIndex--;p.setEnabled(!0);0>=hintIndex?(hintIndex=0,n.setEnabled(!1)):n.setEnabled(!0);l.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);var b=m.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");b[hintIndex+1].innerHTML="&#9675;";b[hintIndex].innerHTML="&#9679;";var e=new CTATTutoringServiceMessageBuilder,b=CTATGuid.guid(),c=new CTATSAI("previousButton",
"ButtonPressed","-1"),e=e.createInterfaceActionMessage(b,c),c=new CTATSAI("previousButton","ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(b,c,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",e);c=a.getCurrentHint();b=h.createAssociatedRulesMessageForHint([c],logHintSAI,"student",null,"",b,hints.length,hintIndex+1);b=new CTATMessage(d.parse(b));CTATCommShell.commShell.processAssociatedRules(b,"HintWindow",c);CTATCommShell.commShell.propagateShellEvent("PreviousPressed",
b)};this.goNext=function(){a.ctatdebug("goNext ()");hintIndex++;n.setEnabled(!0);hintIndex>hints.length-1&&(hintIndex=hints.length-1);hintIndex>hints.length-2?p.setEnabled(!1):p.setEnabled(!0);l.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);var b=m.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");b[hintIndex-1].innerHTML="&#9675;";b[hintIndex].innerHTML="&#9679;";var e=new CTATTutoringServiceMessageBuilder,b=CTATGuid.guid(),c=new CTATSAI("nextButton","ButtonPressed",
"-1"),e=e.createInterfaceActionMessage(b,c),c=new CTATSAI("nextButton","ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(b,c,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",e);c=a.getCurrentHint();b=h.createAssociatedRulesMessageForHint([c],logHintSAI,"student",null,"",b,hints.length,hintIndex+1);b=new CTATMessage(d.parse(b));CTATCommShell.commShell.processAssociatedRules(b,"HintWindow",c);CTATCommShell.commShell.propagateShellEvent("NextPressed",
b)}};CTATHintWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATHintWindow.prototype.constructor=CTATHintWindow;CTAT.ComponentRegistry.addComponentType("CTATHintWindow",CTATHintWindow);var CTATIFrameManager=function(){var c={},g=this;this.initFrame=function(f,e,b){var a=f?f.getAttribute("id"):null;a?c[a]={domNode:f,initialDom:e,initialMode:b}:console.error("iFrames managed by CTATIFrameManager must exist and have unique ids");f.setAttribute("data-ctat-target",b);this.writeData(f,e)};this.refresh=function(f){var e=c[f];e.domNode?(e.domNode.setAttribute("src","about:blank"),this.writeData(e.domNode,e.initialDom)):console.warn("CTATIFrameManager: iFrame id "+f+" not found")};this.writeData=
function(c,e){if(c){var b=c.contentDocument||c.contentWindow.document;b.open();b.write(e);b.close()}};document.addEventListener("refreshIframe",function(c){c=c.detail;console.log("refresh event for iframe "+c);g.refresh(c)})};var CTATImageButton=function(c,g,f,e,b){CTATButtonBasedComponent.call(this,"CTATImageButton","__undefined__",c,g,f,e,b);var a=this;this.init=function(){a.setInitialized(!0);a.setComponent(a.getDivWrap());a.addComponentReference(a,a.getDivWrap());a.setImage(a.getDivWrap().getAttribute("data-ctat-image-default"));var d=a.component;d.setAttribute("role","button");d.classList.add("CTAT-button");d.addEventListener("click",a.processClick);d.addEventListener("focus",a.processFocus);d.addEventListener("mousedown",
a.processBaseMousedown);d.addEventListener("mouseup",a.processBaseMouseup);d.addEventListener("mouseover",a.processBaseMouseover);d.addEventListener("mouseout",a.processBaseMouseout)};var d=this.setEnabled;this.setEnabled=function(b){d(b);a.getEnabled()?a.setImage(a.getDivWrap().getAttribute("data-ctat-image-default")):a.setImage(a.getDivWrap().getAttribute("data-ctat-image-disabled"))};this.getConfigurationActions=function(){var a=this.getDivWrap(),d=a.getAttribute("data-ctat-image-hover"),b=a.getAttribute("data-ctat-image-clicked"),
e=a.getAttribute("data-ctat-image-default"),a=a.getAttribute("data-ctat-image-disabled");if(e){var c=new CTATSAI;c.setSelection(this.getName());d||b||a?(c.setAction("assignImages"),c.setInputArray([d,b,e,a])):(c.setAction("assignImage"),c.setInput(e));return[c]}return[]}};CTATImageButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATImageButton.prototype.constructor=CTATImageButton;CTAT.ComponentRegistry.addComponentType("CTATImageButton",CTATImageButton);var CTATJumble=function(c,g,f,e,b){CTAT.Component.Base.Tutorable.call(this,"CTATJumble","aJumble",c,g,f,e,b);var a=this;this.setActionInput("SetOrder","");var d=null;this.init=function(){this.setInitialized(!0);d=this.getDivWrap();this.setComponent(d);this.addComponentReference(this,d);CTATConfiguration.get("previewMode")||$(d).children().addClass("CTATJumble--item").attr({unselectable:"on",draggable:!0}).each(function(){this.addEventListener("dragstart",l,!1);this.addEventListener("dragenter",n,
!1);this.addEventListener("dragover",m,!1);this.addEventListener("dragleave",p,!1);this.addEventListener("drop",r,!1);this.addEventListener("dragend",u,!1)});this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){this.updateSAI();return[this.getSAI()]};var h=null,l=function(a){/CTATJumble/.test(a.target.className)&&(a.target.classList.add("CTATJumble--item--home"),h=a.target,a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/html",a.target.innerHTML))},
m=function(a){a.preventDefault&&a.preventDefault();a.dataTransfer.dropEffect="move";return!1},n=function(a){this.classList.add("CTATJumble--item--over")},p=function(a){this.classList.remove("CTATJumble--item--over")},r=function(b){b.stopPropagation&&b.stopPropagation();if(h&&($(d).children().removeClass("CTATJumble--item--over"),h!=this)){h.innerHTML=this.innerHTML;var e=h.id;h.id=this.id;this.innerHTML=b.dataTransfer.getData("text/html");this.id=e;a.setInput(a.getOrder());a.processAction()}return!1},
u=function(a){this.classList.remove("CTATJumble--item--home");$(d).children().removeClass("CTATJumble--item--over");h=null},w=this.setEnabled;this.setEnabled=function(a){w(a);d&&$(d).children().attr("draggable",a)};this.init_items=function(a){if(d){var b=document.createDocumentFragment();a=a.split(";");for(var e=a.length,c=0;c<e;c++){var f=document.createElement("div");f.textContent=a[c];f.id=this.getName()+c;f.setAttribute("unselectable","on");f.setAttribute("draggable",!0);f.classList.add("CTATJumble--item");
f.addEventListener("dragstart",l,!1);f.addEventListener("dragenter",n,!1);f.addEventListener("dragover",m,!1);f.addEventListener("dragleave",p,!1);f.addEventListener("drop",r,!1);f.addEventListener("dragend",u,!1);b.appendChild(f)}d.innerHTML="";d.appendChild(b)}};this.setParameterHandler("textItems",this.init_items);this.SetOrder=function(a){a.split(";").forEach(function(a){$(d).append($("#"+a))})};this.getOrder=function(){var b=[];$(d).children().each(function(){this.draggable&&(this.id?b.push(this.id):
console.log("ERROR: The CTATJumble "+a.getName()+" has a child with no id attribute: "+this+"!!!"))});return b.join(";")};this.updateSAI=function(){a.setInput(a.getOrder())}};CTATJumble.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATJumble.prototype.constructor=CTATJumble;CTAT.ComponentRegistry.addComponentType("CTATJumble",CTATJumble);var CTATMathInput=function(){CTAT.Component.Base.Tutorable.call(this,"CTATMathInput","myComponent");CTATMathInput.guppyInitialized||(Guppy.init({path:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/",symbols:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/symbols.json"}),CTATMathInput.guppyInitialized=!0);var c=this,g=null,f=CTATConfiguration.get("previewMode"),e,b,a,d,h,l,m=!1,n=0;if(!CTATMathInput.__osk&&window.GuppyOSK){var p=function(a){for(a=a.target;a.parentNode;){if(a.classList.contains("guppy_osk")||
a.classList.contains("CTATMathInput")&&"false"!==a.getAttribute("data-ctat-enabled"))return!0;a=a.parentNode;if(!a.isConnected)return!0}CTATMathInput.__osk.detach()};document.documentElement.className+="ontouchstart"in document.documentElement?" touch":" no-touch";CTATMathInput.__osk=new GuppyOSK({groups:["qwerty"],controls:"&uarr; &darr; &larr; &rarr; del enter".split(" ")});document.addEventListener("mousedown",p);document.addEventListener("touchstart",p)}this.init=function(){this.ctatdebug("init ("+
c.getName()+")");c.getInitialized()||(e=c.getDivWrap(),b=document.createElement("div"),b.id=e.id+"_math",e.appendChild(b),g=new Guppy(b.id,{events:{done:function(){var a=c.getValue();/^\s*$/.test(String(a))||(c.setActionInput("UpdateTextField",a),c.processAction(),n=0)},focus:function(a){a.focused&&CTATMathInput.__osk&&a.target===g&&CTATMathInput.__osk.guppy!==g&&CTATMathInput.__osk.attach(g)}},settings:{empty_content:""}}),a=document.createElement("div"),a.id=e.id+"_new",e.appendChild(a),d=document.createElement("div"),
d.id=e.id+"_left",d.classList.add("CTATMathInput-left"),l=document.createElement("div"),l.id=e.id+"_equals",l.classList.add("CTATMathInput-equals"),h=document.createElement("div"),h.id=e.id+"_right",h.classList.add("CTATMathInput-right"),this.ctatdebug("Final location: "+c.getX()+","+c.getY()+" with text: "+c.getValue()),e.addEventListener("keydown",function(a){++n;c.ctatdebug("dirty "+n)}),b.addEventListener("blur",function(a){m||(a=c.getValue(),/^\s*$/.test(String(a))||1>n||(c.setActionInput("UpdateTextField",
a),c.processAction(),n=0))}),c.setInitialized(!0),c.setComponent(e),c.addComponentReference(c,e),f&&this.addEventScreen(!1))};this.GuppyStyleInput=function(a){var d;if(a.includes("/")){for(var b=a.indexOf("/"),e=b;0<e;e--)if("+"===a[e]||"-"===a[e]){d=a.slice(0,e+1)+"("+a.slice(e+1,b)+")/"+c.GuppyStyleInput(a.slice(b+1,a.length));break}!d&&(d="("+a.slice(0,b)+")/"+c.GuppyStyleInput(a.slice(b+1,a.length)))}else d=a;return d};this.getValue=function(){try{return g.asciimath()}catch(v){return""}};this.updateSAI=
function(){this.setActionInput("UpdateTextField",c.getValue())};this.setMath=function(b){console.log("setMath ("+b+")");g.import_text(b);c.getEnabled()||(b=g.xml(),b.includes('<f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f>')?(b=b.split('<f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f>').map(function(a,d){return 0===d?a+"</m>":"<m>"+a}),Guppy.Doc.render(b[0],d.id),Guppy.Doc.render('<m><f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f></m>',
l.id),Guppy.Doc.render(b[1],h.id)):Guppy.Doc.render(b,a.id))};this.getConfigurationActions=function(){var a=[],d=$(this.getDivWrap());if(d.attr("value")){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("UpdateTextField");b.setInput(d.attr("value"));a.push(b)}return a};this.UpdateTextField=function(a){console.log("mathinput UpdateTextField");this.setMath(a)};this.reset=function(){c.configFromDescription();c.processSerialization();g.import_text("")};var r=function(){var c=g.xml();b.parentNode===
e&&e.removeChild(b);c.includes('<f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f>')?(d.parentNode!==e&&(e.appendChild(d),e.appendChild(l),e.appendChild(h)),c=c.split('<f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f>').map(function(a,d){return 0===d?a+"</m>":"<m>"+a}),Guppy.Doc.render(c[0],d.id),Guppy.Doc.render('<m><f group="operations" type="=" ast_type="operator"><b p="latex">=</b><b p="asciimath"> = </b></f></m>',
l.id),Guppy.Doc.render(c[1],h.id)):(a.parentNode!==e&&e.appendChild(a),Guppy.Doc.render(c,a.id));CTATMathInput.__osk&&CTATMathInput.__osk.guppy===g&&CTATMathInput.__osk.detach()},u=this.setEnabled;this.setEnabled=function(f){console.log("mathinput setEnabled");u.call(this,f);c.getInitialized()&&(f?(b.parentNode!==e&&e.appendChild(b),a.parentNode===e?e.removeChild(a):d.parentNode===e&&(e.removeChild(d),e.removeChild(l),e.removeChild(h))):r())};var w=this.setCorrect;this.setCorrect=function(){m=!0;
w.apply(this,arguments)};var q=this.showCorrect;this.showCorrect=function(){q.apply(this,arguments);a.style.color="darkgreen";d.style.color="darkgreen";l.style.color="darkgreen";h.style.color="darkgreen"};var y=this.setIncorrect;this.setIncorrect=function(){m=!1;y.apply(this,arguments)};var z=this.showIncorrect;this.showIncorrect=function(){z.apply(this,arguments);b.style.color="red"};var B=this.showHintHighlight;this.showHintHighlight=function(){B.apply(this,arguments);b.style.color="initial"}};
CTATMathInput.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATMathInput.prototype.constructor=CTATMathInput;CTAT.ComponentRegistry.addComponentType("CTATMathInput",CTATMathInput);var CTATMobileTutorHandler=function(c,g){CTATBase.call(this,"CTATMobileTutorHandler","mobiletutorhandler");this.ctatdebug("CTATMobileTutorHandler ()");var f="",e=g?g:"disabled",b=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(b=!0);this.error=function(a){this.ctatdebug(a);alert(a)};this.processOrientationChange=function(a){this.ctatdebug("processOrientationChange ("+a+")")};this.getEnabled=function(){return"disabled"==e||"auto"==e&&0==b?!1:!0};this.processTextFocus=
function(a,d,c,g,m){this.ctatdebug("processTextFocus ("+a+","+d+","+c+","+g+","+m+")");"disabled"==e||"auto"==e&&0==b||(f="",this.manipulateKeyboard())};this.processEnter=function(){this.ctatdebug("processEnter ()");if("disabled"!=e&&("auto"!=e||0!=b)){var a=getSafeElementById(c);if(null!=a)try{a.processExternalEnter(),this.ctatdebug("Successfully called AS3 method")}catch(d){this.ctatdebug("Error description: "+d.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")}};this.setText=
function(a){this.ctatdebug("setText ("+a+")");if("disabled"!=e&&("auto"!=e||0!=b))if(null!=CTATGlobals.selectedTextInput){this.ctatdebug("Attempting to call HTML5 method on text object ...");var d=CTATGlobals.selectedTextInput.getText();CTATGlobals.selectedTextInput.setText(d+a)}else if(this.ctatdebug("Attempting to call AS3 method ..."),d=getSafeElementById(c),null!=d)try{f+=a,this.ctatdebug(f),d.processExternalKeyboard(f),this.ctatdebug("Successfully called AS3 method")}catch(h){this.ctatdebug("Error description: "+
h.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")};this.manipulateKeyboard=function(){this.ctatdebug("manipulateKeyboard()");if("disabled"!=e&&("auto"!=e||0!=b)){this.hideKeyboard();var a=getSafeElementById("keyboardUI");a&&(a.style.visibility="visible")}};this.hideKeyboard=function(){document.activeElement.blur();var a=getSafeElementById("input");a&&a.blur()};this.hideCustomKeyboard=function(){getSafeElementById("keyboardUI").style.visibility="visible"}};
CTATMobileTutorHandler.prototype=Object.create(CTATBase.prototype);CTATMobileTutorHandler.prototype.constructor=CTATMobileTutorHandler;function processTextFocus(c,g,f,e,b){mobileAPI.processTextFocus(c,g,f,e,b)}function processFocusOut(){closeK()};var CTATMovieClip=function(c,g,f,e,b){CTATBase.call(this,"CTATMovieClip",c);var a=CTATGlobalFunctions.gensym.z_index(),d=CTATGlobalFunctions.gensym.div_id(),h=CTATGlobalFunctions.gensym.z_index();CTATGlobalFunctions.gensym.div_id();var l=[],m=this,n=null;this.wrapComponent=function(c){n=document.createElement("div");n.setAttribute("id",d);n.setAttribute("name",this.getName());n.setAttribute("style","z-index: "+a);n.setAttribute("width",e+"px");n.setAttribute("height",b+"px");n.setAttribute("style",
"border: 0px; position: absolute; left:"+g+"px; top:"+f+"px; z-index:"+h+";");c.appendChild(n);return n};this.getDivWrapper=function(){return n};this.addComponent=function(a){m.ctatdebug("addComponent ("+a+")");l.push(a)};this.isRegistered=function(a){for(var d=0;d<l.length;d++)if(l[d]==a)return!0;return!1}};CTATMovieClip.prototype=Object.create(CTATBase.prototype);CTATMovieClip.prototype.constructor=CTATMovieClip;var CTATNLPInput=function(c,g,f,e,b){CTATTextBasedComponent.call(this,"CTATNLPInput","__undefined__",c,g,f,e,b);var a=this,d=null,h=null,l=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+a.getName()+")");d=document.createElement("input");d.type="text";c&&(d.name=c.name);d.setAttribute("maxlength",a.getMaxCharacters());d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setComponent(d);this.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());
var b=$(this.getDivWrap());b.attr("value")&&this.setText(b.attr("value"));var e=$(d);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var d=b.attr(a);d&&e.attr(a,d)});a.setInitialized(!0);a.addComponentReference(a,d);a.getDivWrap().appendChild(d);a.addSafeEventListener("keypress",a.processKeypress,d);a.addSafeEventListener("focus",a.processFocus,d);$(d).on("input",function(d){a.setNotGraded()});l&&this.addEventScreen(!1)};this.getConfigurationActions=
function(){var a=[],d=$(this.getDivWrap());if(d.attr("value")){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("UpdateTextField");b.setInput(d.attr("value"));a.push(b)}return a};this.processAction.bind(this);this.processAction=function(a,d){if("GET"===n){var b=this.nlp_url,b=b.includes("${input}")?b.replace("${input}",this.getValue()):b.concat(this.getValue()),e=this.getName();(function(a){$.get(b,function(d){console.log("NLP DATA: ",d);a(d)})})(function(a){var d=new CTATSAI;d.setSelection(e);
d.setAction("NLPclassification");d.setInput(a.result);CTATCommShell.commShell.processComponentAction(d)})}if("POST"===n){var b=this.nlp_url,c=m,c=c.includes("${input}")?c.replace("${input}",this.getValue()):c.concat(this.getValue()),b=b.concat(c),e=this.getName();(function(a){$.post(b,function(d){a(d)})})(function(a){var d=new CTATSAI;d.setSelection(e);d.setAction("NLPclassification");d.setInput(a);CTATCommShell.commShell.processComponentAction(d)})}};this.setCellContainer=function(a){h=a};this.getCellContainer=
function(){return h};this.setText=function(b){a.ctatdebug("setText ("+b+")");a.assignText(b);d.value=b};this.getValue=function(){return d.value};this.reset=function(){a.configFromDescription();a.processSerialization();d.value=""};this.setStyleHandler("DrawBorder",null);this.nlp_url="";this.setURL=function(a){this.nlp_url=a};this.data_ctat_handlers["nlp-url"]=function(a){this.setURL(a)};var m="";this.setPostBody=function(a){this.post_body=a};this.data_ctat_handlers["post-body"]=function(a){this.setPostBody(a)};
var n="GET";this.setMethod=function(a){a&&(this.method=a)};this.data_ctat_handlers["nlp-method"]=function(a){this.setMethod(a)};this.setPreprocessor=function(a){window&&"function"===typeof window[a]&&(this.preprocessor=window[a])};this.data_ctat_handlers.preprocess=function(a){this.setPreprocessor(a)}};CTATNLPInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATNLPInput.prototype.constructor=CTATNLPInput;CTAT.ComponentRegistry.addComponentType("CTATNLPInput",CTATNLPInput);CTAT.Geom={};CTAT.Geom.Point={};try{new DOMPoint}catch(c){if(console.log("WARNING: new DOMPoint():",c,typeof c),c instanceof ReferenceError||c instanceof TypeError){console.log("   Using shim!");var DOMPoint=function(g,f,e,b){this.z=this.y=this.x=0;this.w=1;if(g instanceof DOMPoint)for(var a in g)this[a]=g[a];else this.x=g||0,this.y=f||0,this.z=e||0,this.w=b||1}}}CTAT.Geom.Point.useDOMMatrix=!0;try{new DOMMatrix}catch(c){c instanceof ReferenceError&&(CTAT.Geom.Point.useDOMMatrix=!1)}
CTAT.Geom.Point.add=function(){if(CTAT.Geom.Point.useDOMMatrix){for(var c=new DOMMatrix,g,f=0;f<arguments.length;f++)g=arguments[f],c.translateSelf(g.x/g.w,g.y/g.w,g.z/g.w);return c.transformPoint(new DOMPoint)}return Array.prototype.reduce.call(arguments,function(e,b){for(var a in e)"w"!=a&&0!==b[a]&&(e[a]+=b[a]/b.w);return e},new DOMPoint)};
DOMPoint.prototype.add||Object.defineProperty(DOMPoint.prototype,"add",{enumerable:!1,value:function(c){return CTAT.Geom.Point.useDOMMatrix?(new DOMMatrix).translate(c.x/c.w,c.y/c.w,c.z/c.w).transformPoint(this):CTAT.Geom.Point.add(this,c)}});CTAT.Geom.Point.angle=function(c,g){return Math.acos(DOMPoint.dot(c,g)/(c.magnitude*g.magnitude))};CTAT.Geom.Point.angle_degrees=function(c,g){return CTAT.Math.rad2deg(CTAT.Geom.Point.angle(c,g))};
CTAT.Geom.Point.angle_between_2d=function(c,g){return CTAT.Math.rad2deg(Math.atan2(g.y,g.x)-Math.atan2(c.y,c.x))};DOMPoint.prototype.clone||Object.defineProperty(DOMPoint.prototype,"clone",{value:function(){return new DOMPoint(this.x,this.y,this.z,this.w)}});CTAT.Geom.Point.distance=function(c,g){var f=CTAT.Geom.Point.add(c,CTAT.Geom.Point.scale(g,-1));return Math.sqrt(CTAT.Geom.Point.dot(f,f))};
DOMPoint.prototype.distance||Object.defineProperty(DOMPoint.prototype,"distance",{value:function(c){return CTAT.Geom.Point.distance(this,c)}});CTAT.Geom.Point.dot=function(c,g){return(c.x*g.x+c.y*g.y+c.z*g.z)/(c.w*g.w)};CTAT.Geom.Point.equals=function(c,g){var f=!0,e;for(e in c)if(e in g?"w"!=e&&(f&=c[e]/c.w==g[e]/g.w):f=!1,!f)break;return f};CTAT.Geom.Point.interpolate=function(c,g,f){return CTAT.Geom.Point.add(c.scale(f),g.scale(1-f))};
"magnitude"in DOMPoint.prototype||Object.defineProperty(DOMPoint.prototype,"magnitude",{enumerable:!1,get:function(){return CTAT.Math.round(Math.sqrt(CTAT.Geom.Point.dot(this,this)))}});DOMPoint.prototype.normalize||Object.defineProperty(DOMPoint.prototype,"normalize",{value:function(c){return this.scale((c?c:1)/this.magnitude)}});
CTAT.Geom.Point.scale=function(c,g){if(CTAT.Geom.Point.useDOMMatrix)return(new DOMMatrix).scale(g).transformPoint(c);var f=new DOMPoint(c),e;for(e in f)"w"!=e&&(f[e]=CTAT.Math.round(c[e]*g));return f};DOMPoint.prototype.scale||Object.defineProperty(DOMPoint.prototype,"scale",{value:function(c){return CTAT.Geom.Point.scale(this,c)}});CTAT.Geom.Point.polar=function(c,g){return new DOMPoint(CTAT.Math.round(c*Math.cos(g)),CTAT.Math.round(c*Math.sin(g)))};
CTAT.Geom.Point.is_on_line=function(c,g,f){return 1E-4>Math.abs(c.distance(f)+g.distance(f)-c.distance(g))};CTAT.Geom.Point.circle_intersection=function(c,g,f,e){g=g.add(c.scale(-1)).normalize();var b=CTAT.Geom.Point.dot(g,f.add(c.scale(-1))),a=c.add(g.scale(b));f=CTAT.Geom.Point.distance(f,a);return f<e?(e=Math.sqrt(e*e-f*f),[c.add(g.scale(b-e)),c.add(g.scale(b+e))]):f==e?[a]:[]};CTAT.Geom.Point.to2DString=function(c,g){var f=[c.x/c.w,c.y/c.w].join();g&&(f="("+f+")");return f};CTAT.Geom.Rectangle={};try{new DOMRect}catch(c){if(console.log("WARNING: new DOMRect():",c,typeof c),c instanceof ReferenceError||c instanceof TypeError){console.log("    Using shim!");var DOMRect=function(g,f,e,b){this.x=g||0;this.y=f||0;this.width=e||0;this.height=b||0;return this}}}"left"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"left",{get:function(){return Math.min(this.x,this.x+this.width)}});
"right"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"right",{get:function(){return Math.max(this.x,this.x+this.width)}});"top"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"top",{get:function(){return Math.min(this.y,this.y+this.height)}});"bottom"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"bottom",{get:function(){return Math.max(this.y,this.y+this.height)}});
CTAT.Geom.Rectangle.contains=function(c,g,f){var e=CTAT.Geom.Rectangle.contains;if(g instanceof DOMRect)return e(c,g.left,g.top)&e(c,g.right,g.bottom);if(g instanceof DOMPoint){var b=!0;if(f instanceof DOMPoint)b=e(c,f.x/f.w,f.y/f.w);else if("number"==typeof f)return e(c,g.x-f,g.y-f)&e(c,g.x+f,g.y+f);return b&e(c,g.x,g.y)}return c.left<=g&c.right>=g&c.top<=f&c.bottom>=f};
DOMRect.prototype.contains||Object.defineProperty(DOMRect.prototype,"contains",{value:function(c,g){return CTAT.Geom.Rectangle.contains(this,c,g)}});DOMRect.prototype.clone||Object.defineProperty(DOMRect.prototype,"clone",{value:function(){return new DOMRect(this.x,this.y,this.width,this.height)}});DOMRect.prototype.copyFrom||Object.defineProperty(DOMRect.prototype,"copyFrom",{value:function(c){this.x=c.x;this.y=c.y;this.width=c.width;this.height=c.height;return this}});
CTAT.Geom.Rectangle.equals=function(c,g){return c.left==g.left&&c.top==g.top&&c.right==g.right&&c.bottom==g.bottom};CTAT.Geom.Rectangle.inflate=function(c,g,f){g=g?g:0;f=f?f:0;g instanceof DOMPoint&&(f=g.y,g=g.x);c=c.clone();c.x-=g;c.y-=f;c.width+=2*g;c.height+=2*f;return c};CTAT.Geom.Rectangle.isEmpty=function(c){return 0===c.width||0===c.height};CTAT.Geom.Rectangle.setEmpty=function(c){c.x=0;c.y=0;c.width=0;c.height=0;return c};
CTAT.Geom.Rectangle.setTo=function(c,g,f,e,b){c.x=g;c.y=f;c.width=e;c.height=b;return c};CTAT.Geom.Rectangle.offset=function(c,g,f){g=g?g:0;f=f?f:0;g instanceof DOMPoint&&(f=g.y,g=g.x);c=c.clone();c.x+=g;c.y+=f;return c};CTAT.Geom.Rectangle.union=function(c,g){var f=new DOMRect;f.x=Math.min(c.x,g.x);f.y=Math.min(c.y,g.y);f.width=Math.max(c.right,g.right)-f.x;f.height=Math.max(c.bottom,g.bottom)-f.y;return f};var CTATNumberLine=function(c,g,f,e,b){CTAT.Component.Base.SVG.call(this,"CTATNumberLine","aNumberLine",c,g,f,e,b);var a=CTAT.Math.Fraction,d=CTATGlobals.NameSpace.svg;c=function(b,e,c,f,g){this.numberline=b;this.step=new a(e);this.size=c;this.origin=new a(0);f=f?f:null;g=g?g:null;this.g=null;this.setStep=function(d){this.step=new a(d)};this.setSize=function(a){a=Number(a);isNaN(a)&&(a=c);this.size=a};this.setOrigin=function(d){this.origin=new a(d)};this.generate=function(){if(this.numberline){var b=
new a,e=document.createDocumentFragment(),c=document.createElementNS(d,"g");c.setAttributeNS(null,"data-step-size",this.step.toString());c.setAttributeNS(null,"pointer-events","none");f&&c.classList.add(f);e.appendChild(c);if(0<this.step){for(b.set(this.origin).reduce();b<=this.numberline.Maximum;)b>=this.numberline.Minimum&&c.appendChild(this.numberline.genTickmark(b,null,this.size)),b=b.add(this.step);b.set(this.origin).reduce();for(b=b.subtract(this.step);b>=this.numberline.Minimum;)b<=this.numberline.Maximum&&
c.appendChild(this.numberline.genTickmark(b,null,this.size)),b=b.subtract(this.step)}g&&$(c).find("text.CTATNumberLine--tickmark-label").each(function(){this.classList.add(g)});return e}}};var h=new c(this,new a(1),30,"CTATNumberLine--large-tickmark","CTATNumberLine--large-tickmark-label");this.setLargeTickSize=function(a){h.setSize(s);this.render();return this};this.setParameterHandler("LargeTickmarkSize",this.setLargeTickSize);this.setParameterHandler("LargeTickmarkStep",function(a){h.setStep(a);
this.render();return this});this.data_ctat_handlers["large-tick-step"]=function(a){h.setStep(a);this.render()};var l=new c(this,new a(1,2),20,"CTATNumberLine--small-tickmark","CTATNumberLine--small-tickmark-label");this.setSmallTickSize=function(a){l.setSize(s);this.render();return this};this.setParameterHandler("SmallTickmarkSize",this.setSmallTickSize);this.setParameterHandler("SmallTickmarkStep",function(a){l.setStep(a);this.render();return this});this.data_ctat_handlers["small-tick-step"]=function(a){l.setStep(a);
this.render()};var m=new c(this,new a(0),25,"CTATNumberLine--denominator-tickmark","CTATNumberLine--denominator-tickmark-label");this.setParameterHandler("DenominatorTickmarkSize",function(a){m.setSize(a);this.render();return this});this.setParameterHandler("DenominatorTickmarkStep",function(d){m.setStep((new a(d)).reciprocal())});this.data_ctat_handlers.denominator=function(d){d=new a(d);m.setStep(d.reciprocal())};this.setColor=function(a){console.log("numberline.setColor");this.color=a=CTATGlobalFunctions.formatColor(a);
for(var d=$(this.getDivWrap()).find("g"),b=0;b<d.length;b++)$(d[b]).css("stroke",a)};this.getColor=function(){console.log("numberline.getColor");return this.color};this.X_Axis=new function(a,d,b,e){var c={};this.svg_group=null;var f=a;Object.defineProperty(this,"start",{get:function(){return f},set:function(a){c={};f=a}});Object.defineProperty(this,"min_loc",{get:function(){if(!c.hasOwnProperty("min_loc")){var a=this.start.clone(),d=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(d);a.x=CTAT.Math.round(a.x);
a.y=CTAT.Math.round(a.y);c.min_loc=a}return c.min_loc}});var g=d;Object.defineProperty(this,"end",{get:function(){return g},set:function(a){c={};g=a}});Object.defineProperty(this,"max_loc",{get:function(){if(!c.hasOwnProperty("max_loc")){var a=this.end.clone(),d=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(d.scale(-1));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);c.max_loc=a}return c.max_loc}});var h=b;Object.defineProperty(this,"min",{get:function(){return h},set:function(a){c={};h=a}});var m=
e;Object.defineProperty(this,"max",{get:function(){return m},set:function(a){c={};m=a}});Object.defineProperty(this,"length",{get:function(){c.hasOwnProperty("length")||(c.length=CTAT.Math.round(this.min_loc.distance(this.max_loc)));return c.length}});this.isHorizontal=function(){return this.start.y===this.end.y};this.isVertical=function(){return this.start.x===this.end.x};Object.defineProperty(this,"range",{get:function(){return this.max.subtract(this.min)}});Object.defineProperty(this,"step_size",
{get:function(){return CTAT.Geom.Point.equals(this.min_loc,this.max_loc)?this.length:CTAT.Math.round(this.length/this.range)}});this.s_vec=function(){return this.max_loc.add(this.min_loc.scale(-1))};this.slope=function(){var a=this.s_vec();return a.y/a.x};this.step=function(){c.hasOwnProperty("step")||(c.step=this.s_vec().normalize(this.step_size));return c.step};this.scalar=function(){c.hasOwnProperty("scalar")||(c.scalar=this.range/this.length);return c.scalar};this.zero=function(){c.hasOwnProperty("zero")||
(c.zero=this.min_loc.add(this.step().scale(-this.min)),c.zero.x=CTAT.Math.round(c.zero.x),c.zero.y=CTAT.Math.round(c.zero.y));return c.zero};this.angle=function(){if(!c.hasOwnProperty("angle")){var a=this.end.add(this.start.scale(-1));c.angle=Math.atan2(a.y,a.x)}return c.angle};this.angle_deg=function(){return CTAT.Math.rad2deg(this.angle())};this.getPosition=function(a){a=this.zero().add(this.step().scale(1*a));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);return a};this.projected_point=function(a){var d=
this.s_vec(),b=a.add(this.min_loc.scale(-1)),b=0+(d.y*b.x-d.x*b.y)/(d.y*d.y+d.x*d.x);return a.add(new DOMPoint(-b*d.y,b*d.x))};this.getProjectedPoint=function(a){a=this.projected_point(a);return a.distance(this.max_loc)>this.length?this.min_loc:a.distance(this.min_loc)>this.length?this.max_loc:a};this.getAxisValue=function(a){return CTAT.Math.round(h+this.scalar()*this.min_loc.distance(this.getProjectedPoint(a)))}}(new DOMPoint(0,0),new DOMPoint(0,0),new a(0),new a(3));Object.defineProperty(this,
"Maximum",{get:function(){return this.X_Axis.max},set:function(d){this.X_Axis.max=new a(d)}});this.setMaximum=function(a){this.Maximum=a};this.setParameterHandler("Maximum",this.setMaximum);this.data_ctat_handlers.maximum=this.setMaximum;Object.defineProperty(this,"Minimum",{get:function(){return this.X_Axis.min},set:function(d){this.X_Axis.min=new a(d)}});this.setMinimum=function(a){this.Minimum=a};this.setParameterHandler("Minimum",this.setMinimum);this.data_ctat_handlers.minimum=this.setMinimum;
var n=1;Object.defineProperty(this,"Max_Points",{get:function(){return n},set:function(a){a=parseInt(a);isNaN(a)||(n=a)}});this.setMaxPoints=function(a){this.Max_Points=a};this.setParameterHandler("Max_Points",this.setMaxPoints);this.data_ctat_handlers["max-points"]=this.setMaxPoints;var p=7;this.setPointSize=function(a){p=Number(a);q&&(q.setAttributeNS(null,"r",p),$(this._point_group).find("circle").each(function(){$(this).attr("r",p)}))};this.setStyleHandler("PointSize",this.setPointSize);this.data_ctat_handlers["point-size"]=
this.setPointSize;var r=!1;this.setSnapToTickMark=function(a){r=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("SnapToTickmark",this.setSnapToTickMark);this.data_ctat_handlers.snap=this.setSnapToTickMark;this.theta=0;Object.defineProperty(this,"Orientation",{get:function(){return 180*this.theta/Math.PI},set:function(a){a=Number(a);isNaN(a)&&(a=0);this.theta=Math.PI*a/180}});this.setOrientation=function(a){this.Orientation=a;this.render()};this.setParameterHandler("Orientation",this.setOrientation);
this.data_ctat_handlers.rotation=this.setOrientation;this._tickmarks=[];this.genTickmark=function(a,b,e){var c=document.createDocumentFragment();if(!this._tickmarks.some(function(d){return d.data.equals(a)})){var f=document.createElementNS(d,"line"),g=this.X_Axis.getPosition(a),h=CTAT.Geom.Point.polar(e/2,this.theta+Math.PI/2).add(g);e=CTAT.Geom.Point.polar(-e/2,this.theta+Math.PI/2).add(g);f.setAttributeNS(null,"x1",h.x);f.setAttributeNS(null,"y1",h.y);f.setAttributeNS(null,"x2",e.x);f.setAttributeNS(null,
"y2",e.y);f.setAttributeNS(null,"data-value",a.toString());f.data=a;f.location=g;f.label=null;this._tickmarks.push(f);c.appendChild(f);if(""!==b){g=document.createElementNS(d,"text");g.classList.add("CTATNumberLine--tickmark-label");g.setAttributeNS(null,"text-anchor","middle");c.appendChild(g);if(null===b||void 0===b)if(1==a.denominator)g.appendChild(document.createTextNode(String(a.numerator.toPrecision(N)))),g.setAttributeNS(null,"x",e.x),g.setAttributeNS(null,"y",e.y);else{b=""+String(a.numerator);
h=""+String(a.denominator);g.style.fontSize="0.6em";g.setAttributeNS(null,"text-align","center");var m=document.createElementNS(d,"tspan"),l=document.createElementNS(d,"tspan");m.appendChild(document.createTextNode(b));l.appendChild(document.createTextNode(h));g.appendChild(m);g.appendChild(l);m.setAttributeNS(null,"text-anchor","middle");m.setAttributeNS(null,"x",e.x);m.setAttributeNS(null,"y",e.y);m.setAttributeNS(null,"dy","-1em");l.setAttributeNS(null,"text-anchor","middle");l.setAttributeNS(null,
"x",e.x);l.setAttributeNS(null,"y",e.y);b.length>h.length?m.style.textDecoration="underline":l.style.textDecoration="overline"}else g.appendChild(document.createTextNode(b.toString())),c.appendChild(tlabel),g.setAttributeNS(null,"x",e.x),g.setAttributeNS(null,"y",e.y);f.label=g}}return c};var u=function(){if(null!==this.X_Axis&&null!==this.X_Axis.svg_group){var a=this.getBoundingBox(),b=window.getComputedStyle(this._axis_line_group),b=parseInt(b.getPropertyValue("stroke-width")),a=CTAT.Geom.Rectangle.inflate(a,
-b,-b),e=new DOMPoint(a.width/2,a.height/2),c=e.add(CTAT.Geom.Point.polar(Math.min(40,a.height,a.width)/4,this.theta)),f=Math.sin(this.theta),g=-Math.cos(this.theta),n=f*e.x+g*e.y,p=-a.height*g,q=-f*a.width,b=new DOMPoint(a.left,e.y),e=new DOMPoint(a.right,e.y);if(0<Math.abs(CTAT.Math.round(p))){var p=new DOMPoint(a.left,(n-f*a.left)/g),y=new DOMPoint(a.right,(n-f*a.right)/g);if(a.contains(p)||a.contains(y))c.distance(p)<c.distance(y)?(b=y,e=p):(b=p,e=y)}0<Math.abs(CTAT.Math.round(q))&&(q=new DOMPoint((n-
g*a.top)/f,a.top),f=new DOMPoint((n-g*a.bottom)/f,a.bottom),a.contains(q)||a.contains(f))&&(c.distance(q)<c.distance(f)?(b=f,e=q):(b=q,e=f));if(this.X_Axis.start.x!=b.x||this.X_Axis.start.y!=b.y||this.X_Axis.end.x!=e.x||this.X_Axis.end.y!=e.y)this.X_Axis.start=b,this.X_Axis.end=e,this.X_Axis.svg_group.innerHTML="",a=document.createDocumentFragment(),c=document.createElementNS(d,"line"),c.setAttributeNS(null,"x1",b.x),c.setAttributeNS(null,"y1",b.y),c.setAttributeNS(null,"x2",e.x),c.setAttributeNS(null,
"y2",e.y),a.appendChild(c),c=document.createElementNS(d,"path"),c.setAttributeNS(null,"d","M 10,6 L 0,0 L 10,-6"),c.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(b)+") rotate("+this.Orientation+")"),a.appendChild(c),b=document.createElementNS(d,"path"),b.setAttributeNS(null,"d","M -10,6 L 0,0 L -10,-6"),b.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(e)+") rotate("+this.Orientation+")"),a.appendChild(b),this.X_Axis.svg_group.appendChild(a);this._tickmarks=
[];b=document.createDocumentFragment();b.appendChild(h.generate());b.appendChild(l.generate());b.appendChild(m.generate());this._tick_mark_group.innerHTML="";this._tick_mark_group.appendChild(b);b=this._point_group.children;for(e=0;e<b.length;e++)a=b[e],c=this.X_Axis.getPosition(a.value),f=new DOMPoint(a.cx.baseVal.value,a.cy.baseVal.value),1<c.distance(f)&&(a.cx.baseVal.value=c.x,a.cy.baseVal.value=c.y)}}.bind(this),w=0,q=null,y=new DOMPoint(-30,-30),z=!1,B=function(a){y.x=a.clientX;y.y=a.clientY},
v=function(a){cancelAnimationFrame(w);q.style.visibility="hidden";z=!1},E=function(a){if(!0===this.getEnabled()&&0<n){this.setHintHighlight(!1);var b;r?(a=K(a.clientX,a.clientY),b=a.location,a=a.data):(a=A(a.clientX,a.clientY),b=this.X_Axis.getProjectedPoint(a),a=this.X_Axis.getAxisValue(a));var e=document.createElementNS(d,"circle");e.classList.add("CTATNumberLine--point");e.setAttributeNS(null,"cx",b.x);e.setAttributeNS(null,"cy",b.y);e.setAttributeNS(null,"r",p);e.value=a;if(this._point_group.children.length>=
this.Max_Points){b=[].slice.call(this._point_group.children);var c=b.filter(function(a,d,b){return a.classList.contains("CTAT--incorrect")});0<c.length?this._point_group.removeChild(c[0]):(b=b.filter(function(a,d,b){return!a.classList.contains("CTAT--correct")}),0<b.length&&this._point_group.removeChild(b[0]))}this._point_group.appendChild(e);this.setActionInput("AddPoint",a.toString());this.processAction()}}.bind(this);this.init=function(){this.initSVG();this.component.classList.add("CTATNumberLine--container");
this._axis_line_group=document.createElementNS(d,"g");this._axis_line_group.classList.add("CTATNumberLine--axis");this._tick_mark_group=document.createElementNS(d,"g");this._tick_mark_group.classList.add("CTATNumberLine--tickmark");this._point_group=document.createElementNS(d,"g");q=document.createElementNS(d,"circle");q.setAttributeNS(null,"r",p);q.classList.add("CTATNumberLine--cursor");q.setAttributeNS(null,"transform","translate(-30,-30)");this.component.appendChild(this._axis_line_group);this.component.appendChild(this._tick_mark_group);
this.component.appendChild(this._point_group);this.component.appendChild(q);this.X_Axis.svg_group=this._axis_line_group;u();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("mousemove",B);this.component.addEventListener("mouseleave",v);var a=this.getEnabled;this.component.addEventListener("mouseenter",function(){!0===a()&&0<n&&(z=!0,q.style.visibility=null,w=requestAnimationFrame(H))});this.component.addEventListener("click",E);this.component.addEventListener("focus",
this.processFocus)};this.getConfigurationActions=function(){var a=[],d,b=$(this.getDivWrap());b.attr("data-ctat-minimum")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("set_minimum"),d.setInput(b.attr("data-ctat-minimum")),a.push(d));b.attr("data-ctat-maximum")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("set_maximum"),d.setInput(b.attr("data-ctat-maximum")),a.push(d));b.attr("data-ctat-max-points")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("set_max_user_entries"),
d.setInput(b.attr("data-ctat-max-points")),a.push(d));b.attr("data-ctat-large-tick-step")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("set_large_step"),d.setInput(b.attr("data-ctat-large-tick-step")),a.push(d));b.attr("data-ctat-small-tick-step")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("set_small_step"),d.setInput(b.attr("data-ctat-small-tick-step")),a.push(d));b.attr("data-ctat-denominator")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("set_denominator"),
d.setInput(b.attr("data-ctat-denominator")),a.push(d));return a};var C=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),A=function(a,d){this.svgPoint=this.svgPoint?this.svgPoint:this.component.createSVGPoint();this.svgPoint.x=a;this.svgPoint.y=d;var b=this._axis_line_group.getScreenCTM().inverse();this.svgPoint=this.svgPoint.matrixTransform(b);b=new DOMPoint(this.svgPoint.x,this.svgPoint.y);if(C){var e=$(this.component),c=parseInt(e.css("borderLeftWidth"))+parseInt(e.css("paddingLeft"))+parseInt(e.css("marginLeft")),
e=parseInt(e.css("borderTopWidth"))+parseInt(e.css("paddingTop"))+parseInt(e.css("marginTop"));b.x-=c;b.y-=e}return b}.bind(this),F=function(a,d){return this.getProjectedPoint(A(a,d))}.bind(this.X_Axis),K=function(a,d){for(var b=F(a,d),e=null,c=Number.POSITIVE_INFINITY,f,g,h=0;h<this._tickmarks.length;h++)f=this._tickmarks[h],g=b.distance(f.location),g<c&&(e=f,c=g);return e}.bind(this),H=function(){if(z&&!0===this.getEnabled()){if(r){var a=K(y.x,y.y);q.setAttributeNS(null,"transform","translate"+
CTAT.Geom.Point.to2DString(a.location,!0))}else q.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(F(y.x,y.y),!0));w=requestAnimationFrame(H)}}.bind(this);this.render=function(){u()};this.calcXCoordinate=function(d){d=new a(d);var b=this.getWidth()-30,b=Math.abs(b-30),e=max.subtract(min);return 30+d.subtract(min).divide(e)/b};this.calcNum=function(a){var d=this.getWidth()-30,d=Math.abs(d-30);a=max.subtract(min).multiply((a-30)/d);return min.add(a)};var x=function(a,d){switch(d.getClassName()){case "CTATMessage":d=
d.getSAI()}var b=d.clone();b.setAction(a.getSAI().getAction());b.setSelection(a.getName());return b};this.showCorrect=function(a){a.getInput();var d=a.getAction(),b=function(d){d.setCorrect(x(d,a))};switch(d){case "AddPoint":0<this._point_group.children.length&&(d=[].slice.call(this._point_group.children),b=d[d.length-1],b.classList.remove("CTAT--incorrect"),b.classList.remove("CTAT--hint"),b.classList.add("CTAT--correct"),this.getDisableOnCorrect()&&(d.length>=this.Max_Points&&d.every(function(a){return a.classList.contains("CTAT--correct")})?
this.setEnabled(!1):this.setEnabled(!0)));break;case "Points":d=this._point_group.children;for(b=0;b<d.length;b++){var e=d[b];e.classList.remove("CTAT--incorrect");e.classList.remove("CTAT--hint");e.classList.add("CTAT--correct")}break;case "set_minimum":W(R()).forEach(b);break;case "set_maximum":W(V()).forEach(b);break;case "set_large_step":W(T()).forEach(b);break;case "set_small_step":W(O()).forEach(b);break;case "set_denominator":W(U()).forEach(b);break;default:console.log("Unhandled Action in",
this.getName(),d)}};this.showInCorrect=function(a){a.getInput();var d=a.getAction(),b=function(d){d.setIncorrect(x(d,a))};switch(d){case "AddPoint":0<this._point_group.children.length&&(d=[].slice.call(this._point_group.children),d=d[d.length-1],d.classList.remove("CTAT--correct"),d.classList.remove("CTAT--hint"),d.classList.add("CTAT--incorrect"));break;case "Points":d=this._point_group.children;for(b=0;b<d.length;b++){var e=d[b];e.classList.remove("CTAT--correct");e.classList.remove("CTAT--hint");
e.classList.add("CTAT--incorrect")}break;case "set_minimum":W(R()).forEach(b);break;case "set_maximum":W(V()).forEach(b);break;case "set_large_step":W(T()).forEach(b);break;case "set_small_step":W(O()).forEach(b);break;case "set_denominator":W(U()).forEach(b);break;default:console.log("Unhandled Action in",this.getName(),d)}};var G=this.setEnabled;this.setEnabled=function(a){G(a);q&&z&&(q.style.visibility=this.getEnabled()?null:"hidden")};this.set_minimum=function(a){this.Minimum=a;this.render()};
this.change_minimum=function(d){d=new a(d);0!==d.valueOf()&&(this.Minimum=this.Minimum.add(d),this.render())};var I=function(){this.setActionInput("set_minimum",this.Minimum)}.bind(this);this.set_maximum=function(a){this.Maximum=a;this.render()};this.change_maximum=function(d){d=new a(d);0!==d.valueOf()&&(this.Maximum=this.Maximum.add(d),this.render())};var S=function(){this.setActionInput("set_maximum",this.Maximum)}.bind(this);this.set_max_user_entries=function(a){this.setMaxPoints(parseInt(a))};
c=function(a,d){a.setStep(d);this.render()};this.set_large_step=c.bind(this,h);var Q=function(){this.setActionInput("set_large_step",h.step.toString())}.bind(this);this.set_small_step=c.bind(this,l);var L=function(){this.setActionInput("set_small_step",l.step.toString())}.bind(this);this.set_denominator=function(d){0===parseInt(d)?m.setStep(0):m.setStep((new a(d)).reciprocal());this.render()};var D=function(){var a=0===m.step.valueOf()?0:m.step.reciprocal();this.setActionInput("set_denominator",a.toString())}.bind(this);
c=function(d,b){if(0!==(new a(b)).valueOf()){var e=d.step.add(b);0>e.valueOf()&&e.set(0,1);d.setStep(e);this.render()}};this.change_large_step=c.bind(this,h);this.change_small_step=c.bind(this,l);this.change_denominator=function(d){d=new a(d);0!==d.valueOf()&&(d=d.add(m.step.denominator),m.setStep(d.reciprocal()),this.render())};var N=void 0;this.set_precision=function(a){N=parseInt(a);this.render()};this.AddPoint=function(b,e){var c=new a(b),f=this.X_Axis.getPosition(c),g=document.createElementNS(d,
"circle");g.classList.add("CTATNumberLine--point");g.setAttributeNS(null,"cx",f.x);g.setAttributeNS(null,"cy",f.y);g.setAttributeNS(null,"r",p);g.value=c;[].slice.call(this._point_group.children).some(function(a){return c.equals(a.value)})||this._point_group.appendChild(g)};this.Points=function(a,d){this._point_group.innerHTML="";var b=a.split(";"),e;for(e in b)this.AddPoint(b[e],d)};var P=function(a,d,b,e){switch(e.getAction()){case "ButtonPressed":a.call(this,e.getInput());break;case "Update":case "UpdateTextField":case "UpdateTextArea":d.call(this,
e.getInput())}b.call();this.processAction(!1,!0)};c=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};var V=c.bind(this,"data-ctat-ctrl-max"),R=c.bind(this,"data-ctat-ctrl-min"),T=c.bind(this,"data-ctat-ctrl-large-tick"),O=c.bind(this,"data-ctat-ctrl-small-tick"),U=c.bind(this,"data-ctat-ctrl-denominator"),W=function(a){return a.map(function(a){return $("#"+a).data("CTATComponent")})},ea=function(a){var d=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=
this&&(d=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=pointer.getName()&&(d=a.getSelection());else if(a instanceof String)a!=pointer.getName()&&(d=a);else if(a instanceof Element)a!=pointer.getComponent()&&(d=a.id);else return null;if(d){if(ia(d))return P.bind(this,this.change_denominator,this.set_denominator,D);if(pa(d))return P.bind(this,this.change_small_step,this.set_small_step,L);if(da(d))return P.bind(this,this.change_large_step,this.set_large_step,Q);if(ga(d))return P.bind(this,
this.change_minimum,this.set_minimum,I);if(ja(d))return P.bind(this,this.change_maximum,this.set_maximum,S)}return null}.bind(this);CTATConfiguration.get("previewMode")||document.addEventListener(CTAT.Component.Base.Tutorable.EventType.action,function(a){var d=a.detail.sai;a=ea(a.detail.component);d&&null!==a&&a(d)},!1);this.setMaxControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-max",a)};this.setParameterHandler("MaxValueControllers",this.setMaxControllers);this.setMinControllers=
function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-min",a)};this.setParameterHandler("MinValueControllers",this.setMinControllers);this.setLargeTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-large-tick",a)};this.setParameterHandler("LargeTickmarkControllers",this.setLargeTickControllers);this.setSmallTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-small-tick",a)};this.setParameterHandler("SmallTickmarkControllers",this.setSmallTickControllers);this.setDenominatorControllers=
function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-denominator",a)};this.setParameterHandler("DenominatorTickmarkControllers",this.setDenominatorControllers);c=function(a,d){return 0<=a().indexOf(d)};var ja=c.bind(null,V),ga=c.bind(null,R),da=c.bind(null,T),pa=c.bind(null,O),ia=c.bind(null,U);this.grade=function(a){a=a.getDivWrap().id;ja(a)?(this.setAction("set_maximum"),this.setInput(this.Maximum.toString())):ga(a)?(this.setAction("set_minimum"),this.setInput(this.Minimum.toString())):da(a)?(this.setAction("set_large_step"),
this.setInput(h.step.toString())):pa(a)?(this.setAction("set_small_step"),this.setInput(l.step.toString())):ia(a)?(this.setAction("set_denominator"),this.setInput(m.step.reciprocal().toString())):this.updateSAI();this.processAction(!0)};this.updateSAI=function(){for(var a=this._point_group.children,d=[],b=0;b<a.length;b++)d.push(a[b].value);d.sort(function(a,d){return a-d});this.setActionInput("Points",d.join(";"))}};CTATNumberLine.prototype=Object.create(CTAT.Component.Base.SVG.prototype);
CTATNumberLine.prototype.constructor=CTATNumberLine;CTAT.ComponentRegistry.addComponentType("CTATNumberLine",CTATNumberLine);var CTATNumericStepper=function(c,g,f,e,b){CTAT.Component.Base.Tutorable.call(this,"CTATNumericStepper","__undefined__",c,g,f,e,b);this.setAction("Update");var a=document.createElement("input");a.type="number";this.set_maximum=function(d){d=Number(d);isNaN(d)||(a.max=d)};this.setParameterHandler("maximum",this.set_maximum);this.set_minimum=function(d){d=Number(d);isNaN(d)||(a.min=d)};this.setParameterHandler("minimum",this.set_minimum);this.set_step=function(d){d=Number(d);isNaN(d)||(a.step=d)};this.setParameterHandler("stepSize",
this.set_step);this.update_value=function(d){d=Number(d);isNaN(d)||(a.value=d,this.setInput(d))};this.setParameterHandler("value",this.update_value);this.updateSAI=function(){this.setInput(a.value)};this.Update=this.update_value;this.init=function(){a.id=this.getName()+"_spinner";this.setComponent(a);this.setInitialized(!0);var d=$(this.getDivWrap()),b=$(a);"autofocus defaultValue placeholder value max min readOnly step".split(" ").forEach(function(a){var e=d.attr(a);e&&b.attr(a,e)});CTATConfiguration.get("previewMode")||
(this.getDivWrap().innerHTML="");this.getDivWrap().appendChild(a);this.component.addEventListener("focus",this.processFocus);var e=this;a.addEventListener("change",function(a){var d=Number(this.min);isNaN(d)&&(d=0);a=Number(this.value);if(isNaN(a))this.value=d;else if(""!==this.min&&a<d)this.value=d;else if(""!==this.max&&!isNaN(Number(this.max))&&a>Number(this.max))this.value=this.max;else{var b=Number(this.step);if(isNaN(b)||0>=b)b=1;d=(a-d)%b;0!==d&&(this.value=a-d)}e.updateSAI();e.processAction();
return!1});CTATConfiguration.get("previewMode")&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var a=[],b,e=$(this.getDivWrap());e.attr("min")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_minimum"),b.setInput(e.attr("min")),a.push(b));e.attr("max")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_maximum"),b.setInput(e.attr("max")),a.push(b));e.attr("step")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_step"),b.setInput(e.attr("step")),
a.push(b));e.attr("value")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("Update"),b.setInput(e.attr("value")),a.push(b));return a}};CTATNumericStepper.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATNumericStepper.prototype.constructor=CTATNumericStepper;CTAT.ComponentRegistry.addComponentType("CTATNumericStepper",CTATNumericStepper);var CTATPieChart=function(c,g,f,e,b){CTAT.Component.Base.UnitDisplay.call(this,"CTATPieChart","aPieChart",c,g,f,e,b);var a=3,d=3,h=this,l,m,n,p=null,r=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(r,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATPieChart--container");l=document.createElementNS(r,"filter");l.id=this.genName("Shadow");m="#"+l.id;n="url("+m+")";l.setAttributeNS(null,"width","200%");l.setAttributeNS(null,
"height","200%");p=document.createElementNS(r,"feOffset");p.setAttributeNS(null,"in","SourceAlpha");p.setAttributeNS(null,"result","offOut");p.setAttributeNS(null,"dx",d);p.setAttributeNS(null,"dy",d);l.appendChild(p);var a=document.createElementNS(r,"feGaussianBlur");a.setAttributeNS(null,"in","offOut");a.setAttributeNS(null,"result","blurOut");a.setAttributeNS(null,"stdDeviation",4);l.appendChild(a);a=document.createElementNS(r,"feBlend");a.setAttributeNS(null,"in","SourceGraphic");a.setAttributeNS(null,
"in2","blurOut");a.setAttributeNS(null,"mode","normal");l.appendChild(a);this.getComponent().getElementsByTagName("defs")[0].appendChild(l);0<d&&this.baseGroup.setAttributeNS(null,"filter",n);this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};this.drawPieces=function(){if(this.baseGroup){this.clear();var b=window.getComputedStyle(this.getComponent()),b=parseFloat(b.getPropertyValue("stroke-width")),
e=this.getBoundingBox(),c=Math.min(e.width/2,e.height/2)-(b+d+4),f=new DOMPoint(e.width/2,e.height/2),b=this.parseValue(),g=document.createDocumentFragment();b.reduce(function(d,b,e,m){if(1<=b.valueOf())e=document.createElementNS(r,"circle"),e.classList.add("CTATPieChart--piece"),e.cx.baseVal.value=f.x,e.cy.baseVal.value=f.y,e.r.baseVal.value=c,this.addPieceElem(e,b,b.selected),g.appendChild(e);else{e=document.createElementNS(r,"path");e.classList.add("CTATPieChart--piece");g.appendChild(e);window.getComputedStyle(e);
var l=2*Math.PI*d.valueOf();m=f.add(CTAT.Geom.Point.polar(c,l));b.reduce();var n=f.add(CTAT.Geom.Point.polar(c,2*Math.PI*b.valueOf()+l)),p=f.clone();if(0<a&&a<c){l=CTAT.Geom.Point.polar(a,l+Math.PI*b.valueOf());p=p.add(l);m=m.add(l);var q=function(a,d,b){return a.distance(d)<a.distance(b)?d:b};m=CTAT.Geom.Point.circle_intersection(p,m,f,c).reduce(q.bind(this,m));n=n.add(l);n=CTAT.Geom.Point.circle_intersection(p,n,f,c).reduce(q.bind(this,n))}l=CTAT.Geom.Point.to2DString;p="M "+l(p);q=new DOMPoint(c,
c);p+=" L "+l(m);p+=" A "+l(q)+" 0 "+(.5<b.valueOf()?1:0)+",1 "+l(n);e.setAttributeNS(null,"d",p+" Z");h.addPieceElem(e,b,b.selected)}return d.add(b)},new CTAT.Math.Fraction);this.baseGroup.innerHTML="";this.baseGroup.appendChild(g)}};this.getExplode=function(){return a};this.getDropShadowDistance=function(){return d};this.setExplode=function(d){d=Number(d);if(!isNaN(d)){var b=d!==a;a=d;b&&this.drawPieces()}return this};this.setStyleHandler("explode",this.setExplode);this.data_ctat_handlers.explode=
function(a){this.setExplode(a)};this.setDropShadowDistance=function(a){d=parseInt(a);d=isNaN(d)?0:d;p&&(p.setAttributeNS(null,"dx",d),p.setAttributeNS(null,"dy",d),0>=d&&this.baseGroup?this.baseGroup.removeAttributeNS(null,"filter"):this.baseGroup.hasAttributeNS(null,"filter")||this.baseGroup.setAttributeNS(null,"filter",n))};this.data_ctat_handlers["shadow-distance"]=function(a){this.setDropShadowDistance(a)}};CTATPieChart.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);
CTATPieChart.prototype.constructor=CTATPieChart;CTAT.ComponentRegistry.addComponentType("CTATPieChart",CTATPieChart);var CTATRadioButton=function(c,g,f,e,b){CTAT.Component.Base.Clickable.call(this,"CTATRadioButton","__undefined__",c,g,f,e,b);var a=CTATConfiguration.get("previewMode"),d=this,h=null,l=null,m="#000000";this.setSelection(this.getComponentGroup());this.setAction("UpdateRadioButton");this.setStyleHandler("BackgroundColor",null);this.init=function(){d.setInitialized(!0);h=document.createElement("input");h.type="radio";h.id=this.getName()+"_radio";h.value=d.getName();this.getComponentGroup()?h.name=d.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?h.name=$(this.getDivWrap()).attr("name"):h.name="radioButtonGroup";!0===d.getEnabled()?h.disabled=!1:h.disabled=!0;d.addComponentReference(d,h);var b;a||(b=this.getDivWrap().innerHTML,this.getDivWrap().innerHTML="");d.getDivWrap().appendChild(h);l=document.createElement("label");l.htmlFor=h.id;this.getText()?l.textContent=d.getText():b&&!a?l.innerHTML=b:this.getDivWrap().getAttribute("data-ctat-label")&&(l.textContent=this.getDivWrap().getAttribute("data-ctat-label"));
d.setComponent(h);this.getDivWrap().appendChild(l);h.addEventListener("click",function(a){d.updateSAI();d.processAction()});h.addEventListener("focus",this.processFocus);h.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup());this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){var a=[];if(0<l.innerHTML.trim().length){var d=new CTATSAI;d.setSelection(this.getName());d.setInput(l.innerHTML.toString());d.setAction("setText");a.push(d)}return a};
this.setFontColor=function(a){m=a;$(l).css("color",a)};this.getFontColor=function(){return m};this.resize=function(){var a=$(this.getDivWrap()).height();$(l).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};var n=this.setText;this.setText=function(a){n(a);null!==l&&(l.innerHTML=this.getText())};this.setStyleHandler("buttonLabel",this.setText);var p=this.setEnabled;this.setEnabled=function(a){p(a);null!==h&&(h.disabled=!this.getEnabled())};
this.setChecked=function(a){null!==h&&(h.checked=a)};this.getChecked=function(){return h.checked};this.getRadioInput=function(){return h.checked?h.value+": "+l.textContent:""};this.setStyleHandler("labelPlacement",null);this.reset=function(){d.ctatdebug(" reset ( "+d.getName()+")");h.checked=!1;d.setEnabled(!0)};this.UpdateRadioButton=function(a){0<=a.indexOf(h.value)&&d.setChecked(!0);d.ctatdebug("UpdateRadioButton ()")};this.updateSAI=function(){var a=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="radio"][name="'+
h.name+'"]:checked)'),b="";1===a.length&&(b=$(a[0]).data("CTATComponent").getRadioInput());d.setSelection(h.name);d.setInput(b)};var r=function(a){l&&l.classList.add(a);h&&h.classList.add(a)},u=function(a){l&&l.classList.remove(a);h&&h.classList.remove(a)};this.showCorrect=function(a){u("CTAT--hint");u("CTAT--incorrect");(a?0===a.getInput().indexOf(h.value):1)?r("CTAT--correct"):u("CTAT-correct")};this.removeCorrect=function(){u("CTAT--correct")};this.showInCorrect=function(a){u("CTAT--hint");u("CTAT--correct");
(a?0===a.getInput().indexOf(h.value):1)?r("CTAT--incorrect"):u("CTAT-incorrect")};this.removeInCorrect=u.bind(this,"CTAT--incorrect");this.showHintHighlight=function(a){this.removeCorrect();this.removeInCorrect();a?r("CTAT--hint"):u("CTAT--hint")}};CTATRadioButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATRadioButton.prototype.constructor=CTATRadioButton;CTAT.ComponentRegistry.addComponentType("CTATRadioButton",CTATRadioButton);var CTATScrollPaneComponent=function(c,g,f,e,b){CTAT.Component.Base.Tutorable.call(this,"CTATScrollPaneComponent","__undefined__",c,g,f,e,b);var a=0,d=this;d.isTabIndexable=!1;this.getAlpha=function(){return a};this.setAlpha=function(d){a=d};this.init=function(){d.ctatdebug("init ("+d.getName()+")");d.ctatdebug("Final location: "+d.getX()+","+d.getY()+" with text: "+d.getText());d.setInitialized(!0)};this.processCommShellEvent=function(a,b){d.ctatdebug("processCommShellEvent ("+a+")")};this.processSerialization=
function(){d.ctatdebug("processSerialization()")};this.postProcess=function(){d.ctatdebug("postProcess ()");for(var a in this.parameters){var b=this.parameters[a];d.ctatdebug("Checking style name: "+a);if("TargetMovieClip"==a)if(d.ctatdebug("Loading sub element: ["+b.trim()+"] ..."),b=findMovieClip(b.trim()),null!==b){if(d.ctatdebug("Found target movieclip, temporarily removing ..."),null!==b.getDivWrapper().parentNode){try{b.getDivWrapper().parentNode.removeChild(b.getDivWrapper())}catch(p){CTATScrim.scrim.errorScrimUp(p.message);
return}d.getDivWrap().setAttribute("id","scrollsubdiv");d.ctatdebug("Adding ...");d.getDivWrap().appendChild(b.getDivWrapper());var e=b.getDivWrapper().style.left,c=b.getDivWrapper().style.top;b.getDivWrapper().style.left="0px";b.getDivWrapper().style.top="0px";d.ctatdebug("Moving canvas from: "+e+","+c+" to: 0,0");b=b.getDivWrapper().childNodes;for(e=0;e<b.length;e++);}}else d.ctatdebug("Unable to find the target movieclip to reparent the content from")}d.ctatdebug("Final location: "+d.getX()+","+
d.getY()+" with text: "+d.getText());null===CTATCommShell.commShell||void 0===CTATCommShell.commShell?d.ctatdebug("Error: can't add event listener to commshell, pointer is invalid"):CTATCommShell.commShell.addGlobalEventListener(this)};this.configFromDescription()};CTATScrollPaneComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATScrollPaneComponent.prototype.constructor=CTATScrollPaneComponent;CTAT.ComponentRegistry.addComponentType("CTATScrollPaneComponent",CTATScrollPaneComponent);var CTATSkillWindow=function(c,g,f,e,b){CTAT.Component.Base.Graphical.call(this,"CTATSkillWindow","__undefined__",c,g,f,e,b);var a=this;a.isTabIndexable=!1;this.getThreshold=function(){var a=parseFloat($(this.getDivWrap()).attr("data-ctat-threshold"));return isNaN(a)?.95:a};this.setThreshold=function(a){$(this.getDivWrap()).attr("data-ctat-threshold",a)};var d=null;this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setIsAbstractComponent(!0);a.setInitialized(!0);d=this.getDivWrap();this.setComponent(d);
this.drawComponent();this.component.addEventListener("focus",this.processFocus)};this.assignSkillSet=function(a){CTATSkillSet.skills=a;this.drawComponent()};this.updateSkillSet=function(d){if(CTATSkillSet.skills){a.ctatdebug("updateSkillSet ("+d.getSkillSet().length+")");d=d.getSkillSet();for(var b=0;b<d.length;b++){var e=d[b];a.ctatdebug("Updating skill "+e.getSkillName()+" to level: "+e.getLevel()+" ...");CTATSkillSet.skills.setSkillLevel(e.getSkillName(),e.getLevel(),1)}this.drawComponent()}else a.ctatdebug("Error: updateSkillSet () no initial skill set given, can't update")};
this.drawComponent=function(){a.ctatdebug("drawComponent ()");if(null===CTATSkillSet.skills)ctatdebug("Info: no skillSet object available, bumping out");else{var b=CTATSkillSet.skills.getSkillSet();if(null===b)a.ctatdebug("Error: list of skills is null in skills object");else if(0>=b.length)a.ctatdebug("Error: list of skills is 0 length");else{for(var e=document.createDocumentFragment(),c=this.getThreshold(),f=0;f<b.length;f++){var g=b[f];a.ctatdebug("Drawing skill "+f+" "+g.getDisplayName()+" level: "+
g.getLevel()+" ...");var r=document.createElement("div");r.classList.add("CTATSkillWindow--skill");var u=document.createElement("div");u.classList.add("CTATSkillWindow--bar");var w=document.createElement("div"),q=g.getLevel();q<c?w.classList.add("CTATSkillWindow--bar--nonmastered"):w.classList.add("CTATSkillWindow--bar--mastery");w.style.width=q>c?"100%":100*q+"%";u.appendChild(w);r.appendChild(u);e.appendChild(r);u=document.createElement("div");u.textContent=g.getDisplayName()||"no-name";u.classList.add("CTATSkillWindow--label");
r.appendChild(u)}d.innerHTML="";d.appendChild(e)}}}};CTATSkillWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATSkillWindow.prototype.constructor=CTATSkillWindow;CTAT.ComponentRegistry.addComponentType("CTATSkillWindow",CTATSkillWindow);var CTATSubmitButton=function(c,g,f,e,b){CTATButton.call(this,c,g,f,e,b);this.setClassName("CTATSubmitButton");CTATConfiguration.get("previewMode");var a=this;this.setParameterHandler("target_components",function(a){this.getDivWrap().setAttribute("data-ctat-target",a);return this});var d=this.init;this.init=function(){d();this.setParameter("tutorComponent",CTAT.Component.Base.Tutorable.Options.DO_NOT_TUTOR);this.component.addEventListener("focus",this.processFocus)};var h=function(d){var b=a.getTargets();
return 0===Object.keys(b).length?!1:d===a?!1:d instanceof CTAT.Component.Base.Tutorable?b.hasOwnProperty(d.getName())||b.hasOwnProperty(d.getComponentGroup()):d instanceof CTATSAI?d.getSelection()!=a.getName()&&b.hasOwnProperty(d.getSelection()):d instanceof String?d!=a.getName()&&b.hasOwnProperty(d):d instanceof Element?d!=a.getComponent()&&(b.hasOwnProperty(d.id)||b.hasOwnProperty(d.getAttribute("name"))):!1};c=CTAT.Component.Base.Tutorable.EventType;document.addEventListener(c.correct,function(d){d.detail.sai&&
h(d.detail.component)&&a.isNotGraded()&&a.setCorrect()},!1);document.addEventListener(c.incorrect,function(d){d.detail.sai&&h(d.detail.component)&&(a.setIncorrect(),a.setEnabled(!0))},!1);document.addEventListener(c.ungrade,function(d){(d=d.detail.component)&&h(d)&&a.setNotGraded()},!1);document.addEventListener(c.action,function(d){var b=d.detail.component;b&&h(b)&&!d.detail.graded&&(a.setNotGraded(),a.setEnabled(!0))},!1);document.addEventListener(c.highlight,function(d){var b=d.detail.component;
b&&h(b)&&a.setHintHighlight(d.detail.isHighlighted)},!1);this.getTargets=function(){var a={},d=this.getDivWrap().getAttribute("data-ctat-target");d&&String(d).split(/\s*[;,]\s*/).forEach(function(d){return a[d.trim()]=1});return a};this.processClick=function(d){if(!0===a.getEnabled()){d=a.getTargets();for(var b in d)d=CTATShellTools.findComponent(b),null!==d&&0<d.length&&(d=d[0],d instanceof CTAT.Component.Base.Tutorable?d.getEnabled()&&d.grade(a):a.ctatdebug("Invalid target component: "+d))}}};
CTATSubmitButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATSubmitButton.prototype.constructor=CTATSubmitButton;CTAT.ComponentRegistry.addComponentType("CTATSubmitButton",CTATSubmitButton);var CTATTable=function(c,g,f,e,b){CTAT.Component.Base.Tutorable.call(this,"CTATTable","__undefined__",c,g,f,e,b);var a=this,d=[],h=[],l=0;this.get_first_row_is_header=function(){return CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-has-header"))};this.set_first_row_is_header=function(a){$(this.getDivWrap()).attr("data-ctat-has-header",a);this.get_first_row_is_header()?(p(),l=1):(r(),l=0)};this.setParameterHandler("FirstRowIsHeader",this.set_first_row_is_header);c=function(a){a=
parseInt($(this.getDivWrap()).attr(a));return isNaN(a)?2:a};var m=c.bind(this,"data-ctat-num-rows");this.get_row_count=m;this.set_row_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-rows",a)};this.setNumRows=function(a){a=Number(a);if(!isNaN(a)){for(;this.get_row_count()<a;)this.addRow();for(;this.get_row_count()>a;)this.deleteRow()}};var n=c.bind(this,"data-ctat-num-cols");this.get_col_count=n;this.set_col_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-cols",a)};this.setNumCols=
function(a){a=Number(a);if(!isNaN(a)){for(;this.get_col_count()<a;)this.addColumn();for(;this.get_col_count()>a;)this.deleteColumn()}};this.super_setName=this.setName;this.setName=function(a){this.super_setName(a);if(d&&d[0])for(var b=0;b<d.length;b++)for(var e=0;e<d[0].length;e++)d[b][e].setAttribute("id",a+".R"+b+"C"+e)};this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setInitialized(!0);var d=a.getDivWrap();a.setComponent(d);a.addComponentReference(a,d);a.render();a.ctatdebug("table name = "+
this.getName());this.adjustTableContents();this.get_first_row_is_header()?(p(),l=1):l=0};this.getConfigurationActions=function(){var a=[],d,b=$(this.getDivWrap());b.attr("data-ctat-num-rows")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("setNumRows"),d.setInput(b.attr("data-ctat-num-rows")),a.push(d));b.attr("data-ctat-num-cols")&&(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("setNumCols"),d.setInput(b.attr("data-ctat-num-cols")),a.push(d));b.attr("data-ctat-has-header")&&
(d=new CTATSAI,d.setSelection(this.getName()),d.setAction("set_first_row_is_header"),d.setInput(b.attr("data-ctat-has-header")),a.push(d));return a};var p=function(){a.ctatdebug("fix_header()");h[0].classList.add("CTATTable--headers");for(var b=0;b<d[0].length;b++)d[0][b].classList.add("CTATTable--header")}.bind(this),r=function(){a.ctatdebug("remove_header()");h[0].classList.remove("CTATTable--headers");for(var b=0;b<d[0].length;b++)d[0][b].classList.remove("CTATTable--header")}.bind(this);this.fixHeader=
p;this.removeHeader=r;var u=function(a,d){var b=document.createElement("div"),e=this.getName()+".R"+a+"C"+d;b.id=e;b.classList.add("CTATTable--cell");b.classList.add("CTATTextArea");var c=new CTATTextArea;c.setName(e);c.setDivWrapper(b);(e=this.getTabIndex())&&c.setTabIndex(e);c.processAttributes();c.init(!0);c.processTabOrder();c.setEnabled(this.getEnabled());$(b).data("CTATComponent",c);return b}.bind(this);this.addRow=function(){var a=document.createElement("div");a.classList.add("CTATTable--row");
var b=m();parseInt(b,10);d[b]=[];for(var e=0;e<n();e++){var c=u(b,e);d[b].push(c);a.appendChild(c)}$(this.getDivWrap()).append(a);h.push(a);this.set_row_count(b+1)};this.deleteRow=function(){var a=this.getDivWrap();a.removeChild(a.lastChild);h.pop();d.pop();this.set_row_count(this.get_row_count()-1)};this.addColumn=function(){var a=n(),b=0;h.forEach(function(e){var c=u(b,a);d[b].push(c);b<l&&c.classList.add("CTATTable--header");e.appendChild(c);b++});this.set_col_count(a+1)};this.deleteColumn=function(){this.getDivWrap();
for(var a=h.length,b=0;b<a;b++)h[b].removeChild(h[b].lastChild),d[b].pop();this.set_col_count(this.get_col_count()-1)};this.adjustTableContents=function(){a.ctatdebug("adjustTableContents()");for(var b=m(),e=0;e<b;e++){var c=document.createElement("div");c.classList.add("CTATTable--row");$(this.getDivWrap()).append(c);h.push(c);for(var f=0;f<n();f++){var g=a.getName()+".R"+e+"C"+f,l=CTATShellTools.findComponent(g);l&&0!==l.length&&l[0].getName()===g?(g=l[0].getDivWrap(),g.classList.add("CTATTable--cell")):
g=u(e,f);c.appendChild(g);d[e]||(d[e]=[]);d[e].push(g)}}}};CTATTable.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATTable.prototype.constructor=CTATTable;CTAT.ComponentRegistry.addComponentType("CTATTable",CTATTable);var CTATTextField=function(c,g,f,e,b){CTATTextBasedComponent.call(this,"CTATTextBasedComponent","__undefined__",c,g,f,e,b);var a=this,d=null,h,l,m=null;this.setAction("UpdateTextArea");this.init=function(){d=this.getDivWrap();a.setComponent(d);this.getText()&&(d.innerHTML=a.getText());var b=d.getAttribute("data-ctat-selectable");b&&"true"==b.toLowerCase()&&p();a.setInitialized(!0);a.addComponentReference(a,d);a.setEditable(!1);b=(b=d.getAttribute("data-ctat-enabled"))&&"true"==b.toLowerCase();a.setEnabled(b);
a.render();a.addSafeEventListener("focus",a.processFocus,d)};var n=this.setEnabled.bind(this);this.setEnabled=function(d){n(d);a.setEditable(!1)};var p=function(){[h,l].forEach(function(a,d){var b=document.createElement("span"),e=document.createElement("div"),c=0==d;b.className="ctattextfield-marker";b.id=c?"start-marker":"end-marker";e.className="handle";b.appendChild(e);c?(e.className+=" start-handle",h=b):(e.className+=" end-handle",l=b);b.addEventListener("click",function(a){a.stopPropagation()});
b.addEventListener("mouseup",function(a){a.stopPropagation()})});a.addSafeEventListener("mouseup",r,d)},r=function(b){if(a.getEnabled()){b=null;a.clearSelectionMarkers();if(window.getSelection){var e=window.getSelection();e.getRangeAt&&(b=e.getRangeAt(0))}else document.selection&&document.selection.createRange&&(b=document.selection.createRange());b&&!b.collapsed&&d.contains(b.startContainer)&&b.startContainer==b.endContainer?(m=b.startOffset+","+b.endOffset,a.processAction(),a.setSelectionMarkers(b)):
(m="0,0",a.processAction())}};this.setSelectionMarkers=function(a){a.insertNode(h);a.collapse(!1);a.insertNode(l)};this.clearSelectionMarkers=function(){h.parentNode&&h.parentNode.removeChild(h);l.parentNode&&l.parentNode.removeChild(l);d.normalize();m=null};this.getConfigurationActions=function(){return 0<d.innerHTML.trim().length?(console.log(d.innerHTML),this.setInput(d.innerHTML.toString()),[this.getSAI()]):[]};this.setText=function(b){a.ctatdebug("setText ("+b+")");a.assignText(b);null!==d&&
(d.innerHTML=b)};this.getValue=function(){var a=content=""+this.getDivWrap().innerHTML;m&&(content=content.replace(/<span.*?class="ctattextfield-marker".*?>.*?<\/span>/g,""),a=m+";"+content);return a};var u=this.updateSAI.bind(this);this.updateSAI=function(){m?a.setAction("TextSelected"):a.setAction("UpdateTextArea");u()};this.setStyleHandler("ShowScrollbars",function(d){!0===CTATGlobalFunctions.toBoolean(d)?a.modifyCSSAttribute("overflow","scroll"):a.modifyCSSAttribute("overflow","hidden")})};
CTATTextField.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextField.prototype.constructor=CTATTextField;CTAT.ComponentRegistry.addComponentType("CTATTextField",CTATTextField);var CTATTextInput=function(c,g,f,e,b){CTATTextBasedComponent.call(this,"CTATTextInput","__undefined__",c,g,f,e,b);var a=this,d=null,h=null,l=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+a.getName()+")");var b=$(this.getDivWrap()),e=b.attr("data-ctat-type");d=document.createElement("input");d.type="number"==e?"number":"text";c&&(d.name=c.name);d.setAttribute("maxlength",a.getMaxCharacters());d.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setComponent(d);
this.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());b.attr("value")&&this.setText(b.attr("value"));var f=$(d);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var d=b.attr(a);d&&f.attr(a,d)});a.setInitialized(!0);a.addComponentReference(a,d);a.getDivWrap().appendChild(d);a.addSafeEventListener("keypress",a.processKeypress,d);a.addSafeEventListener("focus",a.processFocus,d);$(d).on("input",function(d){a.setNotGraded()});
l&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var a=[],d=$(this.getDivWrap());if(d.attr("value")){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("UpdateTextField");b.setInput(d.attr("value"));a.push(b)}return a};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};this.setText=function(b){a.ctatdebug("setText ("+b+")");a.assignText(b);d.value=b};this.getValue=function(){return d.value};this.reset=function(){a.configFromDescription();
a.processSerialization();d.value=""};this.setStyleHandler("DrawBorder",null)};CTATTextInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextInput.prototype.constructor=CTATTextInput;CTAT.ComponentRegistry.addComponentType("CTATTextInput",CTATTextInput);var CTATVideo=function(c,g,f,e,b){CTAT.Component.Base.Tutorable.call(this,"CTATVideo","__undefined__",c,g,f,e,b);var a=0,d=this,h=null;this.getAlpha=function(){return a};this.setAlpha=function(d){a=d};this.ctatdebug(this.getClassName()+" ("+this.getX()+","+this.getY()+","+this.getWidth()+","+this.getHeight()+")");this.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);this.configFromDescription();this.init=function(){d.ctatdebug("init ("+d.getName()+")");d.addCSSAttribute("z-index",
CTATGlobalFunctions.gensym.z_index());h=document.createElement("video");this.getDivWrap()&&$(this.getDivWrap()).attr("src")&&!CTATConfiguration.get("previewMode")&&(h.src=$(this.getDivWrap()).attr("src"));this.getDivWrap()&&$(d.getDivWrap()).attr("data-ctat-controls")?h.controls=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-controls")):h.controls=!0;h.autocontrols=!1;d.ctatdebug("Auto play: "+$(d.getDivWrap()).attr("data-ctat-autoplay"));this.getDivWrap()&&$(d.getDivWrap()).attr("data-ctat-autoplay")?
h.autoplay=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-autoplay")):h.autoplay=!0;d.setComponent(h);h.name=d.getName();h.setAttribute("id",CTATGlobalFunctions.gensym.div_id());h.setAttribute("onkeypress","return noenter(event)");d.addComponentReference(d,h);d.ctatdebug("Final location: "+d.getX()+","+d.getY()+" with text: "+d.getText());d.setInitialized(!0);d.getDivWrap().appendChild(h);d.ctatdebug("Resizing component to: "+$(d.getDivWrap()).width()+","+$(d.getDivWrap()).height());
h.addEventListener("focus",this.processFocus);h.addEventListener("canplay",function(){d.ctatdebug("Video loaded and ready for play")},!0);h.addEventListener("play",function(){d.ctatdebug("Video loaded and ready for play");d.logVideoEvent("play")},!0);h.addEventListener("pause",function(){d.ctatdebug("Video loaded and ready for play");d.logVideoEvent("pause")},!0);d.sizeToDiv()};this.sizeToDiv=function(){h&&(h.setAttribute("width",$(d.getDivWrap()).width()),h.setAttribute("height",$(d.getDivWrap()).height()))};
var l=this.render;this.render=function(){l.call(this);this.sizeToDiv()};this.getConfigurationActions=function(){var a=[],b;$(d.getDivWrap()).attr("data-ctat-controls")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("showControls"),b.setInput($(d.getDivWrap()).attr("data-ctat-controls")),a.push(b));$(d.getDivWrap()).attr("data-ctat-autoplay")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setAutoplay"),b.setInput($(d.getDivWrap()).attr("data-ctat-autoplay")),a.push(b));$(this.getDivWrap()).attr("src")&&
(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setURL"),b.setInput($(this.getDivWrap()).attr("src")),a.push(b));return a};this.logVideoEvent=function(a){d.ctatdebug("logVideoEvent ("+a+")");if(void 0!==h.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(d.getName(),a,d.toHHMMSS(h.currentTime)+".000","");a.addSelection(encodeURIComponent(h.currentSrc),"media_file");a.addSelection(d.toHHMMSS(h.duration)+".000","clip_length");var b=a.getInputObject();null!==b&&b.setType("time");CTATCommShell.commShell.processComponentAction(a,
d.getTutorComponent(),!0,d,"VIDEO_ACTION","USER")}else d.ctatdebug("Error: commShell is null, can't send untutored tool message");else d.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};this.PlayMedia=function(a){h.src=a};this.showControls=function(a){a=CTATGlobalFunctions.toBoolean(a);$(d.getDivWrap()).attr("data-ctat-controls",a);h.controls=a};this.setAutoplay=function(a){a=CTATGlobalFunctions.toBoolean(a);$(d.getDivWrap()).attr("data-ctat-autoplay",a);h.autoplay=a};this.setURL=
function(a){$(this.getDivWrap()).attr("src",a);h.src=a};this.play=function(a){d.ctatdebug("play ()");var b="0";a&&(b="number"===typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=b;h.play()};this.pause=function(a){d.ctatdebug("pause ()");h.pause();var b="0";a&&(b="number"===typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=b};this.stop=function(){d.ctatdebug("stop ()");d.pause()}};CTATVideo.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATVideo.prototype.constructor=CTATVideo;CTAT.ComponentRegistry.addComponentType("CTATVideo",CTATVideo);var CTATAssistments={},assistmentsTimerVar,assistmentsJSONpreface='{ "version" : "AS.1", "action" : ';function iframeToParent(c){window.parent.postMessage(c,"https://test1.assistments.org")}function iframeLoaded(){iframeToParent(assistmentsJSONpreface+'"loaded" }');assistmentsTimerVar=window.setInterval("iframeHeartbeat()",1E4)}function iframeHeartbeat(){iframeToParent(assistmentsJSONpreface+'"heartbeat"}')}
function iframeCompleted(){var c=document.getElementById("MyScore").value;iframeToParent(assistmentsJSONpreface+'"completed", "answer" : "<b>Student worked hard on this problem.</b>","score" : '+c+" }");window.clearTimeout(assistmentsTimerVar)};var CTATEnabledInPreview={},ctatEnabledInPreview={CTATButton:!0,CTATComboBox:!0,CTATAudioButton:!0,CTATImageButton:!0,CTATSubmitButton:!0,CTATTextArea:!0,CTATTextInput:!0,CTATNumericStepper:!0,CTATTable:!0,CTATHintButton:!0,CTATDoneButton:!0};var CTATTutor={drawing:!1,onMobile:!1,tutorInitialized:!1,flashVars:null};Object.defineProperty(CTATTutor,"parser",{get:function(){this._parser||(CTATConfig.parserType_is_XML()?(ctatdebug("Creating XML parser ..."),this._parser=new CTATXML):CTATConfig.parserType_is_JSON()&&(this._parser=new CTATJSON));return this._parser}});
CTATTutor.removeComponent=function(c){var g=[],f=CTATShellTools.findComponent(c);console.log("CTATTutor.removeComponent("+c+") cList",f);if(!c||!f)return g;for(var e=c=null,e=null,b=0;b<f.length;++b)if(c=f[b]){console.log("CTATTutor.removeComponent()[",b,"] ",c.getName&&c.getName(),c);(c.getComponentList?c.getComponentList():[]).forEach(function(a){CTATTutor.removeComponent(a.getName?a.getName():"")});if(e=c.getName&&c.getName())delete CTATShellTools.component_descriptions[e],g.push(e);if(e=c.getDivWrap&&
c.getDivWrap())c.setDivWrapper(null),$(e).data("CTATComponent",null),$(e).remove();console.log("CTATTutor.removeComponent()[",b,"] divWrap",e)}return g};
CTATTutor.initializeHTMLComponent=function(c,g){var f=CTAT.ComponentRegistry[g],e;if(e=$(c).data("CTATComponent"))return e;e=new f;$(c).attr("id")?e.setName($(c).attr("id")):(c.setAttribute("id",CTATGlobalFunctions.gensym.div_id()),e.setName(c.getAttribute("id")));e.setDivWrapper(c);e.processAttributes();e.init();e.processTabOrder();e.setEnabled(e.getEnabled());0==e.isFeedbackComponent()&&(f=new CTATComponentDescription,f.type=e.getClassName(),f.name=e.getName(),f.setComponentPointer(e),CTATShellTools.registerComponentDescription(f));
$(c).data("CTATComponent",e);if(CTATConfiguration.get("previewMode")){var f=e.getDivWrap().getAttribute("data-ctat-enabled"),b=ctatEnabledInPreview[e.getClassName()];b||(b=!1);e.setEnabled(b);e.getDivWrap().setAttribute("data-ctat-enabled",f)}return e};CTATTutor.initializeHTMLComponents=function(){for(var c in CTAT.ComponentRegistry)$("."+c).each(function(){$(this).data("CTATComponent")||CTATTutor.initializeHTMLComponent(this,c)});CTATShellTools.listComponents();ctatdebug("initializeHTMLComponents () done")};
var CTATComponentMutObserver=new MutationObserver(function(c,g){c.forEach(function(c){if(c.addedNodes){c=c.addedNodes;for(var e=c.length,b=0;b<e;b++){var a=c[b];if(a.nodeType===Node.ELEMENT_NODE){a.childNodes&&(c=Array.prototype.concat.call(c,Array.from(a.childNodes)));for(var e=c.length,d=/(CTAT[A-z]*)(\s|$)/g;ctatClass=d.exec(a.className);)if(CTAT.ComponentRegistry[ctatClass[1]]){CTATComponentMutObserver.disconnect();CTATTutor.initializeHTMLComponent(a,ctatClass[1]);CTATComponentMutObserver.observe(document.body,
{childList:!0,subtree:!0});break}}}}})});function addMutObserver(){console.log("adding ctatcomponent mutation observer");CTATComponentMutObserver.observe(document.body,{childList:!0,subtree:!0})}"loading"!==document.readyState?addMutObserver():document.addEventListener("DOMContentLoaded",addMutObserver);CTATTutor.callComponentFunction=function(c,g,f){if((c=CTATShellTools.findComponent(c.id))&&0<c.length){c=c[0];var e=null;g&&(e=g(c,f));return e}};
function assignNameTranslator(c){nameTranslator=c}CTATTutor.drawTutor=function(){if(!0!==this.drawing){this.drawing=!0;for(var c in CTATShellTools.component_descriptions){var g=CTATShellTools.component_descriptions[c].getComponentPointer();null!==g&&g.drawComponent()}this.drawing=!1}};
CTATTutor.initialize=function(){var c=navigator.userAgent.toLowerCase();0<c.search("iphone")?CTATTutor.onMobile=!0:0<c.search("ipod")?CTATTutor.onMobile=!0:0<c.search("android")&&(CTATTutor.onMobile=!0);c=getSafeElementById("pageor");null!==c&&!1===CTATTutor.onMobile&&(c.style.display="none");ctatdebug("initialize ()");this.initializeHTMLComponents();flashVars.getRawFlashVars();c=!0;CTATConfiguration.get("previewMode")&&(ctatdebug("In preview mode..."),c=!1);1==c?(CTATCommShell.commShell=new CTATCommShell,
CTATCommShell.commShell.init(CTATTutor)):CTATScrim.scrim.scrimDown()};
CTATTutor.createInterface=function(){ctatdebug("createInterface ("+Object.keys(CTATShellTools.component_descriptions).length+")");if(1==CTATGlobals.ignoreInterfaceDescriptions)ctatdebug("No need to process interface description messages, the interface should already be ready."),this.postProcess(),this.drawTutor();else{if(CTATGlobals.interfaceElement){ctatdebug("Re-creating interface ...");var c=CTATTutor.parser.getElementChildren(CTATGlobals.interfaceElement);CTATTutor.createStaticInterface(null,
c,null)}for(var g in CTATShellTools.component_descriptions){c=CTATShellTools.component_descriptions[g];if(!c){alert("Internal error parsing component at index "+g);return}if(!c.name){alert("Internal error parsing component at index "+g+" (no name attribute available)");return}if(-1==c.name.indexOf("null."))if(ctatdebug("Component: "+c.name+", type: "+c.type),"CTATCommShell"==c.type){if(CTATCommShell.commShell&&CTATCommShell.commShell.setName(c.name),"CTATCommShell"==c.type){ctatdebug("Tutor dimensions: "+
c.width+"x"+c.height);var f=getSafeElementById(ctatcontainer);null!==f?(ctatdebug("Setting canvas dimensions from: "+f.width+"px, "+f.height+"px, to: "+c.width+"px, "+c.height+"px"),f.width=c.width,f.height=c.height,f.style.width=c.width,f.style.height=c.height,ctatdebug("Canvas dimensions now: "+f.width+"px, "+f.height+"px")):ctatdebug("Error: tutor canvas is null, can't adjust size");f=getSafeElementById(ctatcontainer);null!==f?(f.style.width=c.width+"px",f.style.height=c.height+"px"):ctatdebug("Error: tutor container is null, can't adjust size")}}else CTAT.ComponentRegistry.hasOwnProperty(c.type)?
(ctatdebug("Creating ("+c.type+") :"+c.name),f=new CTAT.ComponentRegistry[c.type](c,c.x,c.y,c.width,c.height),f.setName(c.name),"CTATTextInput"!=c.type&&"CTATTextArea"!=c.type||f.setEnabled(!0),f.setTabIndex(c.tabIndex),c.setComponentPointer(f),f.initialize(),ctatdebug(f.getDivWrap())):ctatdebug("ERROR: Unrecognized component type "+c.type+" for "+c.name)}this.postProcess();this.drawTutor();ctatdebug("Tutor has been intialized from BRD, recalculating canvas position and size ...")}};
CTATTutor.postProcess=function(){ctatdebug("postProcess ()");for(var c in CTATShellTools.component_descriptions){var g=CTATShellTools.component_descriptions[c].getComponentPointer();null!==g?(g.getClassName(),g.postProcess&&g.postProcess()):ctatdebug("Error: component pointer "+c+" is null")}};
CTATTutor.createStaticInterface=function(c,g,f){ctatdebug("createStaticInterface ()");var e=getSafeElementById(ctatcontainer);null!==c&&(e=c);for(c=0;c<g.length;c++){var b=g[c];ctatdebug(this.parser.getElementName(b));if("timeline"==this.parser.getElementName(b)){ctatdebug("Timeline node found, obtaining visual elements ...");g=this.parser.getElementChildren(b);this.createStaticInterface(null,g,null);break}if("ctatcomponent"==this.parser.getElementName(b)){var a=this.parser.getElementAttr("instance");
f&&(ctatdebug("Registering existence of CTAT component on MovieClip container: "+a),f.addComponent(a))}var d,h,l,m;"shape"==this.parser.getElementName(b)&&(d=this.parser.getElementAttr(b,"x"),h=this.parser.getElementAttr(b,"y"),l=this.parser.getElementAttr(b,"width"),m=this.parser.getElementAttr(b,"height"),a=this.parser.getElementAttr(b,"instance"),ctatdebug("Creating shape: "+a+" at: "+d+","+h+","+l+","+m),l="data:image/png;base64, "+this.parser.getNodeTextValue(b),m=new Image,m.setAttribute("style",
"position: absolute; top: "+h+"px; left:"+d+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),m.setAttribute("id",a),m.setAttribute("src",l),e.appendChild(m));"statictext"==this.parser.getElementName(b)&&(d=this.parser.getElementAttr(b,"x"),h=this.parser.getElementAttr(b,"y"),l=this.parser.getElementAttr(b,"width"),m=this.parser.getElementAttr(b,"height"),a=this.parser.getElementAttr(b,"instance"),ctatdebug("Creating static text: "+a+" at: "+d+","+h+","+l+","+m),l="data:image/png;base64, "+
this.parser.getNodeTextValue(b),m=new Image,m.setAttribute("style","position: absolute; top: "+h+"px; left:"+d+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),m.setAttribute("id",a),m.setAttribute("src",l),e.appendChild(m));"statictext"==this.parser.getElementName(b)&&(a=this.parser.getElementAttr("instance"),ctatdebug("Creating movieclip: "+a),d=this.parser.getElementAttr(b,"x"),h=this.parser.getElementAttr(b,"y"),l=this.parser.getElementAttr(b,"width"),m=this.parser.getElementAttr(b,"height"),
d=new CTATMovieClip(a,d,h,l,m),h=d.wrapComponent(e),ctatdebug("Created movieclip: "+a+" at: "+d.x+","+d.y+","+d.width+","+d.height),movieclips.push(d),b=this.parser.getElementChildren(b),this.createStaticInterface(h,b,d))}};
CTATTutor.runTutor=function(){ctatdebug("runTutor ()");!0===CTATGlobals.tutorRunning?ctatdebug("The tutor is already running"):(null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),window.onerror=function(c,g,f){var e=new CTATHTMLManager;ctatdebug(e.htmlEncode(c)+" in "+g+", line "+f);ctatdebug(e.htmlEncode(c)+" in "+g+", line "+f)},centerTutorContainer(),CTATTutor.initialize(),CTATGlobals.tutorRunning=!0,ctatdebug("runTutor () ... all set"))};var idleTime=0;
CTATTutor.setIdleTimeout=function(){setInterval(CTATTutor.timerIncrement,6E4);$(document).mousemove(function(c){idleTime=0});$(document).keypress(function(c){idleTime=0})};
CTATTutor.timerIncrement=function(){if(!(0>idleTime)){var c=1140,g=CTATConfiguration.get("session_timeout");if(g&&!isNaN(g))c=parseInt(g)+60;else if(!CTATLMS.identifier||0>parseInt(CTATLMS.identifier))c=1E20;idleTime+=60;idleTime>c&&(idleTime=-1,CTATScrim.scrim.OKScrimUp("The tutor timed out due to inactivity, click 'Ok' to reload the page.",function(){window.location.reload()}))}};
CTATTutor.initTutor=function(c,g,f,e){ctatdebug("initTutor() aFlashVars "+typeof c+", usingFlash "+e);if(1==CTATTutor.tutorInitialized)ctatdebug("Tutor already initialized, probably in author mode"),"undefined"!=typeof c&&c.previewMode&&(CTATScrim.scrim.scrimDown(),ctatdebug("In preview mode..."));else{CTATConfiguration.generateDefaultConfigurationObject(c,"undefined"==typeof CTATTarget?void 0:CTATTarget);switch(CTATConfiguration.get("show_debug_traces")){case "true":case "basic":useDebuggingBasic=
!0;break;case "on":case "full":useDebugging=!0;break;case "false":case "off":useDebuggingBasic=useDebugging=!1;break;default:useDebuggingBasic=!0}null==e&&(e=CTATConfiguration.usingFlash());e&&CTATScrim.scrim.scrimDown();CTATCommLibrary.setAuthenticityToken(CTATConfiguration.get("authenticity_token"));g&&(ctatcontainer=g);(c=document.getElementById(ctatcontainer))&&c.classList.add("CTATTutorContainer");c=getSafeElementById("debugtraces");null!==c&&(useDebugging=!0===c.checked?!0:!1);ctatdebug("initTutor() CTATConfiguration.get('mode')="+
CTATConfiguration.get("mode")+", window.sendToTutor="+window.sendToTutor);CTATConfiguration.get("swf_name")&&!window.sendToTutor&&(window.sendToTutor=function(b){ctatdebug("window.sendToTutor("+b+") CTAT.ToolTutor.tutor "+CTAT.ToolTutor.tutor);return CTAT.ToolTutor.tutor?CTAT.ToolTutor.tutor.receiveFromInterface(b):CTAT.ToolTutor.tutorMessages.push(b)},window.registerInterface=function(b){CTAT.ToolTutor.registerInterfaceMessageHandler(b)});"javascript"==String(CTATConfiguration.get("tutoring_service_communication")).toLowerCase()&&
("undefined"!=typeof CTATExampleTracer&&CTATExampleTracer?CTAT.ToolTutor.registerTutor(new CTATExampleTracer):CTATScrim.scrim.warningScrimUp('Tutoring service communication parameter is "JavaScript" but class\nCTATExampleTracer is missing. Use a different ctat-*.js script.'));ctatdebug("initTutor ()");"applet"==CTATConfiguration.get("tutoring_service_communication")&&deployJava.runApplet({id:"TSApplet",width:150,height:10},{jnlp_href:"/ctat_applet/TSApplet.jnlp"},"1.6");e||CTATTutor.runTutor();CTATTutor.setIdleTimeout();
CTATTutor.tutorInitialized=!0;document&&typeof("function"==document.dispatchEvent)&&function(b){return new Promise(function(a){return setTimeout(a,b)})}(0).then(function(){return document.dispatchEvent(new CustomEvent("tutorInitialized",{student_interface:CTATConfiguration.get("student_interface"),question_file:CTATConfiguration.get("question_file")}))})}};window.hasOwnProperty("initTutor")||(window.initTutor=CTATTutor.initTutor);function receiveFromTutor(){ctatdebug("receiveFromTutor ()")}
function saveAndQuit(){ctatdebug("saveAndQuit ()")}function prepTutorArea(){initTutor()}window.prepTutorArea=prepTutorArea;function assignAnonymousGradingProcessor(c){CTATCommShell.commShell.assignAnonymousGradingProcessor(c)}function gradeAnonymousComponent(c,g,f){ctatdebug("gradeAnonymousComponent ()");c=new CTATSAI(c,g,f);CTATCommShell.commShell.processComponentAction(c)}
function testTutor(c){ctatdebug("testTutor ()");window.onerror=function(c,f,e){var b=new CTATHTMLManager;ctatdebug(b.htmlEncode(c)+" in "+f+", line "+e)};null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet);(new CTATCommLibrary).send("http://augustus.pslc.cs.cmu.edu/crossdomain.xml")}
function centerTutorContainer(){ctatdebug("centerTutorContainer ()");var c=getSafeElementById(ctatcontainer);if(null==c)ctatdebug("Tutor container not found, bump");else{var g;if(flashVars){g=flashVars.getRawFlashVars();var f,e;f=c.offsetWidth;e=c.offsetHeight;g&&g.width&&g.height&&(ctatdebug("We have raw width and height variables in our flashvars: "+g.width+","+g.height),f=g.width,e=g.height);g.centerTutor?1==g.centerTutor&&(ctatdebug("Moving tutor over by: "+("-"+Number(f/2)+"px 0 0 -"+Number(e/
2)+"px;")),c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.right="0",c.style.bottom="0",c.style.margin="auto"):ctatdebug("The tutor is not configured to center the container, bump")}else ctatdebug("No flashvars yet, bump")}}
function checkTutorCanvas(){ctatdebug("checkTutorCanvas ()");var c=getSafeElementById(ctatcontainer),g=getSafeElementById("main-canvas"),f=flashVars.getRawFlashVars(),e="550",b="450";c&&(ctatdebug("Recording the actual CSS width and height: "+c.offsetWidth+" , "+c.offsetHeight),e=c.offsetWidth,b=c.offsetHeight);f&&f.width&&f.height&&(ctatdebug("We have tutor size flashvars, using those instead: "+f.width+" , "+f.height),e=f.width,b=f.height);null===g?(ctatdebug("No canvas available, creating ..."),
g=document.createElement("canvas"),g.id="main-canvas",g.innerHTML="Your browser does not support CTAT. Please update or use another browser.",ctatdebug("Setting canvas to: 0,0,"+e+" , "+b),getSafeElementById(ctatcontainer).appendChild(g)):(ctatdebug("Setting canvas to: 0 , 0, "+e+" , "+b),g.style.top="0",g.style.left="0");g.style.width=e+"px";g.style.height=b+"px";return g};var CTATNoolsTracerUtil=function(){var c={},g=/^(?:[a-z]+:\/)?\//i;this.setTypes=function(f,e){console.log("setTypes()");e.forEach(function(b){c[b]=f.getDefined(b);c[b]?console.log("set type "+b):console.log("couldn't get "+b)})};this.getFactType=function(f){var e=typeof f;if("object"===e)if(e=null,f instanceof Array)e="Array";else if(f instanceof RegExp)e="RegExp";else if(f instanceof Date)e="Date";else for(t in c)if(c.hasOwnProperty(t)&&c[t]===f.constructor){e=t;break}return e};this.getTypeConstructor=
function(f){return c[f]};this.relativeToAbsolute=function(c,e){if(this.isAbsoluteURL(c))return c;e=e||window.location.origin+window.location.pathname;var b=e.split("/"),a=c.split("/");b.pop();for(var d=0;d<a.length;d++)"."!=a[d]&&(".."==a[d]?b.pop():b.push(a[d]));return b.join("/")};this.isAbsoluteURL=function(c){return g.test(c)};this.buildStartStateMsg=function(){var c=0,e=new CTATTutoringServiceMessageBuilder;return function(b){return e.createInterfaceActionMessage(c++,new CTATSAI(b.selection,
b.action,b.input))}}();this.buildStateGraphMsg=function(c){var e="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>",b;for(b in c)c.hasOwnProperty(b)&&(e+="<"+b+">"+c[b]+"</"+b+">");return e+"</properties></message>"};this.printAgenda=function(c){return JSON.stringify(c.getAgenda())};this.printConflictTree=function(c,e){return c.getConflictTree().toString(e)};this.printFact=function(c,e,b){var a=c.getFact(e),d="";if(a){b&&(d="id: "+e+", ");var d=d+("type: "+c.getFactType(a.object)+
", "),f;try{f="values: "+JSON.stringify(a.object)}catch(l){f="< Error converting fact to JSON >"}d+=f}else d="no fact found with ID "+e;return d};this.getFacts=function(c,e){var b=[];if(Array.isArray(e)){for(var a=$jscomp.makeIterator(e),d=a.next();!d.done;d=a.next())type=d.value,b=b.concat(this.getFacts(c,type));return b}if(Number.isInteger(e))return this.getFact(c,e);b=c.getFacts(e,!0);e||(b=b.filter(function(a){a=c.getFactType(a.object);return!("hint"===a||"tpa"===a||"customfield"===a||"skill"===
a)}));return b.map(function(a){return a.object})};this.getFact=function(c,e){var b=null,a;"number"===typeof e?(b=c.getFact(e))&&(b=b.object):e&&"string"!==typeof e||(a=this.getFacts(c,e))&&(b=a[0]);return b};this.printFacts=function(c,e){var b=e,a="";if(Array.isArray(b)){for(var b=$jscomp.makeIterator(b),d=b.next();!d.done;d=b.next())e=d.value,a+=Number.isInteger(e)?this.printFact(c,e,!0):this.printFacts(c,e),a+="\n";return a}if(Number.isInteger(e))return this.printFact(c,e);b=c.getFacts(e,!0);e||
(b=b.filter(function(a){a=c.getFactType(a.object);return!("hint"===a||"tpa"===a||"customfield"===a||"skill"===a)}));a="got "+b.length+(e?" "+e:"")+" fact(s):\n";b.forEach(function(d){a+="id: "+d.id+", "+(e?"":"type: "+c.getFactType(d.object)+", ");var b;try{b="values: "+JSON.stringify(d.object)+"\n"}catch(m){b="< Error converting fact to JSON >\n"}a+=b});return a};this.printRules=function(c,e){var b=c.getRuleNames();e&&(b=b.filter(function(a){return a.toLowerCase().includes(e)}));return b.join(", ")};
this.printCtNodeMatch=function(c,e){var b=c.getNodeMatcherResult(e),a,d;b&&"no match"!==b?(a=b.student,d=b.tutor,b="rule: "+b.rule+"\nstudent: "+a.selection+", "+a.action+", "+a.input+"\ntutor:   "+d.selection+", "+d.action+", "+d.input+"\nresult: "+(b.isMatch?"match":"no match")):b="no match"===b?"No match found at node "+e:"No conflict tree node found for ID "+e;return b};this.printRuleNodes=function(){function c(b){var a={};b.facts.forEach(function(d,e){var c;for(e=0;!c&&e<b.aliases.length;e++)b.factHash[b.aliases[e]]===
d.object&&(c=b.aliases[e]);c?a[c]=d:console.warn("no alias found for "+JSON.stringify(d))});return a}function e(b,a){var d={},e="NotNode"===a.nodeType||"FromNotNode"===a.nodeType;switch(a.nodeType){case "BetaNode":case "NotNode":case "ExistsNode":var f=a.rightMemory,g,n=[],p;for(p in f)g=f[p].data.match,n.push(c(g));d.factBindings=n;break;case "JoinNode":var n=a.leftMemory,r,u=[];for(f in n)for(g in r=n[f].data.rightMatches,r)p=r[g].match,u.push(c(p));d.factBindings=u;break;case "FromNode":case "FromNotNode":f=
a.fromMemory;u=[];for(n in f)for(r in g=f[n],g)p=g[r][1],p.match&&u.push(c(p.match));d.factBindings=u;break;default:d.factBindings=[]}d.isMatch=d.factBindings.length&&!e||!d.factBindings.length&&e;return d}return function(b,a){var d=!0,c=b.getRuleData(a),f="";if(c){var g=c.memoryNodes,c=[].concat(c.patterns),n={},p=null,r,u,w,q=/("([^"]*)"):/g;try{for(var y=0;y<c.length;y++){var f=f+(p?"\n\t":'\npattern: "'),z=c[y];z.disjuncts&&(f+="or (\n\t",p=y-1+z.disjuncts.length,c.splice.apply(c,[].concat([y,
1],$jscomp.arrayFromIterable(z.disjuncts))),z=c[y]);f+=z.string+(p?"":'"');r=z.alias;n[r]||(n[r]=0);u=e(z,g[r][n[r]++]);u.isMatch||(f+=" NOT");f+=" MATCHED";(w=u.factBindings).length&&(f+=" - Possible bindings: ",w.forEach(function(a,d){for(var b in a)if("__i__"!==b){for(var e=JSON.stringify(a[b].object),c;c=q.exec(e);)e=e.replace(c[1],c[2]);f+="\n\t"+(p?"\t":"")+b+": "+e+" (fact ID "+a[b].id+")"}f+="\n"}));y===p&&(f+='\n)"',p=null);if(!u.isMatch){d=!1;break}}return f+"\nRule "+(d?"":"not ")+"matched"}catch(B){throw console.log("got here: "+
f),B;}}else return"Rule "+a+" not found"}}();this.printBreakpoints=function(c){return"breakpoints set for rules: "+c.getBreakpoints().join(", ")}};var CTATNoolsTracerWrapper=function(c){this.printAgenda=function(){c.printAgenda("override")};this.getAgenda=function(){return c.getAgenda()};this.printConflictTree=function(g,f){c.printConflictTree("override",g,f)};this.printPregenTrees=function(g,f){c.printPregenTrees("override",g,f)};this.printTutorSAIs=function(g){c.printTutorSAIs("override",g)};this.printFact=function(g){c.printFact(g)};this.getFact=function(g){return c.getFact(g)};this.printFacts=function(g){c.printFacts(g)};this.getFacts=function(g){return c.getFacts(g)};
this.printRules=function(g){c.printRules(g)};this.printMatch=function(g){c.printCtNodeMatch(g)};this.printRuleNodes=function(g){c.printRuleNodes(g)};this.setStepperMode=function(g){c.setInStepMode(g)};this.takeSteps=function(g,f){c.takeSteps(g,f)};this.setBreakpoint=function(g,f){c.setBreakpoint(g,f)};this.printBreakpoints=function(){c.printBreakpoints()};this.resume=function(){c.resume()};this.getProblemStateStatus=function(){return c.getProblemStateStatus()}};var CTATAlgebraTreeNode={};
(function(){var c,g=[].slice;c=function(){function c(){}c.operators=[["UNKNOWN"],["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];c.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");c.operatorPrecedence=function(e,b){return Math.sign(this.operators.findIndex(function(a){return a.includes(e)})-this.operators.findIndex(function(a){return a.includes(b)}))};c.operatorStrings=
{EXP:["^","**"],ROOT:["|","\u221a"],UPLUS:["+"],UMINUS:["-"],ITIMES:[""],TIMES:["*","\u00d7"],DIVIDE:["/","\u00f7"],IDIVIDE:["//"],REM:["%"],PLUS:["+"],MINUS:["-"],LESS:["<"],LESSEQUAL:["<=","\u2264"],EQUAL:["=","=="],NOTEQUAL:["!=","/=","<>","\u2260"],GREATEREQUAL:[">=","\u2265"],GREATER:[">"]};c.toOperatorString=function(e){var b;return(null!=(b=this.operatorStrings[e])?b[0]:void 0)||""};c.toOperator=function(e,b){var a;return null!=(a=Object.entries(this.operatorStrings).find(function(a){return function(a){return a[1].includes(e)&&
(!["UPLUS","UMINUS"].includes(a[0])||1===b)}}(this)))?a[0]:void 0};c.diff=function(e,b){return e.filter(function(a){return!b.includes(a)})};c.prototype.toString=function(e,b,a){var d,c;null==b&&(b="EQUAL");null==a&&(a=!1);d=0;for(c=this.parens;0<=c?d<c:d>c;0<=c?++d:--d)e="("+e+")";!this.parented()&&this.addParens(null,!0)&&(e="("+e+")");this.inverted()&&(e="1/"+e);this.negated()&&(e="-"+e);!this.parented()&&this.addParens(b,a)&&(e="("+e+")");return e};c.prototype.setParens=function(){this.parens++;
return this};c.prototype.addParens=function(e,b){var a;null==e&&(e=null);null==b&&(b=!1);null!=e?a=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(e=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,a=this.operator);a=c.operatorPrecedence(e,a);return null!=e&&(0>a||0===a&&b)};c.prototype.addPaths=function(e){return Object.assign(this,{path:e})};c.prototype.evaluate=function(e,b){null==b&&(b=!0);return this.sign*(this.inverted()&&b?1/e:e)};c.prototype.applyOperator=function(e,b,
a){var d;null==a&&(a=!1);d=a?"DIVIDE":this.operator;return function(){switch(d){case "LESS":return e<b;case "GREATER":return e>b;case "LESSEQUAL":return e<=b;case "GREATEREQUAL":return e>=b;case "EQUAL":return e===b;case "NOTEQUAL":return e!==b;case "PLUS":return e+b;case "MINUS":return e-b;case "TIMES":case "ITIMES":return e*b;case "DIVIDE":return e/b;case "EXP":return Math.pow(e,b);case "ROOT":return Math.pow(e,1/b);case "REM":return e%b;case "IDIVIDE":return Math.floor(e/b);case "UPLUS":return e;
case "UMINUS":return-e}}()};c.prototype.equals=function(e){return e&&this.operator===e.operator&&this.sign===e.sign&&this.exp===e.exp&&this.parens===e.parens};c.prototype.subEquals=function(e,b){return!1};c.prototype.subNode=function(e,b){return this};c.prototype.countOperands=function(){return 0};c.prototype.getOperator=function(e,b){null==e&&(e=!1);return e&&this.inverted()&&"DIVIDE"||e&&this.negated()&&"UMINUS"||void 0};c.prototype.getOperators=function(e){null==e&&(e=!1);return this.getOperator(e)&&
[void 0]||[]};c.prototype.getVariables=function(){return[]};c.prototype.getOperands=function(){return[]};c.prototype.getExpression=function(e,b){null==e&&(e=0);null==b&&(b=this.countOperands()-1);return b<=this.countOperands()-1&&1<=b-e&&this.subNode(e,b+1)||null};c.prototype.findExpression=function(e,b,a){var d;null==a&&(a=null);return!a&&this.equals(e)?[Object.assign(this,{path:b})]:null!=a&&null!=this.terms&&this.subEquals(e,a)?[Object.assign(this.subNode(a,d=a+e.terms.length),{path:b.concat([["terms",
a,d]])})]:null!=a&&null!=this.factors&&this.subEquals(e,a)?[Object.assign(this.subNode(a,d=a+e.factors.length),{path:b.concat([["factors",a,d]])})]:[]};c.prototype.createExpression=function(){var e,b,a;b=arguments[0];e=2<=arguments.length?g.call(arguments,1):[];return(null!=(a=function(){switch(b=c.toOperator(b,e.length+1)||b){case "LESS":case "LESSEQUAL":case "EQUAL":case "NOTEQUAL":case "GREATEREQUAL":case "GREATER":return e[0]&&new CTATRelationNode(b,this,e[0])||null;case "PLUS":case "MINUS":return 1<
e.unshift(this)&&new CTATAdditionNode(b,e)||null;case "UPLUS":case "UMINUS":return new CTATUnaryNode(b,this);case "TIMES":case "DIVIDE":return 1<e.unshift(this)&&new CTATMultiplicationNode(b,e)||null;case "IDIVIDE":case "REM":return e[0]&&new CTATIntDivisionNode(b,this,e[0])||null;case "EXP":return e[0]&&new CTATPowerNode(b,this,e[0])||null;case "ROOT":return new CTATPowerNode(b,this,new CTATConstantNode(2))}}.call(this))?a.simpleFlatten():void 0)||null};c.prototype.replaceExpression=function(e,b,
a){var d,c,f,g,n;"number"===typeof a&&(e=this.findExpression(e,[])[a])&&(a=e.path,delete e.path);if(0===(null!=a?a.length:void 0))return b;if(null!=(n=null!=a?a.shift():void 0))return d=this.clone(!1),"string"===typeof n?(d[n]=null!=(c=this[n])?c.replaceExpression(e,b,a):void 0,d.simpleFlatten()):"object"===typeof n&&2===n.length?(d[n[0]]=d[n[0]].slice(0),d[n[0]][n[1]]=null!=(f=this[n[0]])?f[n[1]].replaceExpression(e,b,a):void 0,d.simpleFlatten()):"object"===typeof n&&3===n.length?(d[n[0]]=d[n[0]].slice(0),
[].splice.apply(d[n[0]],[g=n[1],n[2]-g].concat(b)),b,d.simpleFlatten()):this};c.prototype.deleteExpression=function(e,b){var a,d,c,f,g;"number"===typeof b&&(e=this.findExpression(e,[])[b])&&(b=e.path,delete e.path);if(0===(null!=b?b.length:void 0))return null;if(null!=(g=null!=b?b.shift():void 0))return a=this.clone(!1),"string"===typeof g?(a[g]=null!=(d=this[g])?d.deleteExpression(e,b):void 0,a.removeNull()):"object"===typeof g&&2===g.length?(a[g[0]]=a[g[0]].slice(0),a[g[0]][g[1]]=null!=(c=this[g[0]])?
c[g[1]].deleteExpression(e,b):void 0,a.removeNull()):"object"===typeof g&&3===g.length?(a[g[0]]=a[g[0]].slice(0),[].splice.apply(a[g[0]],[f=g[1],g[2]-f].concat(null)),null,a.removeNull()):this};c.prototype.applyRulesSelectively=function(){var e,b,a,d,c,f;c=arguments[0];e=arguments[1];b=arguments[2];a=4<=arguments.length?g.call(arguments,3):[];this.rules=c;null==e&&(e=!0);null==b&&(b=null);return this.checkIndices(a.concat(b))&&(!["PLUS","TIMES"].includes(this.operator)||this.wholeNode(b,a)?this.applyRules(this.rules,
e):(f=this.selectOperands(a.concat(b)))&&f.equals(d=f.applyRules(this.rules,e))?this:this.replaceOperands(d,b,a))||null};c.prototype.applyRules=function(e,b){var a,d,c,f,g;this.rules=e;f=this;c=this.rules;a=0;for(d=c.length;a<d;a++)g=c[a],f=f[g].call(f),f.rules=this.rules;delete f.rules;return f};c.prototype.removeNull=function(){return this};c.prototype.checkIndices=function(e){return e.every(function(b,a){return null==b||0<=b&&1>=b&&e.indexOf(b)===a})};c.prototype.wholeNode=function(e,b){return null==
e||0===b.length||b.concat(e).length>=this.countOperands()};c.prototype.selectOperands=function(e,b){return this};c.prototype.replaceOperands=function(e,b,a){return e};c.prototype.simpleFlatten=function(){return this};c.prototype.flatten=function(){this.parens=0;return this.simpleFlatten()};c.prototype.computeConstants=function(){return this};c.prototype.combineSimilar=function(){return this};c.prototype.expand=function(){return this};c.prototype.distribute=function(){return this};c.prototype.removeIdentity=
function(){return this};c.prototype.sort=function(){return this};c.prototype.spreadIdentity=function(){return this};c.prototype.stripIdentity=function(){return this};c.prototype.multiplyOne=function(e){null==e&&(e=!1);return(new CTATMultiplicationNode("TIMES",[new CTATConstantNode(1,e),this])).popNegation().pushNegation()};c.prototype.powerOne=function(e){null==e&&(e=!1);return(new CTATPowerNode("EXP",this,new CTATConstantNode(1,e))).popInversion().pushInversion().popNegation()};c.prototype.findGroup=
function(e,b){return e.find(function(a){var d,e;return(null!=(d=a[0])?d.equals(b[0]):void 0)||a[0]===(e=b[0])&&null===e})};c.prototype.compareFactors=function(e,b){return this.compareSigns(e,!b)||this.compare(e,b)};c.prototype.compare=function(e,b){return c.operatorPrecedence(this.operator,e.operator)};c.prototype.compareSigns=function(e,b){return(Math.sign(this.sign-e.sign)||Math.sign(this.exp-e.exp))*(b?-1:1)};c.prototype.countVariables=function(){return 0};c.prototype.pushNegation=function(){return this};
c.prototype.popNegation=function(){return this};c.prototype.pushInversion=function(){return this};c.prototype.popInversion=function(){return this};c.prototype.negate=function(){this.sign=-this.sign;return this};c.prototype.invert=function(){this.exp=-this.exp;return this};c.prototype.addition=function(){return"PLUS"===this.operator};c.prototype.subtraction=function(){return"MINUS"===this.operator};c.prototype.multiplication=function(){return"TIMES"===this.operator};c.prototype.division=function(){return"DIVIDE"===
this.operator};c.prototype.intDivision=function(){return"IDIVIDE"===this.operator};c.prototype.power=function(){return"EXP"===this.operator};c.prototype.root=function(){return"ROOT"===this.operator};c.prototype.negation=function(){return"UMINUS"===this.operator};c.prototype.unary=function(){var e;return"UPLUS"===(e=this.operator)||"UMINUS"===e};c.prototype.constant=function(e){return!1};c.prototype.unknown=function(){return!1};c.prototype.integer=function(){return!1};c.prototype.negated=function(){return 0>
this.sign};c.prototype.inverted=function(){return 0>this.exp};c.prototype.parented=function(){return 0<this.parens};c.prototype.even=function(){return!1};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATAlgebraTreeNode=c}).call(this);var CTATRelationNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,d,b,e,c,f){this.operator=a;this.left=d;this.right=b;this.parens=null!=e?e:0;this.sign=null!=c?c:1;this.exp=null!=f?f:1}g(b,e);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.left.clone():this.left,a?this.right.clone():this.right,this.parens,
this.sign,this.exp)};b.prototype.toString=function(a,d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,""+this.left.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.right.toString(this.operator),a,d)};b.prototype.addPaths=function(a){this.left.addPaths(a.concat(["left"]));this.right.addPaths(a.concat(["right"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);return this.applyOperator(this.left.evaluate(a),
this.right.evaluate(a))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};b.prototype.countOperands=function(){return 2};b.prototype.getOperator=function(a,d){return this.operator};b.prototype.getOperators=function(a){return this.left.getOperators().concat(this.getOperator(),this.right.getOperators())};b.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};b.prototype.getOperands=
function(){return[this.left,this.right]};b.prototype.findExpression=function(a,d){return this.left.findExpression(a,d.concat(["left"])).concat(b.__super__.findExpression.call(this,a,d),this.right.findExpression(a,d.concat(["right"])))};b.prototype.applyRules=function(a,d){this.rules=a;null==d&&(d=!0);d&&(this.left=this.left.applyRules(this.rules),this.right=this.right.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a,d;this.left=null!=
(a=this.left)?a.removeNull():void 0;this.right=null!=(d=this.right)?d.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};b.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATConstantNode(this.evaluate()):this};b.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator="LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=
[this.right,this.left];this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};b.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATRelationNode=c}).call(this);var CTATAdditionNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,d,b,e,c){this.operator=a;this.terms=d;this.parens=null!=b?b:0;this.sign=null!=e?e:1;this.exp=null!=c?c:1}g(b,e);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.terms.map(function(a){return a.clone()}):this.terms,this.parens,this.sign,this.exp)};
b.prototype.toString=function(a,d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,this.terms.reduce(function(a){return function(d,b){var e;e=d&&!b.negated()?a.operator:"";return""+d+CTATAlgebraTreeNode.toOperatorString(e)+b.toString(a.operator)}}(this),""),a,d)};b.prototype.addPaths=function(a){this.terms.forEach(function(d,b){return d.addPaths(a.concat([["terms",b]]))});return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);
return b.__super__.evaluate.call(this,this.terms.reduce(function(d){return function(b,e){return d.applyOperator(b,e.evaluate(a))}}(this),0))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(d,b){return d.equals(a.terms[b])})};b.prototype.subEquals=function(a,d){return this.operator===a.operator&&!a.negated()&&this.terms.length>=a.terms.length&&a.terms.every(function(a){return function(b,e){return b.equals(a.terms[d+
e])}}(this))};b.prototype.subNode=function(a,d){console.log(a,d);return null!=a?Object.assign(this.clone(!1),{terms:this.terms.slice(a,d)}):this};b.prototype.countOperands=function(){return this.terms.length};b.prototype.getOperator=function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)||null!=d&&this.terms[d].negated()&&"MINUS"||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.terms.slice(1).reduce(function(d){return function(b,
e,c){return b.concat(d.getOperator(a,c+1),e.getOperators())}}(this),this.terms[0].getOperators())};b.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(a){return function(a,b){return a.concat(b.getVariables())}}(this),this.terms[0].getVariables())};b.prototype.getOperands=function(){return this.terms.slice(0)};b.prototype.findExpression=function(a,d){return this.terms.slice(1).reduce(function(e){return function(c,f,g){return c.concat(b.__super__.findExpression.call(e,a,d,
g),f.findExpression(a,d.concat([["terms",g+1]])))}}(this),this.terms[0].findExpression(a,d.concat([["terms",0]])))};b.prototype.applyRules=function(a,d){this.rules=a;null==d&&(d=!0);d&&(this.terms=this.terms.map(function(a){return function(d){return d.applyRules(a.rules)}}(this)));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){this.terms=this.terms.map(function(a){return null!=a?a.removeNull():void 0}).filter(function(a){return a});return 1<this.terms.length?
this:this.terms[0]||null};b.prototype.checkIndices=function(a){var d;d=this.terms.length;return a.every(function(b,e){return null==b||0<=b&&b<d&&a.indexOf(b)===e})};b.prototype.selectOperands=function(a){return Object.assign(this.clone(!1),{terms:this.terms.filter(function(d,b){return a.includes(b)})})};b.prototype.replaceOperands=function(a,d,b){var e;(e=this.clone(!1)).terms=this.terms.slice(0);[].splice.apply(e.terms,[d,d-d+1].concat(a="PLUS"===a.operator?a.terms:a));a;b.forEach(function(a){var d;
return[].splice.apply(e.terms,[a,a-a+1].concat(d=[])),d});return e};b.prototype.simpleFlatten=function(){!this.terms[0].negation()||this.terms[0].inverted()||this.terms[0].parented()||(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(a,d){d.inverted()||d.parented()||!d.addition()?a.push(d):a.push.apply(a,d.pushNegation().terms);return a},[]);return this};b.prototype.flatten=function(){return b.__super__.flatten.apply(this,
arguments).pushNegation()};b.prototype.computeConstants=function(){var a,d;0<=(d=this.terms.findIndex(function(a){return a.constant()}))&&(a=this.terms[d].evaluate(),this.terms=this.terms.filter(function(b,e){return e<=d||!b.constant()||(a+=b.evaluate())&&!1}),0===a&&1<this.terms.length?this.terms.splice(d,1):this.terms[d]=new CTATConstantNode(a));return 1<this.terms.length?this:this.pushInversion().terms[0]};b.prototype.combineSimilar=function(){var a;a=[];this.terms.forEach(function(d){return function(b){var e,
c,f;f=b.constant()?[null,b]:(b=b.multiplyOne(),[b,b.factors.shift()]);return null!=(c=f[0])&&c.unknown()||!(e=d.findGroup(a,f))?a.push([f[0],f[1].evaluate()]):e[1]+=f[1].evaluate()}}(this));this.terms=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATConstantNode(b[1])).popNegation(),b[0]?(b[0].factors.unshift(b[1]),a.push(b[0].removeIdentity())):a.push(b[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATConstantNode(0));return this.pushInversion().terms[0]};
b.prototype.removeIdentity=function(a){var d;null==a&&(a=!1);d=this.terms.filter(function(d){return!d.constant(0,a)});this.terms=d.length?d:this.terms.slice(0,1);return 1<this.terms.length?this.pushNegation():this.pushInversion().terms[0]};b.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,d){return-a.compare(d,!0)});return this.stripIdentity()};b.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne(!0)});return this};
b.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity(!0)});return this};b.prototype.compare=function(a,d){var e;return b.__super__.compare.apply(this,arguments)||this.countVariables()-a.countVariables()||(e=null,this.terms.some(function(b,c){return e=b.compare(a.terms[c],d)})&&e)||this.compareSigns(a,d)};b.prototype.countVariables=function(){return this.terms.reduce(function(a,d){return a+d.countVariables()},0)};b.prototype.pushNegation=function(){this.negated()&&
(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};b.prototype.unknown=function(){return this.terms.some(function(a){return a.unknown()})};b.prototype.even=function(){return!this.inverted&&this.terms.every(function(a){return a.even()})};
return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATAdditionNode=c}).call(this);var CTATMultiplicationNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,d,b,e,c){this.operator=a;this.factors=d;this.parens=null!=b?b:0;this.sign=null!=e?e:1;this.exp=null!=c?c:1}g(b,e);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.factors.map(function(a){return a.clone()}):this.factors,this.parens,this.sign,
this.exp)};b.prototype.toString=function(a,d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,this.factors.reduce(function(a){return function(d,b){var e,c;b.inverted()?(b.invert(),e=b.toString("DIVIDE",d),b.invert()):e=b.toString(a.operator,d);c=d?b.inverted()?"DIVIDE":"DIVIDE"===a.operator||/^[\d+-]/.test(e)&&/\d$/.test(d)?a.operator:"":"";e=""===c&&b.negated()?"("+e+")":e;return""+d+CTATAlgebraTreeNode.toOperatorString(c)+e}}(this),"TIMES"===this.operator&&this.factors[0].inverted()?
"1":""),a,d)};b.prototype.addPaths=function(a){this.factors.forEach(function(d,b){return d.addPaths(a.concat([["factors",b]]))});return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){var d;null==a&&(a=null);d=this.factors.reduce(function(d){return function(b,e){return e.inverted()?b:d.applyOperator(b,e.evaluate(a,!1))}}(this),1);return b.__super__.evaluate.call(this,this.factors.reduce(function(d){return function(b,e){return e.inverted()?d.applyOperator(b,e.evaluate(a,
!1),!0):b}}(this),d))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.factors.length===a.factors.length&&this.factors.every(function(d,b){return d.equals(a.factors[b])})};b.prototype.subEquals=function(a,d){return this.operator===a.operator&&!a.inverted()&&this.factors.length>=a.factors.length&&a.factors.every(function(a){return function(b,e){return b.equals(a.factors[d+e])}}(this))};b.prototype.subNode=function(a,d){console.log(a,d);return null!=a?Object.assign(this.clone(!1),
{factors:this.factors.slice(a,d)}):this};b.prototype.countOperands=function(){return this.factors.length};b.prototype.getOperator=function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)||null!=d&&this.factors[d].inverted()&&"DIVIDE"||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.factors.slice(1).reduce(function(d){return function(b,e,c){return b.concat(d.getOperator(a,c+1),e.getOperators())}}(this),this.factors[0].getOperators())};
b.prototype.getVariables=function(){return this.factors.slice(1).reduce(function(a){return function(a,b){return a.concat(b.getVariables())}}(this),this.factors[0].getVariables())};b.prototype.getOperands=function(){return this.factors.slice(0)};b.prototype.findExpression=function(a,d){return this.factors.slice(1).reduce(function(e){return function(c,f,g){return c.concat(b.__super__.findExpression.call(e,a,d,g),f.findExpression(a,d.concat([["factors",g+1]])))}}(this),this.factors[0].findExpression(a,
d.concat([["factors",0]])))};b.prototype.applyRules=function(a,d){this.rules=a;null==d&&(d=!0);d&&(this.factors=this.factors.map(function(a){return function(d){return d.applyRules(a.rules)}}(this)));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){this.factors=this.factors.map(function(a){return null!=a?a.removeNull():void 0}).filter(function(a){return a});return 1<this.factors.length?this:this.factors[0]||null};b.prototype.checkIndices=function(a){var d;d=this.factors.length;
return a.every(function(b,e){return null==b||0<=b&&b<d&&a.indexOf(b)===e})};b.prototype.selectOperands=function(a){return Object.assign(this.clone(!1),{factors:this.factors.filter(function(d,b){return a.includes(b)})})};b.prototype.replaceOperands=function(a,d,b){var e;(e=this.clone(!1)).terms=this.factors.slice(0);[].splice.apply(e.factors,[d,d-d+1].concat(a="TIMES"===a.operator?a.factors:a));a;b.forEach(function(a){var d;return[].splice.apply(e.factors,[a,a-a+1].concat(d=[])),d});return e};b.prototype.simpleFlatten=
function(){this.division()&&this.factors[1].invert();this.operator="TIMES";this.factors=this.factors.reduce(function(a,d){d.parented()||!d.multiplication()?a.push(d):a.push.apply(a,d.pushNegation().pushInversion().factors);return a},[]);return this};b.prototype.flatten=function(){return b.__super__.flatten.apply(this,arguments).popNegation()};b.prototype.computeConstants=function(){var a,d,e;0<=(d=this.factors.findIndex(function(a){return a.constant()}))&&(a=new b("TIMES",[new CTATConstantNode(1)]),
this.factors=this.factors.filter(function(b,e){return e<d||!b.constant()||a.factors.push(b)&&!1}),1===(e=a.evaluate())&&0!==this.factors.length||this.factors.unshift(new CTATConstantNode(e)));return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};b.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(d){return function(b){var e,c,f,g,h;h=b.constant()?[null,b]:b.power()?b.exponent.constant()?(b.pushInversion(),[b.base,b.exponent]):(b.exponent=b.exponent.multiplyOne(),
[b,b.exponent.factors.shift()]):(b=b.powerOne(),[b.base,b.exponent]);return null!=(c=h[0])&&c.unknown()||!(e=d.findGroup(a,h))?a.push([h[0],(null!=(g=h[1])?g.evaluate():void 0)||1]):e[1]+=(null!=(f=h[1])?f.evaluate():void 0)||1}}(this));this.factors=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATConstantNode(b[1])).popNegation(),b[0]?b[1].constant(1)?a.push(b[0]):b[1].constant(-1)?a.push(b[0].invert()):b[0].power()?(b[0].exponent.factors.unshift(b[1]),a.push(b[0])):a.push((new CTATPowerNode("EXP",
b[0],b[1])).popInversion()):a.push(b[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATConstantNode(1));return this.pushNegation().pushInversion().factors[0]};b.prototype.distribute=function(){var a,b;a=this.factors.filter(function(a){return!a.inverted()});b=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(b)||this.single(a)&&b.length&&this.distributed(b)?(this.distributed(b)?
(a=this.distributeFactors(this.factors),b=[]):this.distributed(a)?(b=this.distributeFactors(this.factors),a=[]):(a=this.distributeFactors(a),b=this.distributeFactors(b)),this.factors=b.length?a.length?[this.packTerms(a),this.packTerms(b).invert()]:[this.packTerms(b).invert()]:[this.packTerms(a)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]):this};b.prototype.distributedOrSingle=function(a){return this.distributed(a)||this.single(a)};b.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};
b.prototype.single=function(a){return 1===a.length&&a[0].addition()};b.prototype.distributeFactors=function(a){var b;b=a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:[a]}):[[a[0]]];a.slice(1).forEach(function(a){var d;return a.addition()?1===b.length?b=a.terms.map(function(a){var d;d=b[0].map(function(a){return a.clone()});a.multiplication()?d.push.apply(d,a.pushNegation().factors):d.push(a);return d}):b=b.reduce(function(b,d){b.push.apply(b,a.terms.map(function(a){var b;
b=d.map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors.map(function(a){return a.clone()})):b.push(a.clone());return b}));return b},[]):1===b.length?a.multiplication()?(d=b[0]).push.apply(d,a.pushNegation().factors):b[0].push(a):b.forEach(function(d,e){var c;return a.multiplication()?(c=b[e]).push.apply(c,a.pushNegation().factors.map(function(a){return a.clone()})):b[e].push(a.clone())})});return b};b.prototype.packTerms=function(a){var d;d=CTATAlgebraTreeNode.diff(this.rules,
["flatten","distribute"]);return(new CTATAdditionNode("PLUS",a.map(function(a){return(new b("TIMES",a)).popNegation().applyRules(d,!1)}))).applyRules(d,!1)};b.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);this.popNegation();b=this.factors.filter(function(b){return!b.constant(1,a)});this.factors=b.length?b:this.factors.slice(0,1);(b=this.factors.find(function(b){return b.constant(0,a)}))&&this.factors.every(function(a){return!a.inverted()&&(!a.power()||a.exponent.constant())})&&(this.factors=
[b]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};b.prototype.sort=function(){this.factors=this.factors.sort(function(a,b){return a.compareFactors(b)});return this};b.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne(!0)});return this};b.prototype.stripIdentity=function(){this.factors=this.factors.map(function(a){return a.removeIdentity(!0)});return this.popNegation()};b.prototype.multiplyOne=function(a){null==a&&(a=
!1);this.factors[0].constant()||this.factors.unshift(new CTATConstantNode(1,a));return this.pushNegation()};b.prototype.compare=function(a,d){var e,c;return b.__super__.compare.apply(this,arguments)||this.countVariables()-a.countVariables()||(c=null,(e=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,b){return e[b]?c=a.compareFactors(e[b],d):c})&&c)||this.compareSigns(a,d)};b.prototype.countVariables=function(){return this.factors.reduce(function(a,b){return a+b.countVariables()},
0)};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};b.prototype.popNegation=function(){this.factors.forEach(function(a){return function(b){if(b.negated())return a.negate(),b.negate()}}(this));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};b.prototype.unknown=function(){return this.factors.some(function(a){return a.unknown()})};b.prototype.even=
function(){return!this.inverted()&&this.factors.every(function(a){return a.integer()})&&this.factors.some(function(a){return a.even()})};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATMultiplicationNode=c}).call(this);var CTATIntDivisionNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,b,e,c,f,g){this.operator=a;this.dividend=b;this.divisor=e;this.parens=null!=c?c:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(b,e);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.dividend.clone():this.dividend,a?this.divisor.clone():this.divisor,
this.parens,this.sign,this.exp)};b.prototype.toString=function(a,d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,""+this.dividend.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.divisor.toString(this.operator),a,d)};b.prototype.addPaths=function(a){this.dividend.addPaths(a.concat(["dividend"]));this.divisor.addPaths(a.concat(["divisor"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);
return b.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(a),this.divisor.evaluate(a)))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};b.prototype.countOperands=function(){return 2};b.prototype.getOperator=function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.dividend.getOperators().concat(this.getOperator(a),
this.divisor.getOperators())};b.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};b.prototype.getOperands=function(){return[this.dividend,this.divisor]};b.prototype.findExpression=function(a,d){return this.dividend.findExpression(a,d.concat(["dividend"])).concat(b.__super__.findExpression.call(this,a,d),this.divisor.findExpression(a,d.concat(["divisor"])))};b.prototype.applyRules=function(a,d){this.rules=a;null==d&&(d=!0);d&&(this.dividend=
this.dividend.applyRules(this.rules),this.divisor=this.divisor.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a,b;this.dividend=null!=(a=this.dividend)?a.removeNull():void 0;this.divisor=null!=(b=this.divisor)?b.removeNull():void 0;return null!=this.dividend&&null!=this.divisor?this:this.dividend||this.divisor||null};b.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATConstantNode(this.evaluate()):
this};b.prototype.removeIdentity=function(a){null==a&&(a=!1);return this.divisor.constant(1,a)?(this.intDivision()||(this.dividend=new CTATConstantNode(0,a)),this.pushNegation().pushInversion().dividend):this.popNegation()};b.prototype.compare=function(a,d){return b.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,d)||this.divisor.compare(a.divisor,d)||this.operator!==a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,d)};b.prototype.countVariables=function(){return this.dividend.countVariables()+
divisor.countVariables()};b.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};b.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};b.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};b.prototype.unknown=function(){return this.dividend.unknown()||this.divisor.unknown()};
b.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATIntDivisionNode=c}).call(this);var CTATUnaryNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,b,e,c,f){this.operator=a;this.base=b;this.parens=null!=e?e:0;this.sign=null!=c?c:1;this.exp=null!=f?f:1}g(b,e);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.base.clone():this.base,this.parens,this.sign,this.exp)};b.prototype.toString=function(a,
d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,""+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.base.toString(this.operator),a,d)};b.prototype.addPaths=function(a){this.base.addPaths(a.concat(["base"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a,d){null==a&&(a=null);null==d&&(d=!0);return b.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(a)),d)};b.prototype.equals=function(a){return b.__super__.equals.call(this,
a)&&this.base.equals(a.base)};b.prototype.countOperands=function(){return 1};b.prototype.getOperator=function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return[this.getOperator(a)].concat(this.base.getOperators())};b.prototype.getVariables=function(){return this.base.getVariables()};b.prototype.getOperands=function(){return[this.base]};b.prototype.findExpression=function(a,d){return this.base.findExpression(a,
d.concat(["base"])).concat(b.__super__.findExpression.call(this,a,d))};b.prototype.applyRules=function(a,d){this.rules=a;null==d&&(d=!0);d&&(this.base=this.base.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a;this.base=null!=(a=this.base)?a.removeNull():void 0;return null!=this.base?this:null};b.prototype.simpleFlatten=function(){if(this.parented())return this;this.negation()&&(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base};
b.prototype.flatten=function(){return b.__super__.flatten.apply(this,arguments).popNegation()};b.prototype.compare=function(a,d){return a.unary()&&this.base.compare(a.base,d)||b.__super__.compare.apply(this,arguments)||this.compareSigns(a,d)};b.prototype.countVariables=function(){return this.base.countVariables()};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return this.base.constant(a,b)};b.prototype.unknown=function(){return this.base.unknown()};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATUnaryNode=c}).call(this);var CTATPowerNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,b,e,c,f,g){this.operator=a;this.base=b;this.exponent=e;this.parens=null!=c?c:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(b,e);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.base.clone():this.base,a?this.exponent.clone():this.exponent,this.parens,
this.sign,this.exp)};b.prototype.toString=function(a,d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,""+this.base.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.exponent.toString(this.operator),a,d)};b.prototype.addPaths=function(a){this.base.addPaths(a.concat(["base"]));this.exponent.addPaths(a.concat(["exponent"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,
this.applyOperator(this.base.evaluate(a),this.exponent.evaluate(a)))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};b.prototype.countOperands=function(){return 2};b.prototype.getOperator=function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.base.getOperators().concat(this.getOperator(a),
this.exponent.getOperators())};b.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};b.prototype.getOperands=function(){return[this.base,this.exponent]};b.prototype.findExpression=function(a,d){return this.base.findExpression(a,d.concat(["base"])).concat(b.__super__.findExpression.call(this,a,d),this.exponent.findExpression(a,d.concat(["exponent"])))};b.prototype.applyRules=function(a,d){this.rules=a;null==d&&(d=!0);d&&(this.base=this.base.applyRules(this.rules),
this.exponent=this.exponent.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a,b;this.base=null!=(a=this.base)?a.removeNull():void 0;this.exponent=null!=(b=this.exponent)?b.removeNull():void 0;return null!=this.base&&null!=this.exponent?this:this.base||this.exponent||null};b.prototype.flatten=function(){var a,d;b.__super__.flatten.apply(this,arguments);this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();
return this.base.power()?(d=CTATAlgebraTreeNode.diff(this.rules,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATMultiplicationNode("TIMES",a)).applyRules(d,!1),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.computeConstants=function(){return this.base.constant()&&
(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATConstantNode(this.evaluate()),this.exponent=null,this.exp=1):(this.base=new CTATConstantNode((new b("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.powerOne=
function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};b.prototype.expand=function(){var a,b,e;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));
b=[this.base];e=1;for(a=a.evaluate();1<=a?e<a:e>a;1<=a?++e:--e)b.push(this.base.clone());this.base=(new CTATMultiplicationNode("TIMES",b)).applyRules(["distribute"],!1);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};b.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,
d){b.push.apply(b,a.exponent.terms.map(function(a){return[d.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),this.base=this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.packFactors=function(a){var d;d=CTATAlgebraTreeNode.diff(this.rules,["flatten"]);return new CTATMultiplicationNode("TIMES",a.map(function(a){return(new b("EXP",a[0],a[1])).applyRules(d,!1)}))};b.prototype.removeIdentity=function(a){null==
a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};b.prototype.compare=function(a,d){return b.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(d?-1:1)||this.exponent.compare(a.exponent,
d)||this.base.compare(a.base,d)||this.compareSigns(a,d)};b.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};b.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};b.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};b.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};b.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};b.prototype.unknown=function(){return this.base.unknown()||this.exponent.unknown()};b.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};
return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATPowerNode=c}).call(this);var CTATVariableNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,b,e,c,f){this.variableTable=a;this.variable=b;this.parens=null!=e?e:0;this.sign=null!=c?c:1;this.exp=null!=f?f:1;this.operator="VAR"}g(b,e);b.prototype.clone=function(){return new b(this.variableTable,this.variable,this.parens,this.sign,this.exp)};b.prototype.toString=function(a,
d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,this.variable,a,d)};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,null!=a?("function"===typeof a.get?a.get(this.variable):void 0)||a[this.variable]:null!=this.variableTable?this.variableTable.get(this.variable):function(){try{return eval(this.variable)}catch(d){}}.call(this))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.variable===a.variable};b.prototype.getOperator=
function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)};b.prototype.getVariables=function(){return[this.variable]};b.prototype.compare=function(a,d){d=null!=d?-1:1;return b.__super__.compare.apply(this,arguments)||this.variable>a.variable&&d||this.variable<a.variable&&-d||this.compareSigns(a,d)};b.prototype.countVariables=function(){return 1};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATVariableNode=
c}).call(this);var CTATConstantNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,b,e,c,f){this.value=a;this.marked=null!=b?b:!1;this.parens=null!=e?e:0;this.sign=null!=c?c:1;this.exp=null!=f?f:1;this.operator="CONST"}g(b,e);b.prototype.clone=function(){return new b(this.value,this.marked,this.parens,this.sign,this.exp)};b.prototype.toString=function(a,
d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,this.value.toString(),a,d)};b.prototype.evaluate=function(a,d){null==d&&(d=!0);return b.__super__.evaluate.call(this,this.value,d)};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.value===a.value};b.prototype.getOperator=function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)};b.prototype.multiplyOne=function(){return this};b.prototype.powerOne=
function(){return this};b.prototype.compare=function(a,d){d=null!=d?1:-1;return b.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*d||this.compareSigns(a,d)};b.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return null==a||this.evaluate()===a&&this.marked===b};b.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};b.prototype.even=
function(){return 0===this.evaluate()%2};b.prototype.set=function(a){this.exp=1;this.value=Math.abs(a);return this.sign=Math.sign(a)};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATConstantNode=c}).call(this);var CTATUnknownNode={};
(function(){var c,g=function(e,b){function a(){this.constructor=e}for(var d in b)f.call(b,d)&&(e[d]=b[d]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e},f={}.hasOwnProperty;c=function(e){function b(a,b,e){this.parens=null!=a?a:0;this.sign=null!=b?b:1;this.exp=null!=e?e:1;this.operator="UNKNOWN"}g(b,e);b.prototype.clone=function(){return new b(this.parens,this.sign,this.exp)};b.prototype.toString=function(a,d){null==a&&(a="EQUAL");null==d&&(d=!1);return b.__super__.toString.call(this,
"?",a,d)};b.prototype.evaluate=function(a){return NaN};b.prototype.getOperator=function(a,d){null==a&&(a=!1);null==d&&(d=null);return a&&b.__super__.getOperator.apply(this,arguments)};b.prototype.compare=function(a,d){d=null!=d?1:-1;return b.__super__.compare.apply(this,arguments)||this.compareSigns(a,d)};b.prototype.unknown=function(){return!0};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATUnknownNode=c}).call(this);var CTATAlgebraGrammar=function(){function c(){this.yy={}}var g=function(a,b,d,e){d=d||{};for(e=a.length;e--;d[a[e]]=b);return d},f=[1,6],e=[1,7],b=[1,10],a=[1,11],d=[1,12],h=[1,13],l=[1,14],m=[1,22],n=[1,23],p=[5,7,8,9,10,11,12,13,15,26],r=[1,24],u=[1,25],w=[1,27],q=[1,28],y=[5,7,8,9,10,11,12,13,15,16,18,20,21,24,25,26,27,28,29],z=[5,7,8,9,10,11,12,13,15,16,18,20,21,23,24,25,26,27,28,29],g={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,
GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedfactor:17,DIVIDE:18,factor:19,IDIVIDE:20,REM:21,atom:22,EXP:23,SQRT:24,LPAREN:25,RPAREN:26,VARIABLE:27,NUMBER:28,UNKNOWN:29,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",20:"IDIVIDE",21:"REM",23:"EXP",24:"SQRT",25:"LPAREN",26:"RPAREN",27:"VARIABLE",28:"NUMBER",29:"UNKNOWN"},productions_:[0,[3,2],[4,
3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[19,3],[19,2],[19,1],[22,3],[22,1],[22,1],[22,1]],performAction:function(a,b,d,e,c,f,g){a=f.length-1;switch(c){case 1:return f[a-1];case 2:this.$=new e.CTATRelationNode("LESS",f[a-2],f[a]);break;case 3:this.$=new e.CTATRelationNode("GREATER",f[a-2],f[a]);break;case 4:this.$=new e.CTATRelationNode("LESSEQUAL",f[a-2],f[a]);break;case 5:this.$=new e.CTATRelationNode("GREATEREQUAL",
f[a-2],f[a]);break;case 6:this.$=new e.CTATRelationNode("EQUAL",f[a-2],f[a]);break;case 7:this.$=new e.CTATRelationNode("NOTEQUAL",f[a-2],f[a]);break;case 8:case 11:case 17:case 20:case 23:this.$=f[a];break;case 9:this.$=new e.CTATAdditionNode("PLUS",[f[a-2],f[a]]);break;case 10:this.$=new e.CTATAdditionNode("MINUS",[f[a-2],f[a]]);break;case 12:this.$=new e.CTATMultiplicationNode("TIMES",[f[a-2],f[a]]);break;case 13:this.$=new e.CTATMultiplicationNode("DIVIDE",[f[a-2],f[a]]);break;case 14:this.$=
new e.CTATMultiplicationNode("ITIMES",[f[a-1],f[a]]);break;case 15:this.$=new e.CTATIntDivisionNode("IDIVIDE",f[a-2],f[a]);break;case 16:this.$=new e.CTATIntDivisionNode("REM",f[a-2],f[a]);break;case 18:this.$=new e.CTATUnaryNode("UPLUS",f[a]);break;case 19:this.$=new e.CTATUnaryNode("UMINUS",f[a]);break;case 21:this.$=new e.CTATPowerNode("EXP",f[a-2],f[a]);break;case 22:this.$=new e.CTATPowerNode("ROOT",f[a],new e.CTATConstantNode(2));break;case 24:this.$=f[a-1].setParens();break;case 25:this.$=
new e.CTATVariableNode(e.variableTable,f[a]);break;case 26:this.$=new e.CTATConstantNode(Number(f[a]));break;case 27:this.$=new e.CTATUnknownNode}},table:[{3:1,4:2,6:3,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{1:[3]},{5:[1,15]},{5:[2,8],7:[1,16],8:[1,17],9:[1,18],10:[1,19],11:[1,20],12:[1,21],13:m,15:n},g(p,[2,11],{22:9,19:26,16:r,18:u,20:w,21:q,24:b,25:a,27:d,28:h,29:l}),g(y,[2,17]),{13:f,15:e,17:29,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{13:f,15:e,17:30,19:8,22:9,24:b,25:a,27:d,28:h,
29:l},g(y,[2,20]),g(y,[2,23],{23:[1,31]}),{13:f,15:e,17:32,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{6:33,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},g(z,[2,25]),g(z,[2,26]),g(z,[2,27]),{1:[2,1]},{6:34,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{6:35,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{6:36,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{6:37,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{6:38,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,
28:h,29:l},{6:39,13:f,14:4,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{13:f,14:40,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{13:f,14:41,15:e,17:5,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{13:f,15:e,17:42,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{13:f,15:e,17:43,19:8,22:9,24:b,25:a,27:d,28:h,29:l},g(y,[2,14]),{13:f,15:e,17:44,19:8,22:9,24:b,25:a,27:d,28:h,29:l},{13:f,15:e,17:45,19:8,22:9,24:b,25:a,27:d,28:h,29:l},g(y,[2,18]),g(y,[2,19]),{13:f,15:e,17:46,19:8,22:9,24:b,25:a,27:d,28:h,29:l},g(y,[2,22]),
{13:m,15:n,26:[1,47]},{5:[2,2],13:m,15:n},{5:[2,3],13:m,15:n},{5:[2,4],13:m,15:n},{5:[2,5],13:m,15:n},{5:[2,6],13:m,15:n},{5:[2,7],13:m,15:n},g(p,[2,9],{22:9,19:26,16:r,18:u,20:w,21:q,24:b,25:a,27:d,28:h,29:l}),g(p,[2,10],{22:9,19:26,16:r,18:u,20:w,21:q,24:b,25:a,27:d,28:h,29:l}),g(y,[2,12]),g(y,[2,13]),g(y,[2,15]),g(y,[2,16]),g(y,[2,21]),g(z,[2,24])],defaultActions:{15:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else{var d=function(a,b){this.message=a;this.hash=b};d.prototype=
Error;throw new d(a,b);}},parse:function(a){var b=[0],d=[null],e=[],c=this.table,f="",g=0,h=0,m=0,l=e.slice.call(arguments,1),n=Object.create(this.lexer),p={},q;for(q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p[q]=this.yy[q]);n.setInput(a,p);p.lexer=n;p.parser=this;"undefined"==typeof n.yylloc&&(n.yylloc={});q=n.yylloc;e.push(q);var y=n.options&&n.options.ranges;this.parseError="function"===typeof p.parseError?p.parseError:Object.getPrototypeOf(this).parseError;for(var r,w,u,B,
z={},T,O;;){u=b[b.length-1];if(this.defaultActions[u])B=this.defaultActions[u];else{if(null===r||"undefined"==typeof r)r=n.lex()||1,"number"!==typeof r&&(r=this.symbols_[r]||r);B=c[u]&&c[u][r]}if("undefined"===typeof B||!B.length||!B[0]){var U;O=[];for(T in c[u])this.terminals_[T]&&2<T&&O.push("'"+this.terminals_[T]+"'");U=n.showPosition?"Parse error on line "+(g+1)+":\n"+n.showPosition()+"\nExpecting "+O.join(", ")+", got '"+(this.terminals_[r]||r)+"'":"Parse error on line "+(g+1)+": Unexpected "+
(1==r?"end of input":"'"+(this.terminals_[r]||r)+"'");this.parseError(U,{text:n.match,token:this.terminals_[r]||r,line:n.yylineno,loc:q,expected:O})}if(B[0]instanceof Array&&1<B.length)throw Error("Parse Error: multiple actions possible at state: "+u+", token: "+r);switch(B[0]){case 1:b.push(r);d.push(n.yytext);e.push(n.yylloc);b.push(B[1]);r=null;w?(r=w,w=null):(h=n.yyleng,f=n.yytext,g=n.yylineno,q=n.yylloc,0<m&&m--);break;case 2:O=this.productions_[B[1]][1];z.$=d[d.length-O];z._$={first_line:e[e.length-
(O||1)].first_line,last_line:e[e.length-1].last_line,first_column:e[e.length-(O||1)].first_column,last_column:e[e.length-1].last_column};y&&(z._$.range=[e[e.length-(O||1)].range[0],e[e.length-1].range[1]]);u=this.performAction.apply(z,[f,h,g,p,B[1],d,e].concat(l));if("undefined"!==typeof u)return u;O&&(b=b.slice(0,-2*O),d=d.slice(0,-1*O),e=e.slice(0,-1*O));b.push(this.productions_[B[1]][0]);d.push(z.$);e.push(z._$);B=c[b[b.length-2]][b[b.length-1]];b.push(B);break;case 3:return!0}}}},f=function(){return{EOF:1,
parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;
this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,d=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,
this.matched.length-1);d.length-1&&(this.yylineno-=d.length-1);var e=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:d?(d.length===a.length?this.yylloc.first_column:0)+a[a.length-d.length].length-d[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=
!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=
this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var d,e;this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,
matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(e.yylloc.range=this.yylloc.range.slice(0)));if(d=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=d.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+
a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];d=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(d)return d;if(this._backtrack)for(var c in e)this[c]=e[c];return!1},next:function(){if(this.done)return this.EOF;
this._input||(this.done=!0);var a,b,d;this._more||(this.match=this.yytext="");for(var e=this._currentRules(),c=0;c<e.length;c++)if((b=this._input.match(this.rules[e[c]]))&&(!a||b[0].length>a[0].length))if(a=b,d=c,this.options.backtrack_lexer){a=this.test_match(b,e[c]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,e[d]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+
this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=
this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,d,e){switch(d){case 1:return 25;case 2:return 26;case 3:return 23;case 4:return 23;case 5:return 24;case 6:return 24;case 7:return 16;case 8:return 16;case 9:return 16;case 10:return 20;case 11:return 18;case 12:return 18;case 13:return 21;case 14:return 15;case 15:return 13;
case 16:return 9;case 17:return 9;case 18:return 10;case 19:return 10;case 20:return 7;case 21:return 8;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 12;case 26:return 11;case 27:return 11;case 28:return 28;case 29:return 28;case 30:return 27;case 31:return 29;case 32:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\u22c5)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,
/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:([A-Za-z]))/,/^(?:\?)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!0}}}}();g.lexer=f;c.prototype=g;g.Parser=c;return new c}();var CTATAlgebraParser={};
(function(){var c,g=[].slice;c=function(){function c(e){this.parser=new CTATAlgebraGrammar.Parser;this.parser.yy={CTATRelationNode:CTATRelationNode,CTATAdditionNode:CTATAdditionNode,CTATMultiplicationNode:CTATMultiplicationNode,CTATIntDivisionNode:CTATIntDivisionNode,CTATUnaryNode:CTATUnaryNode,CTATPowerNode:CTATPowerNode,CTATVariableNode:CTATVariableNode,CTATConstantNode:CTATConstantNode,CTATUnknownNode:CTATUnknownNode,CTATAlgebraTreeNode:CTATAlgebraTreeNode};this.parser.yy.variableTable=e}c.partial=
["flatten","removeIdentity"];c.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");c.prototype.toTree=function(e,b,a,d){null==b&&(b=!1);null==a&&(a=!1);null==d&&(d=!1);return(e instanceof CTATAlgebraTreeNode?a?e.clone():e:this.parser.parse(String(e))).applyRules([d?"flatten":"simpleFlatten"].concat(b?"sort":[]))};c.prototype.toExpression=function(e,b,a){null==a&&(a=!0);return e instanceof CTATAlgebraTreeNode?a&&b instanceof CTATAlgebraTreeNode?b.addPaths(b.path||
[]):b:null!=b?b.toString():b};c.prototype.equalExpressions=function(e,b){return e instanceof CTATAlgebraTreeNode||b instanceof CTATAlgebraTreeNode?e.toString()===b.toString():e===b};c.prototype.algParse=function(e,b,a){null==b&&(b=!1);null==a&&(a=!1);try{return this.toTree(e,b,!0,a).addPaths([])}catch(d){return null}};c.prototype.algGetError=function(e){try{return e instanceof CTATAlgebraTreeNode||this.parser.parse(String(e)),null}catch(b){return b}};c.prototype.algStringify=function(e){return(null!=
e?e.toString():void 0)||null};c.prototype.algEvaluate=function(e,b){null==b&&(b=null);try{return this.toTree(e).evaluate(b)}catch(a){return null}};c.prototype.algSort=function(e){try{return this.toExpression(e,this.toTree(e,!0,!0))}catch(b){return null}};c.prototype.algGetOperator=function(e){try{return this.toTree(e).getOperator(!0,1)}catch(b){return null}};c.prototype.algGetOperators=function(e){try{return this.toTree(e).getOperators(!0)}catch(b){return null}};c.prototype.algGetVariables=function(e){try{return this.toTree(e).getVariables()}catch(b){return null}};
c.prototype.algGetOperands=function(e){var b;try{return null!=(b=this.toTree(e))?b.getOperands().map(function(a){return function(b){return a.toExpression(e,b,!1)}}(this)):void 0}catch(a){return null}};c.prototype.algGetExpression=function(e,b,a){try{return this.toExpression(e,this.toTree(e).getExpression(b,a),!1)}catch(d){return null}};c.prototype.algFindExpression=function(e,b){try{return this.toTree(e).findExpression(this.toTree(b),[]).map(function(a){return function(b){return a.toExpression(e,
b,!1)}}(this))}catch(a){return null}};c.prototype.algCreateExpression=function(){var e,b,a,d;a=arguments[0];e=arguments[1];b=3<=arguments.length?g.call(arguments,2):[];try{return this.toExpression(e,(d=this.toTree(e,!1,!0)).createExpression.apply(d,[a].concat(g.call(b.map(function(a){return function(b){return a.toTree(b,!1,!0)}}(this))))))}catch(h){return null}};c.prototype.algReplaceExpression=function(e,b,a,d){var c,f;null==d&&(d=null);d=(null!=d?d:null!=(c=b.path)?c.slice(0):void 0)||0;try{return this.toExpression(e,
null!=(f=this.toTree(e))?f.replaceExpression(this.toTree(b),this.toTree(a),d):void 0)}catch(m){return null}};c.prototype.algDeleteExpression=function(e,b,a){var d,c;null==a&&(a=null);a=(null!=a?a:null!=(d=b.path)?d.slice(0):void 0)||0;try{return this.toExpression(e,null!=(c=this.toTree(e))?c.deleteExpression(this.toTree(b),a):void 0)}catch(l){return null}};c.prototype.algApplyRulesSelectively=function(){var e,b,a,d,c,f;e=arguments[0];f=arguments[1];b=arguments[2];a=arguments[3];d=5<=arguments.length?
g.call(arguments,4):[];null==b&&(b=!0);null==a&&(a=null);try{return this.toExpression(e,(c=this.toTree(e,!1,!0)).applyRulesSelectively.apply(c,[f,b,a].concat(g.call(d))))}catch(m){return null}};c.prototype.algApplyRules=function(e,b,a){null==a&&(a=!0);try{return this.toExpression(e,this.toTree(e,!1,!0).applyRules(b,a))}catch(d){return null}};c.prototype.algPartiallySimplify=function(e,b){null==b&&(b=!1);return this.algApplyRules(e,c.partial.concat(b?"sort":[]),!0)};c.prototype.algSimplify=function(e,
b){null==b&&(b=!1);return this.algApplyRules(e,c.full.concat(b?"sort":[]),!0)};c.prototype.algValid=function(e,b){var a,d;null==b&&(b=!1);return null!=(a=this.algParse(e,!0))&&null!=(d=this.algParse(e,!b))?this.equalExpressions(a,d):null};c.prototype.algValued=function(e,b){var a;null==b&&(b=null);return null!=(a=this.algEvaluate(e,b))?!isNaN(a):null};c.prototype.algPartiallySimplified=function(e,b){var a,d;null==b&&(b=!1);return null!=(a=this.algPartiallySimplify(e,!0))&&null!=(d=this.algParse(e,
!b))?this.equalExpressions(a,d):null};c.prototype.algSimplified=function(e,b){var a,d;null==b&&(b=!1);return null!=(a=this.algSimplify(e,!0))&&null!=(d=this.algParse(e,!b))?this.equalExpressions(a,d):null};c.prototype.algIdentical=function(e,b,a,d){null==a&&(a=!1);null==d&&(d=!1);return null!=(e=this.algParse(e,!a,d))&&null!=(b=this.algParse(b,!a,d))?this.equalExpressions(e,b):null};c.prototype.algEqual=function(e,b,a){var d,c;null==a&&(a=null);return null!=(d=this.algEvaluate(e,a))&&null!=(c=this.algEvaluate(b,
a))?d===c:null};c.prototype.algPartiallyEquivalent=function(e,b,a){null==a&&(a=!1);return null!=(e=this.algPartiallySimplify(e,!a))&&null!=(b=this.algPartiallySimplify(b,!a))?this.equalExpressions(e,b):null};c.prototype.algEquivalent=function(e,b,a){null==a&&(a=!1);return null!=(e=this.algSimplify(e,!a))&&null!=(b=this.algSimplify(b,!a))?this.equalExpressions(e,b):null};c.prototype.isAlgValid=c.prototype.algValid;c.prototype.algEval=c.prototype.algEvaluate;c.prototype.algStrictEquivTermsSameOrder=
function(e,b){return this.algPartiallyEquivalent(e,b,!0)};c.prototype.algEquivTermsSameOrder=c.prototype.algStrictEquivTermsSameOrder;c.prototype.algStrictEquivTerms=c.prototype.algPartiallyEquivalent;c.prototype.algEquivTerms=c.prototype.algStrictEquivTerms;c.prototype.algEquiv=c.prototype.algEquivalent;c.prototype.isSimplified=function(e){return this.algSimplified(e,!0)};c.prototype.calc=c.prototype.algEvaluate;c.prototype.calca=function(e){return(+this.algEvaluate(e)).toFixed(2)};c.prototype.simplify=
function(e){return this.algSimplify(e,!0)};c.prototype.algebraicEqual=c.prototype.algEqual;c.prototype.patternMatches=function(e,b){return this.algIdentical(e,b,!0)};c.prototype.polyTermsEqual=function(e,b){return this.algPartiallyEquivalent(e,b)};c.prototype.algebraicMatches=function(e,b){return this.algEquivalent(e,b,!0)};c.prototype.expressionMatches=c.prototype.algebraicMatches;return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATAlgebraParser=c}).call(this);var CTATLogicTreeNode={};
(function(){var c,g=[].slice;c=function(){function c(){var e,b;null!=this.string?c.operatorStrings[null!=(e=this.value)?e:this.operator]=this.string:this.string=c.operatorStrings[null!=(b=this.value)?b:this.operator]}c.operators=[["CONST"],["VAR"],["NOT"],["AND","NAND"],["OR","NOR"],["IF"],["IFF","XOR"]];c.operatorStrings={NOT:"\u00ac",AND:"\u2227",OR:"\u2228",NAND:"\u22bc",NOR:"\u22bd",XOR:"\u2295",IF:"\u2192",IFF:"\u2194","true":"\u22a4","false":"\u22a5"};c.toOperatorString=function(c){return this.operatorStrings[c]||
""};c.diff=function(c,b){return c.filter(function(a){return!b.includes(a)})};c.uniq=function(c){return g.call(new Set(c))};c.removeIndex=function(c,b){var a;c=c.slice(0);[].splice.apply(c,[b,b-b+1].concat(a=[]));a;return c};c.difference=function(c,b){return c.filter(function(a){return!b.some(function(b){return b===a})})};c.intersection=function(c){return c[0].filter(function(b){return c.every(function(a){return a.some(function(a){return a.equals(b)})})})};c.commonLength=function(c){var b;b=null;return c.every(function(a){return(null!=
b?b:b=a.length)===a.length})&&b};c.sameNegation=function(c){return 2===c.length&&c[0].negationNode()===c[1].negationNode()};c.oppositeNegation=function(c){return 2===c.length&&c[0].negationNode()!==c[1].negationNode()};c.replaceTerms=function(c,b,a){var d,e,f,g,n;g=[];d=0;for(e=c.length;d<e;d++)n=c[d],(!(f=b.find(function(a){return a[0]===n}))||a&&(n=n.junctionNode(this.removeIndex(n.terms,f[1]))))&&g.push(n);return g};c.prototype.addOperand=function(c,b,a){null==a&&(a=null);return new CTATLogicFlattenNode(c,
[this,b],a)};c.prototype.setParens=function(){this.parens=!0;return this};c.prototype.checkParens=function(){var c;return"NOT"===(c=this.operator)||"VAR"===c||"CONST"===c||this.parens};c.prototype.toString=function(e,b,a,d){null==b&&(b=!1);null==a&&(a=null);null==d&&(d=!1);this.addParens(b,a,d)&&(e="("+e+")");this.negated&&(e=""+c.operatorStrings.NOT+e);return e};c.prototype.addParens=function(c,b,a){return(null!=this.left||null!=this.terms)&&null!=b&&(c||this.precedence()>b.precedence()||a&&this.precedence()===
b.precedence())};c.prototype.operatorString=function(){return""+(this.binaryOp()?" ":"")+this.string+(this.binaryOp()?" ":"")};c.prototype.evaluate=function(c){return this.negated?applyOperator("NOT",c):c};c.prototype.applyOperator=function(c,b,a){switch(c){case "NOT":if(null!=b)return!b;break;case "AND":return null!=b?b&&a:a&&b;case "OR":return null!=b?b||a:a||b}};c.prototype.equals=function(c,b){return c&&this.operator===c.operator&&b!==(this.negated===c.negated)};c.prototype.inverse=function(c){return this.negationOp()?
this.right.equals(c):c.negationOp()?this.equals(c.right):!1};c.prototype.subEquals=function(c,b){return!1};c.prototype.subNode=function(c,b){return this};c.prototype.countOperands=function(){return 0};c.prototype.getOperator=function(c){null==c&&(c=!1);return!c&&this.operator||this.string};c.prototype.getOperators=function(c){return[]};c.prototype.getVariables=function(){return[]};c.prototype.getOperands=function(){return[]};c.prototype.getExpression=function(c,b){null==c&&(c=0);null==b&&(b=this.countOperands()-
1);return b<=this.countOperands()-1&&1<=b-c&&this.subNode(c,b+1)||null};c.prototype.findOperator=function(c,b,a,d){null==a&&(a=null);null==d&&(d="none");return a||this.operator!==c||null!=this.terms&&2!==this.terms.length&&"none"!==d?null!=a&&this.operator===c&&"none"!==d?(a="left"===d?[0,a+2]:[a,this.terms.length],c=a[0],a=a[1],[Object.assign(this.subNode(c,a),{path:b.concat([[c,a]])})]):[]:[Object.assign(this,{path:b})]};c.prototype.findExpression=function(c,b,a){var d;null==a&&(a=null);return!a&&
this.equals(c)?[Object.assign(this,{path:b})]:null!=a&&this.subEquals(c,a)?[Object.assign(this.subNode(a,d=a+c.terms.length),{path:b.concat([[a,d]])})]:[]};c.prototype.findRule=function(c,b,a,d){null==a&&(a=!1);null==d&&(d=null);return!d&&this.testRule(c,a)?[Object.assign(this,{path:b})]:null!=d&&this.testRule(c,a,d)?[Object.assign(this.subNode(d,d+2),{path:b.concat([[d,d+2]])})]:[]};c.prototype.createExpression=function(){var c,b;b=arguments[0];c=2<=arguments.length?g.call(arguments,1):[];switch(b){case "NAND":case "NOR":case "XOR":case "IF":case "IFF":return c[0]&&
new CTATLogicRelationNode(b,this,c[0])||null;case "AND":case "OR":return 1<c.unshift(this)&&new CTATLogicFlattenNode(b,c)||null;case "NOT":return new CTATLogicRelationNode(b,null,this)}};c.prototype.replaceExpression=function(c,b,a){var d,e,f,g,n;"number"===typeof a&&(c=this.findExpression(c,[])[a])&&(a=c.path,delete c.path);if(0===(null!=a?a.length:void 0))return b;if(null!=(n=null!=a?a.shift():void 0))return d=this.clone(!1),"string"===typeof n?(d[n]=null!=(e=this[n])?e.replaceExpression(c,b,a):
void 0,d):"number"===typeof n?(d.terms=d.terms.slice(0),d.terms[n]=null!=(f=this.terms[n])?f.replaceExpression(c,b,a):void 0,d):"object"===typeof n?(d.terms=d.terms.slice(0),[].splice.apply(d.terms,[g=n[0],n[1]-g].concat(b)),b,d):this};c.prototype.deleteExpression=function(c,b){var a,d,e,f,g;"number"===typeof b&&(c=this.findExpression(c,[])[b])&&(b=c.path,delete c.path);if(0===(null!=b?b.length:void 0))return null;if(null!=(g=null!=b?b.shift():void 0))return a=this.clone(!1),"string"===typeof g?(a[g]=
null!=(d=this[g])?d.deleteExpression(c,b):void 0,a.removeNull()):"number"===typeof g?(a.terms=a.terms.slice(0),a.terms[g]=null!=(e=this.terms[g])?e.deleteExpression(c,b):void 0,a.removeNull()):"object"===typeof g?(a.terms=a.terms.slice(0),[].splice.apply(a.terms,[f=g[0],g[1]-f].concat(null)),null,a.removeNull()):this};c.prototype.removeNull=function(){return this};c.prototype.applyTests=function(c){return c.every(function(b){return function(a){return b[a]()}}(this))};c.prototype.applyRules=function(c,
b,a){null==b&&(b=!1);null==a&&(a=!1);a=("string"===typeof c?[c]:c).reduce(function(a,e){a.rules=c;return a=a[e](b)},this);delete a.rules;return a};c.prototype.testRule=function(c,b,a){null==b&&(b=!1);null==a&&(a=null);return this.subNode(a)[c](b,!0)};c.prototype.findCounterExample=function(e){return this.checkExpressions(e,c.uniq(this.getVariables().concat(e.getVariables())),{})};c.prototype.checkExpressions=function(c,b,a){var d,e;if(b.length)return this.checkExpressions(c,b.slice(1),Object.assign(a,
(d={},d[""+b[0]]=!0,d)))||this.checkExpressions(c,b.slice(1),Object.assign(a,(e={},e[""+b[0]]=!1,e)));if(this.evaluate(a)!==c.evaluate(a))return a};c.prototype.truth=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.domination=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.negation=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.identity=function(c,b){null==c&&(c=!1);null==b&&(b=!1);return c?b||new CTATLogicFlattenNode("OR",this,new CTATLogicConstantNode(!0)):!b&&this};
c.prototype.idempotence=function(c,b){null==c&&(c=!1);null==b&&(b=!1);return c?b||new CTATLogicFlattenNode("OR",[this,this]):!b&&this};c.prototype.absorption=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.inverseAbsorption=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.commutativity=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.associativity=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.distributivity=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.deMorgan=
function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.doubleNegation=function(c,b){null==c&&(c=!1);null==b&&(b=!1);return c&&!this.negationOp()?b||this.negateNode().negateNode():!b&&this};c.prototype.implication=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.biimplication=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.biimplicationToImplication=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.exclusiveDisjunction=function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.exclusiveDisjunctionToImplication=
function(c,b){null==b&&(b=!1);return!b&&this};c.prototype.findPairs=function(c,b,a){var d,e,f,g,n;g=[];d=0;for(f=b.length;d<f;d++)n=b[d],n.operator===c&&-1!==(e=n.terms.findIndex(function(b){return function(d){return d[a](b)}}(this)))&&g.push([n,e]);return g};c.prototype.normalFormOperators=function(){var c;return"NOT"===(c=this.operator)||"AND"===c||"OR"===c||"VAR"===c||"CONST"===c};c.prototype.atomicNegation=function(){return!0};c.prototype.atomicConjunction=function(){return!0};c.prototype.atomicDisjunction=
function(){return!0};c.prototype.replaceNodes=function(){return this};c.prototype.flatten=function(){return this};c.prototype.pushNegation=function(){return this};c.prototype.distributeDisjunction=function(){return this};c.prototype.distributeConjunction=function(){return this};c.prototype.sort=function(){return this};c.prototype.absorb=function(){return this};c.prototype.compare=function(c){return Math.sign(this.countLevels()-c.countLevels()||this.precedence(!0)-c.precedence(!0)||this.countVariables()-
c.countVariables())};c.prototype.compareNegations=function(c){return this.negationNode()-c.negationNode()};c.prototype.precedence=function(e){null==e&&(e=!1);return c.operators.findIndex(function(b){return function(a){return a.includes(b.operator)}}(this))};c.prototype.countVariables=function(){return 0};c.prototype.countLevels=function(){return 0};c.prototype.invertOperator=function(){this.operator=this.inverseOperator();this.string=c.operatorStrings[this.operator];return this};c.prototype.inverseOperator=
function(){return this.conjunctionOp()?"OR":this.disjunctionOp()?"AND":this.operator};c.prototype.negateNode=function(){return new CTATLogicRelationNode("NOT",null,this)};c.prototype.unnegateNode=function(){return this.negationOp()?this.right:this};c.prototype.unnegateOperator=function(){return this.negativeConjunctionOp()?"AND":this.negativeDisjunctionOp()?"OR":this.operator};c.prototype.negationNode=function(){return this.negationOp()&&!this.right.negationNode()||this.negated};c.prototype.negate=
function(){this.negated&&this.setSteps(this.steps+1);this.negated=!this.negated;return this};c.prototype.setSteps=function(c){isNaN(c)||(this.steps=c);return this};c.prototype.atomic=function(){var c,b;return"VAR"===(c=this.operator)||"CONST"===c||"NOT"===this.operator&&("VAR"===(b=this.right.operator)||"CONST"===b)};c.prototype.negationOp=function(){return"NOT"===this.operator};c.prototype.conjunctionOp=function(){return"AND"===this.operator};c.prototype.disjunctionOp=function(){return"OR"===this.operator};
c.prototype.negativeConjunctionOp=function(){return"NAND"===this.operator};c.prototype.negativeDisjunctionOp=function(){return"NOR"===this.operator};c.prototype.junctionOp=function(){var c;return"AND"===(c=this.operator)||"OR"===c};c.prototype.negativeJunctionOp=function(){var c;return"NAND"===(c=this.operator)||"NOR"===c};c.prototype.exclusiveDisjunctionOp=function(){return"XOR"===this.operator};c.prototype.implicationOp=function(){return"IF"===this.operator};c.prototype.biimplicationOp=function(){return"IFF"===
this.operator};c.prototype.binaryOp=function(){var c;return"AND"===(c=this.operator)||"OR"===c||"NAND"===c||"NOR"===c||"IF"===c||"IFF"===c||"XOR"===c};c.prototype.constant=function(c){return!1};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicTreeNode=c}).call(this);var CTATLogicRelationNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,d,c,e,f){this.operator=a;this.left=d;this.right=c;this.string=null!=e?e:null;this.negated=null!=f?f:!1;b.__super__.constructor.apply(this,arguments)}g(b,c);b.prototype.clone=function(a){var d;null==a&&(a=!0);return new b(this.operator,a?(null!=(d=this.left)?d.clone():void 0)||
null:this.left,a?this.right.clone():this.right,this.string,this.negated)};b.prototype.toString=function(a,d,c){var e,f,g;null==a&&(a=!1);null==d&&(d=null);null==c&&(c=!1);return b.__super__.toString.call(this,""+((null!=(e=this.left)?e.toString(a,this,"IF"===(f=this.operator)||"IFF"===f||"XOR"===f):void 0)||"")+(""+this.operatorString())+this.right.toString(a,this,"AND"===(g=this.operator)||"NAND"===g||"OR"===g||"NOR"===g),a,d,c)};b.prototype.evaluate=function(a){var d,c,e;null==a&&(a=null);d=null!=
(c=this.left)?c.evaluate(a):void 0;e=this.right.evaluate(a);return b.__super__.evaluate.call(this,function(){switch(this.operator){case "NOT":return this.applyOperator("NOT",e);case "NAND":return this.applyOperator("NOT",this.applyOperator("AND",d,e));case "NOR":return this.applyOperator("NOT",this.applyOperator("OR",d,e));case "IF":return this.applyOperator("OR",this.applyOperator("NOT",d),e);case "IFF":return this.applyOperator("OR",this.applyOperator("AND",d,e),this.applyOperator("AND",this.applyOperator("NOT",
d),this.applyOperator("NOT",e)));case "XOR":return this.applyOperator("OR",this.applyOperator("AND",d,this.applyOperator("NOT",e)),this.applyOperator("AND",this.applyOperator("NOT",d),e))}}.call(this))};b.prototype.equals=function(a,d){return b.__super__.equals.call(this,a,d)&&(null==this.left||this.left.equals(a.left,!1))&&this.right.equals(a.right,!1)};b.prototype.countOperands=function(){return 2};b.prototype.getOperators=function(a){var b,c;null==a&&(a=!1);return(null!=(b=null!=(c=this.left)?
c.getOperators(a):void 0)?b:[]).concat(this.getOperator(a),this.right.getOperators(a))};b.prototype.getVariables=function(){var a,b;return(null!=(a=null!=(b=this.left)?b.getVariables():void 0)?a:[]).concat(this.right.getVariables())};b.prototype.getOperands=function(){return null!=this.left?[this.left,this.right]:[this.right]};b.prototype.findOperator=function(a,d,c){var e,f;null==c&&(c="none");return(null!=(e=null!=(f=this.left)?f.findOperator(a,d.concat(["left"]),c):void 0)?e:[]).concat(b.__super__.findOperator.call(this,
a,d,null,c),this.right.findOperator(a,d.concat(["right"]),c))};b.prototype.findExpression=function(a,d){var c,e;return(null!=(c=null!=(e=this.left)?e.findExpression(a,d.concat(["left"])):void 0)?c:[]).concat(b.__super__.findExpression.call(this,a,d),this.right.findExpression(a,d.concat(["right"])))};b.prototype.findRule=function(a,d,c){var e,f;null==c&&(c=!1);return(null!=(e=null!=(f=this.left)?f.findRule(a,d.concat(["left"]),c):void 0)?e:[]).concat(b.__super__.findRule.call(this,a,d,c),this.right.findRule(a,
d.concat(["right"]),c))};b.prototype.removeNull=function(){var a,b;this.left=null!=(a=this.left)?a.removeNull():void 0;this.right=null!=(b=this.right)?b.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};b.prototype.applyRules=function(a,d,c){var e,f,g;this.rules=a;null==d&&(d=!1);null==c&&(c=!1);c&&(this.left=(null!=(e=this.left)?null!=(f=e.setSteps(this.steps))?f.applyRules(this.rules,d,!0):void 0:void 0)||null,this.right=this.right.setSteps((null!=(g=
this.left)?g.steps:void 0)||this.steps).applyRules(this.rules,d,!0),this.setSteps(this.right.steps));return b.__super__.applyRules.apply(this,arguments)};b.prototype.truth=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return!a&&this.negationOp()&&this.right.constant()?b||this.right.clone().negate():!b&&this};b.prototype.deMorgan=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return!a&&this.negationOp()&&this.right.junctionOp()?b||this.right.reverseNode():!b&&this};b.prototype.doubleNegation=function(a,
d){null==a&&(a=!1);null==d&&(d=!1);return!a&&this.negationOp()&&this.right.negationOp()?d||this.unnegateNode().unnegateNode():b.__super__.doubleNegation.apply(this,arguments)};b.prototype.negativeConjunction=function(a,d){null==a&&(a=!1);null==d&&(d=!1);return!a&&this.negativeConjunctionOp()?d||(new CTATLogicFlattenNode("AND",[this.left,this.right])).negateNode():a&&this.negationOp()&&this.right.conjunctionOp()&&2===this.right.terms.length?d||new b("NAND",this.right.terms[0],this.right.terms[1]):
!d&&this};b.prototype.negativeDisjunction=function(a,d){null==a&&(a=!1);null==d&&(d=!1);return!a&&this.negativeDisjunctionOp()?d||(new CTATLogicFlattenNode("OR",[this.left,this.right])).negateNode():a&&this.negationOp()&&this.right.disjunctionOp()&&2===this.right.terms.length?d||new b("NOR",this.right.terms[0],this.right.terms[1]):!d&&this};b.prototype.implication=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return!a&&this.implicationOp()?b||new CTATLogicFlattenNode("OR",[this.left.negateNode(),
this.right]):!b&&this};b.prototype.biimplication=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return!a&&this.biimplicationOp()?b||new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[this.left.negateNode(),this.right.negateNode()])]):!b&&this};b.prototype.biimplicationToImplication=function(a,d){null==a&&(a=!1);null==d&&(d=!1);return!a&&this.biimplicationOp()?d||new CTATLogicFlattenNode("AND",[new b("IF",this.left,this.right),new b("IF",
this.right,this.left)]):!d&&this};b.prototype.exclusiveDisjunction=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return!a&&this.exclusiveDisjunctionOp()?b||new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right.negateNode()]),new CTATLogicFlattenNode("AND",[this.left.negateNode(),this.right])]):!b&&this};b.prototype.exclusiveDisjunctionToImplication=function(a,d){null==a&&(a=!1);null==d&&(d=!1);return!a&&this.exclusiveDisjunctionOp()?d||new CTATLogicFlattenNode("AND",
[new b("IF",this.left,this.right.negateNode()),new b("IF",this.right.negateNode(),this.left)]):!d&&this};b.prototype.normalFormOperators=function(){return b.__super__.normalFormOperators.apply(this,arguments)&&(null==this.left||this.left.normalFormOperators())&&this.right.normalFormOperators()};b.prototype.atomicNegation=function(){return this.atomic()||!this.negationOp()&&!this.negated&&this.left.atomicNegation()&&this.right.atomicNegation()};b.prototype.atomicConjunction=function(){return this.atomic()||
(null==this.left||this.left.atomicConjunction())&&this.right.atomicConjunction()};b.prototype.atomicDisjunction=function(){return this.atomic()||(null==this.left||this.left.atomicDisjunction())&&this.right.atomicDisjunction()};b.prototype.replaceNodes=function(){var a,b,c,e;e=CTATLogicTreeNode.diff(this.rules,["replaceNodes"]);switch(this.operator){case "NOT":return this.right.setSteps(this.steps).negate();case "NAND":case "NOR":return(new CTATLogicFlattenNode(this.unnegateOperator(),[this.left,this.right])).setSteps(this.steps+
1).negate().applyRules(e);case "IF":return(new CTATLogicFlattenNode("OR",[a=this.left.setSteps(this.steps).negate().applyRules(e),this.right])).setSteps(a.steps+1);case "IFF":return b=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[a=this.left.clone().setSteps(this.steps).negate().applyRules(e),c=this.right.clone().setSteps(a.steps).negate().applyRules(e)])]),b.setSteps(c.steps).terms=b.terms.map(function(a){return function(a){a=
a.setSteps(b.steps).applyRules(e);b.setSteps(a.steps);return a}}(this)),b.setSteps(b.steps+1);case "XOR":return b=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,c=this.right.clone().setSteps(this.steps).negate().applyRules(e)]),new CTATLogicFlattenNode("AND",[a=this.left.clone().setSteps(c.steps).negate().applyRules(e),this.right])]),b.setSteps(a.steps).terms=b.terms.map(function(a){return function(a){a=a.setSteps(b.steps).applyRules(e);b.setSteps(a.steps);return a}}(this)),
b.setSteps(b.steps+1)}};b.prototype.sort=function(){var a;("NAND"===(a=this.operator)||"NOR"===a||"IFF"===a||"XOR"===a)&&0<this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1]);return this};b.prototype.compare=function(a){return b.__super__.compare.apply(this,arguments)||("NOT"===this.operator&&"NOT"===a.operator?this.right.compare(a.right):"NOT"===this.operator?this.right.compare(a):"NOT"===a.operator?this.compare(a.right):this.left.compare(a.left)||this.right.compare(a.right))||
this.compareNegations(a)};b.prototype.precedence=function(a){null==a&&(a=!1);return a&&"NOT"===this.operator?this.right.precedence():b.__super__.precedence.apply(this,arguments)};b.prototype.countVariables=function(){var a;return((null!=(a=this.left)?a.countVariables():void 0)||0)+this.right.countVariables()};b.prototype.countLevels=function(){var a;return"NOT"===this.operator?this.right.countLevels():1+Math.max((null!=(a=this.left)?a.countLevels():void 0)||0,this.right.countLevels())};return b}(CTATLogicTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicRelationNode=c}).call(this);var CTATLogicVariableNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c){this.variableTable=a;this.variable=b;this.negated=null!=c?c:!1;this.operator="VAR"}g(b,c);b.prototype.clone=function(){return new b(this.variableTable,this.variable,this.negated)};b.prototype.toString=function(a,d,c){null==a&&(a=!1);null==d&&(d=null);null==c&&(c=!1);
return b.__super__.toString.call(this,this.variable,a,d,c)};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,function(){if(null!=a)return("function"===typeof a.get?a.get(this.variable):void 0)||a[this.variable];if(null!=this.variableTable)return this.variableTable.get(this.variable);try{return eval(this.variable)}catch(d){}}.call(this))};b.prototype.equals=function(a,d){return b.__super__.equals.call(this,a,d)&&this.variable===a.variable};b.prototype.getVariables=
function(){return[this.variable]};b.prototype.compare=function(a){return b.__super__.compare.apply(this,arguments)||this.variable>a.variable&&1||this.variable<a.variable&&-1||this.compareNegations(a)};b.prototype.countVariables=function(){return 1};return b}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicVariableNode=c}).call(this);var CTATLogicConstantNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,d,c){this.value=a;this.string=null!=d?d:null;this.negated=null!=c?c:!1;this.operator="CONST";b.__super__.constructor.apply(this,arguments)}g(b,c);b.prototype.clone=function(){return new b(this.value,this.string,this.negated)};b.prototype.toString=function(a,d,c){null==a&&
(a=!1);null==d&&(d=null);null==c&&(c=!1);return b.__super__.toString.call(this,this.string,a,d,c)};b.prototype.evaluate=function(a){return b.__super__.evaluate.call(this,this.value)};b.prototype.equals=function(a,d){return b.__super__.equals.call(this,a,d)&&d!==(this.value===a.value)};b.prototype.truth=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return a?b||this.negateNode():!b&&this};b.prototype.compare=function(a){return b.__super__.compare.apply(this,arguments)||this.value-a.value};b.prototype.negate=
function(){this.setSteps(this.steps+1);this.value=!this.value;this.string=CTATLogicTreeNode.toOperatorString(this.value);return this};b.prototype.constant=function(a){null==a&&(a=null);return null==a||this.value===a};return b}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicConstantNode=c}).call(this);var CTATLogicGrammar=function(){function c(){this.yy={}}var g=function(a,b,d,c){d=d||{};for(c=a.length;c--;d[a[c]]=b);return d},f=[1,3],e=[1,5],b=[1,6],a=[1,7],d=[1,8],h=[1,10],l=[1,11],m=[1,12],n=[1,13],p=[1,14],r=[1,15],u=[1,16],w=[5,6,7,8,9,10,11,12,16],q=[5,7,9,10,11,12,16],g={trace:function(){},yy:{},symbols_:{error:2,expression:3,logical:4,EOF:5,AND:6,OR:7,NAND:8,NOR:9,XOR:10,IF:11,IFF:12,NOT:13,atom:14,LPAREN:15,RPAREN:16,VARIABLE:17,TRUE:18,FALSE:19,$accept:0,$end:1},terminals_:{2:"error",
5:"EOF",6:"AND",7:"OR",8:"NAND",9:"NOR",10:"XOR",11:"IF",12:"IFF",13:"NOT",15:"LPAREN",16:"RPAREN",17:"VARIABLE",18:"TRUE",19:"FALSE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,1],[14,3],[14,1],[14,1],[14,1]],performAction:function(a,b,d,c,e,f,g){a=f.length-1;switch(e){case 1:return f[a-1];case 2:c.parser.checkStrict(f[a-2],g[a-2],c.lexer.matched);c.parser.checkStrict(f[a],g[a],c.lexer.matched);this.$=f[a-2].addOperand("AND",f[a],f[a-1]);break;case 3:c.parser.checkStrict(f[a-
2],g[a-2],c.lexer.matched);c.parser.checkStrict(f[a],g[a],c.lexer.matched);this.$=f[a-2].addOperand("OR",f[a],f[a-1]);break;case 4:c.parser.checkStrict(f[a-2],g[a-2],c.lexer.matched);c.parser.checkStrict(f[a],g[a],c.lexer.matched);this.$=new c.CTATLogicRelationNode("NAND",f[a-2],f[a],f[a-1]);break;case 5:c.parser.checkStrict(f[a-2],g[a-2],c.lexer.matched);c.parser.checkStrict(f[a],g[a],c.lexer.matched);this.$=new c.CTATLogicRelationNode("NOR",f[a-2],f[a],f[a-1]);break;case 6:c.parser.checkStrict(f[a-
2],g[a-2],c.lexer.matched);c.parser.checkStrict(f[a],g[a],c.lexer.matched);this.$=new c.CTATLogicRelationNode("XOR",f[a-2],f[a],f[a-1]);break;case 7:c.parser.checkStrict(f[a-2],g[a-2],c.lexer.matched);c.parser.checkStrict(f[a],g[a],c.lexer.matched);this.$=new c.CTATLogicRelationNode("IF",f[a-2],f[a],f[a-1]);break;case 8:c.parser.checkStrict(f[a-2],g[a-2],c.lexer.matched);c.parser.checkStrict(f[a],g[a],c.lexer.matched);this.$=new c.CTATLogicRelationNode("IFF",f[a-2],f[a],f[a-1]);break;case 9:c.parser.checkStrict(f[a],
g[a],c.lexer.matched);this.$=new c.CTATLogicRelationNode("NOT",null,f[a],f[a-1]);break;case 10:this.$=f[a];break;case 11:this.$=f[a-1].setParens();break;case 12:this.$=new c.CTATLogicVariableNode(c.variableTable,f[a]);break;case 13:this.$=new c.CTATLogicConstantNode(!0,f[a]);break;case 14:this.$=new c.CTATLogicConstantNode(!1,f[a])}},table:[{3:1,4:2,13:f,14:4,15:e,17:b,18:a,19:d},{1:[3]},{5:[1,9],6:h,7:l,8:m,9:n,10:p,11:r,12:u},{4:17,13:f,14:4,15:e,17:b,18:a,19:d},g(w,[2,10]),{4:18,13:f,14:4,15:e,
17:b,18:a,19:d},g(w,[2,12]),g(w,[2,13]),g(w,[2,14]),{1:[2,1]},{4:19,13:f,14:4,15:e,17:b,18:a,19:d},{4:20,13:f,14:4,15:e,17:b,18:a,19:d},{4:21,13:f,14:4,15:e,17:b,18:a,19:d},{4:22,13:f,14:4,15:e,17:b,18:a,19:d},{4:23,13:f,14:4,15:e,17:b,18:a,19:d},{4:24,13:f,14:4,15:e,17:b,18:a,19:d},{4:25,13:f,14:4,15:e,17:b,18:a,19:d},g(w,[2,9]),{6:h,7:l,8:m,9:n,10:p,11:r,12:u,16:[1,26]},g(w,[2,2]),g(q,[2,3],{6:h,8:m}),g(q,[2,4],{6:h}),g([5,10,11,12,16],[2,5],{6:h,7:l,8:m}),g([5,11,12,16],[2,6],{6:h,7:l,8:m,9:n,
10:p}),g([5,12,16],[2,7],{6:h,7:l,8:m,9:n,10:p,11:r}),g([5,16],[2,8],{6:h,7:l,8:m,9:n,10:p,11:r,12:u}),g(w,[2,11])],defaultActions:{9:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else{var d=function(a,b){this.message=a;this.hash=b};d.prototype=Error;throw new d(a,b);}},parse:function(a){var b=[0],d=[null],c=[],e=this.table,f="",g=0,h=0,m=0,l=c.slice.call(arguments,1),n=Object.create(this.lexer),p={},q;for(q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p[q]=this.yy[q]);
n.setInput(a,p);p.lexer=n;p.parser=this;"undefined"==typeof n.yylloc&&(n.yylloc={});q=n.yylloc;c.push(q);var y=n.options&&n.options.ranges;this.parseError="function"===typeof p.parseError?p.parseError:Object.getPrototypeOf(this).parseError;for(var r,w,u,N,P={},V,R;;){u=b[b.length-1];if(this.defaultActions[u])N=this.defaultActions[u];else{if(null===r||"undefined"==typeof r)r=n.lex()||1,"number"!==typeof r&&(r=this.symbols_[r]||r);N=e[u]&&e[u][r]}if("undefined"===typeof N||!N.length||!N[0]){var T;R=
[];for(V in e[u])this.terminals_[V]&&2<V&&R.push("'"+this.terminals_[V]+"'");T=n.showPosition?"Parse error on line "+(g+1)+":\n"+n.showPosition()+"\nExpecting "+R.join(", ")+", got '"+(this.terminals_[r]||r)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==r?"end of input":"'"+(this.terminals_[r]||r)+"'");this.parseError(T,{text:n.match,token:this.terminals_[r]||r,line:n.yylineno,loc:q,expected:R})}if(N[0]instanceof Array&&1<N.length)throw Error("Parse Error: multiple actions possible at state: "+
u+", token: "+r);switch(N[0]){case 1:b.push(r);d.push(n.yytext);c.push(n.yylloc);b.push(N[1]);r=null;w?(r=w,w=null):(h=n.yyleng,f=n.yytext,g=n.yylineno,q=n.yylloc,0<m&&m--);break;case 2:R=this.productions_[N[1]][1];P.$=d[d.length-R];P._$={first_line:c[c.length-(R||1)].first_line,last_line:c[c.length-1].last_line,first_column:c[c.length-(R||1)].first_column,last_column:c[c.length-1].last_column};y&&(P._$.range=[c[c.length-(R||1)].range[0],c[c.length-1].range[1]]);u=this.performAction.apply(P,[f,h,
g,p,N[1],d,c].concat(l));if("undefined"!==typeof u)return u;R&&(b=b.slice(0,-2*R),d=d.slice(0,-1*R),c=c.slice(0,-1*R));b.push(this.productions_[N[1]][0]);d.push(P.$);c.push(P._$);N=e[b[b.length-2]][b[b.length-1]];b.push(N);break;case 3:return!0}}},checkStrict:function(a,b,d){var c=d+"\n"+"-".repeat(b.first_column)+"^",e=["'LPAREN'","'VARIABLE'","'TRUE'","'FALSE'"],c="Parse error on line "+b.first_line+":\n"+c+"\nExpecting "+e.join(", ")+" got '"+d[b.first_column]+"'";this.yy.strictMode&&!a.checkParens()&&
this.parseError(c,{text:d,token:a.operator,line:b.first_line,loc:b,expected:e})}},f=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=
[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,d=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);
this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);d.length-1&&(this.yylineno-=d.length-1);var c=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:d?(d.length===a.length?this.yylloc.first_column:0)+a[a.length-d.length].length-d[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[c[0],c[0]+this.yyleng-b]);this.yyleng=this.yytext.length;
return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-
this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var d,c;this.options.backtrack_lexer&&(c={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,
first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(c.yylloc.range=this.yylloc.range.slice(0)));if(d=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=d.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,
last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];d=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);
if(d)return d;if(this._backtrack)for(var e in c)this[e]=c[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,d;this._more||(this.match=this.yytext="");for(var c=this._currentRules(),e=0;e<c.length;e++)if((b=this._input.match(this.rules[c[e]]))&&(!a||b[0].length>a[0].length))if(a=b,d=e,this.options.backtrack_lexer){a=this.test_match(b,c[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,
c[d]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-
1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,d,c){switch(d){case 1:return 15;case 2:return 16;case 3:return 12;case 4:return 12;case 5:return 12;case 6:return 12;case 7:return 12;case 8:return 12;
case 9:return 12;case 10:return 10;case 11:return 10;case 12:return 10;case 13:return 10;case 14:return 10;case 15:return 10;case 16:return 11;case 17:return 11;case 18:return 11;case 19:return 11;case 20:return 11;case 21:return 8;case 22:return 8;case 23:return 8;case 24:return 8;case 25:return 8;case 26:return 8;case 27:return 8;case 28:return 8;case 29:return 8;case 30:return 8;case 31:return 8;case 32:return 6;case 33:return 6;case 34:return 6;case 35:return 6;case 36:return 6;case 37:return 6;
case 38:return 9;case 39:return 9;case 40:return 9;case 41:return 9;case 42:return 9;case 43:return 9;case 44:return 9;case 45:return 9;case 46:return 9;case 47:return 9;case 48:return 9;case 49:return 7;case 50:return 7;case 51:return 7;case 52:return 7;case 53:return 7;case 54:return 13;case 55:return 13;case 56:return 13;case 57:return 13;case 58:return 18;case 59:return 18;case 60:return 18;case 61:return 18;case 62:return 19;case 63:return 19;case 64:return 19;case 65:return 19;case 66:return 17;
case 67:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:=)/,/^(?:<=>)/,/^(?:<->)/,/^(?:\u21d4)/,/^(?:\u2194)/,/^(?:\u2261)/,/^(?:\u2299)/,/^(?:\u2260)/,/^(?:\u2262)/,/^(?:\u22bb)/,/^(?:\u2295)/,/^(?:\^)/,/^(?:<~>)/,/^(?:=>)/,/^(?:->)/,/^(?:\u21d2)/,/^(?:\u2192)/,/^(?:\u2283)/,/^(?:\u2191)/,/^(?:\u22bc)/,/^(?:~\/\\)/,/^(?:~&&)/,/^(?:~&)/,/^(?:!\/\\)/,/^(?:!&&)/,/^(?:!&)/,/^(?:-\/\\)/,/^(?:-&&)/,/^(?:-&)/,/^(?:&&)/,/^(?:&)/,/^(?:\u2227)/,/^(?:\/\\)/,/^(?:\*)/,/^(?:\.)/,/^(?:\u2193)/,/^(?:\u22bd)/,
/^(?:~\\\/)/,/^(?:~\|\|)/,/^(?:~\|)/,/^(?:!\\\/)/,/^(?:!\|\|)/,/^(?:!\|)/,/^(?:-\\\/)/,/^(?:-\|\|)/,/^(?:-\|)/,/^(?:\|\|)/,/^(?:\|)/,/^(?:\u2228)/,/^(?:\\\/)/,/^(?:\+)/,/^(?:~)/,/^(?:\u00ac)/,/^(?:!)/,/^(?:-)/,/^(?:([Tt][Rr][Uu][Ee]))/,/^(?:T\b)/,/^(?:\u22a4)/,/^(?:1\b)/,/^(?:([Ff][Aa][Ll][Ss][Ee]))/,/^(?:F\b)/,/^(?:\u22a5)/,/^(?:0\b)/,/^(?:([A-Za-z][0-9]*))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,
37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67],inclusive:!0}}}}();g.lexer=f;c.prototype=g;g.Parser=c;return new c}();var CTATLogicFlattenNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,d,c,e){this.operator=a;this.terms=d;this.string=null!=c?c:null;this.negated=null!=e?e:!1;b.__super__.constructor.apply(this,arguments)}g(b,c);b.prototype.addOperand=function(a,d,c){null==c&&(c=null);if(a!==this.operator||this.parens)return b.__super__.addOperand.apply(this,arguments);
this.terms.push(d);return this};b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.terms.map(function(a){return a.clone()}):this.terms,this.string,this.negated)};b.prototype.toString=function(a,d,c){null==a&&(a=!1);null==d&&(d=null);null==c&&(c=!1);return b.__super__.toString.call(this,this.terms.reduce(function(b){return function(d,c){return""+d+(d?""+b.operatorString():"")+c.toString(a,b,!0)}}(this),""),a,d,c)};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,
this.terms.reduce(function(b){return function(d,c){return b.applyOperator(b.operator,d,c.evaluate(a))}}(this),this.conjunctionOp()))};b.prototype.equals=function(a,d){return b.__super__.equals.call(this,a,d)&&this.terms.length===a.terms.length&&this.terms.every(function(b,d){return b.equals(a.terms[d],!1)})};b.prototype.subEquals=function(a,b){return this.operator===a.operator&&!a.negated&&this.terms.length>=a.terms.length&&a.terms.every(function(a){return function(d,c){return d.equals(a.terms[b+
c],!1)}}(this))};b.prototype.subNode=function(a,b){return null!=a?Object.assign(this.clone(!1),{terms:this.terms.slice(a,b)}):this};b.prototype.countOperands=function(){return this.terms.length};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.terms.slice(1).reduce(function(b){return function(d,c,e){return d.concat(b.getOperator(a),c.getOperators(a))}}(this),this.terms[0].getOperators(a))};b.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(a){return function(a,
b,c){return a.concat(b.getVariables())}}(this),this.terms[0].getVariables())};b.prototype.getOperands=function(){return this.terms.slice(0)};b.prototype.findOperator=function(a,d,c){null==c&&(c="none");return this.terms.slice(1).reduce(function(e){return function(f,g,h){return f.concat(b.__super__.findOperator.call(e,a,d,h,c),g.findOperator(a,d.concat([h+1]),c))}}(this),this.terms[0].findOperator(a,d.concat([0]),c))};b.prototype.findExpression=function(a,d){return this.terms.slice(1).reduce(function(c){return function(e,
f,g){return e.concat(b.__super__.findExpression.call(c,a,d,g),f.findExpression(a,d.concat([g+1])))}}(this),this.terms[0].findExpression(a,d.concat([0])))};b.prototype.findRule=function(a,d,c){null==c&&(c=!1);return this.terms.slice(1).reduce(function(e){return function(f,g,h){return f.concat(b.__super__.findRule.call(e,a,d,c,h),g.findRule(a,d.concat([h+1]),c))}}(this),this.terms[0].findRule(a,d.concat([0]),c))};b.prototype.removeNull=function(){this.terms=this.terms.map(function(a){return null!=a?
a.removeNull():void 0}).filter(function(a){return a});return 1<this.terms.length?this:this.terms[0]||null};b.prototype.applyRules=function(a,d,c){this.rules=a;null==d&&(d=!1);null==c&&(c=!1);c&&(this.terms=this.terms.map(function(a){return function(b){b=b.setSteps(a.steps).applyRules(a.rules,d,!0);a.setSteps(b.steps);return b}}(this)));return b.__super__.applyRules.apply(this,arguments)};b.prototype.domination=function(a,b){var d;null==a&&(a=!1);null==b&&(b=!1);return!a&&this.junctionOp()&&(d=this.terms.find(function(a){return function(b){return b.constant(a.disjunctionOp())}}(this)))?
b||d:!b&&this};b.prototype.negation=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return!a&&this.junctionOp()&&this.terms.some(function(a){return function(b,d){return a.terms.slice(d+1).some(function(a){return a.inverse(b)})}}(this))?b||new CTATLogicConstantNode(this.disjunctionOp()):!b&&this};b.prototype.identity=function(a,d){var c;null==a&&(a=!1);null==d&&(d=!1);return!a&&this.junctionOp()&&(c=this.terms.filter(function(a){return function(b){return b.constant(a.conjunctionOp())}}(this))).length?
d||this.junctionNode(CTATLogicTreeNode.difference(this.terms,c)):a&&this.junctionOp()?d||this.junctionNode(this.terms.push(new CTATLogicConstantNode(this.conjunctionOp()))):b.__super__.identity.apply(this,arguments)};b.prototype.idempotence=function(a,d){var c;null==a&&(a=!1);null==d&&(d=!1);return!a&&this.junctionOp()&&(c=this.terms.filter(function(a){return function(b,d){return a.terms.slice(d+1).some(function(a){return a.equals(b)})}}(this))).length?d||this.junctionNode(CTATLogicTreeNode.difference(this.terms,
c)):a&&this.junctionOp()?d||this.junctionNode(this.terms.concat(this.terms)):b.__super__.idempotence.apply(this,arguments)};b.prototype.absorption=function(a,b){var d;null==a&&(a=!1);null==b&&(b=!1);return!a&&this.junctionOp()&&(d=this.terms.reduce(function(a){return function(b,d){return b.concat(d.findPairs(a.inverseOperator(),a.terms,"equals"))}}(this),[])).length?b||this.junctionNode(CTATLogicTreeNode.replaceTerms(this.terms,d,!1)):!b&&this};b.prototype.inverseAbsorption=function(a,b){var d;null==
a&&(a=!1);null==b&&(b=!1);return!a&&this.junctionOp()&&(d=this.terms.reduce(function(a){return function(b,d){return b.concat(d.findPairs(a.inverseOperator(),a.terms,"inverse"))}}(this),[])).length?b||this.junctionNode(CTATLogicTreeNode.replaceTerms(this.terms,d,!0)):!b&&this};b.prototype.junctionNode=function(a){return 1===a.length?a[0]:Object.assign(this.clone(),{terms:a})};b.prototype.commutativity=function(a,d){null==d&&(d=!1);return this.junctionOp()?d||new b(this.operator,this.terms.slice(0).reverse()):
!d&&this};b.prototype.associativity=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return this.junctionOp()&&this.terms.some(function(a){return function(b){return b.operator===a.operator}}(this))?b||this.clone().flatten():!b&&this};b.prototype.distributivity=function(a,d){var c,e,f,g,p,r;null==a&&(a=!1);null==d&&(d=!1);return!a&&this.junctionOp()&&-1!==(e=this.terms.findIndex(function(a){return function(b){return b.junctionOp()&&b.operator!==a.operator}}(this)))?(c=this.terms[e],r=CTATLogicTreeNode.removeIndex(this.terms,
e),d||new b(c.operator,c.terms.map(function(a){return function(d){return new b(a.operator,r.concat([d]))}}(this)))):a&&this.junctionOp()&&this.terms.every(function(a){return function(b){return b.junctionOp()&&b.operator!==a.operator}}(this))&&(p=this.terms.map(function(a){return a.terms}))&&(g=CTATLogicTreeNode.commonLength(p))&&(f=CTATLogicTreeNode.intersection(p))&&f.length===g-1?d||(c=p.map(function(a){return function(a){return CTATLogicTreeNode.difference(a,f)[0]}}(this)),new b(this.terms[0].operator,
f.concat([new b(this.operator,c)]))):!d&&this};b.prototype.deMorgan=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return a&&this.junctionOp()&&this.terms.every(function(a){return a.negationOp()})?this.reverseNode(!0).negateNode():!b&&this};b.prototype.reverseNode=function(a){null==a&&(a=!1);return new b(this.inverseOperator(),this.terms.map(function(b){return a?b.unnegateNode():b.negateNode()}))};b.prototype.implication=function(a,d){var c,e;null==a&&(a=!1);null==d&&(d=!1);return a&&this.disjunctionOp()&&
this.terms.some(function(a){return a.negationOp()})&&this.terms.some(function(a){return!a.negationOp()})?d||(c=this.terms.filter(function(a){return a.negationOp()}).map(function(a){return a.unnegateNode()}),e=this.terms.filter(function(a){return!a.negationOp()}),new CTATLogicRelationNode("IF",1<c.length?new b("AND",c):c[0],1<e.length?new b("OR",e):e[0])):!d&&this};b.prototype.biimplication=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return a&&this.disjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.conjunctionOp()})&&
this.terms[0].terms.every(function(a){return function(b){return a.terms[1].terms.some(function(a){return a.inverse(b)})}}(this))&&CTATLogicTreeNode.sameNegation(this.terms[0].terms)&&CTATLogicTreeNode.sameNegation(this.terms[1].terms)?b||new CTATLogicRelationNode("IFF",this.terms[0].terms[0].unnegateNode(),this.terms[0].terms[1].unnegateNode()):!b&&this};b.prototype.biimplicationToImplication=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return a&&this.conjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.implicationOp()})&&
this.terms[0].left.equals(this.terms[1].right)&&this.terms[0].right.equals(this.terms[1].left)?b||new CTATLogicRelationNode("IFF",this.terms[0].left,this.terms[0].right):!b&&this};b.prototype.exclusiveDisjunction=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return a&&this.disjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.conjunctionOp()})&&this.terms[0].terms.every(function(a){return function(b){return a.terms[1].terms.some(function(a){return a.inverse(b)})}}(this))&&
CTATLogicTreeNode.oppositeNegation(this.terms[0].terms)&&CTATLogicTreeNode.oppositeNegation(this.terms[1].terms)?b||new CTATLogicRelationNode("XOR",this.terms[0].terms[0].unnegateNode(),this.terms[0].terms[1].unnegateNode()):!b&&this};b.prototype.exclusiveDisjunctionToImplication=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return a&&this.conjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.implicationOp()})&&this.terms[0].left.equals(this.terms[1].right)&&this.terms[0].right.equals(this.terms[1].left)?
b||new CTATLogicRelationNode("XOR",this.terms[0].left.unnegateNode(),this.terms[0].right.unnegateNode()):!b&&this};b.prototype.normalFormOperators=function(){return b.__super__.normalFormOperators.apply(this,arguments)&&this.terms.every(function(a){return a.normalFormOperators()})};b.prototype.atomicNegation=function(){return!this.negated&&this.terms.every(function(a){return a.atomicNegation()})};b.prototype.atomicConjunction=function(){return this.conjunctionOp()&&this.terms.every(function(a){return a.atomic()})||
!this.conjunctionOp()&&this.terms.every(function(a){return a.atomicConjunction()})};b.prototype.atomicDisjunction=function(){return this.disjunctionOp()&&this.terms.every(function(a){return a.atomic()})||!this.disjunctionOp()&&this.terms.every(function(a){return a.atomicDisjunction()})};b.prototype.pushNegation=function(){this.negated&&(this.negate(),this.invertOperator(),this.terms.forEach(function(a){return function(b){b.setSteps(a.steps).negate().pushNegation();return a.setSteps(b.steps)}}(this)),
this.setSteps(this.steps+1));return this};b.prototype.flatten=function(){this.terms=this.terms.reduce(function(a){return function(b,c){c.operator!==a.operator?b.push(c):b.push.apply(b,c.terms);return b}}(this),[]);return this};b.prototype.distributeDisjunction=function(){var a,b;return this.disjunctionOp()&&this.conjunctiveTerms()?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(b=this.terms.pop()).setSteps(this.steps).terms=b.terms.map(function(d){return function(c){var e;e=
d.clone();e.terms.push(c);e=e.setSteps(b.steps).applyRules(a);b.setSteps(e.steps);return e}}(this)),b.setSteps(b.steps+1).applyRules(["flatten","sort","distributeDisjunction"])):this};b.prototype.conjunctiveTerms=function(){return this.terms.some(function(a){return a.conjunctionOp()})};b.prototype.distributeConjunction=function(){var a,b;return this.conjunctionOp()&&this.disjunctiveTerms()?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(b=this.terms.pop()).setSteps(this.steps).terms=
b.terms.map(function(d){return function(c){var e;e=d.clone();e.terms.push(c);e=e.setSteps(b.steps).applyRules(a);b.setSteps(e.steps);return e}}(this)),b.setSteps(b.steps+1).applyRules(["flatten","sort","distributeConjunction"])):this};b.prototype.disjunctiveTerms=function(){return this.terms.some(function(a){return a.disjunctionOp()})};b.prototype.absorb=function(){this.terms=this.terms.reduce(function(a){return function(b,c){var d,e,f,g;b instanceof Array&&(a.disjunctionOp()&&c.constant(!0)||a.conjunctionOp()&&
c.constant(!1)?b=c.setSteps(a.steps+1):c.constant()&&0===b.length?b.push(c):null!=(e=b[b.length-1])&&e.equals(c,!1)?a.setSteps(a.steps+1):null!=(f=b[b.length-1])&&f.equals(c,!0)?b=(new CTATLogicConstantNode(a.disjunctionOp(),CTATLogicTreeNode.operatorStrings[a.disjunctionOp()])).setSteps(a.steps+1):c.junctionOp()&&b.find(function(a){return c.subterm(a,!1)})?a.setSteps(a.steps+1):c.junctionOp()&&(d=b.find(function(a){return c.subterm(a,!0)}))?(a.setSteps(a.steps+1),b.push(c.removeInverse(d))):(null!=
(g=b[0])&&g.constant()&&(b.pop(),a.setSteps(a.steps+1)),b.push(c)));return b}}(this),[]);return this.terms instanceof Array?this.prune():this.terms};b.prototype.subterm=function(a,b){return this.terms.some(function(d){return a.equals(d,b)})};b.prototype.removeInverse=function(a){this.terms=this.terms.filter(function(b){return!a.equals(b,!0)});return this.prune()};b.prototype.prune=function(){return 1===this.terms.length?this.terms[0].setSteps(this.steps):this};b.prototype.sort=function(){this.terms=
this.terms.sort(function(a,b){return a.compare(b)});return this};b.prototype.compare=function(a){var d;return(d=b.__super__.compare.apply(this,arguments))||this.terms.some(function(b,c){return d=b.compare(a.terms[c])})&&d||this.compareNegations(a)};b.prototype.countVariables=function(){return this.terms.reduce(function(a,b){return a+b.countVariables()},0)};b.prototype.countLevels=function(){return 1+this.terms.reduce(function(a,b){return Math.max(a,b.countLevels())},0)};return b}(CTATLogicTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicFlattenNode=c}).call(this);var CTATLogicParser={};
(function(){var c,g=[].slice;c=function(){function c(c){this.parser=new CTATLogicGrammar.Parser;this.parser.yy={CTATLogicRelationNode:CTATLogicRelationNode,CTATLogicFlattenNode:CTATLogicFlattenNode,CTATLogicVariableNode:CTATLogicVariableNode,CTATLogicConstantNode:CTATLogicConstantNode,CTATLogicTreeNode:CTATLogicTreeNode};this.parser.yy.variableTable=c}c.SORTRule=["sort"];c.NNFRules="replaceNodes pushNegation flatten sort absorb sort".split(" ");c.CNFRules="replaceNodes pushNegation flatten sort distributeDisjunction absorb sort".split(" ");c.DNFRules=
"replaceNodes pushNegation flatten sort distributeConjunction absorb sort".split(" ");c.NNFTests=["normalFormOperators","atomicNegation"];c.CNFTests=["normalFormOperators","atomicNegation","atomicDisjunction"];c.DNFTests=["normalFormOperators","atomicNegation","atomicConjunction"];c.prototype.getTree=function(c,b,a){null==b&&(b=!1);null==a&&(a=!1);c=c instanceof CTATLogicTreeNode?b?c.clone():c:this.parser.parse(c);a&&null!=c&&c.setSteps(0);return c};c.prototype.getExpression=function(c,b,a){null==
a&&(a=!1);return c instanceof CTATLogicTreeNode?b:"string"===typeof b?b:null!=b?b.toString(a):b};c.prototype.equalExpressions=function(c,b){return c instanceof CTATLogicTreeNode&&b instanceof CTATLogicTreeNode?c.toString()===b.toString():c===b};c.prototype.logicSetMode=function(c){Object.assign(this.parser.yy,c);return c};c.prototype.logicParse=function(c){try{return this.getTree(c)}catch(b){return null}};c.prototype.logicGetError=function(c){try{return c instanceof CTATLogicTreeNode||this.parser.parse(String(c)),
null}catch(b){return b}};c.prototype.logicStringify=function(c){return this.getExpression("",c,this.parser.yy.strictMode)};c.prototype.logicEvaluate=function(c,b){null==b&&(b=null);try{return this.getTree(c).evaluate(b)}catch(a){return null}};c.prototype.logicSort=function(e){return this.getExpression(e,function(){try{return this.getTree(e,!0).applyRules(c.SORTRule,!1,!0)}catch(b){return null}}.call(this))};c.prototype.logicGetOperator=function(c,b){null==b&&(b=!1);try{return this.getTree(c).getOperator(b)}catch(a){return null}};
c.prototype.logicGetOperators=function(c,b){null==b&&(b=!1);try{return this.getTree(c).getOperators(b)}catch(a){return null}};c.prototype.logicGetVariables=function(c){try{return this.getTree(c).getVariables()}catch(b){return null}};c.prototype.logicGetOperands=function(c){try{return this.getTree(c).getOperands().map(function(b){return function(a){return b.getExpression(c,a)}}(this))}catch(b){return null}};c.prototype.logicGetExpression=function(c,b,a){return this.getExpression(c,function(){try{return this.getTree(c).getExpression(b,
a)}catch(d){return null}}.call(this))};c.prototype.logicFindOperator=function(c,b,a){null==a&&(a="none");try{return this.getTree(c).findOperator(b,[],a).map(function(a){return function(b){return a.getExpression(c,b)}}(this))}catch(d){return null}};c.prototype.logicFindExpression=function(c,b){try{return this.getTree(c).findExpression(this.getTree(b),[]).map(function(a){return function(b){return a.getExpression(c,b)}}(this))}catch(a){return null}};c.prototype.logicFindRule=function(c,b,a){null==a&&
(a=!1);try{return this.getTree(c).findRule(b,[],a).map(function(a){return function(b){return a.getExpression(c,b)}}(this))}catch(d){return null}};c.prototype.logicApplyRules=function(c,b,a,d){null==a&&(a=!1);null==d&&(d=!1);return this.getExpression(c,function(){try{return this.getTree(c,d).applyRules(b,a,d)}catch(h){return null}}.call(this))};c.prototype.logicCreateExpression=function(){var c,b,a;a=arguments[0];c=arguments[1];b=3<=arguments.length?g.call(arguments,2):[];return this.getExpression(c,
function(){var d;try{return(d=this.getTree(c)).createExpression.apply(d,[a].concat(g.call(b.map(function(a){return function(b){return a.getTree(b)}}(this)))))}catch(h){return null}}.call(this))};c.prototype.logicReplaceExpression=function(c,b,a,d){var e;null==d&&(d=null);d=(null!=d?d:null!=(e=b.path)?e.slice(0):void 0)||0;return this.getExpression(c,function(){try{return this.getTree(c).replaceExpression(this.getTree(b),this.getTree(a),d)}catch(l){return null}}.call(this))};c.prototype.logicDeleteExpression=
function(c,b,a){var d;null==a&&(a=null);a=(null!=a?a:null!=(d=b.path)?d.slice(0):void 0)||0;return this.getExpression(c,function(){try{return this.getTree(c).deleteExpression(this.getTree(b),a)}catch(h){return null}}.call(this))};c.prototype.logicSimplifyNNF=function(e,b){null==b&&(b=!1);return this.getExpression(e,function(){try{return this.getTree(e,!0,b).applyRules(c.NNFRules,!1,!0)}catch(a){return null}}.call(this))};c.prototype.logicSimplifyCNF=function(e,b){null==b&&(b=!1);return this.getExpression(e,
function(){try{return this.getTree(e,!0,b).applyRules(c.CNFRules,!1,!0)}catch(a){return null}}.call(this))};c.prototype.logicSimplifyDNF=function(e,b){null==b&&(b=!1);return this.getExpression(e,function(){try{return this.getTree(e,!0,b).applyRules(c.DNFRules,!1,!0)}catch(a){return null}}.call(this))};c.prototype.logicValid=function(c){return null!=this.logicParse(c)};c.prototype.logicValued=function(c,b){null==b&&(b=null);return null!=this.logicEvaluate(c,b)};c.prototype.logicSorted=function(c){var b,
a;return null!=(b=this.logicSort(c))&&null!=(a=this.getExpression(c,this.getTree(c)))?this.equalExpressions(b,a):null};c.prototype.logicCheckNNF=function(e){try{return this.getTree(e).applyTests(c.NNFTests)}catch(b){return null}};c.prototype.logicCheckCNF=function(e){try{return this.getTree(e).applyTests(c.CNFTests)}catch(b){return null}};c.prototype.logicCheckDNF=function(e){try{return this.getTree(e).applyTests(c.DNFTests)}catch(b){return null}};c.prototype.logicSimplifiedNNF=function(c){var b,
a;return null!=(b=this.logicSimplifyNNF(c))&&null!=(a=this.logicSort(c))?this.equalExpressions(b,a):null};c.prototype.logicSimplifiedCNF=function(c){var b,a;return null!=(b=this.logicSimplifyCNF(c))&&null!=(a=this.logicSort(c))?this.equalExpressions(b,a):null};c.prototype.logicSimplifiedDNF=function(c){var b,a;return null!=(b=this.logicSimplifyDNF(c))&&null!=(a=this.logicSort(c))?this.equalExpressions(b,a):null};c.prototype.logicIdentical=function(c,b){return null!=(c=this.logicSort(c))&&null!=(b=
this.logicSort(b))?this.equalExpressions(c,b):null};c.prototype.logicEqual=function(c,b,a){null==a&&(a=null);c=this.logicEvaluate(c,a);b=this.logicEvaluate(b,a);if(null!=c&&null!=b)return c===b;if(null===c||null===b)return null};c.prototype.logicEquivalent=function(c,b){return null!=(c=this.logicSimplifyDNF(c))&&null!=(b=this.logicSimplifyDNF(b))?this.equalExpressions(c,b):null};c.prototype.logicSemanticEquivalent=function(c,b){try{return!this.getTree(c).findCounterExample(this.getTree(b))}catch(a){return null}};
c.prototype.logicFindCounterExample=function(c,b){try{return this.getTree(c).findCounterExample(this.getTree(b))}catch(a){return null}};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicParser=c}).call(this);var CTATChemTreeNode={};
(function(){var c;c=function(){function c(){}c.operators=[["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];c.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");c.operatorPrecedence=function(c,e){return Math.sign(this.operators.findIndex(function(b){return b.includes(c)})-this.operators.findIndex(function(b){return b.includes(e)}))};c.operatorStrings=
{EXP:"^",ROOT:"|",UPLUS:"+",UMINUS:"-",ITIMES:"",TIMES:"*",DIVIDE:"/",IDIVIDE:"//",REM:"%",PLUS:"+",MINUS:"-",LESS:"<",LESSEQUAL:"<=",EQUAL:"=",NOTEQUAL:"!=",GREATEREQUAL:">=",GREATER:">"};c.toOperatorString=function(c){return this.operatorStrings[c]||""};c.diff=function(c,e){return c.filter(function(b){return!e.includes(b)})};c.round=function(c,e){var b;"number"!==typeof c&&(c=parseFloat(c));e="number"===typeof e&&0===e%1?e:CTATChemParser.CHEM_DECIMAL_PRECISION;-1<e&&(b=Math.pow(10,e),c=Math.round(c*
b)/b);return c};c.prototype.toString=function(c,e,b){var a;null==e&&(e="");null==b&&(b=!1);b&&(c=e+c+e);this.checkParens()&&(c="("+c+")");this.inverted()&&(c="1/"+c);this.negated()&&(c="-"+c);e=0;for(a=this.parens;0<=a?e<a:e>a;0<=a?++e:--e)c="("+c+")";this.units&&(c+=this.units.toString(b));return c};c.prototype.setParens=function(c,e){null==e&&(e=!1);this.checkParens(c,e)&&(this.parens=1);return this};c.prototype.checkParens=function(f,e){var b;null==e&&(e=!1);null!=f?b=this.negated()?"UMINUS":this.inverted()?
"DIVIDE":this.operator:(f=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,b=this.operator);b=c.operatorPrecedence(f,b);return null!=f&&(0>b||0===b&&e)};c.prototype.evaluate=function(c){return this.sign*Math.pow(c,this.exp)};c.prototype.applyOperator=function(f,e){var b;switch(this.operator){case "LESS":b=f<e;break;case "GREATER":b=f>e;break;case "LESSEQUAL":b=f<=e;break;case "GREATEREQUAL":b=f>=e;break;case "EQUAL":b=f===e;break;case "NOTEQUAL":b=f!==e;break;case "PLUS":b=c.round(f+e);break;
case "MINUS":b=c.round(f-e);break;case "TIMES":case "ITIMES":b=c.round(f*e);break;case "DIVIDE":b=c.round(f/e);break;case "EXP":b=c.round(Math.pow(f,e));break;case "ROOT":b=c.round(Math.pow(f,1)/e);break;case "REM":b=f%e;break;case "IDIVIDE":b=Math.floor(f/e);break;case "UPLUS":b=f;break;case "UMINUS":b=-f;break;case "LOG":b=Math.log10(f);break;case "LN":b=Math.log(f)}return b};c.prototype.equals=function(c){return c&&this.operator===c.operator&&this.sign===c.sign&&this.exp===c.exp&&this.parens===
c.parens};c.prototype.simplify=function(c){this.methods=c;return this.simplifyNode(this.methods)};c.prototype.simplifyNode=function(c){var e,b,a,d;this.methods=c;d=this;a=this.methods;c=0;for(e=a.length;c<e;c++)b=a[c],d=d[b].call(d),d.methods=this.methods;delete d.methods;return d};c.prototype.simpleFlatten=function(){return this};c.prototype.flatten=function(){return this};c.prototype.computeConstants=function(){return this};c.prototype.combineSimilar=function(){return this};c.prototype.expand=function(){return this};
c.prototype.distribute=function(){return this};c.prototype.removeIdentity=function(){return this};c.prototype.sort=function(){return this};c.prototype.spreadIdentity=function(){return this};c.prototype.stripIdentity=function(){return this};c.prototype.multiplyOne=function(c){null==c&&(c=!1);return(new CTATChemMultiplicationNode("TIMES",[new CTATChemConstantNode(1,c),this])).popNegation().pushNegation()};c.prototype.powerOne=function(c){null==c&&(c=!1);return(new CTATChemPowerNode("EXP",this,new CTATChemConstantNode(1,
c))).popInversion().pushInversion().popNegation()};c.prototype.compare=function(f,e){return c.operatorPrecedence(this.operator,f.operator)};c.prototype.compareSigns=function(c,e){return(Math.sign(this.sign-c.sign)||Math.sign(this.exp-c.exp))*e};c.prototype.countVariables=function(){return 0};c.prototype.pushNegation=function(){return this};c.prototype.popNegation=function(){return this};c.prototype.pushInversion=function(){return this};c.prototype.popInversion=function(){return this};c.prototype.negate=
function(){this.sign=-this.sign;return this};c.prototype.invert=function(){this.exp=-this.exp;return this};c.prototype.addition=function(){return"PLUS"===this.operator};c.prototype.subtraction=function(){return"MINUS"===this.operator};c.prototype.multiplication=function(){return"TIMES"===this.operator};c.prototype.division=function(){return"DIVIDE"===this.operator};c.prototype.intDivision=function(){return"IDIVIDE"===this.operator};c.prototype.power=function(){return"EXP"===this.operator};c.prototype.root=
function(){return"ROOT"===this.operator};c.prototype.negation=function(){return"UMINUS"===this.operator};c.prototype.unary=function(){var c;return"UPLUS"===(c=this.operator)||"UMINUS"===c};c.prototype.log=function(){var c;return"LOG"===(c=this.operator)||"LN"===c};c.prototype.constant=function(c){return!1};c.prototype.integer=function(){return!1};c.prototype.negated=function(){return 0>this.sign};c.prototype.inverted=function(){return 0>this.exp};c.prototype.parented=function(){return 0<this.parens};
c.prototype.even=function(){return!1};c.prototype.setUnit=function(c){this.units=c;return this};c.prototype.getVariables=function(){return[]};c.prototype.setVariable=function(){return this};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemTreeNode=c}).call(this);var CTATChemRelationNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f,g){this.operator=a;this.left=b;this.right=c;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(b,c);b.prototype.clone=function(){return new b(this.operator,this.left.clone(),this.right.clone(),this.parens,this.sign,this.exp)};b.prototype.toString=
function(a){null==a&&(a=!1);this.left.setParens(this.operator);this.right.setParens(this.operator);return b.__super__.toString.call(this,""+this.left.toString(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.right.toString(a))};b.prototype.evaluate=function(){return this.applyOperator(this.left.evaluate(),this.right.evaluate())};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};b.prototype.simplify=function(a){this.methods=
a;this.left=this.left.simplify(this.methods);this.right=this.right.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATChemConstantNode(this.evaluate()):this};b.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator="LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=[this.right,this.left];
this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};b.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};b.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};b.prototype.setVariable=function(a,b,c){return[this.left,this.right].forEach(function(d){return function(e,f){var g;return"VAR"===
e.operator&&e.variable===a?(g=c(),g.sign=e.sign,g.exp=e.exp,0===f?d.left=g:d.right=g):e.setVariable(a,b,c)}}(this))};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemRelationNode=c}).call(this);var CTATChemAdditionNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f){this.operator=a;this.terms=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(b,c);b.prototype.clone=function(){return new b(this.operator,this.terms.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};b.prototype.toString=function(a){null==
a&&(a=!1);return b.__super__.toString.call(this,this.terms.reduce(function(b){return function(c,d){d.setParens(b.operator);return""+c+(c&&!d.negated()?"+":"")+d.toString(a)}}(this),""))};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.terms.reduce(function(a){return function(b,c){return a.applyOperator(b,c.evaluate())}}(this),0))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(b,c){return b.equals(a.terms[c])})};
b.prototype.simplify=function(a){this.methods=a;this.terms=this.terms.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return b.__super__.simplify.apply(this,arguments)};b.prototype.simpleFlatten=function(){this.terms[0].negation()&&!this.terms[0].inverted()&&(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(a,b){b.inverted()||b.parented()||!b.addition()?a.push(b):a.push.apply(a,
b.pushNegation().terms);return a},[]);return this};b.prototype.flatten=function(){this.simpleFlatten();return this.pushNegation()};b.prototype.computeConstants=function(){var a,b;0<=(b=this.terms.findIndex(function(a){return a.constant()}))&&(a=this.terms[b].evaluate(),this.terms=this.terms.filter(function(c){return function(d,e){return e<=b||!d.constant()||(a=c.applyOperator(a,d.evaluate()))&&!1}}(this)),0===a&&1<this.terms.length?this.terms.splice(b,1):this.terms[b].set(a));return 1<this.terms.length?
this:this.pushInversion().terms[0]};b.prototype.combineSimilar=function(){var a;a=[];this.terms.forEach(function(b){var c,d;c=null;b.constant()?c=[null,b]:(b=b.multiplyOne(),c=[b,b.factors.shift()]);d=c[1].evaluate();if(b=a.find(function(a){var b;return null!=(b=a[0])?b.equals(c[0]):void 0}))return b[1]+=d;b=[c[0],d];return a.push(b)});this.terms=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATChemConstantNode(b[1],!1,0,1,1,void 0)).popNegation(),b[0]?(b[0].factors.unshift(b[1]),a.push(b[0].removeIdentity())):
a.push(b[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATChemConstantNode(0));return this.pushInversion().terms[0]};b.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);b=this.terms.filter(function(b){return!b.constant(0,a)});this.terms=b.length?b:this.terms.slice(0,1);return 1<this.terms.length?this:this.pushInversion().terms[0]};b.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,b){return-a.compare(b,
!0)});return this.stripIdentity()};b.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne(!0)});return this};b.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity(!0)});return this};b.prototype.compare=function(a,c){var d;return(d=b.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||this.terms.some(function(b,e){return d=b.compare(a.terms[e],c)})&&d||this.compareSigns(a,c)};b.prototype.countVariables=
function(){return this.terms.reduce(function(a,b){return a+b.countVariables()},0)};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};b.prototype.even=function(){return!this.inverted&&
this.terms.every(function(a){return a.even()})};b.prototype.getVariables=function(){var a;a=[];this.terms.forEach(function(b){return function(b){return a=a.concat(b.getVariables())}}(this));return a};b.prototype.setVariable=function(a,b,c){var d,e,f;d=0;for(f=[];d<this.terms.length;)"VAR"===this.terms[d].operator&&this.terms[d].variable===a?(e=c(),e.sign=this.terms[d].sign,e.exp=this.terms[d].exp,this.terms[d]=e):this.terms[d].setVariable(a,b,c),f.push(d++);return f};return b}(CTATChemTreeNode);"undefined"!==
typeof module&&null!==module?module.exports=c:this.CTATChemAdditionNode=c}).call(this);var CTATChemMultiplicationNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f){this.operator=a;this.factors=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(b,c);b.prototype.clone=function(){return new b(this.operator,this.factors.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};b.prototype.toString=
function(a){null==a&&(a=!1);return b.__super__.toString.call(this,this.factors.reduce(function(b){return function(c,d){var e,f;f=d.inverted()?(d.invert(),d.setParens("DIVIDE",!!c),e=d.toString(a),d.invert(),"/"):(d.setParens(b.operator,!!c),/^[\d+-]/.test(e=d.toString(a))&&/\d$/.test(c)?"*":"");return""+c+(c?f:"")+e}}(this),this.factors[0].inverted()?"1":""))};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.factors.reduce(function(a){return function(b,c){return a.applyOperator(b,
c.evaluate())}}(this),1))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.factors.length===a.factors.length&&this.factors.every(function(b,c){return b.equals(a.factors[c])})};b.prototype.simplify=function(a){this.methods=a;this.factors=this.factors.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return b.__super__.simplify.apply(this,arguments)};b.prototype.simpleFlatten=function(){this.division()&&this.factors[1].invert();this.operator="TIMES";
this.factors=this.factors.reduce(function(a,b){b.parented()||!b.multiplication()?a.push(b):a.push.apply(a,b.pushNegation().pushInversion().factors);return a},[]);return this};b.prototype.flatten=function(){this.simpleFlatten();return this.popNegation()};b.prototype.computeConstants=function(){var a,b;b=this.factors.findIndex(function(a){return a.constant()&&0<a.exp});b=0<=b?this.factors.splice(b,1)[0]:null;a=this.factors.findIndex(function(a){return a.constant()&&0>a.exp});a=0<=a?this.factors.splice(a,
1)[0]:null;[b,a].forEach(function(a){return function(b,c){var d;if(b&&(d=b.evaluate(),a.factors=a.factors.filter(function(c,e){return 0>c.exp*b.exp||!c.constant()||(d=a.applyOperator(d,c.evaluate()))&&!1}),!(1===d&&1<a.factors.length)&&(b.set(0===c?d:Math.pow(d,-1)),1===c)))return b.exp=-1}}(this));b&&a?(b.set(this.applyOperator(b.evaluate(),a.evaluate())),this.factors.unshift(b)):b?this.factors.unshift(b):a&&this.factors.push(a);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()};
b.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(b){var c,d,e,f;f=b.constant()?[null,b]:b.power()?b.exponent.constant()?(b.pushInversion(),[b.base,b.exponent]):(b.exponent=b.exponent.multiplyOne(),[b,b.exponent.factors.shift()]):(b=b.powerOne(),[b.base,b.exponent]);return(c=a.find(function(a){var b;return null!=(b=a[0])?b.equals(f[0]):void 0}))?c[1]+=(null!=(d=f[1])?d.evaluate():void 0)||1:a.push([f[0],(null!=(e=f[1])?e.evaluate():void 0)||1])});this.factors=a.reduce(function(a,
b){0!==b[1]&&(b[1]=(new CTATChemConstantNode(b[1])).popNegation(),b[0]?b[1].constant(1)?a.push(b[0]):b[1].constant(-1)?a.push(b[0].invert()):b[0].power()?(b[0].exponent.factors.unshift(b[1]),a.push(b[0])):a.push((new CTATChemPowerNode("EXP",b[0],b[1])).popInversion()):a.push(b[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATChemConstantNode(1));return this.pushNegation().pushInversion().factors[0]};b.prototype.distribute=function(){var a,b;
a=this.factors.filter(function(a){return!a.inverted()});b=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(b)||this.single(a)&&b.length&&this.distributed(b)?(this.distributed(b)?(a=this.distributeFactors(this.factors),b=[]):this.distributed(a)?(b=this.distributeFactors(this.factors),a=[]):(a=this.distributeFactors(a),b=this.distributeFactors(b)),this.factors=b.length?a.length?[this.packTerms(a),this.packTerms(b).invert()]:[this.packTerms(b).invert()]:
[this.packTerms(a)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()):this};b.prototype.distributedOrSingle=function(a){return this.distributed(a)||this.single(a)};b.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};b.prototype.single=function(a){return 1===a.length&&a[0].addition()};b.prototype.distributeFactors=function(a){var b;b=a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:
[a]}):[[a[0]]];a.slice(1).forEach(function(a){var c;return a.addition()?1===b.length?b=a.terms.map(function(a){var c;c=b[0].map(function(a){return a.clone()});a.multiplication()?c.push.apply(c,a.pushNegation().factors):c.push(a);return c}):b=b.reduce(function(b,c){b.push.apply(b,a.terms.map(function(a){var b;b=c.map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors.map(function(a){return a.clone()})):b.push(a.clone());return b}));return b},[]):1===b.length?
a.multiplication()?(c=b[0]).push.apply(c,a.pushNegation().factors):b[0].push(a):b.forEach(function(c,d){var e;return a.multiplication()?(e=b[d]).push.apply(e,a.pushNegation().factors.map(function(a){return a.clone()})):b[d].push(a.clone())})});return b};b.prototype.packTerms=function(a){var c;c=CTATChemTreeNode.diff(this.methods,["flatten","distribute"]);return(new CTATChemAdditionNode("PLUS",a.map(function(a){return(new b("TIMES",a)).popNegation().simplifyNode(c)}))).simplifyNode(c)};b.prototype.removeIdentity=
function(a){var b;null==a&&(a=!1);this.popNegation();b=this.factors.filter(function(b){return!b.constant(1,a)});this.factors=b.length?b:this.factors.slice(0,1);(b=this.factors.find(function(b){return b.constant(0,a)}))&&this.factors.every(function(a){return!a.inverted()&&(!a.power()||a.exponent.constant())})&&(this.factors=[b]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};b.prototype.sort=function(){this.spreadIdentity();this.factors=this.factors.sort(function(a,
b){return a.compare(b)});return this.stripIdentity()};b.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne(!0)});return this};b.prototype.stripIdentity=function(){this.factors=this.factors.map(function(a){return a.removeIdentity(!0)});return this.popNegation()};b.prototype.multiplyOne=function(a){null==a&&(a=!1);this.factors[0].constant()||this.factors.unshift(new CTATChemConstantNode(1,a));return this.pushNegation()};b.prototype.compare=function(a,c){var d,
e;return(e=b.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||(d=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,b){return e=a.compare(d[b],c)})&&e||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.factors.reduce(function(a,b){return a+b.countVariables()},0)};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};b.prototype.popNegation=function(){this.factors.forEach(function(a){return function(b){if(b.negated())return a.negate(),
b.negate()}}(this));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};b.prototype.even=function(){return!this.inverted()&&this.factors.every(function(a){return a.integer()})&&this.factors.some(function(a){return a.even()})};b.prototype.getVariables=function(){var a;a=[];this.factors.forEach(function(b){return function(b){return a=a.concat(b.getVariables())}}(this));return a};b.prototype.setVariable=
function(a,b,c){var d,e,f;d=0;for(f=[];d<this.factors.length;)"VAR"===this.factors[d].operator&&this.factors[d].variable===a?(e=c(),e.sign=this.factors[d].sign,e.exp=this.factors[d].exp,this.factors[d]=e):this.factors[d].setVariable(a,b,c),f.push(d++);return f};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemMultiplicationNode=c}).call(this);var CTATChemIntDivisionNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f,g){this.operator=a;this.dividend=b;this.divisor=c;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(b,c);b.prototype.clone=function(){return new b(this.operator,this.dividend.clone(),this.divisor.clone(),this.parens,this.sign,this.exp)};b.prototype.toString=
function(a){null==a&&(a=!1);this.dividend.setParens(this.operator);this.divisor.setParens(this.operator,!0);return b.__super__.toString.call(this,""+this.dividend.toString(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.divisor.toString(a))};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(),this.divisor.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};
b.prototype.simplify=function(a){this.methods=a;this.dividend=this.dividend.simplify(this.methods);this.divisor=this.divisor.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATChemConstantNode(this.evaluate()):this};b.prototype.removeIdentity=function(a){null==a&&(a=!1);return this.divisor.constant(1,a)?(this.intDivision()||(this.dividend=new CTATChemConstantNode(0,a)),this.pushNegation().pushInversion().dividend):
this.popNegation()};b.prototype.compare=function(a,c){return b.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,c)||this.divisor.compare(a.divisor,c)||this.operator!==a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.dividend.countVariables()+divisor.countVariables()};b.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};b.prototype.pushInversion=
function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};b.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};b.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};b.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};b.prototype.setVariable=function(a,b,
c){return[this.dividend,this.divisor].forEach(function(d){return function(e,f){var g;return"VAR"===e.operator&&e.variable===a?(g=c(),g.sign=e.sign,g.exp=e.exp,0===f?d.dividend=g:d.divisor=g):e.setVariable(a,b,c)}}(this))};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemIntDivisionNode=c}).call(this);var CTATChemUnaryNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f){this.operator=a;this.base=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}g(b,c);b.prototype.clone=function(){return new b(this.operator,this.base,this.parens,this.sign,this.exp)};b.prototype.toString=function(a){null==a&&(a=!1);this.base.setParens(this.operator);
return b.__super__.toString.call(this,""+CTATChemTreeNode.toOperatorString(this.operator)+this.base.toString(a))};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.base.equals(a.base)};b.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.flatten=function(){this.negation()&&
(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base.pushNegation()};b.prototype.compare=function(a,c){return a.unary()&&this.base.compare(a.base,c)||b.__super__.compare.apply(this,arguments)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.base.countVariables()};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return this.base.constant(a,b)};b.prototype.getVariables=function(){return this.base.getVariables()};b.prototype.setVariable=function(a,b,c){return"VAR"===this.base.operator&&this.base.variable===a?(a=c(),a.sign=this.base.sign,a.exp=this.base.exp,this.base=a):this.base.setVariable(a,b,c)};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemUnaryNode=c}).call(this);var CTATChemPowerNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f,g){this.operator=a;this.base=b;this.exponent=c;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(b,c);b.prototype.clone=function(){return new b(this.operator,this.base.clone(),this.exponent.clone(),this.parens,this.sign,this.exp)};b.prototype.toString=
function(a){null==a&&(a=!1);this.base.setParens(this.operator);this.exponent.setParens(this.operator);return b.__super__.toString.call(this,""+this.base.toString(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.exponent.toString(a))};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(),this.exponent.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};
b.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);this.exponent=this.exponent.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.flatten=function(){var a,b;this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();return this.base.power()?(b=CTATChemTreeNode.diff(this.methods,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],
this.exponent.multiplication()?a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATChemMultiplicationNode("TIMES",a)).simplifyNode(b),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.computeConstants=function(){return this.base.constant()&&(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATChemConstantNode(this.evaluate()),
this.exponent=null):(this.base=new CTATChemConstantNode((new b("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().base):this};b.prototype.powerOne=function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};b.prototype.expand=function(){var a,b,c;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||
this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));b=[this.base];c=1;for(a=a.evaluate();1<=a?c<a:c>a;1<=a?++c:--c)b.push(this.base.clone());this.base=(new CTATChemMultiplicationNode("TIMES",b)).simplifyNode(["distribute"]);return this.exponent?this:
this.pushBaseNegation().pushBaseInversion().base}return this};b.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,c){b.push.apply(b,a.exponent.terms.map(function(a){return[c.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),this.base=
this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.packFactors=function(a){var c;c=CTATChemTreeNode.diff(this.methods,["flatten"]);return new CTATChemMultiplicationNode("TIMES",a.map(function(a){return(new b("EXP",a[0],a[1])).simplifyNode(c)}))};b.prototype.removeIdentity=function(a){null==a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATChemConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;
if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};b.prototype.compare=function(a,c){return b.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(c?-1:1)||this.exponent.compare(a.exponent,c)||this.base.compare(a.base,c)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):
Infinity)};b.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};b.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};b.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};b.prototype.popInversion=
function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};b.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};b.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};b.prototype.setVariable=function(a,b,c){return[this.base,this.exponent].forEach(function(d){return function(e,f){var g;return"VAR"===e.operator&&e.variable===
a?(g=c(),g.sign=e.sign,g.exp=e.exp,0===f?d.base=g:d.exponent=g):e.setVariable(a,b,c)}}(this))};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemPowerNode=c}).call(this);var CTATChemVariableNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f,g){this.variableTable=a;this.variable=b;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.symDelim=null!=g?g:"";this.operator="VAR"}g(b,c);b.prototype.clone=function(){return new b(this.variableTable,this.variable,this.parens,this.sign,this.exp,
this.symDelim)};b.prototype.toString=function(a){null==a&&(a=!1);return b.__super__.toString.call(this,this.variable,this.symDelim,a)};b.prototype.evaluate=function(){var a;return b.__super__.evaluate.call(this,(null!=(a=this.variableTable)?a.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(d){return NaN}}.call(this))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.variable===a.variable};b.prototype.compare=function(a,c){c=null!=c?-1:1;return b.__super__.compare.apply(this,
arguments)||this.variable>a.variable&&c||this.variable<a.variable&&-c||this.compareSigns(a,c)};b.prototype.countVariables=function(){return 1};b.prototype.getVariables=function(){return[this.variable]};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemVariableNode=c}).call(this);var CTATChemConstantNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e,f,g){this.marked=null!=b?b:!1;this.parens=null!=c?c:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.operator="CONST";this.precision=g||0;0===this.precision&&(this.precision=void 0);this.value=CTATChemParser.chemRoundTo("string"===typeof a?parseFloat(a):a,15)}g(b,c);
b.prototype.clone=function(){return new b(this.value,this.marked,this.parens,this.sign,this.exp,this.precision)};b.prototype.toString=function(){return b.__super__.toString.call(this,this.value.toPrecision?this.value.toPrecision(this.precision):this.value)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.value)};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.value===a.value};b.prototype.multiplyOne=function(){return this};b.prototype.powerOne=
function(){return this};b.prototype.compare=function(a,c){c=null!=c?1:-1;return b.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*c||this.compareSigns(a,c)};b.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return null==a||this.evaluate()===a&&this.marked===b};b.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};b.prototype.even=
function(){return 0===this.evaluate()%2};b.prototype.set=function(a,b){this.exp=1;this.value=CTATChemParser.chemRoundTo(Math.abs(a),15);this.sign=Math.sign(a);return this.precision=b||void 0};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemConstantNode=c}).call(this);var CTATChemLogNode={};
(function(){var c,g=function(c,b){function a(){this.constructor=c}for(var d in b)f.call(b,d)&&(c[d]=b[d]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,e){this.val=a;this.operator=b;this.sign=null!=c?c:1;this.exp=null!=e?e:1}g(b,c);b.prototype.clone=function(){return new b(this.base,this.val,this.sign,this.exp)};b.prototype.toString=function(a){var c;null==a&&(a=!1);c="LOG"===this.operator?"log(":"ln(";c+=this.val.toString(a);
return b.__super__.toString.call(this,c+")")};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.val.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.val.equals(a.val)};b.prototype.simplify=function(a){this.methods=a;this.val=this.val.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.flatten=function(){return this};b.prototype.computeConstants=function(){var a;console.log("logNode computeConstants");
return this.val.constant()?(a=this.evaluate(),console.log("value is "+a),this.val=new CTATChemConstantNode(a),console.log("const node before set: "),console.log(this.val),this.val.set(a),console.log("const node after set: "),console.log(this.val),this.val):this};b.prototype.compare=function(a,c){return a.log()&&this.base.compare(a.base,c)||b.__super__.compare.apply(this,arguments)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.base.countVariables()};b.prototype.pushNegation=
function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return this.base.constant(a,b)};b.prototype.getVariables=function(){return this.val.getVariables()};b.prototype.setVariable=function(a,b,c){return"VAR"===this.base.operator&&this.base.variable===a?(a=c(),a.sign=this.base.sign,a.exp=this.base.exp,this.base=a):this.base.setVariable(a,
b,c)};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemLogNode=c}).call(this);var CTATChemGrammar=function(){function c(){this.yy={}}var g=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},f=[1,6],e=[1,7],b=[1,11],a=[1,12],d=[1,14],h=[1,13],l=[1,15],m=[1,16],n=[1,17],p=[1,25],r=[1,26],u=[5,7,8,9,10,11,12,13,15,32],w=[1,27],q=[1,28],y=[1,29],z=[1,32],B=[1,33],v=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,29,30,31,32,33,34,35,36],E=[1,37],C=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,26,29,30,31,32,33,34,35,36],A=[1,40],F=[1,41],K=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,
26,28,29,30,31,32,33,34,35,36],g={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedunitfactor:17,DIVIDE:18,ROOT:19,unitfactor:20,factor:21,IDIVIDE:22,REM:23,signedfactor:24,unit:25,UNIT:26,atom:27,EXP:28,SQRT:29,LOG:30,LPAREN:31,RPAREN:32,LN:33,VARIABLE:34,NUMBER:35,SUBSTANCE:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",
10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",19:"ROOT",22:"IDIVIDE",23:"REM",26:"UNIT",28:"EXP",29:"SQRT",30:"LOG",31:"LPAREN",32:"RPAREN",33:"LN",34:"VARIABLE",35:"NUMBER",36:"SUBSTANCE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,3],[14,2],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[17,1],[24,2],[24,2],[24,1],[20,2],[25,1],[21,3],[21,2],[21,1],[27,4],[27,4],[27,3],[27,1],[27,1],[27,1]],performAction:function(a,
b,c,d,e,f,g){b=f.length-1;switch(e){case 1:return f[b-1];case 2:this.$=new d.CTATChemRelationNode("LESS",f[b-2],f[b]);break;case 3:this.$=new d.CTATChemRelationNode("GREATER",f[b-2],f[b]);break;case 4:this.$=new d.CTATChemRelationNode("LESSEQUAL",f[b-2],f[b]);break;case 5:this.$=new d.CTATChemRelationNode("GREATEREQUAL",f[b-2],f[b]);break;case 6:this.$=new d.CTATChemRelationNode("EQUAL",f[b-2],f[b]);break;case 7:this.$=new d.CTATChemRelationNode("NOTEQUAL",f[b-2],f[b]);break;case 8:case 11:case 19:case 22:case 23:case 26:case 31:this.$=
f[b];break;case 9:this.$=new d.CTATChemAdditionNode("PLUS",[f[b-2],f[b]]);break;case 10:this.$=new d.CTATChemAdditionNode("MINUS",[f[b-2],f[b]]);break;case 12:this.$=new d.CTATChemMultiplicationNode("TIMES",[f[b-2],f[b]]);break;case 13:this.$=new d.CTATChemMultiplicationNode("DIVIDE",[f[b-2],f[b]]);break;case 14:this.$=new d.CTATChemPowerNode("ROOT",f[b-2],f[b]);break;case 15:case 16:this.$=new d.CTATChemMultiplicationNode("ITIMES",[f[b-1],f[b]]);break;case 17:this.$=new d.CTATChemIntDivisionNode("IDIVIDE",
f[b-2],f[b]);break;case 18:this.$=new d.CTATChemIntDivisionNode("REM",f[b-2],f[b]);break;case 20:case 24:this.$=new d.CTATChemUnaryNode("UPLUS",f[b]);break;case 21:case 25:this.$=new d.CTATChemUnaryNode("UMINUS",f[b]);break;case 27:this.$=f[b-1].setUnit(f[b]);break;case 28:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\#/g,""),0,1,1,"#");break;case 29:this.$=new d.CTATChemPowerNode("EXP",f[b-2],f[b]);break;case 30:this.$=new d.CTATChemPowerNode("ROOT",f[b],new d.CTATChemConstantNode(2));
break;case 32:this.$=new d.CTATChemLogNode(f[b-1],"LOG");break;case 33:this.$=new d.CTATChemLogNode(f[b-1],"LN");break;case 34:this.$=f[b-1];break;case 35:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\&/g,""),0,1,1,"&");break;case 36:this.$=new d.CTATChemConstantNode(a);break;case 37:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\$/g,""),0,1,1,"$")}},table:[{3:1,4:2,6:3,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{1:[3]},{5:[1,18]},{5:[2,
8],7:[1,19],8:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:p,15:r},g(u,[2,11],{27:10,20:30,21:31,16:w,18:q,19:y,22:z,23:B,29:b,30:a,31:d,33:h,34:l,35:m,36:n}),g(v,[2,19]),{13:f,15:e,17:34,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:f,15:e,17:35,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},g(v,[2,22]),g(v,[2,23],{25:36,26:E}),g(C,[2,31],{28:[1,38]}),{13:A,15:F,21:42,24:39,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{31:[1,43]},{31:[1,44]},{6:45,13:f,14:4,15:e,17:5,20:8,21:9,27:10,
29:b,30:a,31:d,33:h,34:l,35:m,36:n},g(K,[2,35]),g(K,[2,36]),g(K,[2,37]),{1:[2,1]},{6:46,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{6:47,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{6:48,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{6:49,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{6:50,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{6:51,13:f,14:4,15:e,17:5,20:8,
21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:f,14:52,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:f,14:53,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:f,15:e,17:54,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:f,15:e,17:55,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:f,15:e,17:56,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},g(v,[2,15]),g(v,[2,16],{25:36,26:E}),{13:f,15:e,17:57,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,
36:n},{13:f,15:e,17:58,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},g(v,[2,20]),g(v,[2,21]),g(v,[2,27]),g(v,[2,28]),{13:A,15:F,21:42,24:59,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},g(C,[2,30]),{13:A,15:F,21:42,24:60,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:A,15:F,21:42,24:61,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},g(C,[2,26]),{6:62,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{6:63,13:f,14:4,15:e,17:5,20:8,21:9,27:10,29:b,30:a,31:d,33:h,34:l,35:m,36:n},{13:p,
15:r,32:[1,64]},{5:[2,2],13:p,15:r},{5:[2,3],13:p,15:r},{5:[2,4],13:p,15:r},{5:[2,5],13:p,15:r},{5:[2,6],13:p,15:r},{5:[2,7],13:p,15:r},g(u,[2,9],{27:10,20:30,21:31,16:w,18:q,19:y,22:z,23:B,29:b,30:a,31:d,33:h,34:l,35:m,36:n}),g(u,[2,10],{27:10,20:30,21:31,16:w,18:q,19:y,22:z,23:B,29:b,30:a,31:d,33:h,34:l,35:m,36:n}),g(v,[2,12]),g(v,[2,13]),g(v,[2,14]),g(v,[2,17]),g(v,[2,18]),g(C,[2,29]),g(C,[2,24]),g(C,[2,25]),{13:p,15:r,32:[1,65]},{13:p,15:r,32:[1,66]},g(K,[2,34]),g(K,[2,32]),g(K,[2,33])],defaultActions:{18:[2,
1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else{var c=function(a,b){this.message=a;this.hash=b};c.prototype=Error;throw new c(a,b);}},parse:function(a){var b=[0],c=[null],d=[],e=this.table,f="",g=0,h=0,m=0,n=d.slice.call(arguments,1),l=Object.create(this.lexer),p={},q;for(q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p[q]=this.yy[q]);l.setInput(a,p);p.lexer=l;p.parser=this;"undefined"==typeof l.yylloc&&(l.yylloc={});q=l.yylloc;d.push(q);var r=l.options&&l.options.ranges;
this.parseError="function"===typeof p.parseError?p.parseError:Object.getPrototypeOf(this).parseError;for(var w,y,u,v,z={},A,B;;){u=b[b.length-1];if(this.defaultActions[u])v=this.defaultActions[u];else{if(null===w||"undefined"==typeof w)w=l.lex()||1,"number"!==typeof w&&(w=this.symbols_[w]||w);v=e[u]&&e[u][w]}if("undefined"===typeof v||!v.length||!v[0]){var ia;B=[];for(A in e[u])this.terminals_[A]&&2<A&&B.push("'"+this.terminals_[A]+"'");ia=l.showPosition?"Parse error on line "+(g+1)+":\n"+l.showPosition()+
"\nExpecting "+B.join(", ")+", got '"+(this.terminals_[w]||w)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==w?"end of input":"'"+(this.terminals_[w]||w)+"'");this.parseError(ia,{text:l.match,token:this.terminals_[w]||w,line:l.yylineno,loc:q,expected:B})}if(v[0]instanceof Array&&1<v.length)throw Error("Parse Error: multiple actions possible at state: "+u+", token: "+w);switch(v[0]){case 1:b.push(w);c.push(l.yytext);d.push(l.yylloc);b.push(v[1]);w=null;y?(w=y,y=null):(h=l.yyleng,f=l.yytext,g=
l.yylineno,q=l.yylloc,0<m&&m--);break;case 2:B=this.productions_[v[1]][1];z.$=c[c.length-B];z._$={first_line:d[d.length-(B||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(B||1)].first_column,last_column:d[d.length-1].last_column};r&&(z._$.range=[d[d.length-(B||1)].range[0],d[d.length-1].range[1]]);u=this.performAction.apply(z,[f,h,g,p,v[1],c,d].concat(n));if("undefined"!==typeof u)return u;B&&(b=b.slice(0,-2*B),c=c.slice(0,-1*B),d=d.slice(0,-1*B));b.push(this.productions_[v[1]][0]);
c.push(z.$);d.push(z._$);v=e[b[b.length-2]][b[b.length-1]];b.push(v);break;case 3:return!0}}}},f=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&
(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;
a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+
this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=
this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,
last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+
1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);
this.done&&this._input&&(this.done=!1);if(c)return c;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;
return a?(a=this.test_match(a,d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-
1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 1:return 31;case 2:return 32;case 3:return 28;case 4:return 28;case 5:return 19;case 6:return 29;case 7:return 29;case 8:return 30;
case 9:return 33;case 10:return 16;case 11:return 16;case 12:return 22;case 13:return 18;case 14:return 18;case 15:return 23;case 16:return 15;case 17:return 13;case 18:return 9;case 19:return 9;case 20:return 10;case 21:return 10;case 22:return 7;case 23:return 8;case 24:return 12;case 25:return 12;case 26:return 12;case 27:return 12;case 28:return 11;case 29:return 11;case 30:return 35;case 31:return 35;case 32:return 26;case 33:return 36;case 34:return 34;case 35:return 34;case 36:return 34;case 37:return 5}},
rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:sqrt\b)/,/^(?:log\b)/,/^(?:ln\b)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:#[^\#\s]+#)/,/^(?:\$[^\$\s]+\$)/,/^(?:&[^\&\s]+&)/,
/^(?:deltaT\b)/,/^(?:([A-Za-z]))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],inclusive:!0}}}}();g.lexer=f;c.prototype=g;g.Parser=c;return new c}();var CTATChemParser={};
(function(){var c;c=function(){function c(c){this.parser=new CTATChemGrammar.Parser;this.parser.yy={CTATChemRelationNode:CTATChemRelationNode,CTATChemAdditionNode:CTATChemAdditionNode,CTATChemMultiplicationNode:CTATChemMultiplicationNode,CTATChemIntDivisionNode:CTATChemIntDivisionNode,CTATChemUnaryNode:CTATChemUnaryNode,CTATChemLogNode:CTATChemLogNode,CTATChemPowerNode:CTATChemPowerNode,CTATChemVariableNode:CTATChemVariableNode,CTATChemConstantNode:CTATChemConstantNode,CTATChemTreeNode:CTATChemTreeNode};this.parser.yy.variableTable=
c}c.none=["simpleFlatten"];c.partial=["flatten","removeIdentity"];c.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");c.compConstants=["flatten","computeConstants"];c.CHEM_DECIMAL_PRECISION=-1;c.prototype.chemParse=function(f,e){var b;null==e&&(e=!1);try{return b="string"===typeof f?this.parser.parse(f):f,b.simplify(c.none.concat(e?"sort":[]))}catch(a){return console.log("error parsing "+f+" : "),console.log(a),null}};c.prototype.chemStringify=function(c,e){null==
e&&(e=!1);return null!=c?c.toString(e):c};c.prototype.chemEvaluate=function(f){var e;try{return e="string"===typeof f?this.parser.parse(f):f,e.simplify(c.none).evaluate()}catch(b){return console.log(b),null}};c.prototype.chemPartialSimplify=function(f,e,b){var a;null==e&&(e=!1);null==b&&(b=!1);try{return a="string"===typeof f?this.parser.parse(f):f,a.simplify(c.partial.concat(e?"sort":[])).toString(b)}catch(d){return null}};c.prototype.chemSimplify=function(f,e,b){var a;null==e&&(e=!1);null==b&&(b=
!1);try{return a="string"===typeof f?this.parser.parse(f):f,a.simplify(c.full.concat(e?"sort":[])).toString(b)}catch(d){return console.log(d),null}};c.prototype.chemComputeConstants=function(f,e){var b;null==e&&(e=!1);try{return b="string"===typeof f?this.parser.parse(f):f,b.simplify(c.compConstants).toString(e)}catch(a){return console.log(a),null}};c.prototype.chemValid=function(c,e){var b,a;null==e&&(e=!1);return null!=(b=this.chemParse(c,!0))&&null!=(a=this.chemParse(c,!e))?b.toString()===a.toString():
null};c.prototype.chemValued=function(c){var e;return null!=(e=this.chemEvaluate(c))?!isNaN(e):null};c.prototype.chemPartialSimplified=function(c,e){var b,a;null==e&&(e=!1);return null!=(b=this.chemPartialSimplify(c,!0))&&null!=(a=this.chemParse(c,!e))?b===a.toString():null};c.prototype.chemSimplified=function(c,e){var b,a;null==e&&(e=!1);return null!=(b=this.chemSimplify(c,!0))&&null!=(a=this.chemParse(c,!e))?b===a.toString():null};c.prototype.chemConstantsComputed=function(c){var e,b;return null!=
(e=this.chemComputeConstants(c))&&null!=(b=this.chemParse(c))?e===b.toString():null};c.prototype.chemIdentical=function(c,e,b){var a,d;null==b&&(b=!1);return null!=(a=this.chemParse(c,!b))&&null!=(d=this.chemParse(e,!b))?a.toString()===d.toString():null};c.prototype.chemEqual=function(c,e){var b,a;return null!=(b=this.chemEvaluate(c))&&null!=(a=this.chemEvaluate(e))?b===a:null};c.prototype.chemPartialEquivalent=function(c,e,b){var a,d;null==b&&(b=!1);return null!=(a=this.chemPartialSimplify(c,!b))&&
null!=(d=this.chemPartialSimplify(e,!b))?a===d:null};c.prototype.chemEquivalent=function(c,e,b){var a,d;null==b&&(b=!1);return null!=(a=this.chemSimplify(c,!b))&&null!=(d=this.chemSimplify(e,!b))?a===d:null};c.prototype.isChemValid=c.prototype.chemValid;c.prototype.chemEval=c.prototype.chemEvaluate;c.prototype.chemStrictEquivTermsSameOrder=function(c,e){return this.chemPartialEquivalent(c,e,!0)};c.prototype.chemEquivTermsSameOrder=c.prototype.chemStrictEquivTermsSameOrder;c.prototype.chemStrictEquivTerms=
c.prototype.chemPartialEquivalent;c.prototype.chemEquivTerms=c.prototype.chemStrictEquivTerms;c.prototype.chemEquiv=c.prototype.chemEquivalent;c.prototype.isSimplified=function(c){return this.chemSimplified(c,!0)};c.prototype.calc=c.prototype.chemEvaluate;c.prototype.calca=function(c){return(+this.chemEvaluate(c)).toFixed(2)};c.prototype.simplify=function(c){return this.chemSimplify(c,!0)};c.prototype.algebraicEqual=c.prototype.chemEqual;c.prototype.patternMatches=function(c,e){return this.chemIdentical(c,
e,!0)};c.prototype.polyTermsEqual=function(f,e){return this.parser.parse(f).simplify(c.partial).equals(this.parser.parse(e).simplify(c.partial))};c.prototype.algebraicMatches=function(c,e){return this.chemEquivalent(c,e,!0)};c.prototype.expressionMatches=c.prototype.algebraicMatches;c.prototype.chemGetQuadraticCoefficients=function(c,e){var b,a,d,f,g,m,n,p,r,u,w,q;b=e?this.chemSimplify(c,!1,!0):c;a=this.chemParse(b);b=null;u=[];q=null;"EQUAL"===a.operator&&("PLUS"===a.left.operator&&"CONST"===a.right.operator&&
0===a.right.value?b=a.left:"PLUS"===a.right.operator&&"CONST"===a.left.operator&&0===a.left.value&&(b=a.right));if(b&&1<b.terms.length&&4>b.terms.length){a=function(a){var b,c,d,e;c=e=b=null;d=1;"TIMES"===a.operator&&2===a.factors.length?(a.factors.forEach(function(b){return function(b,d){if("EXP"===b.operator)return e=b,c=a.factors[0===d?1:0]}}(this)),d=a.sign):"EXP"===a.operator&&(e=a);!e||"VAR"!==e.base.operator||2!==e.exponent.value||q&&e.base.variable!==q||((q||(q=e.base.variable),!c||"CONST"!==
c.operator&&"UMINUS"!==c.operator)?c||(b=a.sign):b=c.evaluate()*d);return b};d=function(a){var b,c,d;c=d=b=null;"TIMES"===a.operator&&2===a.factors.length?a.factors.forEach(function(b){return function(b,e){if("VAR"===b.operator&&(!q||b.variable===q))return q||(q=b.variable),d=b,c=a.factors[0===e?1:0]}}(this)):"VAR"!==a.operator||q&&a.variable!==q||(q||(q=a.variable),d=a);d&&(c&&"CONST"===c.operator?b=c.evaluate()*a.sign:c||(b=a.sign));return b};f=function(a){var b;b=null;"CONST"===a.operator&&(b=
a.evaluate());return b};a={a:a,b:d,c:f};m=["a","b","c"];for(f=g=0;3>g;f=++g)if(b.terms[f]){w=r=null;d=n=0;for(p=m.length;0<=p?n<p:n>p;d=0<=p?++n:--n)if(a[m[d]]&&(r=a[m[d]](b.terms[f]))){w=d;break}if(null===r)return null;u[w]=r;delete a[m[w]]}if(!u[0]||!u[1])return null;u[2]||(u[2]=0);return u}return null};c.prototype.chemSolveQuadratic=function(c,e,b){var a;a=Math.pow(e,2)-4*c*b;b=[];0===a?b.push(""+-e/(2*c)):0<a?(a=Math.sqrt(a),b.push(""+(-e+a)/(2*c)),b.push(""+(-e-a)/(2*c))):(a=Math.sqrt(Math.abs(a)),
c*=2,a/=c,e=-e/c,b.push(e+"+"+a+"i"),b.push(e+"-"+a+"i"));return b};c.prototype.chemGetVariables=function(c){var e,b;c=this.chemParse(c).getVariables();b=[];e={};c.forEach(function(a){return function(a){if(!e[a])return b.push(a),e[a]=!0}}(this));return b};c.prototype.chemSetVariable=function(c,e,b){c=this.chemParse(c);if("VAR"===c.operator)return c.variable===e?this.chemParse(b):c;c.setVariable(e,b,this.chemParse.bind(this,b));return c};c.prototype.chemSetPrecision=function(c,e){c="string"===typeof c?
this.chemParse(c):c;switch(c.operator){case "TIMES":c.factors.forEach(function(b){return function(a){return b.chemSetPrecision(a,e)}}(this));break;case "PLUS":c.terms.forEach(function(b){return function(a){return b.chemSetPrecision(a,e)}}(this));break;case "EXP":this.chemSetPrecision(c.base,e);this.chemSetPrecision(c.exponent,e);break;case "EQUAL":this.chemSetPrecision(c.left,e);this.chemSetPrecision(c.right,e);break;case "UMINUS":this.chemSetPrecision(c.base,e);break;case "CONST":c.precision=e}return c};
c.prototype.chemGetPrecision=function(c){var e,b,a;b=function(a){var b,c;b=Math.log(10);a=String(a);(c=/^(\d(\.\d+)?)e(\+|-)\d/.exec(a))&&(a=c[1]);c=(c=/\.[0-9]*?(0+)$/.exec(a))?c[1].length:0;a=Math.abs(a.replace(".",""));if(0===a)return 0;for(;0!==a&&0===a%10;)a/=10;return c+Math.floor(Math.log(a)/b)+1};if(!isNaN(c))return b(c);c="string"===typeof c?this.chemParse(c):c;a=null;e=function(a){return function(b){var c;c=Number.POSITIVE_INFINITY;b.forEach(function(b){b=a.chemGetPrecision(b);return c=
b<c?b:c});return c}}(this);switch(c.operator){case "TIMES":a=e(c.factors);break;case "PLUS":a=e(c.terms);break;case "EXP":a=e([c.base,c.exponent]);break;case "EQUAL":a=e([c.left,c.right]);break;case "UMINUS":a=this.chemGetPrecision(c.base);break;case "CONST":a=c.precision?c.precision:b(c.value)}return a};c.prototype.chemToPrecision=function(c,e,b,a){var d,f;c="string"===typeof c?this.chemParse(c):c;a=a||{};switch(c.operator){case "TIMES":c.factors.forEach(function(c){return function(d){return c.chemToPrecision(d,
e,b,a)}}(this));break;case "PLUS":c.terms.forEach(function(c){return function(d){return c.chemToPrecision(d,e,b,a)}}(this));break;case "EXP":this.chemToPrecision(c.base,e,b,a);this.chemToPrecision(c.exponent,e,b,a);break;case "EQUAL":this.chemToPrecision(c.left,e,b,a);this.chemToPrecision(c.right,e,b,a);break;case "UMINUS":this.chemToPrecision(c.base,e,b,a);break;case "CONST":f=+c.evaluate().toPrecision(e),a[f]=c.value,d=c.exp,c.set(f,c.precision),c.exp=d}return{result:c.toString(b),roundedVals:a}};
c.chemRoundTo=function(c,e){var b;b=String(Math.round(c*("10e"+(e-1))));b.includes("e")?(b=b.split("e"),b=Number(b[0]+"e"+String(Number(b[1])-e))):b=Number(b+"e-"+e);return b};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemParser=c}).call(this);var CTATVariableTableCount=0,CTATVariableTable=function(){function c(e){var b={},a;for(a in e)!0===e.hasOwnProperty(a)&&(b[a]="object"!==typeof e[a]?e[a]:c(e[a]));return b}CTATBase.call(this,"CTATVariableTable","");CTATVariableTableCount++;var g={},f=this;this.toString=function(){var c="",b;for(b in g)0<c.length&&(c+=", "),c=c+b+"="+g[b];return"{ "+c+" }"};this.clone=function(){ctatdebug("CTATVariableTable --\x3e in clone; this "+this+", this.getTable() "+this.getTable);var e=new CTATVariableTable;
ctatdebug("CTATVariableTable --\x3e in clone; copy "+e+", copy.setTable() "+e.setTable);e.setTable(c(g));ctatdebug("CTATVariableTable --\x3e out of clone");return e};this.put=function(c,b){f.ctatdebug("CTATVariableTable.put("+c+", "+b+") typeof value "+typeof b);var a;if(c)if(0>c.indexOf("."))g[c]=b;else{var d=c.split(".");if("object"!==typeof g[d[0]]||null===g[d[0]])g[d[0]]={};a=g[d[0]];for(var e=1;e<d.length-1;e++)if("object"!==typeof a[d[e]]||null===a[d[e]])a[d[e]]={},a=a[d[e]];a[d[e]]=b}else console.log("CTATVariableTable.put() warning: null or empty variable name '"+
c+"'");return f};this.getTable=function(){return g};this.setTable=function(c){g=c};this.get=function(c){if(0>c.indexOf("."))return null===g[c]||"undefined"===typeof g[c]?null:g[c];var b=c.split(".");if(null===g[b[0]]||"undefined"===typeof g[b[0]])return null;c=g[b[0]];for(var a=1;a<b.length-1;a++){if(null===c[b[a]]||"undefined"===typeof c[b[a]])return null;c=c[b[a]]}return null===c[b[a]]||"undefined"===typeof c[b[a]]?null:c[b[a]]}};
Object.defineProperty(CTATVariableTable,"serialVersionUID",{enumerable:!1,configurable:!1,writable:!1,value:"201403071830L"});CTATVariableTable.standardizeType=function(c){if("string"!=typeof c||1>c.trim().length)return c;if((!0).toString()==c)return!0;if((!1).toString()==c)return!1;if("null"==c)return null;var g=Number(c);return isNaN(g)?c:g};CTATVariableTable.valueAsString=function(c){return"string"==typeof c?c:String(c)};CTATVariableTable.nameAsString=function(c){return c?c+"_String":null};
CTATVariableTable.prototype=Object.create(CTATBase.prototype);CTATVariableTable.prototype.constructor=CTATVariableTable;"undefined"!==typeof module&&(module.exports=CTATVariableTable);var CTATFormulaFunctions={};
(function(){var c,g,f,e,b,a,d,h,l,m,n,p,r,u=[].slice;a=/^([-+])?(?:(\d+)(?:$|\s))?(?:(\d+)\/(\d+))?$/;b=/^\d+(\.\d\d)?$/;d=RegExp("((\\d+)\\.?(\\d+)?|\\.(\\d+))([Ee]([+-]?\\d+))?","g");p=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?$/;e=/^s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*\/s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*$/;n=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?/;m=/^\s*\(\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\,\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\)\s*$/;l=
/([bcdfghjklmnpqrstvwxz]|qu)y$/;h=/([bcdfghjklmnpqrstvwxz]o|[sc]h|s)$/;r=function(a,b){var c;null==b&&(b=!1);var d,e,f,g;f=null!=(c=a[4])?c:a[2]+(a[3]||"");g=[];d=0;for(e=f.length;d<e;d++)c=f[d],(b||(b="0"!==c))&&g.push(c);return g.length};f=function(a){return(a[4]||a[3]||"").length-+(a[6]||0)};g=function(a,b,c){var d,e;return isNaN(d=+a)||isNaN(e=+b)?c(String(a).toLowerCase(),String(b).toLowerCase()):c(d,e)};c=function(){function c(){}c.printf=("undefined"!==typeof window&&null!==window?window:global).sprintf;
c.sum=function(){return(1<=arguments.length?u.call(arguments,0):[]).reduce(function(a,b){return a+ +b},0)};c.mod=function(a,b){return Math.round(a)%Math.round(b)};c.modf=function(a,b){return a%b};c.IEEEremainder=c.modf;c.isFactor=function(a,b){return 1!==+a&&0===b%a};c.isMultiple=function(a,b){return 0===a%b};c.isUnit=function(a){return 1===+a};c.isAny=function(a,b){return this.isFactor(a,b)||this.isMultiple(a,b)||this.isUnit(a)};c.gcf=function(a,b){var c;c=[Math.abs(a),Math.abs(b)];a=c[0];for(b=
c[1];0<b;)c=[b,a%b],a=c[0],b=c[1];return a};c.lcm=function(a,b){return Math.abs(a*b)/this.gcf(a,b)};c.inRange=function(a,b,c){null==b&&(b=-Infinity);null==c&&(c=Infinity);return b<=a&&a<=c};c.integerInRange=function(a,b,c){var d;null==b&&(b=-Infinity);null==c&&(c=Infinity);return Math.round(b)<=(d=Math.round(a))&&d<=Math.round(c)};c.fmtDecimal=function(a,b){null==b&&(b=2);return(+a).toFixed(Math.round(+b))};c.fmtNormal=function(a,b){null==b&&(b=6);return this.fmtDecimal(a,b).replace(/\.0+$|(\..+?)0+$/,
"$1")};c.fmtDollar=function(a,b){null==b&&(b="");a=this.fmtDecimal(a);b=b.toLowerCase();0<=b.indexOf("i")&&(a=a.replace(/\.00$/,""));return 0<=b.indexOf("d")?"$"+a:a};c.dollarEquals=function(){var a,b;a=arguments[0];b=2<=arguments.length?u.call(arguments,1):[];a=this.fmtDollar(a,"i");return b.some(function(b){return function(c){return a===b.fmtDollar(c,"i")}}(this))};c.matchWithPrecision=function(a,b){var c,d;return(c=String(a).match(p))&&(d=String(b).match(p))&&r(c)===r(d)&&g(a,b,function(a,b){return a===
b})};c.matchWithoutPrecision=function(a,b){var c,d;return(c=String(a).match(p))&&(d=String(b).match(p))&&(a=r(c)>r(d)?(+a).toFixed(f(d)):String(a))&&g(a,b,function(a,b){return a===b})};c.constantsConform=function(){var a,b;a=arguments[0];b=2<=arguments.length?u.call(arguments,1):[];b=b.map(function(a){return"string"===typeof a?new RegExp(a,"i"):a});return(a.match(d)||[]).every(function(a){return b.some(function(b){return b.test(a)})})};c.constantsDollar=function(a){return this.constantsConform(a,
b)};c.isInteger=function(a,b){null==b&&(b=!0);return Number.isInteger(b&&+a||a)};c.isNumber=function(a,b){null==b&&(b=!0);return Number.isFinite(b&&+a||a)};c.isVar=function(a){return/^\s*[a-zA-Z]\s*$/.test(a)};c.makeFraction=function(a,b,c,d){""!==a&&"+"!==a&&"-"!==a&&(d=["",a,b,c],a=d[0],b=d[1],c=d[2],d=d[3]);null!=c&&null==d&&(d=[0,b,c],b=d[0],c=d[1],d=d[2]);b=+b||0;c=+c||0;d=+d||1;return this.isInteger(b)&&this.isInteger(c)&&this.isInteger(d)?a+(b?b+(c?" ":""):"")+(c?c+(1===d?"":"/"+d):""):null};
c.fractionMake=c.makeFraction;c.getSign=function(b){return null!=(b=String(b).match(a))?b[1]||"":null};c.getWhole=function(b){return null!=(b=String(b).match(a))?(b[1]||"")+(b[2]||"0"):null};c.getNumerator=function(b){return null!=(b=String(b).match(a))?(b[1]||"")+(b[3]||"0"):null};c.getDenominator=function(b){return null!=(b=String(b).match(a))?b[4]||"1":null};c.convertToMixed=function(b){return null!=(b=String(b).match(a))?this.makeFraction(b[1]||"",(+b[2]||0)+Math.floor((+b[3]||0)/(+b[4]||1)),
(+b[3]||0)%(+b[4]||1),b[4]):null};c.convertToImproper=function(b){return null!=(b=String(b).match(a))?this.makeFraction(b[1]||"",0,(+b[2]||0)*(+b[4]||1)+(+b[3]||0),b[4]||1):null};c.evaluateFraction=function(b){return null!=(b=String(b).match(a))?((b[1]||"+")+"1")*((+b[2]||0)*(+b[4]||1)+(+b[3]||0))/(+b[4]||1):null};c.simplifyFraction=function(b){var c;return null!=(b=String(b).match(a))?(null!=b[2]&&null!=b[3]&&(b[2]=+b[2]+Math.floor(+b[3]/+b[4]),b[3]=+b[3]%+b[4]),c=null!=b[3]?this.gcf(+b[3],+b[4]):
1,this.makeFraction(b[1]||"",b[2],b[3]/c,b[4]/c)):null};c.fractionsimplify=c.simplifyFraction;c.simplifyMixed=c.simplifyFraction;c.simplifiedFraction=function(a){var b;return null!=(b=this.simplifyFraction(a))?b===a:null};c.isSimplifiedMixed=c.simplifiedFraction;c.fractionEquals=function(a,b){var c,d;return null!=(c=this.evaluateFraction(a))&&null!=(d=this.evaluateFraction(b))?c===d:null};c.simplifiedFractionEquals=function(a,b){var c,d;return null!=(c=this.simplifiedFraction(a))&&null!=(d=this.simplifiedFraction(b))?
c&&d&&this.fractionEquals(a,b):null};c.rationalEquals=function(a,b){return this.matchWithoutPrecision(+b||this.evaluateFraction(b),+a||this.evaluateFraction(a))};c.getDividend=function(a){var b;return null!=(b=String(a).match(e))?b[1]:null};c.getDivisor=function(a){var b;return null!=(b=String(a).match(e))?b[8]:null};c.divEvaluate=function(a){var b;return null!=(b=String(a).match(e))?+b[1]/b[8]:null};c.matchQuantNumber=function(a,b,c){var d;return(d=+String(a).match(n)[0])&&d>=b-c&&d<=b+c};c.matchQuantUnit=
function(){var a,b,c,d;b=arguments[0];d=2<=arguments.length?u.call(arguments,1):[];return(a=String(b).match(n)[0])&&(c=b.slice(a.length).trim())&&d.includes(c)};c.quote=function(a){return'"'+a+'"'};c.compact=function(a){return String(a).replace(/\s*/g,"")};c.equalsIgnoreCase=function(a,b){return a===b||String(a).toLowerCase()===String(b).toLowerCase()};c.replaceFirst=function(a,b,c){return String(a).replace(new RegExp(b),c)};c.replaceAll=function(a,b,c){return String(a).replace(new RegExp(b,"g"),
c)};c.regExMatch=function(a,b,c){return("string"===typeof a?new RegExp(a,c):a).test(b)};c.rm1coeff=function(a){if(null!=a)return String(a).replace(/(^|[^0-9])1([a-zA-Z])/g,"$1$2")};c.setMatches=function(a,b,c){var d,e;d=a.split(c);e=b.split(c);return e.every(function(a){return d.includes(a)})&&d.every(function(a){return e.includes(a)})};c.pointInRange=function(a,b,c,d,e){var f,g,h;if(f=null!=b?"function"===typeof b.match?b.match(m):void 0:void 0)e=[f[1],f[8],c,d],b=e[0],c=e[1],d=e[2],e=e[3];null==
d&&(d=0);null==e&&(e=d);return(f=a.match(m))&&b-d<=(g=f[1])&&g<=+b+ +d&&c-e<=(h=f[8])&&h<=+c+ +e};c.plural=function(a,b,c,d){var e;if(!b||2>a)return b;null==c&&(c=l.test(e=b.toLowerCase())?"y":"");if(!b.endsWith(c))return b;null==d&&(d=l.test(e)?"ies":h.test(e)?"es":"s");c.length&&(b=b.split(c)[0]);return b+(/[A-Z]/.test(b[b.length-1])?d.toUpperCase():d)};c.first=function(){return(1<=arguments.length?u.call(arguments,0):[])[0]};c.last=function(){var a;a=1<=arguments.length?u.call(arguments,0):[];
return a[a.length-1]};c.chooseRandomly=function(){var a;a=1<=arguments.length?u.call(arguments,0):[];return a[Math.floor(Math.random()*a.length)]};c.firstNonNull=function(){var a;return null!=(a=(1<=arguments.length?u.call(arguments,0):[]).find(function(a){return null!=a}))?a:null};c.valueOrZero=function(){var a;return null!=(a=(1<=arguments.length?u.call(arguments,0):[]).find(function(a){return null!=a}))?a:0};c.hasValue=function(){return(1<=arguments.length?u.call(arguments,0):[]).every(function(a){return null!=
a})};c.equals=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?u.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.every(function(a){return b===(null!=a?a:void 0)}):c.every(function(b){return a===+(null!=b?b:NaN)})};c.memberOf=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?u.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.some(function(a){return b===(null!=a?a:void 0)}):c.some(function(b){return a===+(null!=b?b:NaN)})};c.greaterThan=function(a,b){return g(a,
b,function(a,b){return a>b})};c.lessThan=function(a,b){return g(a,b,function(a,b){return a<b})};c.greaterThanOrEqual=function(a,b){return g(a,b,function(a,b){return a>=b})};c.lessThanOrEqual=function(a,b){return g(a,b,function(a,b){return a<=b})};c.equal=function(a,b){return g(a,b,function(a,b){return a===b})};c.notEqual=function(a,b){return g(a,b,function(a,b){return a!==b})};c.and=function(){return(1<=arguments.length?u.call(arguments,0):[]).reduce(function(a,b){return a&&b},!0)};c.or=function(){return(1<=
arguments.length?u.call(arguments,0):[]).reduce(function(a,b){return a||b},!1)};c.not=function(a){return!a};c.ifThen=function(a,b,c){return a?b:c};c.assign=function(a,b){var c,d,e,f,g,h;h="undefined"!==typeof window&&null!==window?window:global;d=a.split(".");e=2<=d.length?u.call(d,0,c=d.length-1):(c=0,[]);f=d[c++];c=0;for(g=e.length;c<g;c++)d=e[c],h=null!=h[d]?h[d]:h[d]={};return h[f]=b};c.length=function(a){return a.length};c.toString=function(a){return a.toString()};return c}();"undefined"!==typeof module&&
null!==module?module.exports=c:this.CTATFormulaFunctions=c}).call(this);var CTATFormulaActions={};
(function(){var c;c=function(){function c(){}c.goToState=function(c){return CTAT.ToolTutor.tutor.goToState(c)};c.goToStartState=function(){return CTAT.ToolTutor.tutor.goToStartState()};c.performInterfaceAction=function(c,e,b){return CTAT.ToolTutor.sendToInterface((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATMessage.makeTransactionId(),new CTATSAI(c,e,b)))};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATFormulaActions=c}).call(this);var CTATFormulaParser={};
(function(){var c,g,f,e,b=[].slice,a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=/"(?:[^\\"]|\\\")*"|'(?:[^\\'']|\\\')*'/;g=/[A-Za-z_][\w._]*(?![\w(._])/g;f="abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface let long native new null of package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield Array Date eval function global hasOwnProperty Infinity isFinite isNaN isPrototypeOf length Math NaN name Number Object prototype String toString undefined valueOf window".split(" ");c=
function(){function c(a){var c,d,e;this.variableTable=a;this.algebraParser=new CTATAlgebraParser;this.logicParser=new CTATLogicParser;this.chemParser=new CTATChemParser;this.keys=[];this.values=[];e="EPSILON MAX_SAFE_INTEGER MAX_VALUE MIN_SAFE_INTEGER MIN_VALUE NEGATIVE_INFINITY POSITIVE_INFINITY isFinite isInteger isNaN isSafeInteger parseFloat parseInt".split(" ");a=0;for(d=e.length;a<d;a++)c=e[a],this.keys.push(c),this.values.push(Number[c]);e=["toExponential","toFixed","toLocaleString","toPrecision",
"valueOf"];a=0;for(d=e.length;a<d;a++)c=e[a],this.keys.push(c),this.values.push(function(a){return function(){var c,d;d=arguments[0];c=2<=arguments.length?b.call(arguments,1):[];return a.apply(d,c)}}(Number.prototype[c]));e="E LN10 LN2 LOG10E LOG2E PI SQRT1_2 SQRT2 abs acos acosh asin asinh atan atanh atan2 cbrt ceil clz32 cos cosh exp expm1 floor fround hypot imul log log10 log1p log2 max min pow random round sign sin sinh sqrt tan tanh trunc".split(" ");a=0;for(d=e.length;a<d;a++)c=e[a],this.keys.push(c),
this.values.push(Math[c]);e=["fromCharCode","fromCodePoint"];a=0;for(d=e.length;a<d;a++)c=e[a],this.keys.push(c),this.values.push(String[c]);e="charAt charCodeAt codePointAt concat endsWith includes indexOf lastIndexOf localeCompare match normalize padEnd padStart repeat replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toUpperCase trim trimEnd trimStart valueOf".split(" ");d=0;for(a=e.length;d<a;d++)c=e[d],this.keys.push(c),this.values.push(function(a){return function(){var c,
d;d=arguments[0];c=2<=arguments.length?b.call(arguments,1):[];return a.apply(d,c)}}(String.prototype[c]));e="algParse algGetError algStringify algEvaluate algSort algGetOperator algGetVariables algGetOperands algGetExpression algFindExpression algCreateExpression algReplaceExpression algDeleteExpression algSimplifyRules algPartiallySimplify algSimplify algValid algValued algPartiallySimplified algSimplified algIdentical algEqual algPartiallyEquivalent algEquivalent isAlgValid algEval algStrictEquivTermsSameOrder algEquivTermsSameOrder algStrictEquivTerms algEquivTerms algEquiv isSimplified calc calca simplify algebraicEqual patternMatches polyTermsEqual algebraicMatches expressionMatches".split(" ");
d=0;for(a=e.length;d<a;d++)c=e[d],this.keys.push(c),this.values.push(function(a,c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(this.algebraParser[c],this.algebraParser));e="logicSetMode logicParse logicGetError logicStringify logicEvaluate logicSort logicGetOperator logicGetOperators logicGetVariables logicGetOperands logGetExpression logicFindOperator logicFindExpression logicFindRule logicApplyRules logicCreateExpression logicReplaceExpression logicDeleteExpression logicValid logicValued logicSorted logicIdentical logicEqual logicEquivalent logicSemanticEquivalent logicFindCounterExample logicSimplifyNNF logicSimplifyCNF logicSimplifyDNF logicSimplifiedNNF logicSimplifiedCNF logicSimplifiedDNF".split(" ");
d=0;for(a=e.length;d<a;d++)c=e[d],this.keys.push(c),this.values.push(function(a,c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(this.logicParser[c],this.logicParser));for(c in CTATFormulaFunctions)this.keys.push(c),this.values.push(function(a,c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(CTATFormulaFunctions[c],CTATFormulaFunctions));for(c in CTATFormulaActions)this.keys.push(c),this.values.push(function(a,
c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(CTATFormulaActions[c],CTATFormulaActions))}c.prototype.evaluate=function(c,d,m,n){var h,l,u,w,q,y,z,B,v,E,C,A;try{B="undefined"!==typeof window&&null!==window?window:global;h=function(){var a;a=[];for(w in B)a.push(w);return a}().concat(["selection","action","input"]);v=c.split(e);l=0;for(q=v.length;l<q;l++)for(z=v[l],C=null!=(E=z.match(g))?E:[],u=0,y=C.length;u<y;u++)w=C[u],0>a.call(f,w)&&0>a.call(h,w)&&
0>a.call(this.keys,w)&&CTATFormulaFunctions.assign(w,void 0);for(w in A=this.variableTable.getTable())B[w]=A[w];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(b.call(this.keys),["return "+c.trim().replace(/[\\]/g,"\\$&")]),function(){}).apply(B,[d,m,n].concat(b.call(this.values)))}catch(F){return console.log(F),null}finally{for(w in B)null!=w&&0>a.call(h,w)&&(A[w]=B[w],delete B[w])}};c.prototype.interpolateSplitPattern=
/<%=|%>/;c.prototype.interpolate=function(a,b,c,d){var e,f,g,h,m;h=a.split(this.interpolateSplitPattern);m=[];a=f=0;for(g=h.length;f<g;a=++f)e=h[a],m.push(a%2?this.evaluate(e,b,c,d):e);return m.join("")};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATFormulaParser=c}).call(this);var CTATNoolsTracer=function(c,g,f){var e,b,a,d;function h(a){wa=[];M.setDoBacktracking(!1);J("debug","starting initial match");xa=function(){J("debug","done initial match");ka=la=!0;M.setPruneOldActivations(X.prune_old_activations);M.setDoBacktracking(X.use_backtracking);M.setSearchAllPermutations(X.search_all_permutations);fa=!0;"function"===typeof a&&a()};E()}function l(){J("debug","start conflict tree pregeneration...");ha=!0;ca=[];var a=0;0===ma.length&&ma.push({selection:"not_specified",action:"not_specified",
input:"not_specified"});var b=function(){++a>=ma.length?c():m(ma[a],b)},c=function(){J("debug","done conflict tree pregeneration");ha=!1;ya();ya=function(){}};X.use_hint_fact?(a--,m(null,b,!0)):m(ma[a],b)}function m(a,b,c){M.prepForMatch();x();var d;d=c?v():B(a,!0);E(null,function(){M.retract(d);ka=!0;var e=M.getConflictTree();c?ca.__hintTree=[Y,e]:ca.push([a,Y,e]);b()})}function n(a,b,c){var d=null,e=null,f=null;if("untutored_action"===c)return B(a,!1),l(),!0;"hint"===c&&ca.__hintTree&&(e=F(!0,a.selection,
ca.__hintTree[0]));if(!e)for(var g=0;g<ca.length;g++){var h=ca[g][0],m=ca[g][1],n=m.firstPredictedSolution,m=m.selectionMap;!f&&("hint"!==c||0<n.hints.length)&&(f=n);if(H(a,h).isMatch){!e&&("hint"!==c||0<n.hints.length)&&(e=n);for(var p in m){if(m.hasOwnProperty(p))for(h=m[p],n=0;n<h.length;n++){var r=h[n];if("tutored_action"===c){if(H(a,r.sai,r.saiComparator).isMatch){d=r;break}}else!e&&0<r.hints.length&&(e=r)}if(d||"hint"===c&&e)break}}}if(d)J("debug","Matched w/ pregen tree, refiring chain: "+
d.activationIds.join(" , ")),ra=d,ma=[],M.prepForMatch(),x(),B(a,!0),E(null,function(){J("debug","done refiring activations, returning result");var a=ra.sai.isCorrect?"correct":"bug";1===d.halted&&(d.halted=2);la="correct"===a;ka=!0;ra=ba=null;b(a,d);l()},d.activationIds);else return e||(f||(f=new va),e=f),"tutored_action"===c?(J("debug","didn't get a match :( "),b("no_model",e)):b(e),!0}function p(a,b){"string"===typeof a&&(e[e.length-1].successOrBugMsg={message:a,priority:b||0})}function r(a){e[e.length-
1].priority=a}function u(a){var b=e[e.length-1].sai;a.selection&&(b.selection=a.selection);a.action&&(b.action=a.action);a.input&&(b.input=a.input)}function w(a,b,c,d,e,f,g){J("debug","handleImports for "+b);c=c||{};e=e||{count:0,chunks:[]};f=f||0;g=g||0;for(var h=/\bimport\s?\(('|")?([^()'"\s]*)\1?\);/g,m,n=[];null!=(m=h.exec(a));){var l=Z.relativeToAbsolute(m[2],b);c[l]?J("debug","skipping duplicate import: "+l):(n.push(l),c[l]=!0);a=a.replace(m[0],"");h.lastIndex-=m[0].length}e.chunks[f]||(e.chunks[f]=
[]);e.chunks[f][g]=a;e.count+=n.length;J("debug",b+" is importing "+n.length+" files");if(0<n.length)for(a={i:0};a.i<n.length;a={url$17:a.url$17,i:a.i},a.i++)a.url$17=n[a.i],$.ajax(a.url$17,{dataType:"text",success:function(a){return function(b){w(b,a.url$17,c,d,e,f+1,a.i);e.count--;0==e.count&&d(q(e.chunks))}}(a),error:function(a,b,c){J("error","Error in _handleImports() : ");J("error",b)}});else 0==f&&d(q(e.chunks))}function q(a){for(var b="",c;0<a.length;)for(c=a.pop();0<c.length;)b+=c.shift()+
"\n";return b}function y(a,b){var c={getRuntime:function(){return Ea},getStudentInput:function(){return aa.getLastStudentSAI()},getStudentSAIs:function(){return aa.getStudentSAIs()},checkSAI:K,setTutorSAI:u,setSuccessOrBugMsg:p,setChainPriority:r,setProblemAttribute:G,getInitialized:function(){return aa.getInitialized()},backtrack:function(){M.setAboutToBacktrack()},assert:Q,modify:D,bulkModify:N,retract:L,undoAll:V,addPregenSAI:T,halt:P,pruneOldActivations:R,setCTNodeData:I};[CTATAlgebraParser,CTATLogicParser,
CTATChemParser,CTATFormulaParser].forEach(function(a){var b=new a;a={};for(var d in b)a.f=d,"function"===typeof b[a.f]&&(c[a.f]=function(a){return function(){return b[a.f].apply(b,arguments)}}(a)),a={f:a.f}});try{oa=nools.compile(a,{name:b||"CTATFlow",scope:c})}catch(Ma){return J("error","Error compiling rule file"),fa=!1,Ma}z();return!0}function z(){var a,b;a=oa.__scope;var c={};oa.__rules.forEach(function(a){c[a.name]=!0});if(a&&a.skill_definitions)if(a=a.skill_definitions,a instanceof Array)a.forEach(function(a){b=
a.ruleName.split(",");b.forEach(function(b){b=b.trim();if(c[b])za[b]={name:a.skillName||a.ruleName,category:a.category,label:a.label||a.skillName,description:a.description||"",mastery:a.mastery||CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,level:a.pKnown||CTATExampleTracerSkill.DEFAULT_P_KNOWN,pGuess:a.pGuess||CTATExampleTracerSkill.DEFAULT_P_GUESS,pLearn:a.pLearn||CTATExampleTracerSkill.DEFAULT_P_LEARN,pSlip:a.pSlip||CTATExampleTracerSkill.DEFAULT_P_SLIP};else throw Error("Rule "+a.ruleName+
" named by skill "+a.skillName+" does not exist in model");})});else throw Error("Global variable 'skill_definitions' must be of type Array");}function B(a,b){J("debug","Assert sai ("+(b?"":"un")+"tutored) : "+JSON.stringify(a));var c=sa[a.selection];if(c&&M.factExists(c))c.action=a.action,c.input=a.input,c.tutored=b,M.modify(c);else{c=oa.getDefined("StudentValues");if(!c)throw Error("StudentValues type not defined");c=new c(a.selection,a.action,a.input);c.tutored=b;M.assert(c,"_student_input_"+Fa);
sa[a.selection]=c;ha||Fa++}return ba=c}function v(){J("debug","Asserting hint fact...");if(!ta){var a=oa.getDefined("IsHintMatch");if(!a)throw Error("IsHintMatch type not defined");ta=new a}return M.assert(ta,"_isHintMatch")}function E(a,b,c){na=!1;M.match(function(a){ha||(Aa=M.getConflictTree());if(a)throw J("error","nools encountered an error: "+a),a;b&&"function"===typeof b?b():na&&(qa&&J("override","search complete, returning result"),xa())},a,!1,ka,c);ka=!1}function C(a){var b="no_model",c,d;
Y.matchChain?(c=Y.matchChain,b="correct"):(Y.bugMatchChains.length&&(c=Y.bugMatchChains.sort(function(a,b){return b.priority-a.priority})[0],b="bug",d=c.msg),c=F(!1),d&&(c.msg=d));la="correct"===b;c.tpas=Ba;ka=!0;ba=null;a(b,c)}function A(a,b,c){c=F(!0,c);b&&(la=Ca=!1,ka=!0,ba=null,X.use_hint_fact&&M.retract(ta));a(c)}function F(a,b,c){var d=c||Y;c=d.selectionMap;b=b||(ba?ba.selection:"");var d=d.firstTutorSelection,e=[];J("debug","getBiasedPrediction selecting chain to return.  includeHints is "+
a+", studentSelection is "+b);for(s in c){var f=c[s];J("debug","\tchecking selection: "+s);if(f)for(var g=0;g<f.length;g++){var h=f[g];J("debug","\t\tchecking chain: "+JSON.stringify(h));if(a&&0<h.hints.length||h.sai.isCorrect){J("debug","\t\t^^^^^^^^valid chain found");for(var m=0;m<e.length;){var n;a:{n=e[m];if(a){if(h.hints.length&&!n.hints.length){n=-1;break a}if(n.hints.length&&!h.hints.length){n=1;break a}}n=h.sai.selection===b&&n.sai.selection!==b?-1:n.sai.selection===b&&h.sai.selection!==
b?1:h.sai.selection===d&&n.sai.selection!==d?-1:n.sai.selection===d&&h.sai.selection!==d?1:h.priority>n.priority?-1:n.priority>h.priority?1:0}if(0>=n)break;m++}e.splice(m,0,h)}}}(a=e.shift())?J("debug","returning chain: "+JSON.stringify(a)):(J("debug","\tno chain found, returning blank chain"),a=new va);return a}function K(b,c,d){var f=!1,g=b.selection,h=b.action,m=b.input,n=e,n=n[n.length-1],l="not_specified"===g||"not_specified"===h||"not_specified"===m;J("sai_check","check SAI against: "+JSON.stringify(b));
if(X.pregen_conflict_tree)return J("sai_check","in pregen mode, skipping check  (was "+(d?"":"not")+" a buggy step)"),n.sai={selection:g,action:h,input:m,isCorrect:!d&&!l},n.comparator=c,ra&&(J("sai_check","currently re-firing; updating sai in matched chain..."),ra.sai=n.sai),!0;if(!ba)return J("sai_check","no student input to check, returning false"),!1;J("sai_check","student input: "+JSON.stringify(ba));n.sai={selection:null!==g&&void 0!==g&&"not_specified"!==g&&"don't_care"!==g?g:"",action:null!==
h&&void 0!==h&&"not_specified"!==h&&"don't_care"!==h?h:"",input:null!==m&&void 0!==m&&"not_specified"!==m&&"don't_care"!==m?m:"",isCorrect:!d&&!l};Ca?J("sai_check","Skipping check, we're hint matching"):(f=H(ba,b,c),J("sai_check",(f.isMatch?"Match":"No match")+", "+(d?"was":"was not")+" a buggy step"),a=f.isMatch?d?"buggy":"match":null,M.setNodeMatcherResult(f,d));return f.isMatch}function H(a,b,c){var d=b.selection,e=b.action,f=b.input,g=a.selection,h=a.action,m=a.input,n=["-","-","-"],l={student:a,
tutor:b,isMatch:!1,matchedFields:null},m=isNaN(m)?m:parseInt(m,10),f=isNaN(f)?f:parseInt(f,10),p=function(a,b,c){return"don't_care"===a?"*":"not_specified"===a?" ":a===b?c:"-"};n[0]=p(d.toLowerCase(),g.toLowerCase(),"S");n[1]=p(e.toLowerCase(),h.toLowerCase(),"A");n[2]=p(f,m,"I");l.matchedFields=n;if(c&&"function"===typeof c)l.isMatch=c(a,b);else for(l.isMatch=!0,a=0;3>a;a++)if("-"===n[a]){l.isMatch=!1;break}return l}function x(){Y=new ua;e=[];b=[];a=null;na=d=!1}function G(a,b){J("debug","setProblemAttribute ("+
a+", "+b+")");X[a]=b}function I(a){M.setNodeData(a)}function S(){for(var b=e,c=Y.selectionMap,f,g,h={message:"",priority:Number.NEGATIVE_INFINITY},m,n=[],l=[],p=[],r=[],u=[],q,w={selection:"",action:"",input:""},v=null,A={},G=d?ha?1:2:0,I=0,x=0;x<b.length;x++)f=b[x],g=f.sai,l.push(f.ruleName),(m=za[f.ruleName])&&p.push(m.name+" "+m.category),p=p.concat(f.skills),r=r.concat(f.hints),u=u.concat(f.tpas),n.push(f.activationId),f.successOrBugMsg&&f.successOrBugMsg.priority>h.priority&&(h=f.successOrBugMsg),
g&&(g.selection&&(q=w.selection=g.selection),g.action&&(w.action=g.action),g.input&&(w.input=g.input),w.isCorrect=g.isCorrect,f.comparator&&"function"===typeof f.comparator&&(v=f.comparator)),f.customFields.forEach(function(a){return A[a.name]=a.value}),I=f.priority>I?f.priority:I;r.sort(function(a,b){var c=b.precedence-a.precedence;0===c&&(c=a.pos-b.pos);return c});q?Y.firstTutorSelection||(Y.firstTutorSelection=q):q="_default_key";c[q]||(c[q]=[]);b=new va(w,l,p,r,h,A,n,v,u,G,I);w.isCorrect&&!Y.firstPredictedSolution&&
(Y.firstPredictedSolution=b);c[q].push(b);switch(a){case "buggy":Y.bugMatchChains.push(b);break;case "match":Y.matchChain=b}Y.numChains++;Ba=u;J("debug","stored last chain: \n\trules: "+l+"\n\tskills: "+p+"\n\thints: "+r.map(function(a){return a.msg})+"\n\tfinalSAI: "+JSON.stringify(w)+"\n\tmatchType: "+a+"\n\tmsg: "+h+"\n\tpriority: "+I)}function Q(a){X.use_backtracking&&M.pushUndo("assert",a);return M.assert(a)}function L(a){X.use_backtracking&&M.pushUndo("retract",a);return M.retract(a)}function D(a,
b,c){if(X.use_backtracking)M.pushUndo("modify",a,b);else if(3>arguments.length)return M.modify.apply(M,arguments);a[b]=c;return M.modify(a)}function N(a,b){if(X.use_backtracking)M.pushUndo("bulkModify",a,Object.keys(b));else if(2>arguments.length)return M.modify.apply(M,arguments);for(var c in b)a[c]=b[c];return M.modify(a)}function P(){d=!0;ha?M.setAboutToBacktrack():(M.halt(!0),na=!0)}function V(){M.undoAll(!0)}function R(){var a=M.pruneOldActivations();J("debug","pruned old activations: "+a.join(","))}
function T(){if(!ha)for(var a=0;a<arguments.length;a++){var b=arguments[a];!b.selection&&(b.selection="not_specified");!b.action&&(b.action="not_specified");!b.input&&(b.input="not_specified");ma.push(b)}}function O(){S()}function U(a){Da||b.pop();Da=!1;Ba=[];J("backtrack","backtracking, initiated by "+(a?"model":"engine"))}function W(a,b,c,d){var f;try{f=JSON.stringify(a)}catch(Na){f="< Error converting fact to JSON >"}J("assert",b+" fact asserted with ID "+d+": "+f);c=e[e.length-1];switch(b){case "tpa":J("tpa",
"TPA asserted: "+JSON.stringify(a));fa?X.use_backtracking?c.tpas.push(a):La(a):wa.push(Z.buildStartStateMsg(a));break;case "hint":fa&&(a.pos=+(e.length+"."+c.hints.length),c.hints.push(a));break;case "skill":fa&&c.skills.push(a.name+" "+a.category);break;case "customfield":fa&&c.customFields.push(a)}}function ea(a,b,c,d){J("modify",b+" fact modified with ID "+d)}function ja(a,b,c,d){J("retract",b+" fact retracted with ID "+d)}function ga(c){J("state_save","Hit branch point, agenda: "+JSON.stringify(c.agenda)+
", factIdCntr: "+c.state.factIdCounter);b.push({numLinks:e.length,matchType:a})}function da(c){J("state_restore","State restored, agenda: "+JSON.stringify(c.agenda)+", factIdCntr: "+c.state.factIdCounter);c=b;c=c[c.length-1];links=e;links.splice(c.numLinks);a=c.matchType}function pa(a,b,c){J("fire","Firing activation: "+c);e.push(new Ka(a,c));Da=!0}function ia(a,b,c){J("agenda_insert",a+" added to agenda, is "+(b?" ":"not ")+"new, was "+(c?" ":"not ")+"skipped")}function Ha(a){J("agenda_retract",
a+" removed from agenda")}function Ia(){J("agenda_empty","No more activations in agenda, all branches have been explored");na=!0}function Ja(a){J("override","hit breakpoint on rule "+a+" (call resume() to resume matching)")}var ua=function(){this.firstTutorSelection=null;this.selectionMap={};this.matchChain=null;this.bugMatchChains=[];this.numChains=0;this.firstPredictedSolution=null},va=function(a,b,c,d,e,f,g,h,m,n,l){this.sai=a||{selection:"",action:"",input:""};this.rules=b||[];this.skills=c||
[];this.hints=d||[];this.msg=e?e.message:"";this.customFields=f||{};this.activationIds=g||[];this.saiComparator=h||null;this.tpas=m||[];this.halted=n;this.priority=l||0},Ka=function(a,b){this.ruleName=a;this.activationId=b;this.hints=[];this.tpas=[];this.skills=[];this.customFields=[]},J=c,La=g,Ea=f,aa=this,fa=!1,oa=null,M=null,sa={},Y=new ua,ba=null,Fa=0;e=[];b=[];a=null;var Da=d=!1,Z=null,wa=[],X={use_backtracking:!0,prune_old_activations:!1,use_hint_fact:!1,search_all_permutations:!0,hint_out_of_order:!1,
substitute_input:!1,auto_hint:"none",auto_hint_threshold:3},la=!0,Ca=!1,ta=null,za={},Ba=[],qa=!1,ka=!0,xa=function(){},na=!1,ma=[],ha=!1,ya=function(){},ca=[],ra=null,Aa=null,Ga;this.getSession=function(){return M};this.getInitialized=function(){return fa};this.getSkills=function(){return za};this.getProblemAttribute=function(a){return X[a]};this.getProblemStateStatus=function(){return Ea.getOutputStatus()};this.init=function(a,b,c){J("debug","noolstracer init w/ source file: "+a);if(nools){Z=new CTATNoolsTracerUtil;
var d=Z.relativeToAbsolute(a);$.ajax(a,{dataType:"text",success:function(e){w(e,d,null,function(d){J("debug","compiling model...");!0!==(d=y(d,a))?(J("error","CTATNoolsTracer: Error compiling model"),c(d)):(J("debug","done compile"),aa.createSession()||c("CTATNoolsTracer: Error creating session"),registerTracerWrapper(new CTATNoolsTracerWrapper(aa)),h(function(){J("override","tracer initialized, log flags: ");getTracerLogFlags();printBreakpoints();b(wa,X);var a=new Event("noolsModelLoaded");window.dispatchEvent(a);
X.pregen_conflict_tree&&l()}))})},error:function(a,b,d){ctatdebug("Error retrieving rule file: ");ctatdebug(b);c(b)}})}else J("error","Error: nools is not defined"),c("nools is not defined")};this.createSession=function(){J("debug","creating session...");(M=oa.getSession({iAmEventListeners:!0,assert:W,retract:ja,modify:ea,state_save:ga,state_restore:da,backtrack:U,fire:pa,agenda_insert:ia,agenda_retract:Ha,agenda_empty:Ia,endOfChain:O,breakpoint:Ja}))&&J("debug","session created");return!!M};this.evaluate=
function(a,b,c){J("debug","noolsTracer.evaluate, matchType = "+c+", sai "+JSON.stringify(a)+", "+la);Ga=Date.now();if(X.pregen_conflict_tree)return n(a,b,c);var d=C.bind(aa,b);M.prepForMatch();switch(c){case "hint":if(la||X.use_hint_fact)Ca=!0,d=A.bind(aa,b,!0),X.use_hint_fact&&v();else return J("debug","re-using hints from last match"),A(b,!1,a.selection),!0;case "tutored_action":x();B(a,!0);xa=function(){M.prepForMatch();M.restoreAgenda();aa.printTraceTime();aa.printAgenda("agenda_post");aa.printConflictTree("conflict_tree");
d()};qa||(aa.printAgenda("agenda_pre"),E());break;case "untutored_action":return B(a,!1),!0}return!1};this.setListener=function(a,b){M&&M.on(a,b)};this.getStudentSAIs=function(){return sa};this.getLastStudentSAI=function(){return ba};this.getTutorSAIs=function(){return Y.selectionMap};this.reset=function(a){aa.createSession();fa=!1;sa={};Y=new ua;ba=null;la=!0;h(a)};this.printTraceTime=function(){var a=(Date.now()-Ga)/1E3;J("time","trace took "+a+" seconds.")};this.printAgenda=function(a){J(a,Z.printAgenda(M))};
this.getAgenda=function(){return M.getAgenda()};this.printConflictTree=function(a,b,c){J(a,"\n"+Aa.toString(b,c))};this.printPregenTrees=function(a,b,c){ca.__hintTree&&J(a," hint tree: \n"+ca.__hintTree[1].toString(b,c));ca.forEach(function(d){J(a," tree for sai: "+JSON.stringify(d[0])+"\n"+d[2].toString(b,c))})};this.printTutorSAIs=function(a,b){var c="";Aa.getMatchChains().forEach(function(a){var d=a.match.tutor;c+="\n"+d.selection+" ; "+d.action+" ; "+d.input;b&&(c+=" \n "+a.rules.join(",")+"\n")});
J(a,c)};this.printFact=function(a){J("override",Z.printFact(M,a))};this.printFacts=function(a){J("override",Z.printFacts(M,a))};this.printRules=function(a){J("override",Z.printRules(M,a))};this.getFact=function(a){return Z.getFact(M,a)};this.getFacts=function(a){return Z.getFacts(M,a)};this.printCtNodeMatch=function(a){J("override",Z.printCtNodeMatch(M,a))};this.printRuleNodes=function(a){J("override",Z.printRuleNodes(M,a))};this.printBreakpoints=function(){J("override",Z.printBreakpoints(M))};this.setInStepMode=
function(a){a=a&&"false"!==a;J("override","Stepper mode "+(a?"on":"off"));!qa||a||na||E();qa=a};this.takeSteps=function(a){qa?ba?(a=a||1,J("override","taking "+a+" steps"),E(a)):J("override","no new student input, ignoring"):J("override","not in step mode, ignoring")};this.setBreakpoint=function(a,b){a?(b=b||"first",M.setBreakpoint(a,b)?J("override","breakpoint "+("none"===b?"cleared":"set")+" for rule "+a):J("override","breakpoint not "+("none"===b?"cleared":"set")+" -- rule "+a+" doesn't exist")):
J("override","need a rule name to break on")};this.resume=function(){qa?J("override","can't resume; engine is in stepper mode"):na?J("override","not at a breakpoint, ignoring"):E()};this.getIAmPregenerating=function(){return ha};this.setDonePregenCallback=function(a){J("debug","setDonePregenCallback()");ya=a}};var CTATLogger=function(c){var g={},f=0;c&&c.forEach(function(c){g[c]=!1});this.isSet=function(c){return!!g[c]};this.set=function(e){if(c&&!(e in g))return!1;f++;return g[e]=!0};this.unset=function(e){if(c&&!(e in g))return!1;f--;return!(g[e]=!1)};this.getFlags=function(){return g};this.getNFlagsSet=function(){return f};this.log=function(c,b){(g[c]||"override"===c)&&console.log(("override"!==c?"["+c+"]: ":"")+b)}};var CTATRuleTracerGlobals={},NOOLS_LOG_FLAGS="time conflict_tree assert modify retract state_save state_restore backtrack agenda_insert agenda_retract agenda_empty fire error debug sai_check agenda_pre agenda_post tpa".split(" "),CTATNoolsTracerLogger=new CTATLogger(NOOLS_LOG_FLAGS),globalTracerRef=null;function registerTracerWrapper(c){globalTracerRef=c}function setTracerLogFlag(c){c=CTATNoolsTracerLogger.set(c)?"set flag "+c:"Error - invalid flag: "+c;CTATNoolsTracerLogger.log("override",c)}
function setTracerLogFlags(c){var g=[],f=[];(c instanceof Array?c:Array.prototype.slice.call(arguments)).forEach(function(c){CTATNoolsTracerLogger.set(c)?g.push(c):f.push(c)});g.length&&CTATNoolsTracerLogger.log("override","set flags: "+g.join(","));f.length&&CTATNoolsTracerLogger.log("override","Error - invalid flag(s): "+f.join(","))}
function getTracerLogFlags(){var c=CTATNoolsTracerLogger.getFlags(),g=[],f=[],e;for(e in c)c[e]?g.push(e):f.push(e);CTATNoolsTracerLogger.log("override","set: "+g.join(",")+"\nunset: "+f.join(","))}function unsetTracerLogFlag(c){CTATNoolsTracerLogger.unset(c)}function unsetTracerLogFlags(c){(c instanceof Array?c:Array.prototype.slice.call(arguments)).forEach(function(c){unsetTracerLogFlag(c)})}function printAgenda(){globalTracerRef.printAgenda()}
function getAgenda(){return globalTracerRef.getAgenda()}function printConflictTree(c,g){globalTracerRef.printConflictTree(c,g)}function printPregenTrees(c,g){globalTracerRef.printPregenTrees(c,g)}function printTutorSAIs(c){globalTracerRef.printTutorSAIs()}function printFact(c){globalTracerRef.printFact(c)}function getFact(c){return globalTracerRef.getFact(c)}function printFacts(c){globalTracerRef.printFacts(c)}function getFacts(c){return globalTracerRef.getFacts(c)}
function printRules(c){globalTracerRef.printRules(c)}function printMatch(c){globalTracerRef.printMatch(c)}function whyNot(c){globalTracerRef.printRuleNodes(c)}function setStepperMode(c){globalTracerRef.setStepperMode(c)}function takeSteps(c,g){globalTracerRef.takeSteps(c,g)}function setBreakpoint(c,g){globalTracerRef.setBreakpoint(c,g)}function printBreakpoints(){globalTracerRef.printBreakpoints()}function resume(){globalTracerRef.resume()}
function getProblemStateStatus(){return globalTracerRef.getProblemStateStatus()};var CTATRuleTracer=function(c,g){function f(b,c,d,f){var g=f.msg,l=f.sai,p=new CTATSAI(l.selection,l.action,l.input),u=b.getStudentSAI(),q=f.customFields,w=""+l.selection+(l.selection&&l.action?" ":"")+l.action+"";m("debug","ruleTracer.handleResult, result = "+d+"\n\ttutorSAI = "+JSON.stringify(l)+"\n\tmsg = "+g+"\n\tassociated rules = "+f.rules+"\n\tassociated skills = "+f.skills+"\n\tstep ID = "+w+"\n\ttpas = "+f.tpas+"\n\tcustom fields = "+JSON.stringify(q)+"\n\thalted = "+f.halted);b.setStepID(w);
b.setTutorSAI("correct"!==d||n.getProblemAttribute("substitute_input")?p:u);b.setSuccessOrBuggyMsg(g);b.setAssociatedRules(f.rules);b.setAssociatedSkills(f.skills);b.setCustomFields(q);switch(d){case "correct":b.setResult(CTATExampleTracerLink.CORRECT_ACTION);b.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION);r={all:0};break;case "bug":case "no_model":e(b,u,"bug"===d),m("debug","consecutive errors: \n\t"+Object.keys(r).map(function(a){return a+": "+r[a]}).join("\n\t")),h()}0<CTATNoolsTracerLogger.getNFlagsSet()&&
m("override","------ end of trace ------\n");2===f.halted&&f.tpas.forEach(function(b){a(b)});c()}function e(a,b,c){b.getSelection().includes("done")&&"ButtonPressed"===b.getAction()&&a.setDoneStepFailed(!0);c?(a.setResult(CTATExampleTracerLink.BUGGY_ACTION),a.setTraceOutcome(CTATExampleTracerLink.BUGGY_ACTION)):(a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL));a=b.getSelection();r.all++;r[a]?r[a]++:r[a]=1}function b(a,b,c){var d=c.hints.map(function(a){return a.msg}),
e=c.rules,f=c.skills;c=c.sai;a.getStudentSAI();var g=""+c.selection+(c.selection&&c.action?" ":"")+c.action+"";m("debug","ruleTracer.handleHintResult,\n\ttutorSAI = "+JSON.stringify(c)+"\n\tassociated rules = "+e+"\n\tassociated skills = "+f+"\n\tstep ID = "+g+"\n\thints = "+JSON.stringify(d));a.setTutorSAI(new CTATSAI(c.selection,c.action,c.input));a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(d.length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);a.setReportableHints(d);
a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR);a.setStepID(g);a.setAssociatedSkills(f);a.setAssociatedRules(e);r={all:0};b(a,a.getTransactionID())}function a(a){l&&l.addTPAToMessageTank(a.selection,a.action,a.input,"tutor-performed")}function d(a){return{selection:a.getSelection()||"",action:a.getAction()||"",input:a.getInput()||""}}function h(){var a=n.getProblemAttribute("auto_hint"),b=n.getProblemAttribute("auto_hint_threshold");if("all"===a?r.all>=b:"selection"===a&&Object.keys(r).some(function(a){return"all"!==
a&&r[a]>=b}))m("debug","at consecutive error threshold, sending hint request..."),CTATCommShell.commShell.processComponentAction(new CTATSAI("hint","ButtonPressed","hint request"))}var l=g,m=CTATNoolsTracerLogger.log,n=null,p=null,r={all:0},u=this;this.getEngine=function(){return n};this.initEngine=function(b,d,e){switch(c){case "nools":n=new CTATNoolsTracer(m,a,l)}var f=function(a,b){console.log("CTATRuleTracer.doneInit");var c=n.getSkills();if(!CTATConfiguration.get("skills"))if(CTATSkillSet.skills){m("debug",
"skills not defined in flashVars, using model definitions");var e=[];for(skillName in c){var f=c[skillName];CTATSkillSet.skills.addSkillAsObject(f);e.push(new CTATExampleTracerSkill(f.category,f.name,f.pGuess,f.level,f.pSlip,f.pLearn,null))}l.getProblemSummary().setSkills(new CTATSkills(e));CTATCommShell.commShell.updateSkillWindow(null)}else m("debug","CTATSkillSet.skills not defined, skipping initSkills");d(a,b)};n&&n.init(b,f,e)};this.getModelInitialized=function(){return n&&n.getInitialized()};
this.getProblemStateStatus=function(){return l.getOutputStatus()};this.setListener=function(a,b){n.setListener(a,b)};this.evaluate=function(a,b){var c=d(a.getStudentSAI()),e=f.bind(u,a,b),c=n.evaluate.bind(n,c,e,"tutored_action");if(n.getIAmPregenerating())n.setDonePregenCallback(c);else return c()};this.doHint=function(a,c,e){a.setTransactionID(c);return n.evaluate(d(a.getStudentSAI()),b.bind(this,a,e),"hint")};this.handleUntutoredAction=function(a){m("debug","ruleTracer.handleUntutoredAction( "+
JSON.stringify(a)+" )");n.evaluate({selection:a.selection[0],action:a.action[0],input:a.input[0]},null,"untutored_action")};this.checkOutOfOrder=function(a,b){var c;n.getProblemAttribute("hint_out_of_order")?(c=d(a.getStudentSAI()),c=!n.getTutorSAIs()[c.selection]):c=!1;b(c)};this.setDefaultBuggyMsg=function(a){a&&"string"===typeof a&&(p=a)};this.getDefaultBuggyMsg=function(){return p};this.reset=function(a){n.reset(a)}};var CTATHintPolicyEnum=function(){};Object.defineProperty(CTATHintPolicyEnum,"HINTS_UNBIASED",{enumerable:!0,configurable:!1,writable:!1,value:"Always Follow Best Path"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_CURRENT_SELECTION_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Current Selection Only"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_PRIOR_ERROR_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Prior Error Only"});
Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_ALL",{enumerable:!0,configurable:!1,writable:!1,value:"Use Both Kinds of Bias"});Object.defineProperty(CTATHintPolicyEnum,"DEFAULT",{enumerable:!0,configurable:!1,writable:!1,value:CTATHintPolicyEnum.HINTS_BIASED_BY_ALL});CTATHintPolicyEnum.prototype=Object.create(Object.prototype);CTATHintPolicyEnum.prototype.constructor=CTATHintPolicyEnum;
CTATHintPolicyEnum.lookup=function(c){for(policy in CTATHintPolicyEnum)if(CTATHintPolicyEnum[policy]==c)return CTATHintPolicyEnum[policy];return CTATHintPolicyEnum.DEFAULT};"undefined"!==typeof module&&(module.exports=CTATHintPolicyEnum);var CTATMatcher=function(c,g,f){CTATBase.call(this,"CTATMatcher","");this.lastResult=null;var e=new CTATSAI("","",""),b=f,a=CTATMsgType.DEFAULT_ACTOR,d=!1,h=this;this.resetMatcher=function(){};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>Matcher</matcherType>\n")+(a+'    <matcherParameter name="single">null</matcherParameter>\n')+(a+"</matcher>\n")};this.getSelection=function(){return h.getDefaultSelection()};this.getAction=function(){return h.getDefaultAction()};this.getInput=
function(){return h.getDefaultInput()};this.getActor=function(){return a};this.setCaseInsensitive=function(a){b=a};this.getEvaluatedInput=function(a,b){return h.getInput()};this.getTraversalIncrement=function(){return 1};this.getTutorSAI=function(a,b,c){a=String(c).toLowerCase()==CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()?a:h.getDefaultSAI();console.log("CTATMatcher.getTutorSAI() superclass method called, should be subclass;\n  returning: "+a);return a};this.getDefaultSelection=function(){return h.getDefaultSAI().getSelection()};
this.getDefaultAction=function(){return h.getDefaultSAI().getAction()};this.getDefaultInput=function(){return h.getDefaultSAI().getInput()};this.getDefaultSAI=function(){return e};this.setDefaultSAI=function(a){e=a};this.getDefaultActor=function(){switch(String(getActor()).toLowerCase()){case CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_STUDENT_ACTOR;case CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;
case CTATMsgType.ANY_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;default:return console.log("CTATMatcher.getDefaultActor() unexpected value for actor: "+a+"; returning "+CTATMsgType.DEFAULT_ACTOR),CTATMsgType.DEFAULT_ACTOR}};this.getInput=function(){return h.getDefaultInput()};this.getCaseInsensitive=function(){return b};this.match=function(a,b,c,d,e){console.log("CTATMatcher superclass method called: match("+a+", "+b+", "+c+", "+d+")");return!1};this.matchForHint=function(a,b,c,d){console.log("CTATMatcher superclass method called: matchForHint("+
a+", "+b+", "+c+", vt)");return!1};this.matchActor=function(a){a=String(a).toUpperCase();var b=String(h.getActor()).toUpperCase();ctatdebug("CTATMatcher.matchActor("+a+") myActor is "+b);return CTATMsgType.ANY_ACTOR.toString().toUpperCase()==b||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==b&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==a||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==a&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==b?!0:b==a};this.getDefaultSelectionArray=
function(){return h.getDefaultSAI().getSelectionArray()};this.getDefaultActionArray=function(){return h.getDefaultSAI().getActionArray()};this.getDefaultInputArray=function(){return h.getDefaultSAI().getInputArray()};this.getLastResult=function(){return null===h.lastResult||"undefined"===typeof h.lastResult?"":h.lastResult.toString()};this.setActor=function(b){ctatdebug("CTATMatcher --\x3e in setActor("+b+")");if(null===b||"undefined"===typeof b)b=CTATMsgType.DEFAULT_ACTOR;b=String(b).toLowerCase().trim();
a="tool"==b?CTATMsgType.DEFAULT_TOOL_ACTOR:b==CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_STUDENT_ACTOR:b==CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_TOOL_ACTOR:b==CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase()?CTATMsgType.UNGRADED_TOOL_ACTOR:b==CTATMsgType.ANY_ACTOR.toLowerCase()?CTATMsgType.ANY_ACTOR:CTATMsgType.DEFAULT_ACTOR};this.array2ConcatString=function(a){var b="";if(null==a)return b;if(!Array.isArray(a))return a.toString();a.forEach(function(a){null!=
a&&(b+=a.toString()+"\n")});return b.substring(0,0<b.length?b.length-1:0)};this.matchConcatenation=function(a){return h.matchSingle(h.array2ConcatString(a))};this.isLinkTriggered=function(){return d};this.setLinkTriggered=function(a){d=a};this.evaluateReplacement=function(a,b,c){return""};this.replaceInput=function(){return!!h.getReplacementFormula()};this.getReplacementFormula=function(){return""}};
CTATMatcher.prototype.toString=function(){console.log("Error: CTATMatcher.toString() called; should be overridden in subclass");return"This is CTATMatcher."};CTATMatcher.prototype.setParameter=function(c,g,f){};CTATMatcher.isTutorActor=function(c,g){return CTATMsgType.DEFAULT_TOOL_ACTOR.toUpperCase()===c.toUpperCase()||CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()===c.toUpperCase()||g&&CTATMsgType.ANY_ACTOR.toUpperCase()===c.toUpperCase()?!0:!1};
Object.defineProperty(CTATMatcher,"NON_SINGLE",{enumerable:!1,configurable:!1,writable:!1,value:-1});Object.defineProperty(CTATMatcher,"SELECTION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATMatcher,"ACTION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATMatcher,"INPUT",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATMatcher,"VECTOR",{enumerable:!1,configurable:!1,writable:!1,value:3});
Object.defineProperty(CTATMatcher,"ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Actor"});CTATMatcher.prototype=Object.create(CTATBase.prototype);CTATMatcher.prototype.constructor=CTATMatcher;"undefined"!==typeof module&&(module.exports=CTATMatcher);var CTATSingleMatcher=function(c,g){CTATMatcher.call(this,!0,c,g);var f=this,e="",b="";this.getSingle=function(a){return e};this.setSingle=function(a){null===a||"undefined"===typeof a?f.ctatdebug('CTATSingleMatcher --\x3e bad argument "'+a+'" to setSingle()'):e=a};this.toString=function(){console.log("Error: CTATSingleMatcher.toString() called: should be overridden")};this.matchSingle=function(a){console.log("Error: CTATSingleMatcher.matchSingle("+a+") called: should be overridden");return!1};this.getReplacementFormula=
function(){return b};this.setReplacementFormula=function(a){b=a?a:""};this.evaluateReplacement=function(a,c,e){e=null;if(!b)return e;f.ctatdebug("CTATSingleMatcher.evaluateReplacement("+a+", "+c+")");var d=a.getSelection(),g=a.getAction();a=CTATVariableTable.standardizeType(a.getInput());c||(c=new CTATVariableTable);c=new CTATFormulaParser(c);f.ctatdebug("CTATSingleMatcher calling CTATFormulaParser.evaluate("+b+", "+d+", "+g+", "+a+")");try{e=c.evaluate(b,d,g,a)}catch(n){f.ctatdebug("CTATSingleMatcher error from CTATFormulaParser.evaluate("+
b+") "+n.name+": "+n.message),e=null}f.ctatdebug("CTATSingleMatcher.evaluateReplacement() returns "+e+", type "+typeof e);return e}};CTATSingleMatcher.prototype=Object.create(CTATMatcher.prototype);CTATSingleMatcher.prototype.constructor=CTATSingleMatcher;CTATSingleMatcher.prototype.matchConcatenation=function(c){c=this.array2ConcatString(c);return this.matchSingle(c)};CTATSingleMatcher.prototype.match=function(c,g,f,e){return this.matchConcatenation(c)};
CTATSingleMatcher.prototype.setParameter=function(c,g,f){this.ctatdebug("CTATSingleMatcher.setParameter("+c+", "+g+", "+f+") calling\n  "+this.setSingle.toString());this.setSingle(c)};"undefined"!==typeof module&&(module.exports=CTATSingleMatcher);var CTATAnyMatcher=function(c,g){CTATSingleMatcher.call(this,c,!0);var f=this;this.toString=function(){return"*"};this.matchSingle=function(c){return!0};this.MatcherSAItoXML=function(c){return c+"<matcher>\n"+(c+"    <matcherType>AnyMatcher</matcherType>\n")+(c+'    <matcherParameter name="single">'+f.getSingle()+"</matcherParameter>\n")+(c+"</matcher>\n")}};CTATAnyMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATAnyMatcher.prototype.constructor=CTATAnyMatcher;
"undefined"!==typeof module&&(module.exports=CTATAnyMatcher);var CTATExactMatcher=function(c,g){CTATSingleMatcher.call(this,c,!0);var f=this;this.toString=function(){return f.getSingle().toString()};this.matchSingle=function(c){var b=f.getSingle();ctatdebug("CTATExactMatcher --\x3e in matchSingle: s = "+c+", singleval = "+b+", caseInsensitive "+f.getCaseInsensitive()+", "+typeof f.getCaseInsensitive());return f.getCaseInsensitive()?String(c).toUpperCase()==String(b).toUpperCase():String(c)==String(b)};this.MatcherSAItoXML=function(c){return c+"<matcher>\n"+
(c+"    <matcherType>ExactMatcher</matcherType>\n")+(c+'    <matcherParameter name="single">'+f.getSingle()+"</matcherParameter>\n")+(c+"</matcher>\n")}};CTATExactMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExactMatcher.prototype.constructor=CTATExactMatcher;"undefined"!==typeof module&&(module.exports=CTATExactMatcher);var CTATExampleTracerException=function(c){CTATBase.call(this,"CTATExampleTracerException","");this.toString=function(){return c}};CTATExampleTracerException.prototype=Object.create(CTATBase.prototype);CTATExampleTracerException.prototype.constructor=CTATExampleTracerException;"undefined"!==typeof module&&(module.exports=CTATExampleTracerException);var CTATExpressionMatcher=function(c,g){function f(b,c,d,f,g){h.ctatdebug("CTATExpressionMatcher.testVector["+f+"]("+b+", "+c+", "+d+", "+g+") to call evaluate");var m=CTATVariableTable.standardizeType(d);h.ctatdebug("CTATExpressionMatcher.testVector typeof input "+typeof d+"; inputConv "+m+", typeof "+typeof m);d=h.evaluate(b,c,m,g);h.ctatdebug("CTATExpressionMatcher.testVector evaluate("+b+", "+c+", "+m+", "+g+") returned "+d+", type "+typeof d);g=null;switch(f){case CTATMatcher.SELECTION:g=b;break;
case CTATMatcher.ACTION:g=c;break;case CTATMatcher.INPUT:case CTATMatcher.NON_SINGLE:g=m}a=g;h.ctatdebug("CTATExpressionMatcher.testVector comparee "+g+", type "+typeof g+", relation "+e+"( "+CTATExpressionMatcher.RELATIONS[e]+" )");try{switch(e){case CTATExpressionMatcher.BOOL_RELATION:return!!d;case CTATExpressionMatcher.EQ_RELATION:if(null==g)return null==d;if(null==d)break;return h.compareNumberOrString(g,d,e);case CTATExpressionMatcher.NOT_EQ_RELATION:return null==g?null!=d:null==d?!0:h.compareNumberOrString(g,
d,e);case CTATExpressionMatcher.LT_RELATION:case CTATExpressionMatcher.GT_RELATION:if(null==g||null==d)break;return h.compareNumberOrString(g,d,e);case CTATExpressionMatcher.LTE_RELATION:case CTATExpressionMatcher.GTE_RELATION:if(null==g)return null==d;if(null!=d)return h.compareNumberOrString(g,d,e)}}catch(w){}return!1}CTATSingleMatcher.call(this,c,g);var e=CTATExpressionMatcher.EQ_RELATION,e=CTATExpressionMatcher.BOOL_RELATION,b=g,a=null,d=!1,h=this;this.getLastInput=function(){h.ctatdebug("CTATExpressionMatcher.getLastInput() returns "+
a);return a};this.isEqualRelation=function(){h.ctatdebug("CTATExpressionMatcher --\x3e in isEqualRelation");return e===CTATExpressionMatcher.EQ_RELATION};this.getEvaluatedInput=function(a,b){h.ctatdebug("CTATExpressionMatcher --\x3e in getEvaluatedInput("+a+", "+b+")");var c=CTATVariableTable.standardizeType(a.getInput()),c=h.evaluate(a.getSelection(),a.getAction(),c,b);h.ctatdebug("CTATExpressionMatcher.getEvaluatedInput() returns "+c);return c};this.toString=function(){return CTATExpressionMatcher.RELATIONS[e]+
' "'+b+'"'};this.MatcherSAItoXML=function(a){var b;b=a+"<matcher>\n"+(a+"    <matcherType>ExpressionMatcher</matcherType>\n")+(a+'    <matcherParameter name="InputExpression">'+h.getInputExpression()+"</matcherParameter>\n");b+=a+'    <matcherParameter name="relation">'+CTATExpressionMatcher.RELATIONS[e]+"</matcherParameter>\n";return b+(a+"</matcher>\n")};this.matchSingle=function(a){throw new CTATExampleTracerException("UnsupportedOperationException");};this.setInputExpression=function(a){b=a};
this.setRelation=function(a){e=a};this.interpolate=function(a,b,c,d){try{var e=new CTATVariableTable;return(new CTATFormulaParser(e)).interpolate(a,b,c,d)}catch(u){return null}};this.evaluate=function(a,b,c,d){if("undefined"==typeof d||null==d)d=new CTATVariableTable;h.ctatdebug("CTATExpressionMatcher.evaluate(..., vt="+d+") creating CTATFormulaParser");d=new CTATFormulaParser(d);h.ctatdebug("calling CTATFormulaParser.evaluate("+h.getInputExpression()+", "+a+", "+b+", "+c+")");try{return d.evaluate(h.getInputExpression(),
a,b,c)}catch(r){return h.ctatdebug("CTATExpressionMatcher --\x3e "+r.name+": "+r.message),null}};this.matchConcatenation=function(a,b,e,g){a=h.array2ConcatString(a);null===b||"undefined"===typeof b||null===e||"undefined"===typeof e?d=f(a,null,null,c,g):(b=h.array2ConcatString(b),e=h.array2ConcatString(e),d=f(a,b,e,c,g));return d};this.match=function(a,b,c,d,e){return h.matchConcatenation(a,b,c,e)};this.getInputExpression=function(){return b};(function(){if(null!==g&&"undefined"!==typeof g){var a;
a=g.indexOf('"');var b=g.lastIndexOf('"');0<=a&&0<=b?(a=g.substring(a+1,b),b=g.substring(0,g.indexOf(" ")),e=CTATExpressionMatcher.nameToRelation(b)):a=g;h.setInputExpression(a)}})()};Object.defineProperty(CTATExpressionMatcher,"EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATExpressionMatcher,"LT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:1});
Object.defineProperty(CTATExpressionMatcher,"GT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATExpressionMatcher,"NOT_EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATExpressionMatcher,"GTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:4});Object.defineProperty(CTATExpressionMatcher,"LTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:5});
Object.defineProperty(CTATExpressionMatcher,"BOOL_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:6});Object.defineProperty(CTATExpressionMatcher,"RELATIONS",{enumerable:!1,configurable:!1,writable:!1,value:"= < > != >= <= boolean".split(" ")});CTATExpressionMatcher.nameToRelation=function(c){for(var g=0;g<CTATExpressionMatcher.RELATIONS.length;g++)if(c==CTATExpressionMatcher.RELATIONS[g])return g;return CTATExpressionMatcher.EQ_RELATION};CTATExpressionMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATExpressionMatcher.prototype.constructor=CTATExpressionMatcher;CTATExpressionMatcher.prototype.setParameter=function(c,g,f){c&&g&&f&&(c=f.getNodeTextValue(c),this.ctatdebug("CTATExpressionMatcher.setParameter("+g+", "+c+")"),"InputExpression"==g?this.setInputExpression(c):"relation"==g&&this.setRelation(CTATExpressionMatcher.nameToRelation(c)))};
CTATExpressionMatcher.prototype.compareNumberOrString=function(c,g,f){c=String(c);g=String(g);var e=Number(c),b=Number(g);if(isNaN(e)||isNaN(b))switch(f){case CTATExpressionMatcher.EQ_RELATION:return c==g;case CTATExpressionMatcher.NOT_EQ_RELATION:return c!=g;case CTATExpressionMatcher.LT_RELATION:return c.toLowerCase()<g.toLowerCase();case CTATExpressionMatcher.GT_RELATION:return c.toLowerCase()>g.toLowerCase();case CTATExpressionMatcher.LTE_RELATION:return c.toLowerCase()<=g.toLowerCase();case CTATExpressionMatcher.GTE_RELATION:return c.toLowerCase()>=
g.toLowerCase();case CTATExpressionMatcher.BOOL_RELATION:return!!g;default:return!1}else switch(f){case CTATExpressionMatcher.EQ_RELATION:return e==b;case CTATExpressionMatcher.NOT_EQ_RELATION:return e!=b;case CTATExpressionMatcher.LT_RELATION:return e<b;case CTATExpressionMatcher.GT_RELATION:return e>b;case CTATExpressionMatcher.LTE_RELATION:return e<=b;case CTATExpressionMatcher.GTE_RELATION:return e>=b;case CTATExpressionMatcher.BOOL_RELATION:return!!b;default:return!1}};
"undefined"!==typeof module&&(module.exports=CTATExpressionMatcher);var CTATRangeMatcher=function(c,g){CTATSingleMatcher.call(this,c,!0);var f=this,e=0,b=0;this.toString=function(){return"[ "+e+" , "+b+" ]"};this.MatcherSAItoXML=function(a){var b;b=a+"<matcher>\n"+(a+"    <matcherType>RangeMatcher</matcherType>\n")+(a+'    <matcherParameter name="minimum">'+f.getMinimum()+"</matcherParameter>\n");b+=a+'    <matcherParameter name="maximum">'+f.getMaximum()+"</matcherParameter>\n";return b+(a+"</matcher>\n")};this.setMinimum=function(a){try{e=parseFloat(a)}catch(d){throw new CTATExampleTracerException('Number format exception while parsing minimum value "'+
a+'": '+d);}};this.getMinimum=function(){return e};this.setMaximum=function(a){try{b=parseFloat(a)}catch(d){throw new CTATExampleTracerException('Number format exception while parsing maximum value "'+a+'": '+d);}};this.getMaximum=function(){return b};this.matchSingle=function(a){var c;try{c=parseFloat(a)}catch(h){throw new CTATExampleTracerException("Number format exception while parsing .");}return e<=c&&c<=b?!0:!1}};CTATRangeMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATRangeMatcher.prototype.constructor=CTATRangeMatcher;CTATRangeMatcher.prototype.setParameter=function(c,g){switch((g?g:"").toString().trim().toLowerCase()){case "minimum":this.setMinimum(c);break;case "maximum":this.setMaximum(c);break;default:console.log('CTATRangeMatcher.setParameter() undefined parameter name "'+g+'"'),this.setMinimum(c),this.setMaximum(c)}};CTATRangeMatcher.prototype.match=function(c,g,f,e){return this.matchSingle(c,g,f,e)};"undefined"!==typeof module&&(module.exports=CTATRangeMatcher);var CTATRegexMatcher=function(c,g){CTATSingleMatcher.call(this,c,!0);var f=null,e=null,b=this,a=b.setCaseInsensitive;this.toString=function(){return f};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>RegexMatcher</matcherType>\n")+(a+'    <matcherParameter name="single">'+b.getSinglePattern()+"</matcherParameter>\n")+(a+"</matcher>\n")};this.setSinglePattern=function(a){"undefined"===typeof a||null===a?console.log("CTATRegexMatcher: null or undefined pattern"):(f=String(a),
e=b.getCaseInsensitive()?new RegExp(f,"i"):new RegExp(f))};this.getSinglePattern=function(){return f};this.setCaseInsensitive=function(c){ctatdebug("CTATRegexMatcher --\x3e in setCaseInsensitive("+c+"), typeof(parentSetCaseInsensitive) "+typeof a);a(c);null!=b.getSinglePattern()&&b.setSinglePattern(b.getSinglePattern())};this.setSingle=function(a){b.setSinglePattern(a)};this.matchSingle=function(a){return null==a?null==getSingle():null==e?(console.log("Error: CTATRegexMatcher.matchSingle called before pattern has been set"),
!1):null!=e.exec(a)}};CTATRegexMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRegexMatcher.prototype.constructor=CTATRegexMatcher;"undefined"!==typeof module&&(module.exports=CTATRegexMatcher);var CTATWildcardMatcher=function(c,g){function f(b){if(null==b||"undefined"===typeof b)return null;var a=(new String(b)).replace(RegExp("\\?","g"),"."),c=a.replace(RegExp("\\*","g"),".*"),f=c.replace(RegExp("\\[\\!","g"),"[^");e.ctatdebug("CTATWildcardMatcher.convertToFullRegex("+b+") after qm: "+a+"; after aster: "+c+"; after negate: "+f+";");return f}CTATRegexMatcher.call(this,c,g);var e=this;this.toString=function(){return null};this.MatcherSAItoXML=function(b){return b+"<matcher>\n"+(b+"    <matcherType>WildcardMatcher</matcherType>\n")+
(b+'    <matcherParameter name="single">'+e.getSinglePattern()+"</matcherParameter>\n")+(b+"</matcher>\n")};this.setSingle=function(b){e.simpleSinglePattern=b;e.setSinglePattern.call(e,f(b))};this.setSingle(g);this.simpleSinglePattern=g};CTATWildcardMatcher.prototype=Object.create(CTATRegexMatcher.prototype);CTATWildcardMatcher.prototype.constructor=CTATWildcardMatcher;"undefined"!==typeof module&&(module.exports=CTATWildcardMatcher);var CTATVectorMatcher=function(c,g,f,e){function b(b,c,e,f,g){m.ctatdebug("CTATVectorMatcher --\x3e in _match("+b+", "+c+", "+e+", "+f+")");if(0===a.length||0===d.length||0===h.length)a.push(new CTATExactMatcher(CTATMatcher.SELECTION,m.array2ConcatString(m.getDefaultSelectionArray()))),d.push(new CTATExactMatcher(CTATMatcher.ACTION,m.array2ConcatString(m.getDefaultActionArray()))),h.push(new CTATExactMatcher(CTATMatcher.INPUT,m.array2ConcatString(m.getDefaultInputArray())));var n=[];n[CTATMatcher.SELECTION]=
b;n[CTATMatcher.ACTION]=c;n[CTATMatcher.INPUT]=e;for(var p=0;3>p;p++){var r=l[p][0],u=r instanceof CTATExpressionMatcher?r.matchConcatenation(b,c,e,f):r.matchConcatenation(n[p]);m.ctatdebug("CTATVectorMatcher --\x3e in _match["+p+"] after "+r+".concat returns: "+u);if(g)g.push(u);else if(!1===u)return!1}if(g)for(b=0;b<g.length;++b)if(!g[b])return!1;return!0}CTATMatcher.call(this,!0,CTATMatcher.VECTOR,!0);var a=c instanceof Array?c:[],d=g instanceof Array?g:[],h=f instanceof Array?f:[],l=[];l[CTATMatcher.SELECTION]=
a;l[CTATMatcher.ACTION]=d;l[CTATMatcher.INPUT]=h;var m=this;this.match=function(a,c,d,e,f){return!1!==b(a,c,d,f)&&m.matchActor(e)?!0:!1};this.getMatchers=function(a){return l[a]};this.getTutorSAI=function(a,c,d){m.ctatdebug("CTATVectorMatcher.getTutorSAI("+a+", vt, "+d+")");if(d&&CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()==d.toLowerCase())return a;var e=[];if(b(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),c,e))return d=a.clone(),a=m.evaluateReplacement(a,c,null),null!=a&&d.setInput("object"==
typeof a?a.toString():a),d;d=a.clone();for(a=0;a<e.length;a++)switch(a){case CTATMatcher.SELECTION:if(e[a])continue;d.setSelection(m.getDefaultSelection());d.setSelectionArray(m.getDefaultSelectionArray());break;case CTATMatcher.ACTION:if(e[a])continue;d.setAction(m.getDefaultAction());d.setActionArray(m.getDefaultActionArray());break;case CTATMatcher.INPUT:if(e[a])continue;d.setInput(m.getDefaultInput());d.setInputArray(m.getDefaultInputArray());break;default:console.log("CTATVectorMatcher.getTutorSAI() unexpected no. of details: "+
a)}return d};this.getInputMatcher=function(){var a=h[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultInput():a.toString()};this.getActionMatcher=function(){var a=d[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultAction():a.toString()};this.getSelectionMatcher=function(){var b=a[0];return b instanceof CTATExactMatcher&&b.toString()==="".toString()?m.getDefaultSelection():b.toString()};this.getSingleMatcher=function(b){return"selection".toString().toUpperCase()===
b.toString().toUpperCase()?a[0]:"action".toString().toUpperCase()===b.toString().toUpperCase()?d[0]:h[0]};var n=m.getDefaultSAI;this.getDefaultSAI=function(){var b=n.apply(m),c=0<a.length&&a[0]instanceof CTATExactMatcher?a[0].getSingle():b.getSelection(),e=0<d.length&&d[0]instanceof CTATExactMatcher?d[0].getSingle():b.getAction(),b=0<h.length&&h[0]instanceof CTATExactMatcher?h[0].getSingle():b.getInput();return new CTATSAI(c,e,b)};this.getSelection=function(){return 0===a.length?m.getDefaultSelection():
a[0].toString()};this.getAction=function(){return 0===d.length?m.getDefaultAction():d[0].getAction()};this.setDefaultSelection=function(b){return 0===a.length?m.internalSetDefaultSelection(b):a[0].setDefaultSelection(b)};this.setDefaultAction=function(a){return 0===d.length?m.internalSetDefaultAction(a):d[0].setDefaultAction(a)};this.setDefaultInput=function(a){return 0===h.length?m.internalSetDefaultInput(a):h[0].setDefaultInput(a)};this.getEvaluatedInput=function(a,b){if(0===h.length)return m.getInput();
var c=h[0];return!1===c instanceof CTATExpressionMatcher?m.getInput():!0===c.isEqualRelation()?c.getEvaluatedInput(a,b):m.getInput()};this.matchForHint=function(b,c,d,e){ctatdebug("CTATVectorMatcher.matchForHint("+b+", "+c+", "+d+", vt)");if(!m.matchActor(d))return!1;c=a[0];return Array.isArray(b)?c.matchConcatenation(b,m.getDefaultActionArray(),m.getDefaultInputArray(),e):c.matchConcatenation([b],m.getDefaultActionArray(),m.getDefaultInputArray(),e)};this.setCaseInsensitive=function(a){ctatdebug("CTATVectorMatcher.setCaseInsensitive("+
a+")");for(var b=0;b<l.length;++b)if(Array.isArray(l[b]))for(var c=0;c<l[b].length;++c)l[b][c].setCaseInsensitive(a);else l[b]instanceof CTATMatcher&&l[b].setCaseInsensitive(a)};this.toString=function(){return"this is CTATVectorMatcher"};this.getReplacementFormula=function(){var a=h[0];return null===a||"undefined"===typeof a?null:a.getReplacementFormula()};this.evaluateReplacement=function(a,b,c){return h[0].evaluateReplacement(a,b,c)};this.setActor(e)};CTATVectorMatcher.prototype=Object.create(CTATMatcher.prototype);
CTATVectorMatcher.prototype.constructor=CTATVectorMatcher;"undefined"!==typeof module&&(module.exports=CTATVectorMatcher);var CTATExampleTracerNodeVisualData=function(){CTATBase.call(this,"ExampleTracerNodeVisualData","visualdata");var c="****",g="undefined",f=-1,e=-1,b=null;this.setID=function(a){c=a};this.getID=function(){return c};this.setLabel=function(a){g=a};this.getLabel=function(){return g};this.setX=function(a){f=a};this.getX=function(){return f};this.setY=function(a){e=a};this.getY=function(){return e};this.setVizReference=function(a){b=a};this.getVizReference=function(){return b}};
CTATExampleTracerNodeVisualData.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNodeVisualData.prototype.constructor=CTATExampleTracerNodeVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNodeVisualData);var CTATExampleTracerNode=function(c,g){CTATBase.call(this,"CTATExampleTracerNode",c);var f=null,e={x:1,y:1},b="",a=g?g:new Set,d=new Set;a.forEach(function(a,b,c){b.isCorrect()&&d.add(b)});var h=new Set,l=!1,m=this;this.toString=function(){return"node"+c};this.toXML=function(a){var b=a+'<node locked="'+this.getLocked()+'" doneState="'+this.IsDoneState()+'">\n',b=b+(a+"    <text>"+this.getNodeName()+"</text>\n"),b=b+(a+"    <uniqueID>"+this.getNodeID()+"</uniqueID>\n"),c=this.getDimension(),d=a+"    ",
e;e=d+"<dimension>\n"+(d+"    <x>"+c.x+"</x>\n");e+=d+"    <y>"+c.y+"</y>\n";return b+(e+(d+"</dimension>")+"\n")+(a+"</node>")};this.getNodeID=function(){return c};this.getLocked=function(){return!1};this.IsDoneState=function(){return this.getNodeName().startsWith("Done")?!0:l};this.setDoneState=function(a){l=a};this.getDimension=function(){return e};this.setDimension=function(a){e=a};this.getNodeName=function(){return b};this.setNodeName=function(a){m.ctatdebug("CTATExampleTracerGraph --\x3e in setNodeName("+
a+")");b=a};this.getOutLinks=function(){ctatdebug("CTATExampleTracerNode --\x3e getOutLinks");return a};this.getCorrectOutLinks=function(){return d};this.addOutLink=function(b){ctatdebug("CTATExampleTracerNode --\x3e addOutLink( "+b+" )");a.add(b);b.isCorrect()&&d.add(b)};this.clearInLinks=function(){h=new Set};this.addInLink=function(a){h.add(a)};this.getInLinks=function(){return h};this.getOutDegree=function(){return a.size};this.getCorrectOutDegree=function(){return d.size};this.setVisualData=
function(a){f=a};this.getVisualData=function(){return f}};CTATExampleTracerNode.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNode.prototype.constructor=CTATExampleTracerNode;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNode);var CTATExampleTracerLinkVisualData=function(){CTATBase.call(this,"CTATExampleTracerLinkVisualData","visualdata");var c="****",g="undefined",f="****",e="****";this.setID=function(b){c=b};this.getID=function(){return c};this.setLabel=function(b){g=b};this.getLabel=function(){return g};this.setSource=function(b){f=b};this.getSource=function(){return f};this.setDestination=function(b){e=b};this.getDestination=function(){return e}};CTATExampleTracerLinkVisualData.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerLinkVisualData.prototype.constructor=CTATExampleTracerLinkVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkVisualData);var CTATExampleTracerLink=function(c,g,f){CTATBase.call(this,"CTATExampleTracerLink","("+g+"-"+f+")");var e="undefined"===typeof c||null===c?null:c,b=null,a="",d="",h="undefined"===typeof g||null===g?null:g,l="undefined"===typeof f||null===f?null:f,m=null,n=1,p=1,r="CORRECT_ACTION",u=[],w=!1,q=null,y="",z=p.toString(),B=n.toString(),v=null,E=null,C=this;this.getUniqueID=function(){return e};this.getMatcher=function(){C.ctatdebug("CTATExampleTracerLink --\x3e in getMatcher");return m};this.isCorrect=
function(){return r==CTATExampleTracerLink.CORRECT_ACTION};this.matchesSAI=function(a,b,c){var d=C.getMatcher();C.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAI(); matcher "+d+", typeof "+typeof d+", sai "+a);a=d.match(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,c);C.ctatdebug("CTATExampleTracerLink --\x3e out of matchesSAI: result = "+a);return a};this.matchesSAIforHint=function(a,b,c,d){C.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAIforHint("+a+", "+b+") selectionArray "+
a.getSelectionArray());if(!1===C.getMatcher().matchForHint(a.getSelectionArray(),a.getActionArray(),b,d))return C.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false because no match"),!1;if(null!==c&&"undefined"!==typeof c&&!0===c.getWantReportableHints()&&(a=null===C.getAllHints()||"undefined"===typeof C.getAllHints()?0:C.getAllHints().length,1>a))return C.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false nStaticHints "+a+"< 1"),!1;C.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning true");
return!0};this.getDepth=function(){return b};this.getBuggyMsg=function(){return y};this.getSuccessMsg=function(){return q};this.getType=function(){return r};this.getPrevNode=function(){return h};this.getNextNode=function(){return l};this.setPrevNode=function(a){h=a};this.setNextNode=function(a){l=a};this.toString=function(){var a;a="[link "+C.getUniqueID();a+=" ("+C.getPrevNode()+"-"+C.getNextNode();a+=") "+C.getType();return a+"]"};this.toXML=function(a){var b;b=a+"    ";var c=b+'<actionLabel preferPathMark="'+
C.getIsPreferredLink()+'" minTraversals="'+C.getMinTraversalsStr()+'" maxTraversals="'+C.getMaxTraversalsStr()+'">\n',c=c+(b+"    <studentHintRequest></studentHintRequest>\n")+(b+"    <stepSuccessfulCompletion></stepSuccessfulCompletion>\n")+(b+"    <stepStudentError></stepStudentError>\n")+(b+"    <uniqueID>"+C.getUniqueID()+"</uniqueID>\n"),d=b+"    ",e="";C.getDemoMsgObj()&&(e+=d+C.getDemoMsgObj().getXMLString(!0)+"\n");c=c+e+(b+"    <buggyMessage>"+C.getBuggyMsg()+"</buggyMessage>\n");c+=b+"    <successMessage>"+
C.getSuccessMsg()+"</successMessage>\n";d=C.getHints();for(e=0;e<d.length;e++)c+=b+"    <hintMessage>"+d[e]+"</hintMessage>\n";var c=c+(b+"    <callbackFn></callbackFn>\n")+(b+"    <actionType>"+C.getActionType()+"</actionType>\n"),c=c+(b+"    <oldActionType>Correct Action</oldActionType>\n")+(b+"    <checkedStatus>Never Checked</checkedStatus>\n"),d=b+"    ",f=C.getMatcher().getMatchers(0)[0],e=C.getMatcher().getMatchers(1)[0],g=C.getMatcher().getMatchers(2)[0],f=d+'<matchers Concatenation="true">\n'+
(d+"    <Selection>\n")+f.MatcherSAItoXML(d+"        "),f=f+(d+"    </Selection>\n")+(d+"    <Action>\n")+e.MatcherSAItoXML(d+"        "),f=f+(d+"    </Action>\n")+(d+"    <Input>\n")+g.MatcherSAItoXML(d+"        "),f=f+(d+"    </Input>\n")+(d+'    <Actor linkTriggered="false">'+C.getMatcher().getActor()+"</Actor>\n");b=a+"<edge>\n"+(c+(f+(d+"</matchers>\n"))+(b+"</actionLabel>\n"));b+=a+"    <preCheckedStatus>No-Applicable</preCheckedStatus>\n";c=this.getSkillNames();d=a+"    ";e="";if(0<c.length)for(g=
0;g<c.length;g++)e+=d+"<rule>\n",e+=d+"    <text>"+c[g]+"</text>\n",e+=d+"    <indicator>-1</indicator>\n",e+=d+"</rule>\n";else e=e+(d+"<rule>\n")+(d+"    <text>unnamed</text>\n")+(d+"    <indicator>-1</indicator>\n")+(d+"</rule>\n");b=b+e+(a+"    <sourceID>"+this.getPrevNode()+"</sourceID>\n");b+=a+"    <destID>"+this.getNextNode()+"</destID>\n";return b+(a+"    <traversalCount>0</traversalCount>\n")+(a+"</edge>")};this.getDemoMsgObj=function(){return a};this.setDemoMsgObj=function(b){a=b};this.getTransactionID=
function(){return d};this.setTransactionID=function(a){d=a};this.getXMLString=function(a){if(messageObj.xml)return messageObj.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(messageObj);alert("ERROR: Extremely old browser");return""};this.getTutorSAI=function(a,b){return C.getMatcher().getTutorSAI(a,b,C.getActionType())};this.getEvaluatedInput=function(a,b){return C.getMatcher().getEvaluatedInput(a,b)};this.setDepth=function(a){b=a};this.getMaxTraversals=function(){return n};this.getMaxTraversalsStr=
function(){return B};this.isDone=function(){var a=String(C.getDefaultSAI().getSelection()).toLowerCase(),b=String(C.getDefaultSAI().getAction()).toLowerCase(),a=CTATMsgType.DONE.toLowerCase()==a&&CTATMsgType.BUTTON_PRESSED.toLowerCase()==b;C.ctatdebug("CTATExampleTracerLink.isDone() returns "+a);return a};this.interpolateHints=function(a){C.ctatdebug("CTATExampleTracerLink --\x3e interpolateHints("+a+")");var b=[];if(null===u||"undefined"===typeof u||0===u.length)return b;null==a&&(a=new CTATVariableTable);
var c=new CTATFormulaParser(a);u.forEach(function(a){if(!(1>String(a).trim().length)){var d=C.getDefaultSAI().getSelection(),e=C.getDefaultSAI().getAction(),f=CTATVariableTable.standardizeType(C.getDefaultSAI().getInput());C.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate("+a+", "+d+", "+e+", "+f+")");a=c.interpolate(a,d,e,f);C.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate() returns "+a);b.push(a)}});C.ctatdebug("CTATExampleTracerLink --\x3e out of interpolateHints "+
b);return b};this.getHints=function(){C.ctatdebug("CTATExampleTracerLink --\x3e in getHints");var a=[];C.interpolateHints(null).forEach(function(b){C.ctatdebug("CTATExampleTracerLink --\x3e in getHints loop");b.toString()!=="".toString()&&a.push(b)});C.ctatdebug("CTATExampleTracerLink --\x3e out of getHints");return a};this.getAllNonEmptyHints=function(){var a=[];u.forEach(function(b){b.trim().toString()!=="".toString()&&a.push(b)});return a};this.isTraversable=function(){return 1>C.getMaxTraversals()?
!1:CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()==C.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()==C.getActionType().toString().toUpperCase()?!0:!1};this.replaceInput=function(){return CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==C.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==C.getActionType().toString().toUpperCase()?!1:C.getMatcher().replaceInput()};
this.evaluateReplacement=function(a,b,c){return C.getMatcher().evaluateReplacement(a,b,c)};this.getActor=function(){return C.getMatcher().getActor()};this.getDefaultSAI=function(){C.ctatdebug(C.toString()+".getSAI(): "+(m?m.getDefaultSAI():"(matcher null)"));return m.getDefaultSAI()};this.getActionType=function(){return r};this.getMinTraversals=function(){return p};this.getMinTraversalsStr=function(){return z};this.getIsPreferredLink=function(){return w};this.getAllHints=function(){return u};this.setMatcher=
function(a){m=a};this.addHint=function(a){null!==a&&"undefined"!==typeof a&&a.toString()!=="".toString()&&u.push(a)};this.setSelection=function(a){C.getMatcher().setDefaultSelection(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setAction=function(a){C.getMatcher().setDefaultAction(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setActionType=function(a){if(null===a||"undefined"===typeof a||a.toString()!==CTATExampleTracerLink.CORRECT_ACTION.toString()&&a.toString()!==
CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.HINT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.UNTRACEABLE_ERROR.toString()&&a.toString()!==CTATExampleTracerLink.CLT_ERROR_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.GIVEN_ACTION.toString())throw new CTATExampleTracerException("invalid action type "+r);r=a};this.setBuggyMsg=function(a){y=a};this.setSuccessMsg=function(a){q=
a};this.setMinTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)z="1",p=1;else try{z=a,p=parseInt(a.trim()),isNaN(p)&&(p=1)}catch(F){p=1}};this.setMaxTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)B=z,n=p;else try{B=a,n=parseInt(a.trim()),isNaN(n)&&(n=1)}catch(F){n=p}};this.setUniqueID=function(a){e=a};this.addSkillName=function(a){C.ctatdebug("ETLink["+e+"].addSkillName("+a+")");if("unnamed"!==a){if(null===E||"undefined"===typeof E)E=[];-1<E.indexOf(a)||
(E.push(a),C.ctatdebug("ETLink.addSkillName() return with skillNames "+E))}};this.getSkillNames=function(){if(null===E||"undefined"===typeof E)E=[];return E};this.isTutorPerformed=function(a){if(CTATExampleTracerLink.CORRECT_ACTION.toUpperCase()!==C.getActionType().toUpperCase())return!1;var b=C.getMatcher();if(null===b||"undefined"===typeof b||null!==a&&"undefined"!==typeof a&&a!==b.isLinkTriggered())return!1;a=C.getActor();return CTATMatcher.isTutorActor(a,!0)?!0:!1};this.setIsPreferredLink=function(a){C.ctatdebug("ETLink.setIsPreferredLink() was "+
w+", now "+a);w=a};this.setVisualData=function(a){v=a};this.getVisualData=function(){return v}};
CTATExampleTracerLink.compareLinkTypes=function(c,g){ctatdebug("CTATExampleTracerLink --\x3e in compareLinkTypes("+c+", "+g+")");return null===c||"undefined"===typeof c?null===g||"undefined"===typeof g?0:1:null===g||"undefined"===typeof g?-1:c.toString()===g.toString()?0:c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?1:c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?
1:c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?1:0};Object.defineProperty(CTATExampleTracerLink,"BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Buggy Action"});Object.defineProperty(CTATExampleTracerLink,"FIREABLE_BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Fireable Buggy Action"});
Object.defineProperty(CTATExampleTracerLink,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Correct Action"});Object.defineProperty(CTATExampleTracerLink,"NO_MODEL",{enumerable:!1,configurable:!1,writable:!1,value:"NO-MODEL"});Object.defineProperty(CTATExampleTracerLink,"HINT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Hint Action"});Object.defineProperty(CTATExampleTracerLink,"UNTRACEABLE_ERROR",{enumerable:!1,configurable:!1,writable:!1,value:"Untraceable Error"});
Object.defineProperty(CTATExampleTracerLink,"CLT_ERROR_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Error Action"});Object.defineProperty(CTATExampleTracerLink,"GIVEN_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Given Action"});Object.defineProperty(CTATExampleTracerLink,"SUCCESS",{enumerable:!1,configurable:!1,writable:!1,value:"SUCCESS"});CTATExampleTracerLink.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLink.prototype.constructor=CTATExampleTracerLink;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerLink);var CTATExampleTracerPathComparator=function(){CTATBase.call(this,"CTATExampleTracerPathComparator","");var c=this;this.compare=function(g,f){c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare");c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isDonePath(): "+g.isDonePath());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isDonePath(): "+f.isDonePath());if(!0===g.isDonePath()&&!1===f.isDonePath())return-1;if(!0===f.isDonePath()&&!1===g.isDonePath())return 1;
c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isIncorrectPath(): "+f.isIncorrectPath());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isIncorrectPath()(): "+g.isIncorrectPath());if(!0===f.isIncorrectPath()&&!1===g.isIncorrectPath())return-1;if(!0===g.isIncorrectPath()&&!1===f.isIncorrectPath())return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredPrefixLinks(): "+g.getNumberOfPreferredPrefixLinks());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredPrefixLinks(): "+
f.getNumberOfPreferredPrefixLinks());var e=g.getNumberOfPreferredPrefixLinks(),b=f.getNumberOfPreferredPrefixLinks();if(e>b)return-1;if(e<b)return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfSuboptimalLinks(): "+g.getNumberOfSuboptimalLinks());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfSuboptimalLinks(): "+f.getNumberOfSuboptimalLinks());e=g.getNumberOfSuboptimalLinks();b=f.getNumberOfSuboptimalLinks();if(e<b)return-1;if(e>b)return 1;
c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredLinks(): "+g.getNumberOfPreferredLinks());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredLinks(): "+f.getNumberOfPreferredLinks());e=g.getNumberOfPreferredLinks();b=f.getNumberOfPreferredLinks();if(e>b)return-1;if(e<b)return 1;e=g.getLinks().size;b=f.getLinks().size;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+e);c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+
b);if(e<b)return-1;if(e>b)return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e out of comapre, about to call breakByLowerLinkID");return c.breakByLowerLinkID(g,f)};this.breakByLowerLinkID=function(g,f){c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID");var e=g.getSortedLinks(),b=f.getSortedLinks(),a=null,d=null,h=0,l=0;do c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID in do while"),l>=e.length?(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 1 is shorter"),
h=-1):l>=b.length?(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 2 is shorter"),h=1):(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path are same, compare IDS"),a=e[l],d=b[l]),l++;while(0===h&&a.getUniqueID()===d.getUniqueID());0===h&&(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+a.getUniqueID()),c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+d.getUniqueID()),
h=a.getUniqueID()<d.getUniqueID()?-1:1);return h}};CTATExampleTracerPathComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPathComparator.prototype.constructor=CTATExampleTracerPathComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPathComparator);var CTATExampleTracerPath=function(c){CTATBase.call(this,"CTATExampleTracerPath","");var g=new Set;"undefined"!==typeof c&&null!==c&&c.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in constructor building links with "+a);g.add(a)});var f=null,e=null,b=null,a=null,d=null,h=null,l=this;this.isIncorrectPath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isIncorrectPath");if(null!==h&&"undefined"!==typeof h)return h;var a=!1;l.getLinks().forEach(function(b){!0!==a&&b.getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(a=h=!0)});if(!0===a)return!0;h=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isIncorrectPath");return!1};this.getNumberOfSuboptimalLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfSuboptimalLinks");l.getSortedLinks();if(null!==a&&"undefined"!==typeof a)return a;var b=0;l.getLinks().forEach(function(a){CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()===a.getType().toString()&&b++});a=b;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfSuboptimalLinks");
return b};this.getNumberOfPreferredPrefixLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredPrefixLinks");if(null!==e&&"undefined"!==typeof e)return e;var a=0,b=!1;l.getSortedLinks().forEach(function(c){!0!==b&&(!0===c.getIsPreferredLink()?a++:b=!0)});e=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredPrefixLinks");return a};this.size=function(){return g.size};this.containsAll=function(a){var b=!0;if(a)for(var c=0;b&&c<a.length;++c)b=l.getLinks().has(a[c]);
l.ctatdebug("CTATExampleTracerPath containsAll(testLinks.length "+a.length+") returning "+b);return b};this.getLinksRestricted=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getLinksRestricted");var b=CTATExampleTracerPath.getDeepestLink(a),c=new Set;g.forEach(function(a){a.getDepth()<=b.getDepth()&&c.add(a)});ctatdebug("CTATExampleTracerPath --\x3e out of getLinksRestricted");return c};this.getLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getLinks");return g};this.getSortedLinks=
function(){ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks that.getLinks(): "+l.getLinks());f=[];l.getLinks().forEach(function(a){f.push(a)});ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks sortedLinks.length(): "+f.length);f.sort(function(a,b){return a.getDepth()-b.getDepth()});ctatdebug("CTATExampleTracerPath --\x3e out of getSortedLinks, returning "+f);return f};this.isDonePath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isDonePath");if(null!==d&&"undefined"!==typeof d)return d;
var a=!1;l.getLinks().forEach(function(b){!0!==a&&!0===b.isDone()&&(a=d=!0)});if(!0===a)return!0;d=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isDonePath");return!1};this.addLink=function(c){ctatdebug("CTATExampleTracerPath --\x3e in addLink ("+c+")");g.add(c);h=d=a=b=e=f=null;ctatdebug("CTATExampleTracerPath --\x3e out of addLink")};this.getNumberOfPreferredLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredLinks");if(null!==b&&"undefined"!==typeof b)return b;var a=
0;l.getLinks().forEach(function(b){!0===b.getIsPreferredLink()&&a++});b=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredLinks");return a};this.subpath=function(a){for(var b=new CTATExampleTracerPath,c=l.getSortedLinks(),d=0;d<c.length;++d)if(b.addLink(c[d]),c[d].getNextNode()==a.getNodeID())return b;return null};this.toString=function(){var a="CTATExampleTracerPath: links";l.getSortedLinks().forEach(function(b){a+=" "+b});return a};CTATExampleTracerPath.getDeepestLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getDeepestLink");
var b=null;a.forEach(function(a){if(null===b||"undefined"===typeof b||b.getDepth()<a.getDepth())b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getDeepestLink");return b};CTATExampleTracerPath.getBestPath=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath");var b=null,c=new CTATExampleTracerPathComparator;a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath loop");if(null===b||"undefined"===typeof b||0<c.compare(b,a))b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getBestPath");
return b}};CTATExampleTracerPath.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPath.prototype.constructor=CTATExampleTracerPath;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPath);var CTATLinkGroup=function(){CTATBase.call(this,"CTATLinkGroup","")};CTATLinkGroup.prototype=Object.create(CTATBase.prototype);CTATLinkGroup.prototype.constructor=CTATLinkGroup;"undefined"!==typeof module&&(module.exports=CTATLinkGroup);var CTATDefaultLinkGroup=function(c,g,f,e){CTATLinkGroup.call(this,"CTATDefaultLinkGroup",c);var b=c,a=g,d=f,h=new Set;null!==e&&"undefined"!==typeof e&&e.forEach(function(a){h.add(a)});var l=new Set,m=null,n=null,p=this;p.ctatdebug("CTATDefaultLinkGroup constructor group name: "+c);p.ctatdebug("CTATDefaultLinkGroup constructor group isOrdered: "+g);p.ctatdebug("CTATDefaultLinkGroup constructor group isReenterable: "+f);this.toXML=function(a,b){var c=a+'<group name="'+p.getName(),c=c+('" ordered="'+
p.getIsOrdered()),c=c+('" reenterable="'+p.getIsReenterable()+'">\n');b.getUniqueLinks(p).forEach(function(b){c+=a+'    <link id="'+b.getUniqueID()+'"/>\n'});l.forEach(function(d){c+=d.toXML(a+"    ",b)});return c+=a+"</group>\n"};this.setOrdered=function(c){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered group name: "+b);p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered:: "+c);a=c};this.setName=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setName: "+a);b=a};this.containsLink=
function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in containsLink: "+a.getUniqueID());return h.has(a)};this.removeLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in removeLink: "+a.getUniqueID());return h["delete"](a)};this.getParent=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getParent");return m};this.addLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addLink: "+a.getUniqueID());h.add(a)};this.getIsOrdered=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsOrdered: "+
a);return a};this.getIsReenterable=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsReenterable: "+d);return d};this.getSubgroups=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getSubgroups");return l};this.setSubgroups=function(a){l=a};this.getLinks=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getLinks");return h};this.setReenterable=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setReenterable: "+a);d=a};this.setParent=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setParent: "+
a.getName());m=a};this.addSubgroup=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addSubgroup groupName: "+a.getName());l.add(a)};this.getName=function(){return b};this.getDefaultBuggyMsg=function(){return n};this.setDefaultBuggyMsg=function(a){n=""==a?null:a};this.toString=function(){return"Group Name: "+this.getName()}};CTATDefaultLinkGroup.prototype=Object.create(CTATLinkGroup.prototype);CTATDefaultLinkGroup.prototype.constructor=CTATDefaultLinkGroup;
"undefined"!==typeof module&&(module.exports=CTATDefaultLinkGroup);var InternalGroupIterator=function(c,g){CTATBase.call(this,"InternalGroupIterator",c);var f=this,e=g.length,b=[],a=0;c.getSubgroups().forEach(function(a){a&&b.push(a)});g.push(f);f.ctatdebug("InternalGroupIterator() constructor group "+c+", stack.length "+g.length+", sgList.length "+b.length);this.toString=function(){return"{"+c+" at "+e+" with "+b.length+" subgroups}"};this.next=function(){return a>=b.length?(g.pop(),f.ctatdebug("InternalGroupIterator at deepest next() returning "+c+" with stack.length "+
g.length),{value:c,done:!1}):(new InternalGroupIterator(b[a++],g)).next()}};InternalGroupIterator.prototype=Object.create(CTATBase.prototype);InternalGroupIterator.prototype.constructor=InternalGroupIterator;var CTATGroupIterator=function(c){CTATBase.call(this,"CTATGroupIterator",c);this.ctatdebug("CTATGroupIterator("+c+") begin constructor");var g=null;this.next=function(){null===g&&(g=[],new InternalGroupIterator(c,g));return 0>=g.length?{value:null,done:!0}:g[g.length-1].next()}};
CTATGroupIterator.prototype=Object.create(CTATBase.prototype);CTATGroupIterator.prototype.constructor=CTATGroupIterator;"undefined"!==typeof module&&(module.exports=CTATGroupIterator);var CTATGroupModel=function(){CTATBase.call(this,"CTATGroupModel","");var c=this;this.clear=function(){};this.setDefaultReenterable=function(c){};this.setGroupOrdered=function(c,f){};this.getTopLevelGroup=function(){};this.setGroupName=function(c,f){};this.addLinkToGroup=function(c,f){};this.isGroupOrdered=function(c){};this.isGroupReenterable=function(c){};this.isLinkInGroup=function(){};this.getGroupsContainingLink=function(c){};this.getGroupLinkCount=function(g){return c.getGroupLinks(g).size};
this.getLowestLevelGroupOfLink=function(c){};this.getGroupSubgroups=function(c){};this.getUniqueLinks=function(c){};this.getGroupLinks=function(c){};this.removeLinkFromGroup=function(c,f){};this.getGroupParent=function(c){};this.addGroup=function(c,f,e){};this.setGroupReenterable=function(c,f){}};CTATGroupModel.prototype=Object.create(CTATBase.prototype);CTATGroupModel.prototype.constructor=CTATGroupModel;"undefined"!==typeof module&&(module.exports=CTATGroupModel);var CTATDefaultGroupModel=function(){function c(a,b,c){l.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroupRecursive");!0===a.containsLink(b)&&(l.getGroupSubgroups(a).forEach(function(a){l.removeLinkFromGroup(a,b)}),(a!==d||c)&&g(a,b))}function g(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroup");return a.removeLink(b)}function f(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in getImmediateGroupOfLink");var c=null,d=!1,e=null;l.getGroupSubgroups(b).forEach(function(b){!0!==
d&&!0===l.isLinkInGroup(b,a)&&(c=f(a,b),e=null!==c&&"undefined"!==typeof c?c:b,d=!0)});return!0===d?e:null}function e(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in getNaturalContainingGroup");if(b.size===l.getGroupLinks(a).size)throw l.getGroupLinks(a).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}),new CTATExampleTracerException("Group containing this set of links already exists: "+a);if(b.size>=l.getGroupLinks(a).size)throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+
a);var c=!1,d=null;b.forEach(function(f){if(!0!==c){if(!1===l.isLinkInGroup(a,f))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);l.getGroupSubgroups(a).forEach(function(g){!0!==c&&!0===l.isLinkInGroup(g,f)&&(l.getGroupLinkCount(g)>=b.size?(d=e(g,b),c=!0):l.getGroupLinks(g).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}))})}});return!0===c?d:a}function b(b,
c){l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity parent: "+b.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity child: "+c.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity size: "+l.getGroupSubgroups(b).size);l.getGroupSubgroups(b).forEach(function(d){var e=l.getGroupLinks(d);if(0===e.size)l.getGroupSubgroups(b)["delete"](d),a(c,d);else{var f=null,g=!1;e.forEach(function(a){!1===g&&(f=a,g=!0)});!0===l.isLinkInGroup(c,
f)&&(l.getGroupSubgroups(b)["delete"](d),a(c,d))}});a(b,c)}function a(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroup");a.addSubgroup(b);b.setParent(a)}CTATGroupModel.call(this);var d=null,h=!1,l=this;this.clear=function(){l.ctatdebug("CTATDefaultGroupModel --\x3e in clear");d=new CTATDefaultLinkGroup("defaultName",!0,h,null)};this.setDefaultReenterable=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in setDefaultReenterable");h=a};this.setGroupOrdered=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupOrdered");
a.setOrdered(b)};this.getTopLevelGroup=function(){ctatdebug("CTATDefaultGroupModel --\x3e in getTopLevelGroup");return d};this.setGroupName=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupName");a.setName(b)};this.addLinkToGroup=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in addLinkToGroup");for(l.removeLinkFromGroup(d,b);null!==a&&"undefined"!==typeof a;a=l.getGroupParent(a)){var c=a,e=b;l.ctatdebug("CTATDefaultGroupModel --\x3e in internalAddLinkToGroup");c.addLink(e)}};
this.isGroupOrdered=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered group name: "+a.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered: "+a.getIsOrdered());return a.getIsOrdered()};this.isGroupReenterable=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupReenterable");return a.getIsReenterable()};this.isLinkInGroup=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in isLinkInGroup");return a.containsLink(b)};this.getGroupsContainingLink=
function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink("+a+"): TopLevel "+d+", typeof(TopLevel) "+typeof d);var b=new Set,c=new CTATGroupIterator(d);l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink before loop: groupIter "+c+", typeof(groupIter) "+typeof c);for(var e=c.next();!e.done;e=c.next())e=e.value,!0===l.isLinkInGroup(e,a)&&b.add(e);l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink returning groups.size "+b.size);return b};this.getLowestLevelGroupOfLink=
function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getLowestLevelGroupOfLink");var b=f(a,d);return null!==b&&"undefined"!==typeof b?b:!0===l.isLinkInGroup(d,a)?d:null};this.getGroupSubgroups=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupSubgroups");return null!==a&&"undefined"!==typeof a?a.getSubgroups():null};this.getUniqueLinks=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getUniqueLinks");var b=new Set;l.getGroupLinks(a).forEach(function(a){b.add(a)});l.getGroupSubgroups(a).forEach(function(a){l.getGroupLinks(a).forEach(function(a){b["delete"](a)})});
return b};this.getGroupLinks=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupLinks: "+a.getName());return a.getLinks()};this.removeLinkFromGroup=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in removeLinkFromGroup");c(a,b,!1)};this.getGroupParent=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupParent");return a.getParent()};this.addGroup=function(a,c,f){l.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup");var g=null;try{g=e(d,f)}catch(u){return u.toString()}a=
new CTATDefaultLinkGroup(a,c,h,f);l.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup after creating new group");b(g,a);return""};this.setGroupReenterable=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupReenterable");a.setReenterable(b)};this.createIdToLinkMap=function(){l.ctatdebug("CTATDefaultGroupModel --\x3e in createIdToLinkMap");var a={};l.getGroupLinks(d).forEach(function(b){a[b.getUniqueID()]=b});return a};this.getGroupByName=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupByName TopLevel has: "+
d.getSubgroups().size);for(var b=new CTATGroupIterator(d),c=b.next();!c.done;c=b.next())if(c=c.value,l.getGroupName(c).toString()===a.toString())return c;return null};this.getGroupName=function(a){return a.getName()};l.clear()};CTATDefaultGroupModel.prototype=Object.create(CTATGroupModel.prototype);CTATDefaultGroupModel.prototype.constructor=CTATDefaultGroupModel;"undefined"!==typeof module&&(module.exports=CTATDefaultGroupModel);var CTATMatcherComparator=function(){CTATBase.call(this,"CTATMatcherComparator","");CTATMatcherComparator.compare=function(c,g){ctatdebug("CTATMatcherComparator--\x3e in compare");var f=CTATMatcherComparator.compareBasedOnType(c,g);if(0!==f||!1===c instanceof CTATVectorMatcher&&!1===g instanceof CTATVectorMatcher)return f;f=CTATMatcherComparator.compareBasedOnType(c.getSingleMatcher("input"),g.getSingleMatcher("input"));if(0!==f)return f;f=CTATMatcherComparator.compareBasedOnType(c.getSingleMatcher("selection"),
g.getSingleMatcher("selection"));return 0!==f?f:CTATMatcherComparator.compareBasedOnType(c.getSingleMatcher("action"),g.getSingleMatcher("action"))};CTATMatcherComparator.compareBasedOnType=function(c,g){ctatdebug("CTATMatcherComparator --\x3e in compareBasedOnType");for(var f in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(f)&&c instanceof CTATMatcherComparator.matcherPrecedenceOrder[f])break;for(var e in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(e)&&
g instanceof CTATMatcherComparator.matcherPrecedenceOrder[e])break;return f<e?1:f>e?-1:0}};Object.defineProperty(CTATMatcherComparator,"matcherPrecedenceOrder",{enumerable:!1,configurable:!1,writable:!1,value:{0:CTATExactMatcher,1:CTATRangeMatcher,2:CTATExpressionMatcher,3:CTATWildcardMatcher,4:CTATRegexMatcher,5:CTATAnyMatcher}});CTATMatcherComparator.prototype=Object.create(CTATBase.prototype);CTATMatcherComparator.prototype.constructor=CTATMatcherComparator;
"undefined"!==typeof module&&(module.exports=CTATMatcherComparator);new CTATMatcherComparator;var CTATExampleTracerLinkComparator=function(c,g){CTATBase.call(this,"CTATExampleTracerLinkComparator","");this.compare=function(f,e){ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());var b=f.getType(),a=e.getType(),b=CTATExampleTracerLink.compareLinkTypes(b,a);if(0!==b)return ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare m: "+b),b;b=g.nonEmptyHints(f,
c.getVariableTable());a=g.nonEmptyHints(e,c.getVariableTable());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare h1, h2: "+b+", "+a);if(0<b&&0>=a)return-1;if(0>=b&&0<a)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getDepth(), l2.getDepth(): "+f.getDepth()+", "+e.getDepth());if(f.getDepth()<e.getDepth())return-1;if(f.getDepth()>e.getDepth())return 1;b=c.getTraversalCount(f)-f.getMinTraversals();a=c.getTraversalCount(e)-e.getMinTraversals();ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare tc1, tc2: "+
b+", "+a);if(0>b&&0<=a)return-1;if(0<=b&&0>a)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getIsPreferredLink(): "+f.getIsPreferredLink());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getIsPreferredLink(): "+e.getIsPreferredLink());if(f.getIsPreferredLink())return-1;if(e.getIsPreferredLink())return 1;if(0!==(b=CTATMatcherComparator.compare(f.getMatcher(),e.getMatcher())))return b;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+
f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+e.getUniqueID());return f.getUniqueID()<e.getUniqueID()?-1:1}};CTATExampleTracerLinkComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLinkComparator.prototype.constructor=CTATExampleTracerLinkComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkComparator);var CTATExampleTracerEvent=function(c,g,f){CTATBase.call(this,"CTATExampleTracerEvent",g?g.toString():"null");var e="",b=!1,a=CTATExampleTracerLink.NO_MODEL,d=!1,h=null,l=null,m="student",n=null,p=null,r="",u=null,w="",q=null,y=null,z=null,B=null,v=[],E=!1,C=null,A=null,F=this,K=null,H=[],x=[],G={};this.getMsgToRestore=function(){return K};this.setMsgToRestore=function(a){K=a};this.getActor=function(){return m};this.setActor=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e setActor("+a+")");
m=a};this.getStudentSAI=function(){F.ctatdebug("CTATExampleTracerEvent.getStudentSAI() returning type "+typeof h+", value "+h);return h};this.setStudentSAI=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setStudentSAI("+a+")");null!==a&&"undefined"!==typeof a&&(h=a);F.ctatdebug("CTATExampleTracerEvent --\x3e out of setStudentSAI")};this.getPreloadedLinkMatches=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getPreloadedLinkMatches");return q};this.setTutorSAI=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setTutorSAI");
null!==a&&"undefined"!==typeof a&&(l=a);F.ctatdebug("CTATExampleTracerEvent --\x3e out of setTutorSAI")};this.setNumberOfInterpretations=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setNumberOfInterpretations( "+a+" )")};this.getTransactionID=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getTransactionID() returning "+e);return e};this.setTransactionID=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setTransactionID( "+a+" )");e=a};this.setDoneStepFailed=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setDoneStepFailed( "+
a+" )");b=a};this.setHintRequest=function(a){d=a};this.getHintRequest=function(){return d};this.setResult=function(b){F.ctatdebug("CTATExampleTracerEvent --\x3e in setResult( "+b+" )");a=b};this.isBuggyResult=function(){return a.toString()===CTATExampleTracerLink.BUGGY_ACTION||a.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION};this.isSolverResult=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in isSolverResult");return!1};this.getResult=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getResult() returning "+
a);return a};this.setReportableLink=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableLink("+a+")");n=a};this.setReportableInterpretation=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableInterpretation("+a+")");p=a};this.setStepID=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setStepID("+a+")");r=a?a.toString():""};this.setReportableVariableTable=function(a){z=a.clone()};this.setSuccessOrBuggyMsg=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setSuccessOrBuggyMsg("+
a+")");B=a};this.setReportableHints=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableHints("+a+")");v=Array.isArray(a)&&0<a.length?a:[]};this.getWantReportableHints=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getWantReportableHints() returning "+E);return E};this.setOutOfOrder=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setOutOfOrder("+a+")");u=a};this.isOutOfOrder=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getOutOfOrder() returning "+
u);return u};this.setTraceOutcome=function(a){w=a};this.getTraceOutcome=function(){return w};this.setEvaluatedInput=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setEvaluatedInput("+a+")");if(null===y||"undefined"===typeof y)y=[];y.push(a)};this.addPreloadedLinkMatch=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in addPreloadedLinkMatch("+a+")");if(null===q||"undefined"===typeof q)q=[];q.push(a)};this.setInterpolatedSAI=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedSAI("+
a+")");a&&(C=a)};this.getInterpolatedSAI=function(){return C?C:F.getStudentSAI()};this.setInterpolatedHints=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedHints("+a+")");A&&(A.length=0);a&&(A=a.slice(0));F.ctatdebug("CTATExampleTracerEvent --\x3e out of setInterpolatedHints")};this.setWantReportableHints=function(a){F.ctatdebug("CTATExampleTracerEvent --\x3e in setWantReportableHints("+a+")");E=a};this.setAssociatedRules=function(a){H=a instanceof Array?a:a instanceof String?
[a]:[]};this.setAssociatedSkills=function(a){x=a instanceof Array?a:a instanceof String?[a]:[]};this.setCustomFields=function(a){G=a instanceof Object?a:{}};this.getSuccessOrBuggyMsg=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getSuccessOrBuggyMsg() returning "+B);return B};this.getReportableHints=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableHints() returning "+v);return v};this.getReportableLink=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableLink() returning "+
n);return n};this.getReportableVariableTable=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableVariableTable() returning "+z);return z};this.getReportableInterpretation=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableInterpretation() returning "+p);return p};this.getStepID=function(){F.ctatdebug("CTATExampleTracerEvent --\x3e in getStepID() returning "+r);return r};this.getTutorSelection=function(){return null===l||"undefined"===typeof l?null:l.getSelectionArray()};
this.getTutorAction=function(){return null===l||"undefined"===typeof l?null:l.getActionArray()};this.getTutorInput=function(){return null!==y&&"undefined"!==typeof y?F.getEvaluatedInputArray():null!==l&&"undefined"!==typeof l?l.getInputArray():null};this.getEvaluatedInputArray=function(){return y};this.toString=function(){var a;a="["+F.getResult();null!==F.getStudentSAI()&&"undefined"!==typeof F.getStudentSAI()&&(a+=", StudentSAI "+F.getStudentSAI());null!==F.getReportableLink()&&"undefined"!==typeof F.getReportableLink()&&
(a+=", reportableLink "+F.getReportableLink());!0===F.isDoneStepFailed()&&(a+=", doneStepFailed");null!==F.getTutorSAI()&&"undefined"!==typeof F.getTutorSAI()&&(a+=", TutorSAI "+F.getTutorSAI());return a+"]"};this.isDoneStepFailed=function(){return b};this.getTutorSAI=function(){return l};this.getAssociatedRules=function(){return H};this.getAssociatedSkills=function(){return x};this.getCustomFields=function(){return G};this.setStudentSAI(g);this.setActor(f)};CTATExampleTracerEvent.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerEvent.prototype.constructor=CTATExampleTracerEvent;"undefined"!==typeof module&&(module.exports=CTATExampleTracerEvent);var CTATExampleTracerInterpretation=function(c){CTATBase.call(this,"CTATExampleTracerInterpretation","");var g=null,f=[],e={},b=new CTATVariableTable,a=new Set;c.forEach(function(b){a.add(b)});var d=CTATExampleTracerLink.CORRECT_ACTION,h=null,l=this;this.getVariableTable=function(){return b};this.setVariableTable=function(a){b=a};this.setLatestHints=function(a,c){l.ctatdebug("In evaluate after calling setInterpolatedHints");if(!Array.isArray(a)||1>a.length)a=c;!Array.isArray(a)||1>a.length||b.put("hints",
a)};this.getLatestHints=function(){return b.get("hints")};this.setLatestBuggyMessage=function(a){!a||1>(a=String(a)).length||b.put("buggy_message",a)};this.setLatestSuccessMessage=function(a){!a||1>(a=String(a)).length||b.put("success_message",a)};this.getLatestBuggyMessage=function(){return b.get("buggy_message")};this.getLatestSuccessMessage=function(){return b.get("success_message")};this.getTraversalCount=function(a){a=e[a.getUniqueID()];return"undefined"===typeof a||null===a?0:a[0]};this.getPaths=
function(){return a};this.clone=function(){var c=new CTATExampleTracerInterpretation(a);c.setInterpolatedSAI(l.getInterpolatedSAI());c.addTraversedLinks(f);for(var g in e)e.hasOwnProperty(g)&&c.putInlinkIdTraversalCountMap(g,e[g].slice());c.setWorstLinkType(d);g=b.clone();c.setVariableTable(g);c.setLatestHints(l.getLatestHints());c.setLatestSuccessMessage(l.getLatestSuccessMessage());c.setLatestBuggyMessage(l.getLatestBuggyMessage());h&&c.setPathToDone(new CTATExampleTracerPath(h.getLinks()));ctatdebug("CTATExampleTracerInterpretation --\x3e out of clone");
return c};this.addTraversedLinks=function(a){f=f.concat(a)};this.putInlinkIdTraversalCountMap=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap");ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap key: "+a);ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap value: "+b);e[a]=b};this.setWorstLinkType=function(a){d=a};this.addLink=function(a){!a.isTraversable()||h&&h.getLinks().has(a)||(h=null);
ctatdebug("CTATExampleTracerInterpretation.addLink("+(a&&a.getUniqueID())+") pathToDone "+(h&&h.size()));f.push(a);var b=a.getMatcher(),b=null===b||"undefined"===typeof b?1:b.getTraversalIncrement(),c=e[a.getUniqueID()];null!==c&&"undefined"!==typeof c?c[0]+=b:(c=[],c.push(b),e[a.getUniqueID()]=c);a=a.getType();0>CTATExampleTracerLink.compareLinkTypes(d,a)&&(d=a)};this.setPathToDone=function(a){h=a};this.getPathToDone=function(a){if(h)return h;var b=a.getStartNode();b&&a.getDoneStates().forEach(function(c){h||
(h=a.getBestSubpath(b,c,f))});return h};this.countStepsForScore=function(a){var b=Number.MAX_VALUE,c=l.getPathToDone(a);if((a=a.getStudentStartsHereNode()||a.getStartNode())&&c&&c.getLinks()){var d=a.getNodeID(),b=0;c.getSortedLinks().forEach(function(a){if(!(0<d&&a.getPrevNode()!=d||(d=-1,CTATMatcher.isTutorActor(a.getActor(),!0)))){var c=l.getTraversalCount(a);a=a.getMinTraversals();b=c>a?b+c:b+a}})}return b};this.updateVariableTable=function(a,c,d){var e=a,f=a.getInput();null!==c&&"undefined"!==
typeof c&&(f=c,e=new CTATSAI(a.getSelection(),a.getAction(),f));b.put("link"+d.getUniqueID()+".selection",a.getSelection());b.put("link"+d.getUniqueID()+".action",a.getAction());c="link"+d.getUniqueID()+".input";b.put(c,f);b.put(CTATVariableTable.nameAsString(c),CTATVariableTable.valueAsString(f));if(CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()===d.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()===d.getActionType().toString().toUpperCase())a=
a.getSelection(),null!==a&&"undefined"!==typeof a&&0<a.length&&b.put(a,f);return e};this.getInterpolatedSAI=function(){return g};this.setInterpolatedSAI=function(a){g=a};this.getLastMatchedLink=function(){return 0===f.length?null:f[f.length-1]};this.getMatchedLinks=function(){return f};this.getType=function(){return d};this.isTraversed=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed: "+a.getUniqueID());var c=e[a.getUniqueID()];if(null===c||"undefined"===typeof c)return ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (traversalCount === null): "+
(null===c)),ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (typeof(traversalCount) === 'undefined'): "+("undefined"===typeof c)),!0===b?0>=a.getMinTraversals():!1;ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition traversalCount[0]: "+c[0]);ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition link.getMinTraversals(): "+a.getMinTraversals());return c[0]>=a.getMinTraversals()};this.toString=function(){var c=
"{";f.forEach(function(a){c+=a.getUniqueID()+", "});c.substring(c.length-2,c.length).toString()===", ".toString()&&(c=c.substring(0,c.length-2));c+=" ("+(null===a||"undefined"===typeof a?-1:a.size)+" paths)";c+=" var tbl "+b;return c+="}"}};CTATExampleTracerInterpretation.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretation.prototype.constructor=CTATExampleTracerInterpretation;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretation);var CTATExampleTracerInterpretationComparator=function(){CTATBase.call(this,"CTATExampleTracerInterpretationComparator","");var c=this;this.compare=function(g,f){c.ctatdebug("CTATExampleTracerInterpretationComparator --\x3e in compare");var e=g.getType(),b=CTATExampleTracerLink.compareLinkTypes(e,f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i1Type: "+g.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i2Type: "+f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing link types result: "+
b);if(0!==b)return ctatdebug("CTATExampleTracerInterpretationComparator result is not equal to 0"),0>b?1:-1;if(CTATExampleTracerLink.BUGGY_ACTION.toString().toUpperCase()===e.toString().toUpperCase()&&(ctatdebug("CTATExampleTracerInterpretationComparator checking for buggy actions"),e=g.getLastMatchedLink(),b=f.getLastMatchedLink(),e=CTATMatcherComparator.compare(e.getMatcher(),b.getMatcher()),0!==e))return e;var b=CTATExampleTracerPath.getBestPath(g.getPaths()),e=CTATExampleTracerPath.getBestPath(f.getPaths()),
a=new Set;a.add(b);a.add(e);b=CTATExampleTracerPath.getBestPath(a);ctatdebug("CTATExampleTracerInterpretationComparator found best path: "+(b===e));b.getLinks().forEach(function(a){c.ctatdebug("My best link==: "+a.getUniqueID())});return b===e?-1:1}};CTATExampleTracerInterpretationComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretationComparator.prototype.constructor=CTATExampleTracerInterpretationComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretationComparator);var CTATExampleTracerTracer_count=0,CTATExampleTracerTracer=function(c,g){function f(a,b,c){if(!a)return a;b=new CTATFormulaParser(b);x.ctatdebug("CTATETT.interpolate("+a+",vt,"+c+")");var d=c.getSelection(),e=c.getAction();c=c.getInput();c=CTATVariableTable.standardizeType(c);x.ctatdebug("CTATETT.interpolate() calling CTATFP.interpolate("+a+", "+d+", "+e+", "+c);a=b.interpolate(a,d,e,c);x.ctatdebug("CTATETT.interpolate() returning "+a);return a}function e(a,b,c,d,e,g){x.ctatdebug("finishEvaluate() doUpdate "+
b+", link "+d+", bestInterp.getLastMatchedLink() "+e.getLastMatchedLink());null==d&&(d=e.getLastMatchedLink());(b||a.getWantReportableHints())&&g.forEach(function(b){var c="",g=b.getLastMatchedLink();g&&(g.getActionType()==CTATExampleTracerLink.CORRECT_ACTION?a.getHintRequest()?a.getWantReportableHints()&&b.setLatestHints(d.interpolateHints(b.getVariableTable()),g.getHints()):b.setLatestSuccessMessage(c=f(g.getSuccessMsg(),b.getVariableTable(),a.getStudentSAI())):b.setLatestBuggyMessage(c=f(g.getBuggyMsg(),
b.getVariableTable(),a.getStudentSAI())),b==e&&(x.ctatdebug('ETT.finishEvaluate() successOrBuggyMsg "'+c+'"'),a.setSuccessOrBuggyMsg(c)))});if(b){C.push(a.getStudentSAI());d!=e.getLastMatchedLink()&&(e.addLink(d),a.setResult(d.getActionType()),a.setTraceOutcome(d.getActionType()));if(c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()){x.ctatdebug("In evaluate -- in first branch doUpdate()");g.forEach(function(a){a.getLastMatchedLink().getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(x.ctatdebug("In evaluate -- deleting an incorrect interp"),g["delete"](a))});x.ctatdebug("In evaluate -- to call setInterpretations(), if 0 < newInterps.size "+g.size);0<g.size&&(r(g),K=e);for(var h in E)E.hasOwnProperty(h)&&delete E[h];x.ctatdebug("In evaluate -- out of DoUpdate if branch")}else{x.ctatdebug("In evaluate -- in else branch of doUpdate");a.setNumberOfInterpretations(0);for(var l in E)E.hasOwnProperty(l)&&delete E[l];g.forEach(function(a){E[a.getLastMatchedLink().getUniqueID()]=
a.getLastMatchedLink()})}c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&C.splice(C.length-1,1)}a.isSolverResult()||(x.ctatdebug("In evaluate inside the NOT solver result if condition "+c),a.setResult(c),a.setTraceOutcome(c));x.ctatdebug("In evaluate out the solver result if condition");a.setReportableLink(d);a.setAssociatedSkills(d.getSkillNames());a.setStepID(d.getUniqueID());a.setReportableInterpretation(e);a.setInterpolatedSAI(e.getInterpolatedSAI());a.setReportableVariableTable(e.getVariableTable());
a.getHintRequest()?(a.setReportableHints(e.getLatestHints()),x.ctatdebug("In evaluate --\x3e after setReportableHints")):(b=d.getTutorSAI(a.getInterpolatedSAI(),e.getVariableTable()),x.ctatdebug("In evaluate -- TUTORSAI: "+b+", studentSAI was "+a.getStudentSAI()),a.setTutorSAI(b));x.ctatdebug("In evaluate after fireExampleTracerEvent");x.ctatdebug("CTATExampleTracerTracer --\x3e out of finishEvaluate");return c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()}function b(b,c,d,e){x.ctatdebug("checkDoneStep() hintTrace "+
c+", sai "+b.getStudentSAI()+", exitOnIncorrectDone "+A.exitOnIncorrectDone()+", hideButRequireSteps "+A.hideButRequireSteps()+", nInterps "+e.size);if(!b.getStudentSAI().isDone())return x.ctatdebug("checkDoneStep() not isDone(), so setDoneStepFailed(false) & return null "),null;if(A.exitOnIncorrectDone())return x.ctatdebug("checkDoneStep() exitOnIncorrectDone() with setDoneStepFailed(false), so return CORRECT"),a(b,d,null,e);if(!c&&A.hideButRequireSteps()){c=A.getDoneLinks();x.ctatdebug("checkDoneStep getDoneLinks().size "+
c.size);c=c.values();for(var f;!(f=c.next()).done;)if(A.pathToLinkIsSubset(f.value,H))return a(b,d,f.value,e)}1>e.size&&b.setDoneStepFailed(!0);return null}function a(a,b,c,d){var f;a.setDoneStepFailed(!1);1>d.size?(d=x.getInterpretationsInternal(),f=x.getBestInterpretation()):f=p(d);f.setInterpolatedSAI(new CTATSAI("done","ButtonPressed","-1"));return e(a,b,CTATExampleTracerLink.CORRECT_ACTION,c,f,d)}function d(a,c,d){x.ctatdebug("CTATExampleTracerTracer --\x3e _evaluate("+a+", "+c+", "+d+")");F=
a;var f=new Set,g=a.getPreloadedLinkMatches();x.ctatdebug("interps # : "+v.length);x.ctatdebug("interps: "+v);v.forEach(function(b){x.ctatdebug("In evaluate -- entered the interpretations loop");if("undefined"===typeof g||null===g)x.ctatdebug("In evaluate -- entered if check for saiLinkMatches"),g=l(a.getStudentSAI(),a.getActor(),c,b.getVariableTable(),a),x.ctatdebug("In evaluate -- exiting if check for saiLinkMatches");else for(var e=0;e<g.length;++e)h(a.getStudentSAI(),!0,g[e],g[e].getActor(),b.getVariableTable());
x.ctatdebug("Link matches # : "+g.length);g.forEach(function(c){x.ctatdebug("In evaluate -- entered the saiLinkMatches loop + "+c);if(!A.relaxOrderConstraints()&&b.getTraversalCount(c)>=c.getMaxTraversals())return x.ctatdebug("In evaluate -- skipped a saiLinkMatches loop \n Skipped due to max traversals"+c.getMaxTraversals()),!1;var e=b.clone();e.setInterpolatedSAI(null);x.ctatdebug("In evaluate size of getPaths "+e.getPaths().size);e.getPaths().forEach(function(b){x.ctatdebug("In evaluate -- looping through the newInterp.getPaths()\n Examining path: "+
b);!1===m(c,e,b,!1,a)&&(x.ctatdebug("In evaluate -- in if condition, checking if isPathOK"),e.getPaths()["delete"](b),x.ctatdebug("In evaluate -- out of if condition, checking if isPathOK\n Tried to delete path."))});x.ctatdebug("In evaluate -- done looping through the newInterp.getPaths(), size "+e.getPaths().size);if(0<e.getPaths().size){x.ctatdebug("In evaluate -- if number of paths is greater than 0");e.addLink(c);x.ctatdebug("In evaluate -- new link added");if(!0===d){x.ctatdebug("In evaluate -- we are in the doUpdate if condition");
var g=n(c,a.getStudentSAI(),e);x.ctatdebug("In evaluate -- updatingVariable table");e.setInterpolatedSAI(e.updateVariableTable(a.getStudentSAI(),g,c));x.ctatdebug("In evaluate -- done updatingVariable table: "+e.getVariableTable())}f.add(e);x.ctatdebug("In evaluate -- added new interp")}x.ctatdebug("In evaluate -- out of saiLinkMatches loop")});x.ctatdebug("In evaluate -- out of interpretation loops")});a.setNumberOfInterpretations(f.size);x.ctatdebug("In evaluate -- number of interpretations "+f.size+
" set");var q=b(a,c,d,f);if(null!==q)return q;if(0===f.size)return x.ctatdebug("In evaluate -- if condition no new interpretations"),0!==g.length&&!0===g[0].isDone()&&a.setDoneStepFailed(!0),a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL),x.ctatdebug("In evaluate -- if condition no new interpretations returning false"),!1;q=p(f);x.ctatdebug("In evaluate -- just found bestInterp");var u=null;!0===a.isSolverResult()?(x.ctatdebug("In evaluate -- in if branch of isSolverResult"),
u=CTATExampleTracerLink.NO_MODEL.toString().toUpperCase()===a.getResult().toString().toUpperCase()?CTATExampleTracerLink.BUGGY_ACTION.toString():a.getResult().toString()):(x.ctatdebug("In evaluate -- in else branch of isSolverResult"),u=q.getLastMatchedLink().getType());return e(a,d,u,null,q,f)}function h(a,b,c,d,e){var f=b&&c.isCorrect();if("undefined"!=typeof H[c.getUniqueID()]||c.matchesSAIforHint(a,d,null,e))H[c.getUniqueID()]=f;x.ctatdebug("updateMatchedSelections(): link "+c.getUniqueID()+", matched "+
b+", newResult "+f+", matchedSelections[link] "+H[c.getUniqueID()])}function l(a,b,c,d,e){x.ctatdebug("CTATExampleTracerTracer --\x3e in findSAIMatchingLinks("+a+", "+b+", "+c+")");var f=[];A.getLinks().forEach(function(g){if(!1===c){x.ctatdebug("Calling link.matchesSAI() on link "+g+", sai "+a);var l=g.matchesSAI(a,b,d);x.ctatdebug("Result from link.matchesSAI() on link "+g+": "+l+", typeof "+typeof l);!0===l&&f.push(g);A.hideButRequireSteps()&&h(a,l,g,b,d)}else!0===g.matchesSAIforHint(a,b,e,d)&&
f.push(g)});x.ctatdebug("CTATExampleTracerTracer --\x3e out of findSAIMatchingLinks: #matchingLinks "+f.length);return f}function m(a,b,c,d,e){x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK");var f=null;if(!0===d){x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK in demonstrate mode");var g=b.getMatchedLinks().slice();g.push(a);f=c.getLinksRestricted(g)}else x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK NOT in demonstrate mode"),f=c.getLinks();x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK path.getLinks() "+
c.getLinks().size);x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK pathLinks "+f.size);if(!0===d){var h=[],l=!0;b.getMatchedLinks().forEach(function(a){!1!==l&&(!1===A.observesOrderingConstraints(h,a,f,e)||!1===w(b,a,f)?(x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false1"),l=!1):h.push(a))});if(!1===l)return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false2"),!1}if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()){if(!1===
A.isIncorrectLinkOK(b.getMatchedLinks(),a,f,b))return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false3"),!1}else{if(!1===A.observesOrderingConstraints(b.getMatchedLinks(),a,f,e))return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false4"),!1;if(!1===w(b,a,f))return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false5"),!1}x.ctatdebug("CTATExampleTracerTracer --\x3e out of isPathOK returning true");return!0}function n(a,b,c){x.ctatdebug("CTATExampleTracerTracer.replaceInput("+
a+", "+b+", ...)");if(null===a||"undefined"===typeof a||!1===a.replaceInput())return x.ctatdebug("replaceInput false, returning null"),null;a=a.evaluateReplacement(b,c.getVariableTable(),x);x.ctatdebug("CTATExampleTracerTracer.replaceInput() returning "+a);return a}function p(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation");var b=new CTATExampleTracerInterpretationComparator,c=null;a.forEach(function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation iteration");
null===c||"undefined"===typeof c?(x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation first if condition"),c=a):(x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation else of first if condition"),0<b.compare(a,c)&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation second if condition"),c=a))});x.ctatdebug("CTATExampleTracerTracer --\x3e out of findBestInterpretation");return c}function r(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in setInterpretations");
v.length=0;0===a.size?x.ctatdebug("CTATExampleTracerTracer --\x3e returning from setInterpretations"):(x.ctatdebug("CTATExampleTracerTracer --\x3e setInterpretations c.size: "+a.size),a.forEach(function(a){v.push(a)}),K=null,x.ctatdebug("CTATExampleTracerTracer --\x3e out of setInterpretations"))}function u(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths");var a=A.findAllPaths();x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths: #paths "+a.size);a.forEach(function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths loopring through paths");
x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths size of path"+a.getLinks().size)});return a}function w(a,b,c){x.ctatdebug("CTATExampleTracerTracer --\x3e in doneStepOK: link "+b+", isDone() "+b.isDone());if(null===b||"undefined"===typeof b||!1===b.isDone())return x.ctatdebug("doneStepOK in first if condition"),!0;if(b.isDone()&&A.exitOnIncorrectDone())return!0;if(b.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return x.ctatdebug("doneStepOK in second if condition"),
!0;x.ctatdebug("doneStepOK before loop");var d=!0;c.forEach(function(c){if(!1===d)x.ctatdebug("CTATExampleTracerTracer --\x3e we are breaking from the loop");else if(c.getUniqueID()===b.getUniqueID())x.ctatdebug("CTATExampleTracerTracer --\x3e inside second if condition");else{var e=a.getTraversalCount(c);A.hideButRequireSteps()&&(0<e||1>c.getMinTraversals())||!(e<c.getMinTraversals())||(x.ctatdebug("CTATExampleTracerTracer --\x3e we should return false from the second if condition"),d=!1)}});if(!1===
d)return x.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning false"),!1;x.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning true");return!0}function q(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink");var c=null!==b&&"undefined"!==typeof b&&null!==b[0]&&"undefined"!==typeof b[0]?b[0]:null;if(null===c||"undefined"===typeof c)x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink first if condition"),c=x.getBestInterpretation();null!==
b&&"undefined"!==typeof b&&(b[0]=c);x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink interp.getPaths(): "+c.getPaths().size);var d=CTATExampleTracerPath.getBestPath(c.getPaths());x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink path: "+d);var e=y(c,d,a,!1);x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink highestLink: "+e);if(null!==e&&"undefined"!==typeof e)return x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning highestLink"),e;
var f=null;x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getLinks() "+d.getLinks().size);x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getSortedLinks() "+d.getSortedLinks());var g=!1,h=null;d.getSortedLinks().forEach(function(b){!0!==g&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in for loop"+b),f=b,c.getTraversalCount(b)<b.getMaxTraversals()&&(!1===a||0<x.nonEmptyHints(b,c.getVariableTable()))&&A.observesOrderingConstraints(c.getMatchedLinks(),
b,d.getLinks(),null)&&w(c,b,d.getLinks())&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in link: "+b),h=b,g=!0))});if(!0===g)return h;x.ctatdebug("CTATExampleTracerTracer --\x3e out of _getBestNextLink, returning: "+f);return null}function y(a,b,c,d){x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink");var e=new CTATExampleTracerEvent(x,null,CTATMsgType.DEFAULT_STUDENT_ACTOR),f=!0,g=[];b.getSortedLinks().forEach(function(b){x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop link.getUniqueID(): "+
b.getUniqueID());x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop interp.isTraversed(link, countOptionalAsTraversed): "+a.isTraversed(b,d));x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop isNoOp(link): "+z(b));!0===a.isTraversed(b,d)||!0===z(b)?(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in if condition"),f=!0):(!0===f&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in second if condition"),
A.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){c&&1>x.nonEmptyHints(b,a.getVariableTable())||a.getTraversalCount(b)>=b.getMaxTraversals()||(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink pushing outlink: "+b.getUniqueID()),g.push(b))})),f=null===b||"undefined"===typeof b?!1:b.getMinTraversals()<=a.getTraversalCount(b))});g.sort(function(b,c){return(new CTATExampleTracerLinkComparator(a,x)).compare(b,c)});x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink before sorting");
var h=!1,l=null;g.forEach(function(c){!0!==h&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in fro loop"),!0===m(c,a,b,!1,e)?(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting first if"),l=c,h=!0):a.getPaths().forEach(function(d){!0!==h&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in inner loop"),b!==d&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting second if"),
!0===m(c,a,d,!1,e)&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting third if"),l=c,h=!0)))}))});if(!0===h)return x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink returning: "+l.getUniqueID()),l;x.ctatdebug("CTATExampleTracerTracer --\x3e out of getHighestUntraversedLink");return null}function z(a){return null===a||"undefined"===typeof a?!1:1>a.getMinTraversals()&&1>a.getMaxTraversals()}CTATBase.call(this,"CTATExampleTracerTracer",c);
var B=!1,v=null,E=null,C=null,A=c,F=null;CTATExampleTracerTracer_count++;var K=null,H={},x=this;this.getModelInitialized=function(){return B};this.setModelInitialized=function(a){B=a};this.goToDone=function(a,b,c){return(a=a.getPathToDone(b))?c.traceLinks(a.getSortedLinks()):!1};this.getMatchedSelections=function(){return H};this.getLastResult=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getResult");return F};this.resetTracer=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer entering");
null===v||"undefined"===typeof v?(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer making interpretations array"),v=[]):(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer clearing interpretations array"),v.length=0);var a=new CTATExampleTracerInterpretation(u());x.ctatdebug("CTATExampleTracerTracer tempInterp--\x3e in resetTracer tempInterp "+a);null!==g&&"undefined"!==typeof g&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer startStateVT if condition"),a.setVariableTable(g));
v.push(a);K=a;if(null===E||"undefined"===typeof E)x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer incorrectActionMatches if condition"),E={};else{x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of incorrectActionMatches if condition");for(var b in E)E.hasOwnProperty(b)&&delete E[b]}H={};null===C||"undefined"===typeof C?(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer last if condition"),C=[]):(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of last if condition"),
C.length=0);x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer before iterating over all the links in the graphs");A.getLinks().forEach(function(a){a.getMatcher().resetMatcher()});x.ctatdebug("CTATExampleTracerTracer --\x3e out of resetTracer")};this.evaluate=function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in public evaluate(), calling private _evaluate; given event "+a);return d(a,!1,!0)};this.nonEmptyHints=function(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints");
if(null===a||"undefined"===typeof a)return 0;var c=a.interpolateHints(b);x.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints: link.interpolateHints() "+a.interpolateHints().length);if(null===c||"undefined"===typeof c||1>c.length)return 0;for(var d=0,e=0;e<c.length;++e)0<String(c[e]).trim().length&&d++;x.ctatdebug("CTATExampleTracerTracer --\x3e returning from nonEmptyHints "+d);return d};this.traceForHint=function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint");var b=d(a,
!0,!1);x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint return from evaluate "+b);x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint result from evaluate "+a.getResult().toString());x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint link   from evaluate "+a.getReportableLink());if(a.getResult().toString()===CTATExampleTracerLink.CORRECT_ACTION.toString())return b=a.getReportableLink(),a.setTutorSAI(new CTATSAI(a.getStudentSAI().getSelection(),b.getDefaultSAI().getAction(),
b.getDefaultSAI().getInput())),a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR),x.ctatdebug("CTATExampleTracerTracer --\x3e traceForHint returning hintLink "+b+", result "+a),b;x.ctatdebug("CTATExampleTracerTracer --\x3e out of traceForHint, returning null");return null};this.matchForHint=function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint");var b;if((b=(b=a.getStudentSAI())?b.getSelectionArray():null)&&0<b.length&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint first if"),
(b=x.traceForHint(a))&&0<a.getReportableHints().length))return x.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint via traceForHint returning "+b+", result "+a),b;b=x.getBestNextLink(!0,a);x.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint() traceForHint via getBestNextLink returning "+b);return b};this.getBestNextLink=function(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink");var c=[],d=q(a,c);if(null===d||"undefined"===typeof d)return x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink returning null"),
null;if(d.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return null no correct suboptimal step"),null;x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink else branch");x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink got interp "+(null==c?"null":c[0]));if(b){var e=d.interpolateHints(c[0].getVariableTable());b.setInterpolatedHints(e);x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink setInterpolatedHints");
Array.isArray(e)&&0<e.length?b.setReportableHints(e):b.setReportableHints(d.getHints());x.ctatdebug("In evaluate --\x3e after setReportableHints");c&&c[0]&&c[0].setLatestHints(e,d.getHints());b.setReportableLink(d);b.setAssociatedSkills(d.getSkillNames());b.setReportableInterpretation(c[0]);b.setResult(d.getType());b.setTraceOutcome(d.getType());b.setStepID(d.getUniqueID());b.setTutorSAI(d.getDefaultSAI())}x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return etLink");return d};this.doHint=
function(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in doHint");var c=x.matchForHint(a);Array.isArray(b)&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in doHint last if condition"),b.push(a));x.ctatdebug("CTATExampleTracerTracer --\x3e returning from doHint: "+c);return c};this.getBestInterpretation=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation");if(null===K||"undefined"===typeof K)x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation in if condition"),
K=p(x.getInterpretationsInternal());x.ctatdebug("CTATExampleTracerTracer --\x3e out of getBestInterpretation "+(null===K||void 0===K));return K};this.getInterpretationsInternal=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getInterpretationsInternal");return v};this.toString=function(){var a="TracerState\n";null===v?a+="(no interpretations)\n":v.forEach(function(b){a+=b.toString()+"\n"});return a};this.addInterfaceVariablesFromEvent=function(a){if(a){var b=a.getTutorSelection();a=a.getTutorInput();
x.addInterfaceVariables(b,a)}};this.addInterfaceVariables=function(a,b){x.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables("+a+", "+b+")");if(a&&b){var c=a.length;c>b.length&&(c=b.length);for(var d=0;d<c;d++)a[d]&&(g.put(a[d],CTATVariableTable.standardizeType(b[d])),g.put(CTATVariableTable.nameAsString(a[d]),CTATVariableTable.valueAsString(b[d])));x.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() startStateVT "+g);v&&v.forEach(function(d){if(d=d.getVariableTable()){for(var e=0;e<
c;e++)a[e]&&(d.put(a[e],CTATVariableTable.standardizeType(b[e])),d.put(CTATVariableTable.nameAsString(a[e]),CTATVariableTable.valueAsString(b[e])));x.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() interp.vt "+d)}})}};this.findCurrentState=function(){x.ctatdebug("Entering findCurrentState");var a=x.getBestInterpretation();return a&&a.getLastMatchedLink()&&a.getLastMatchedLink().isDone()?a.getLastMatchedLink().getNextNode():(a=q(!1,[a]))?a.getPrevNode():A?A.getStartNode():null};this.saveLastReport=
function(a){v&&a&&v.forEach(function(b){b.setLatestHints(a.getReportableHints()||[]);var c=a.getSuccessOrBuggyMsg()||"";a.getResult()==CTATExampleTracerLink.CORRECT_ACTION?(b.setLatestSuccessMessage(c),b.setLatestBuggyMessage("")):(b.setLatestSuccessMessage(""),b.setLatestBuggyMessage(c))})}};CTATExampleTracerTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracerTracer.prototype.constructor=CTATExampleTracerTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracerTracer);var CTATExampleTracerGraph=function(c,g,f){function e(b,c,e){D.ctatdebug("CTATExampleTracerGraph --\x3e in isOrderOK");if(D.relaxOrderConstraints()||c.isDone()&&D.exitOnIncorrectDone())return!0;for(var f=a(c),g=0;g<f.length;g++){var l=f[g];if(!0===I.isGroupOrdered(l))if(g!==f.length-1){if(!1===d(l,h(f[g+1],e),b,e))return!1}else if(!1===d(l,c,b,e))return!1}D.ctatdebug("CTATExampleTracerGraph --\x3e out of isOrderOK");return!0}function b(b,c,d){D.ctatdebug("CTATExampleTracerGraph --\x3e in isReenteringOK");
if(D.relaxOrderConstraints()||c.isDone()&&D.exitOnIncorrectDone())return!0;c=a(c);for(var e=!0,f=0;f<c.length;f++)if(!0===e&&!1===I.isGroupReenterable(c[f]))for(var e=!1,g=0;g<b.length;g++)if(!0===I.isLinkInGroup(c[f],b[g]))e=!0;else{if(!0===e)return!1}else if(!1===e)break;if(0!==b.length){var h=a(b[b.length-1]);D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups null? "+(null===h));D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups undefined? "+("undefined"===
typeof h));D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups last traversedLink "+b[b.length-1].getUniqueID());D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups length "+(h?h.length:null));c.forEach(function(a){a=h.indexOf(a);0<=a&&h.splice(a,1)});D.ctatdebug("CTATETGraph.isReentrableOK: exitedGroups.length after removing newLink's groups: "+h.length);for(k=h.length-1;0<=k;k--)I.isGroupReenterable(h[k])&&h.splice(k,1);D.ctatdebug("CTATETGraph --\x3e in isReentrableOK: exitedGroups after removing reenterables: "+
h.length);D.ctatdebug("CTATETGraph --\x3e in isReentrableOK: traversedLinks: "+b+", path: "+d);var m=!0;h.forEach(function(a){!1!==m&&d.forEach(function(c){!1!==m&&l(b,c)<c.getMinTraversals()&&!0===I.isLinkInGroup(a,c)&&(m=!1)})});if(!1===m)return!1}D.ctatdebug("CTATExampleTracerGraph --\x3e out of isReenteringOK");return!0}function a(a){D.ctatdebug("in findGroupsOfLink(link "+a+"): typeof(groupModel) "+typeof I);a=I.getGroupsContainingLink(a);D.ctatdebug("in findGroupsOfLink groupsSet.size "+a.size);
var b=[];a.forEach(function(a){D.ctatdebug("in findGroupsOfLink group element "+a.getName());b.push(a)});b.sort(function(a,b){return I.getGroupLinkCount(b)-I.getGroupLinkCount(a)});return b}function d(a,b,c,d){var e=-1,f=null,g=Number.MAX_VALUE,m=null;I.getGroupSubgroups(a).forEach(function(a){if(!1===I.isLinkInGroup(a,b)&&0!==I.getGroupLinkCount(a)){var l=h(a,d);null!==l&&"undefined"!==typeof l&&(l=l.getDepth(),l<b.getDepth()&&l>e&&(!1===n(a)||!0===p(a,c))&&(e=l,f=a),l>b.getDepth()&&l<g&&(!1===n(a)||
!0===p(a,c))&&(g=l,m=a))}});I.getUniqueLinks(a).forEach(function(a){if(!0===d.has(a)){var h=a.getDepth();h<b.getDepth()&&h>e&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(e=h,f=a);h>b.getDepth()&&h<g&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(g=h,m=a)}});if(null!==f&&"undefined"!==typeof f)if(f instanceof CTATExampleTracerLink){if(l(c,f)<f.getMinTraversals())return!1}else if(f instanceof CTATLinkGroup&&!1===r(f,c,d))return!1;return null!==m&&"undefined"!==typeof m&&(m instanceof CTATExampleTracerLink&&
-1<c.indexOf(m)||m instanceof CTATLinkGroup&&!0===p(m,c))?!1:!0}function h(a,b){var c=Number.MAX_VALUE,d=null;I.getGroupLinks(a).forEach(function(a){a.getDepth()<c&&!0===b.has(a)&&(c=a.getDepth(),d=a)});return d}function l(a,b){for(var c=0,d=0;d<a.length;d++)b===a[d]&&c++;D.ctatdebug("CTATETGraph.getTraversalCount("+b+"): "+c);return c}function m(a,b,c){var d=!1,e=!0,f=!1;(new CTATExampleTracerPath(b)).getSortedLinks().forEach(function(b){if(!1!==e&&!0!==f){if(!1===d)!0===I.isLinkInGroup(a,b)&&(d=
!0);else if(!1===I.isLinkInGroup(a,b)){f=!0;return}c.getTraversalCount(b)<b.getMaxTraversals()&&(e=!1)}});return!1===e?!1:!0}function n(a){var b=!0;I.getGroupLinks(a).forEach(function(a){!1!==b&&0!==a.getMinTraversals()&&(b=!1)});return!1===b?!1:!0}function p(a,b){for(var c=0;c<b.length;c++)if(!0===I.isLinkInGroup(a,b[c]))return!0;return!1}function r(a,b,c){var d=!0;I.getGroupLinks(a).forEach(function(a){!1!==d&&!0===c.has(a)&&l(b,a)<a.getMinTraversals()&&(d=!1)});return!1===d?!1:!0}function u(){for(var a=
0;a<B.length;a++)B[a].clearInLinks();var b=D.getStartNode();null!==b&&"undefined"!==typeof b&&null!==b.getOutLinks()&&"undefined"!==typeof b.getOutLinks()&&(a=0,b.getOutLinks().forEach(function(b){w(b,a++)}))}function w(a,b){ctatdebug("updateInLinkSubGraph("+a+", "+b+")");var c=D.getNode(a.getNextNode());if(null!==c&&"undefined"!==typeof c){c.addInLink(a);var d=0;c.getOutLinks().forEach(function(a){w(a,d++)})}}function q(a){var b=D.getNode(a.getPrevNode());if(null!==b&&"undefined"!==typeof b){var c=
-1;b.getInLinks().forEach(function(a){-1===a.getDepth()&&q(a);a.getDepth()>c&&(c=a.getDepth())});a.setDepth(c+1)}}function y(a){var b=D.getGroupModel(),c=b.getTopLevelGroup(),d="",e=c.getSubgroups(),d=a+'<EdgesGroups ordered="'+c.getIsOrdered()+'">\n';e.forEach(function(c){d+=c.toXML(a+"    ",b)});return d+=a+"</EdgesGroups>\n"}CTATBase.call(this,"CTATExampleTracerGraph","visualdata");var z=null,B=null,v=null,E=null,C=null,A=null,F="",K=[],H=new Set,x=new Set,G=null,I=null,S=!0,Q=!0,L=CTATMsgType.SHOW_ALL_FEEDBACK,
D=this;this.getAllNodes=function(){var a=[],b;for(b in E)a.push(E[b]);return a};this.getFeedbackPolicy=function(){return L};this.setFeedbackPolicy=function(a){D.ctatdebug("Graph.setFeedbackPolicy("+a+") old policy "+L);L="false"===a?CTATMsgType.SHOW_ALL_FEEDBACK:"true"===a?CTATMsgType.HIDE_ALL_FEEDBACK:a};this.hideButRequireSteps=function(){return L==CTATMsgType.HIDE_BUT_COMPLETE};this.hideAllFeedback=function(){return L==CTATMsgType.HIDE_ALL_FEEDBACK};this.relaxOrderConstraints=function(){return D.hideAllFeedback()||
D.hideButRequireSteps()||L==CTATMsgType.DELAY_FEEDBACK};this.exitOnIncorrectDone=function(){switch(L){case CTATMsgType.HIDE_ALL_FEEDBACK:case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}};this.getDefaultBuggyMsg=function(){return I.getTopLevelGroup()?I.getTopLevelGroup().getDefaultBuggyMsg():null};this.getLinks=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getLinks");return v};this.addLink=function(a,b){D.ctatdebug("CTATExampleTracerGraph --\x3e in addLink");v.push(a);a.isDone()?
x.add(a):x["delete"](a);null===b||"undefined"===typeof b?I.addLinkToGroup(I.getTopLevelGroup(),a):I.addLinkToGroup(b,a);D.ctatdebug("CTATExampleTracerGraph --\x3e out of addLink")};this.addNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in addNode");B.push(a);E[a.getNodeID()]=a;D.ctatdebug("CTATExampleTracerGraph --\x3e out of addNode")};this.findAllPaths=function(){ctatdebug("CTATExampleTracerGraph --\x3e in findAllPaths "+D.getStartNode().getNodeID());return D.findPathsFromNode(D.getStartNode())};
this.pathToLinkIsSubset=function(a,b){var c=D.getNode(a.getPrevNode());D.ctatdebug("pathToLinkIsSubset("+a+") sourceNode "+c.getNodeID());if(0<a.getMinTraversals()&&"undefined"==typeof b[a.getUniqueID()])return!1;if(c==D.getStartNode())return!0;for(c=c.getInLinks().values();!(c=c.next()).done;)return D.pathToLinkIsSubset(c.value,b);return!1};this.observesOrderingConstraints=function(a,c,d,f){D.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints");null!==f&&"undefined"!==typeof f&&
(D.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints initializing out of order false"),f.setOutOfOrder(!1));if(null===d||"undefined"===typeof d||0===d.size||null===c||"undefined"===typeof c)return D.ctatdebug("CTATExampleTracerGraph --\x3e returning first true observesOrderingConstraints"),!0;if(c.isDone()&&D.exitOnIncorrectDone())return D.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning true for doneStep && exitOnIncorrectDone"),!0;if(!0===d.has(c)&&
!0===e(a,c,d)&&!0===b(a,c,d))return D.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning isOrderOK true && isisReenteringOK() true"),!0;null!==f&&"undefined"!==typeof f&&(D.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints setting out of order true"),f.setOutOfOrder(!0));D.ctatdebug("CTATExampleTracerGraph --\x3e returning false observesOrderingConstraints");return!1};this.isIncorrectLinkOK=function(a,b,c,d){D.ctatdebug("CTATExampleTracerGraph --\x3e in isIncorrectLinkOK");
var f=!1,g=null,h=!0,l=!1;D.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){!0!==l&&!1!==h&&b.getType().toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&!0===c.has(b)&&(f=!0,!1===e(a,b,c)?h=!1:(g=b,l=!0))});if(!1===h||null===g||"undefined"===typeof g)return!1;if(!1===f)return D.ctatdebug("isIncorrectLinkOK(): no siblings of link in path"),!1;if(!0===f&&(b=D.getSmallestContainingGroup(b),!0===I.isLinkInGroup(b,g)&&!1===I.isGroupOrdered(b)&&!0===m(b,c,d)))return!1;D.ctatdebug("CTATExampleTracerGraph --\x3e out of isIncorrectLinkOK");
return!0};this.toXML=function(a){var b=this.getLinks(),c=D.getGroupModel().getTopLevelGroup().getIsOrdered(),d;d='<?xml version="1.0" standalone="yes"?>\n<stateGraph firstCheckAllStates="true" caseInsensitive="'+D.getCaseInsensitive();d=d+('" unordered="'+!c)+('" lockWidget="'+D.getLockWidget());d+='" hintPolicy="'+D.getHintPolicy();d=d+'" version="4.0'+('" suppressStudentFeedback="'+D.isFeedbackSuppressed());d+='" highlightRightSelection="'+D.isHighlightRightSelection();d+='" confirmDone="'+a.getConfirmDone();
d+='" startStateNodeName="'+D.getStudentStartStateNodeName();d+='" tutorType="Example-tracing Tutor">\n';for(var c=this.getStartStateMsgs(),e="    <startNodeMessages>\n",f=0;f<c.length;f++)e+="        "+c[f].outerHTML+"\n";d+=e+"    </startNodeMessages>\n";for(c=0;c<B.length;c++)d+=B[c].toXML("    ")+"\n";for(c=0;c<b.length;c++)d+=b[c].toXML("    ")+"\n";b=d;a=a.getGraphSkills();d="";for(c=0;c<a.length;c++)d+="    <productionRule>\n",d+="        <ruleName>"+CTATExampleTracerSkill.getName(a[c].getSkillName())+
"</ruleName>\n",d+="        <productionSet>"+a[c].getCategory()+"</productionSet>\n",d+="        <label>"+a[c].getLabel()+"</label>\n",d+="        <description>"+a[c].getDescription()+"</description>\n",d+="    </productionRule>\n";d=b+d+y("    ");return d+="</stateGraph>\n"};this.addGroup=function(a,b,c){};this.getCaseInsensitive=function(){return Q};this.setCaseInsensitive=function(a){Q=a};this.getLockWidget=function(){return S};this.setLockWidget=function(a){S=a};this.getHintPolicy=function(){return hintPolicy};
this.setHintPolicy=function(a){hintPolicy=CTATHintPolicyEnum.lookup(a)};this.isFeedbackSuppressed=function(){return feedbackSuppressed};this.setFeedbackSuppressed=function(a){feedbackSuppressed="false"===a?!1:"true"===a?!0:a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;D.ctatdebug("setFeedbackSuppressed("+a+"): "+feedbackSuppressed);problemSummary&&problemSummary.setCountOnlyLastResults(feedbackSuppressed)};
this.isHighlightRightSelection=function(){return highlightRightSelection};this.setHighlightRightSelection=function(a){highlightRightSelection=a};this.getStartStateMsgs=function(){return K};this.setStartStateMsgs=function(a){K=a};this.getNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in getNode("+a+") returning "+E[a]);return E[a]};this.findNode=function(a){if(a){a=a.toLowerCase();for(var b in E)if(E[b].getNodeName().toLowerCase()==a)return D.getNode(b);if("start"==a)return D.getStudentStartsHereNode()||
D.getStartNode()}return null};this.findPathsFromNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in findPathsFromNode outlinks "+a.getOutLinks().size);var b=new Set;if(!a||0===a.getOutLinks().size)return b.add(new CTATExampleTracerPath(null)),b;D.ctatdebug("CTATExampleTracerGraph --\x3e before forEach ");a.getOutLinks().forEach(function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in forEach "+a.getType().toString());if(a.getType().toString()!=CTATExampleTracerLink.BUGGY_ACTION.toString()){var c=
D.findPathsFromNode(D.getNode(a.getNextNode()));D.ctatdebug("findPathsFromNode childPaths.size "+c.size);c.forEach(function(c){D.ctatdebug("findPathsFromNode childPath.size "+c.size+", outLink "+a);c.addLink(a);b.add(c)})}},a);0===b.size&&b.add(new CTATExampleTracerPath(null));D.ctatdebug("CTATExampleTracerGraph --\x3e out of findPathsFromNode "+b.size);return b};this.getDoneStates=function(){return H};this.checkForDoneState=function(a){if(a.isDone()&&a.isTraversable()){var b=D.getNode(a.getNextNode());
D.ctatdebug("CTATExampleTracerGraph.addDoneState(linkID "+a.getUniqueID()+") adding destNode "+b);H.add(b)}};this.getBestSubpath=function(a,b,c){if(!a||!b)return null;var d=D.findPathsFromNode(a),e=new Set;d.forEach(function(a){a=a.subpath(b);!a||c&&!a.containsAll(c)||e.add(a)});D.ctatdebug("CTATExampleTracerGraph.getBestSubpath("+a+", "+b+", ["+(c?c.length:-1)+"]) pathsFrom "+d.size+", pathsFromTo "+e.size);return 1>e.size?null:CTATExampleTracerPath.getBestPath(e)};this.getStartNode=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getStartNode() returning "+
C);return C};this.getLinkByID=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in getLinkByID");for(var b=0;b<v.length;b++)if(v[b].getUniqueID()===a)return v[b];D.ctatdebug("CTATExampleTracerGraph --\x3e out of getLinkByID");return null};this.setStartNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in setStartNode("+a+")");C=a};this.getStudentStartsHereNode=function(){return null!=A?A:getStartNode()};this.setStudentStartsHereNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in setStudentStartsHereNode("+
a+")");A=a};this.setStudentStartStateNodeName=function(a){F=a};this.getStudentStartStateNodeName=function(){return F};this.getExampleTracer=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getExampleTracer() returning "+z);return z};this.forDebugging=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in forDebugging");D.ctatdebug("Nodes in the graph -- ids");B.forEach(function(a){D.ctatdebug(a.getNodeID())});D.ctatdebug("Links in the graph -- ids, from, to");v.forEach(function(a){D.ctatdebug(a)})};
this.getSmallestContainingGroup=function(a){return I.getLowestLevelGroupOfLink(a)};this.redoLinkDepths=function(){u();D.getLinks().forEach(function(a){a.setDepth(-1)});D.getLinks().forEach(function(a){-1===a.getDepth()&&q(a)})};this.getGroupModel=function(){return I};this.setVisualData=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in setVisualData");G=a};this.getVisualData=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getVisualData() returning "+G);return G};this.getDoneLinks=
function(){return x};(function(a,b){D.ctatdebug("CTATExampleTracerGraph --\x3e in initGraph ("+a+" , "+b);v=[];B=[];E={};if(null===I||"undefined"===typeof I)I=new CTATDefaultGroupModel,D.ctatdebug("CTATExampleTracerGraph --\x3e created a group model from here");I.clear();I.setDefaultReenterable(!b);I.setGroupOrdered(I.getTopLevelGroup(),a);I.setGroupName(I.getTopLevelGroup(),CTATExampleTracerGraph.TOP_LEVEL);z=new CTATExampleTracerTracer(D,f);D.ctatdebug("CTATExampleTracerGraph --\x3e out of initGraph")})(!c,
g)};Object.defineProperty(CTATExampleTracerGraph,"TOP_LEVEL",{enumerable:!1,configurable:!1,writable:!1,value:"Top Level"});Object.defineProperty(CTATExampleTracerGraph,"STUDENT_BEGINS_HERE_VAR",{enumerable:!1,configurable:!1,writable:!1,value:"%(startStateNodeName)%"});Object.defineProperty(CTATExampleTracerGraph,"IS_ORDERED",{enumerable:!1,configurable:!1,writable:!1,value:"ordered"});CTATExampleTracerGraph.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerGraph.prototype.constructor=CTATExampleTracerGraph;"undefined"!==typeof module&&(module.exports=CTATExampleTracerGraph);var CTATGraphParser=function(){function c(b){ctatdebug("processEdge()");for(var c=new CTATExampleTracerLink(null,null,null),f=d.getElementChildren(b),h,l,m,p,r,u=b=-1,A=CTATMsgType.DEFAULT_ACTOR,F=!1,K=0;K<f.length;K++){"sourceID"===d.getElementName(f[K])&&(b=parseInt(d.getNodeTextValue(f[K])),c.setPrevNode(b));"destID"===d.getElementName(f[K])&&(u=parseInt(d.getNodeTextValue(f[K])),c.setNextNode(u));if("rule"===d.getElementName(f[K]))for(var H=d.getElementChildren(f[K]),x=0;x<H.length;x++)"text"===
d.getElementName(H[x])&&c.addSkillName(d.getNodeTextValue(H[x]).toString());if("actionLabel"===d.getElementName(f[K]))for(c.setIsPreferredLink("false"!=d.getElementAttr(f[K],"preferPathMark")),c.setMinTraversalsStr(d.getElementAttr(f[K],"minTraversals")),c.setMaxTraversalsStr(d.getElementAttr(f[K],"maxTraversals")),H=d.getElementChildren(f[K]),x=0;x<H.length;x++){"uniqueID"===d.getElementName(H[x])&&(r=d.getNodeTextValue(H[x]),c.setUniqueID(parseInt(d.getNodeTextValue(H[x]))));"message"===d.getElementName(H[x])&&
(p=new CTATMessage(H[x]),c.setDemoMsgObj(p));"actionType"===d.getElementName(H[x])&&c.setActionType(d.getNodeTextValue(H[x]));"buggyMessage"===d.getElementName(H[x])&&c.setBuggyMsg(d.getNodeTextValue(H[x]));"successMessage"===d.getElementName(H[x])&&c.setSuccessMsg(d.getNodeTextValue(H[x]));"hintMessage"===d.getElementName(H[x])&&c.addHint(d.getNodeTextValue(H[x]));if("matchers"===d.getElementName(H[x]))for(var G=d.getElementChildren(H[x]),I=0;I<G.length;I++)"Selection"===d.getElementName(G[I])&&
(h=g(G[I],0)),"Action"===d.getElementName(G[I])&&(l=g(G[I],1)),"Input"===d.getElementName(G[I])&&(m=g(G[I],2)),"Actor"===d.getElementName(G[I])&&(A=d.getNodeTextValue(G[I]),F=(F=d.getElementAttr(G[I],"linkTriggered"))&&"false"!=F.toLowerCase().trim()?!0:!1);if("matcher"===d.getElementName(H[x])){m=H[x];l=p;h=d.getElementAttr(m,"replacementFormula");var S=d.getElementChildren(m),Q=G=void 0,L,D=void 0,I=CTATMsgType.DEFAULT_ACTOR;m=new CTATExactMatcher(CTATMatcher.SELECTION,null);A=new CTATExactMatcher(CTATMatcher.ACTION,
null);e.ctatdebug("processMatcher(): nChildren "+S.length+", saiMessage "+l);for(var N=0;N<S.length;N++)"matcherType"===d.getElementName(S[N])&&(L=d.getNodeTextValue(S[N]),"ExactMatcher"===L&&(Q=CTATExactMatcher),"RegexMatcher"===L&&(Q=CTATRegexMatcher),"AnyMatcher"===L&&(Q=CTATAnyMatcher),"RangeMatcher"===L&&(Q=CTATRangeMatcher),"WildcardMatcher"===L&&(Q=CTATWildcardMatcher),"ExpressionMatcher"===L&&(Q=CTATExpressionMatcher),e.ctatdebug("processMatcher(): child "+N+", eltText "+L+", matcher "+Q)),
"matcherParameter"===d.getElementName(S[N])&&(L=d.getElementAttr(S[N],"name"),D=d.getNodeTextValue(S[N]),"selection"==L&&m.setParameter(D),"action"==L&&A.setParameter(D),"input"==L&&(G=G?G:new Q(CTATMatcher.INPUT,null),G.setParameter(D)),"actor"==L&&(I=D),"minimum"==L&&(G=G?G:new Q(CTATMatcher.INPUT,null),G.setParameter(D,"minimum")),"maximum"==L&&(G=G?G:new Q(CTATMatcher.INPUT,null),G.setParameter(D,"maximum")),"InputExpression"==L&&(G=G?G:new Q(CTATMatcher.INPUT,null),G.setParameter(S[N],L,d)),
"relation"==L&&(G=G?G:new Q(CTATMatcher.INPUT,null),G.setParameter(S[N],L,d)),e.ctatdebug("processMatcher(): child "+N+", eltAttrName "+L+", inputMatcher "+G));G||(G=Q?new Q(CTATMatcher.INPUT,null):new CTATExactMatcher(CTATMatcher.INPUT,null),G.setParameter(D?D:""),"undefined"!=typeof l&&"function"==typeof l.getSAI&&(l=l.getSAI(),m.setSingle(l.getSelection()),A.setSingle(l.getAction()),G.setSingle(l.getInput())));G.setReplacementFormula(h);A=[[m],[A],[G],I];h=A[0];l=A[1];m=A[2];A=A[3]}}}a.getStartNode()&&
u==a.getStartNode().getNodeID()&&console.log("***WARNING*** edge "+r+" destination is graph startNode "+a.getStartNode());r=new CTATVectorMatcher(h,l,m,A);r.setDefaultSAI(p.getSAI());r.setCaseInsensitive(n);r.setLinkTriggered(F);c.setMatcher(r);ctatdebug("GraphParser.processEdge() "+b+"->"+u+", edge "+c);a.getNode(b).addOutLink(c);a.checkForDoneState(c);return c}function g(a,b){e.ctatdebug("processMatchers()");for(var c=d.getElementChildren(a),f=[],g=0;g<c.length;g++)if("matcher"===d.getElementName(c[g])){for(var h=
null,l=d.getElementAttr(c[g],"replacementFormula"),m=d.getElementChildren(c[g]),n=0;n<m.length;n++){if("matcherType"===d.getElementName(m[n]))switch(h=d.getNodeTextValue(m[n]),e.ctatdebug("CTATGraphParser.processMatchers() matcherType["+n+"] = "+h),h){case "ExactMatcher":h=new CTATExactMatcher(b,null);break;case "RegexMatcher":h=new CTATRegexMatcher(b,null);break;case "AnyMatcher":h=new CTATAnyMatcher(b,null);break;case "RangeMatcher":h=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":h=
new CTATWildcardMatcher(b,null);break;case "ExpressionMatcher":h=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+n+"] = "+h+"; using CTATExactMatcher"),h=new CTATExactMatcher(b,null)}if("matcherParameter"===d.getElementName(m[n])){var p=d.getElementAttr(m[n],"name");"single"===p?h.setParameter(d.getNodeTextValue(m[n])):"minimum"===p?h.setParameter(d.getNodeTextValue(m[n]),"minimum"):"maximum"===p?h.setParameter(d.getNodeTextValue(m[n]),
"maximum"):h.setParameter(m[n],p,d)}}h&&h.setReplacementFormula(l);f.push(h)}return f}function f(a,b){var c=new Set;if("group"!==d.getElementName(a))return c;var e=d.getElementAttr(a,"name");ctatdebug("readGroupFromXML group name: "+e);var g="true"===d.getElementAttr(a,"ordered"),h="true"===d.getElementAttr(a,"reenterable");ctatdebug("readGroupFromXML group isOrdered typeof: "+typeof g);ctatdebug("readGroupFromXML group isOrdered: "+g);for(var l=function(a){c.add(a)},n=d.getElementChildren(a),p=0;p<
n.length;p++){if("link"===d.getElementName(n[p])){var r=Number(d.getElementAttr(n[p],"id")),u=b[r];if(null!==u||void 0!==u)ctatdebug("Added link ID : "+r),c.add(u)}"group"===d.getElementName(n[p])&&(ctatdebug("encountered a subgroup"),f(n[p],b).forEach(l))}m.addGroup(e,g,c);m.setGroupReenterable(m.getGroupByName(e),h);return c}CTATBase.call(this,"CTATGraphParser","__undefined__");var e=this,b,a,d=new CTATXML,h=null,l=[];new XMLSerializer;var m,n=!0,p=!0,r=[];this.getLockWidget=function(){return p};
this.setLockWidget=function(a){p=a};this.parseGraph=function(e,g){ctatdebug("parseBRD()");var q=0,u="true"===d.getElementAttr(e,"unordered");n="false"!=String(d.getElementAttr(e,"caseInsensitive")).toLowerCase();p=d.getElementAttr(e,"lockWidget");hintPolicy=d.getElementAttr(e,"hintPolicy");feedbackSuppressed=d.getElementAttr(e,"suppressStudentFeedback");var w=new CTATVariableTable;a=new CTATExampleTracerGraph(u,!1,w);a.setCaseInsensitive(n);a.setStudentStartStateNodeName(d.getElementAttr(e,"startStateNodeName"));
var B=d.getElementChildren(e),w=d.getElementAttr(e,"suppressStudentFeedback");if(null===w||void 0===w)w=CTATMsgType.SHOW_ALL_FEEDBACK;a.setFeedbackPolicy(w);g.setFeedbackSuppressed(w);w=d.getElementAttr(e,"highlightRightSelection");g.setHighlightRightSelection("false"!=w);var v=d.getElementAttr(e,"confirmDone");g.setConfirmDone("true"===v?!0:"false"===v?!1:a.getFeedbackPolicy()===CTATMsgType.HIDE_ALL_FEEDBACK);g.setHintPolicy(d.getElementAttr(e,"hintPolicy"));g.setOutOfOrderMessage(d.getElementAttr(e,
"outOfOrderMessage"));for(var v=null,E=0;E<B.length;E++)switch(d.getElementName(B[E])){case "startNodeMessages":l=d.getElementChildren(B[E]);a.setStartStateMsgs(l);break;case "node":q++;var C;C=B[E];ctatdebug("processNode("+C+")");var A=d.getElementChildren(C),F=-1;C="";for(var K=[],H=0;H<A.length;H++)switch(d.getElementName(A[H])){case "uniqueID":F=parseInt(d.getNodeTextValue(A[H]));break;case "text":C=d.getNodeTextValue(A[H]);break;case "dimension":for(var x=d.getElementChildren(A[H]),G=0;G<x.length;G++)ctatdebug("grandkids "+
G+", "+x[G]+", "+d.getNodeTextValue(x[G])+", "+parseInt(d.getNodeTextValue(x[G]))),K[G]=parseInt(d.getNodeTextValue(x[G]));ctatdebug("grandkids d "+K)}A=new CTATExampleTracerNode(F,new Set);""!==C&&A.setNodeName(C);2<=K.length&&A.setDimension({x:K[0],y:K[1]});C=A;a.addNode(C);1==q&&(a.setStartNode(C),a.setStudentStartsHereNode(C));C.getNodeName()==a.getStudentStartStateNodeName()&&a.setStudentStartsHereNode(C);break;case "edge":a.addLink(c(B[E]));break;case "EdgesGroups":v=B[E];break;case "productionRule":H=
B[E];ctatdebug("processSkill()");K=C="";F=A=null;H=d.getElementChildren(H);for(x=0;x<H.length;x++)G=d.getElementName(H[x]),"ruleName"==G&&(C=d.getNodeTextValue(H[x]),ctatdebug("ruleName="+C)),"productionSet"==G&&(K=d.getNodeTextValue(H[x]),ctatdebug("productionSet="+K)),"label"==G&&(A=d.getNodeTextValue(H[x]),ctatdebug("label="+A)),"description"==G&&(F=d.getNodeTextValue(H[x]),ctatdebug("description="+F));C&&(H=new CTATExampleTracerSkill(K,C,CTATExampleTracerSkill.DEFAULT_P_GUESS,CTATExampleTracerSkill.DEFAULT_P_KNOWN,
CTATExampleTracerSkill.DEFAULT_P_SLIP,CTATExampleTracerSkill.DEFAULT_P_LEARN,CTATExampleTracerSkill.DEFAULT_HISTORY),null!=A?H.setLabel(A):H.setLabel(C),null!=F?H.setDescription(F):H.setDescription(C+(K?" "+K:"")),r.push(H))}if(v){q=d.getElementAttr(v,"ordered");if(null===q||"undefined"==typeof isordered)q=!u;ctatdebug("parseGraph() value of isOrdered = "+q);ctatdebug("parseGraph() value of isUnordered = "+u);ctatdebug("parseGraph() typeof isOrdered: "+typeof q);ctatdebug("parseGraph()typeof isUnordered: "+
typeof u);B=v;v=q;ctatdebug("processGroup()");m=a.getGroupModel();q=m.createIdToLinkMap();m.setGroupOrdered(m.getTopLevelGroup(),v);ctatdebug("processGroup() name of group: "+m.getGroupName(m.getTopLevelGroup()));ctatdebug("processGroup() group isOrdered?: "+m.isGroupOrdered(m.getTopLevelGroup()));ctatdebug("processGroup() order of group: isOrdered= "+v);ctatdebug("processGroup() order of group: isOrdered typeof= "+typeof v);B=d.getElementChildren(B);for(v=0;v<B.length;v++)switch(d.getElementName(B[v])){case "group":f(B[v],
q);break;case "outOfOrderMessage":m.getTopLevelGroup().setDefaultBuggyMsg(d.getNodeTextValue(B[v]))}a.addGroup(void 0)}q=g.getSkillBarVector(!1,!0);if(!q||1>q.length)ctatdebug("No existing skills. Add skills from BRD."),g.addGraphSkills(r),q=g.getSkillBarVector();h=(new CTATTutorMessageBuilder).createStateGraphMessage(n,u,p,g.isSourceFlash()?a.exitOnIncorrectDone():g.isFeedbackSuppressed(),w,String(g.getConfirmDone()),q);a.redoLinkDepths();b=a.getExampleTracer();b.resetTracer();a.forDebugging();ctatdebug("Graph loaded.");
return{gr:a,tracer:b,ssm:l,sgMsg:h}}};CTATGraphParser.prototype=Object.create(CTATBase.prototype);CTATGraphParser.prototype.constructor=CTATGraphParser;"undefined"!==typeof module&&(module.exports=CTATGraphParser);var CTATProblemStateStatus=function(){var c="empty";this.getStatus=function(){return c};this.setStatus=function(g){c=g}};Object.defineProperty(CTATProblemStateStatus,"empty",{enumerable:!1,configurable:!1,writable:!1,value:"empty"});Object.defineProperty(CTATProblemStateStatus,"incompleteStartState",{enumerable:!1,configurable:!1,writable:!1,value:"incompleteStartState"});Object.defineProperty(CTATProblemStateStatus,"startState",{enumerable:!1,configurable:!1,writable:!1,value:"startState"});
Object.defineProperty(CTATProblemStateStatus,"incomplete",{enumerable:!1,configurable:!1,writable:!1,value:"incomplete"});Object.defineProperty(CTATProblemStateStatus,"goingToState",{enumerable:!1,configurable:!1,writable:!1,value:"goingToState"});Object.defineProperty(CTATProblemStateStatus,"normalFeedback",{enumerable:!1,configurable:!1,writable:!1,value:"normalFeedback"});Object.defineProperty(CTATProblemStateStatus,"complete",{enumerable:!1,configurable:!1,writable:!1,value:"complete"});
Object.defineProperty(CTATProblemStateStatus,"completedEarlier",{enumerable:!1,configurable:!1,writable:!1,value:"completedEarlier"});CTATProblemStateStatus.prototype=Object.create(CTATBase.prototype);CTATProblemStateStatus.prototype.constructor=CTATProblemStateStatus;CTATProblemStateStatus.prototype.isSendingSavedMsgsForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.normalFeedback:case CTATProblemStateStatus.complete:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustSaveForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.countForProblemSummary=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.startState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};CTATProblemStateStatus.prototype.isOutputSuppressed=function(){switch(this.getStatus()){case CTATProblemStateStatus.goingToState:return!0;default:return!1}};
CTATProblemStateStatus.prototype.isComplete=function(){switch(this.getStatus()){case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};CTATProblemStateStatus.prototype.canRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustRetrieveProblemState=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.transition=function(c,g){var f=this.getStatus();if(CTATProblemStateStatus.completedEarlier!=f)if(CTATProblemStateStatus.complete==f&&g==CTATProblemStateStatus.completedEarlier)this.setStatus(CTATProblemStateStatus.completedEarlier);else{switch(c){case CTATMsgType.SET_PREFERENCES:CTATProblemStateStatus[g]&&(CTATProblemStateStatus.incomplete==CTATProblemStateStatus[g]?this.setStatus(CTATProblemStateStatus.incompleteStartState):CTATProblemStateStatus.complete==CTATProblemStateStatus[g]?
this.setStatus(CTATProblemStateStatus.completedEarlier):this.setStatus(CTATProblemStateStatus.startState));break;case CTATMsgType.STATE_GRAPH:this.getStatus()==CTATProblemStateStatus.incomplete||this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incompleteStartState):this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.START_STATE_END:this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incomplete):
this.getStatus()==CTATProblemStateStatus.incomplete?this.setStatus(CTATProblemStateStatus.incomplete):this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.PROBLEM_RESTORE_END:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.END_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.BEGIN_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.BEGIN_RESTORE:this.getStatus()!=CTATProblemStateStatus.incompleteStartState&&
this.setStatus(CTATProblemStateStatus.incomplete)}ctatdebug("CTATProblemStateStatus.transition("+c+", "+g+") old "+f+" => new "+this.getStatus());return this.getStatus()}};CTATProblemStateStatus.prototype.toString=function(){return"{"+this.getStatus()+"}"};var CTATMessageTank=function(c){function g(c){l.ctatdebug("entering updateProblemSummary()");c&&a.forEach(function(a){if(a.msgType==CTATMsgType.ASSOCIATED_RULES){var d=a.evt;l.ctatdebug("entering updateProblemSummaryWithEvent("+d+")");if(d)if(b&&b.getOutputStatus().isComplete())c.setCompletionStatus(CTATMsgType.CompletionValue[1],!1);else{a=d.getResult();d.getHintRequest()&&(a=CTATExampleTracerLink.HINT_ACTION);var e=CTATMsgType.CompletionValue[0],f=a&&a==CTATExampleTracerLink.CORRECT_ACTION,g=!1,
h=null,m=null,n=null,B=d.getStudentSAI();B&&(h=B.getSelection())&&(m=B.getAction())&&(g="done"==String(h).toLowerCase()&&"buttonpressed"==String(m).toLowerCase());c.setCompletionStatus(e,CTATGlobals.confirmDone);l.ctatdebug("updateProblemSummary() Completion status "+e+", doneStep "+g+", correct "+f);g&&(e=f?(n=B.getInput())&&"-1"!=n?n:CTATMsgType.CompletionValue[1]:CTATMsgType.CompletionValue[0],c.setCompletionStatus(e,!0));e.startsWith(CTATMsgType.CompletionValue[1])?(c.stopTimer(),b&&b.setOutputStatus(CTATProblemStateStatus.complete)):
c.restartTimer();e=d.getActor();d=d.getStepID();l.ctatdebug("updateProblemSummmary() actor "+e+", indicatorObj "+a+", stepID "+d);!CTATMatcher.isTutorActor(e)&&b.getOutputStatus().countForProblemSummary()&&(CTATTutorMessageBuilder.isHint(a)?c.addHint(d):CTATTutorMessageBuilder.isCorrect(a)?null!==a&&"undefined"!==typeof a&&c.addCorrect(d):c.addError(d))}}})}function f(a){switch(l.suppressFeedback(a,b.getFeedbackPolicy())){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.DELAY_FEEDBACK:a=
a.msg;var c=CTATMsgType.getProperty(a,"Selection");l.ctatdebug("CTATMessageTank.addToDelayedFeedbackTank(\n  "+a+") selection "+c);c&&(b.getDelayedFeedback()[c.toLowerCase()]=a);return!0;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}}function e(a,b){for(var c=new CTATMessageTank(a,null),d=0;d<b.length;++d){var e=b[d];l.ctatdebug("sendNewTankful() mto["+d+"] msgType "+e.msgType);c.addToMessageTank(e.msgType,
e.msg,e.evt,null)}c.flushMessageTank(null,!0)}CTATBase.call(this,"CTATMessageTank",null);var b=c,a=null,d=null,h=null;c=new Set;c.add("SuccessMessage");c.add("BuggyMessage");c.add("HighlightMsg");c.add("NotDoneMessage");var l=this;this.toString=function(){l.ctatdebug("toString tank "+a);if(!a||1>a.length)return"MessageTank empty";var b="";a.forEach(function(a){b+=a.msgType+", "});return"MessageTank["+b.substr(0,b.length-2)+"]"};this.enqueueToolActionToStudent=function(a,c,d,e){l.ctatdebug("Entering enqueueToolActionToStudent("+
a+", "+c+", "+d+", "+e+")");var f=CTATMsgType.INTERFACE_ACTION;l.ctatdebug("entering enqueueMessageToStudent()");var g=CTATMessage.makeTransactionId();a=new CTATSAI(a,c,d);c=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(g,a);c=CTATMsgType.setProperty(c,CTATTutorMessageBuilder.TRIGGER,"DATA");c=CTATMsgType.setProperty(c,CTATTutorMessageBuilder.SUBTYPE,!e||1>e.length?CTATTutorMessageBuilder.TUTOR_PERFORMED:e);e=new CTATExampleTracerEvent(b,a,CTATMsgType.DEFAULT_TOOL_ACTOR);e.setTransactionID(g);
l.addToMessageTank(f,c,e,a);return g};this.addToMessageTank=function(b,c,e,f){l.ctatdebug("Entering addToMessageTank("+b+", "+c+", "+e+")");if(c){a||(a=[],d={},h={});var g={};g.msgType=b;g.msg=c;g.evt=e;g.sai=f;a.push(g);d[b]=d[b]?d[b]+1:1;b=e.getResult();e.getHintRequest()&&(b=CTATExampleTracerLink.HINT_ACTION);h[b]=h[b]?h[b]+1:1;l.ctatdebug("Exiting addToMessageTank() this "+l.toString())}};this.flushMessageTank=function(c,n){l.ctatdebug("Entering flushMessageTank("+c+", "+n+")");if(a&&!(1>a.length)){g(c);
l.ctatdebug("flushMessageTank() after updateProblemSummary; messageTank.length "+a.length);for(var m=[],r=[],u=0;u<a.length;++u){var w=a[u];if(w.msg){var q=w.msgType,y=w.evt;l.ctatdebug("entering processInterfaceVariables() msgType "+q+", evt "+y);if(q){var z=b?b.getTracer():null;l.ctatdebug("entering processInterfaceVariables() et "+b+", tracer "+z);q=q.toLowerCase();(0===q.indexOf("correct")||0===q.indexOf("interfaceaction"))&&z&&z.addInterfaceVariablesFromEvent(y)}if(!(q=f(w)))if(q=w,y=r,CTATConfiguration.usingFlash()){var B=
z=void 0;if(!(q&&q.sai&&(z=q.sai.getAction())&&(B=CTATSAI.delayedActionRegExp.exec(z)))||3>B.length||1>=B[2])q=!1;else{var v=y.length-1,v=0>v?null:y[v];q.msg=q.msg.replace(z,B[1]);v&&v.timeout==B[2]?v.msgTuples.push(q):y.push({timeout:Number(B[2]),msgTuples:[q]});q=!0}}else q=!1;q||m.push(w.msg)}}l.ctatdebug("flushMessageTank(): msgBundle.length "+m.length+", delayedMsgsBundle.length "+r.length);for(u=0;u<r.length;++u)w=r[u],l.ctatdebug("processDelayedMsgs() delayedMsgs.timeout "+w.timeout+", .msgTuples.length "+
w.msgTuples.length),setTimeout(e,w.timeout,b,w.msgTuples);0<m.length&&(l.ctatdebug("Bottom of flushMessageTank(); to send bundle of length "+m.length+" via "+b),b.sendBundle(m)&&(l.ctatdebug("CTATMessageTank.shouldSaveNow() resultTypes "+h+", msgTypes "+d),(h[CTATExampleTracerLink.CORRECT_ACTION]||h[CTATExampleTracerLink.FIREABLE_BUGGY_ACTION]||d.CorrectAction||d.InterfaceAction||d.UntutoredAction||b.isFeedbackSuppressed()&&d.AssociatedRules)&&b.isSendingSavedMsgsForRestore()&&(CTATGlobalFunctions.isInstructorMode()?
l.ctatdebug("We're in reviewer mode: we shouldn't save as we go"):b.getProblemStateSaver().saveAsYouGo(c))),l.ctatdebug("Exiting flushMessageTank() #CorrectAction "+d.CorrectAction+", #InterfaceAction "+d.InterfaceAction+", #UntutoredAction "+d.UntutoredAction));d=a=null}};this.flushDelayedFeedback=function(){l.ctatdebug("Entering flushDelayedFeedback()");var a=b.getDelayedFeedback(),c;for(c in a)a.hasOwnProperty(c)&&CTAT.ToolTutor.sendToInterface(a[c]);b.clearDelayedFeedback()};this.suppressFeedback=
function(a,b){l.ctatdebug("CTATMessageTank.suppressFeedback("+a.msgType+", "+b+")");var c;b==CTATMsgType.SHOW_ALL_FEEDBACK?(l.ctatdebug("if.1"),c=b):CTATMsgType.hasTextFeedback(a.msgType)?(l.ctatdebug("if.2"),b==CTATMsgType.HIDE_ALL_FEEDBACK||b==CTATMsgType.HIDE_BUT_ENFORCE?(l.ctatdebug("if.2.1"),c=b):(l.ctatdebug("if.2.2"),(c=CTATMsgType.getProperty(a.msg,CTATMsgType.BUGGY_MSG))&&-1!=c.toLowerCase().indexOf(CTATMsgType.NOT_DONE_MSG.toLowerCase())?(l.ctatdebug("if.2.2.1"),c=CTATMsgType.SHOW_ALL_FEEDBACK):
(l.ctatdebug("if.2.2.2"),c=CTATMsgType.HIDE_ALL_FEEDBACK))):CTATMsgType.isCorrectOrIncorrect(a.msgType)?(l.ctatdebug("if.3: "+a.msg),CTATMsgType.isDoneMessage(a.msg)?(l.ctatdebug("if.3.1"),c=CTATMsgType.SHOW_ALL_FEEDBACK):(l.ctatdebug("if.3.2"),c=b)):(l.ctatdebug("if.4"),c=CTATMsgType.SHOW_ALL_FEEDBACK);l.ctatdebug("CTATMessageTank.suppressFeedback() returning "+c);return c}};Object.defineProperty(CTATMessageTank,"END_OF_TRANSACTION",{enumerable:!1,configurable:!1,writable:!1,value:"end_of_transaction"});
CTATMessageTank.prototype=Object.create(CTATBase.prototype);CTATMessageTank.prototype.constructor=CTATMessageTank;"undefined"!==typeof module&&(module.exports=CTATMessageTank);var CTATStep=function(c,g){CTATBase.call(this,"CTATStep",c);this.id=c;this.result=g;this.nFirstHints=0;this.lastResult=null;this.nErrors=this.nCorrect=0;var f=this;f.ctatdebug("entering CTATStep("+c+", "+g+") constructor");this.incrementFirstHints=function(){f.nFirstHints++};this.incrementNCorrect=function(){f.nCorrect++};this.incrementErrors=function(){f.nErrors++};this.setLastResult=function(c){f.lastResult=c};this.getLastResult=function(){return f.lastResult};this.getResult=function(){return f.result};
this.getNCorrect=function(){return f.nCorrect};this.getNErrors=function(){return f.nErrors};this.getNFirstHints=function(){return f.nFirstHints};f.ctatdebug("in CTATStep("+c+", "+g+") constructor");switch(g){case CTATStep.StepResult[3]:f.incrementNCorrect();break;case CTATStep.StepResult[1]:f.incrementErrors();break;case CTATStep.StepResult[2]:f.incrementFirstHints()}f.ctatdebug("exiting CTATStep constructor")};
CTATStep.fromJSON=function(c){if(!c)return null;var g=new CTATStep("",""),f;for(f in c)c.hasOwnProperty(f)&&"function"!=typeof c[f]&&(g[f]=c[f]);return g};Object.defineProperty(CTATStep,"StepResult",{enumerable:!1,configurable:!1,writable:!1,value:["UNTRIED","INCORRECT","HINT","CORRECT"]});CTATStep.prototype=Object.create(CTATBase.prototype);CTATStep.prototype.constructor=CTATStep;"undefined"!==typeof module&&(module.exports=CTATStep);var CTATProblemSummary=function(c,g,f){CTATBase.call(this,"CTATProblemSummary","");var e=this;if(null===c||"undefined"===typeof c||1>c.length)throw new CTATExampleTracerException("givenProblemName null or empty");this.showCounts=!0;this.requiredSteps=Number.MAX_VALUE;this.problemName=c;this.pSummarySkills="undefined"==typeof g?null:g;this.pSummaryUpdates={toJSON:function(a){var b=e.getSkills();return"pSummaryUpdates"==a?b?b.getAllUpdates():[]:this}};this.countOnlyLastResults="undefined"==typeof f?
null:f;this.timeElapsed=this.initialErrorsOnly=this.initialHintsOnly=0;var b=new Date;this.stepMap={};this.uniqueErrors=this.uniqueCorrectUnassisted=this.uniqueCorrect=this.uniqueHints=this.errors=this.hints=this.correct=0;this.completionStatus=CTATMsgType.CompletionValue[0];this.getCountOnlyLastResults=function(){return e.countOnlyLastResults};this.setCountOnlyLastResults=function(a){e.countOnlyLastResults=a};this.getTimeElapsed=function(){return e.timeElapsed};this.getUniqueErrors=function(){if(!e.getCountOnlyLastResults())return e.uniqueErrors;
var a=0,b;for(b in e.stepMap)e.stepMap[b].getLastResult()==CTATStep.StepResult[1]&&a++;return a};this.getUniqueCorrect=function(){if(!e.getCountOnlyLastResults())return e.uniqueCorrect;var a=0,b;for(b in e.stepMap)e.stepMap[b].getLastResult()==CTATStep.StepResult[3]&&a++;return a};this.getUniqueCorrectUnassisted=function(){return e.uniqueCorrectUnassisted};this.getHintsOnly=function(){var a=e.initialHintsOnly,b;for(b in e.stepMap)CTATStep.StepResult[2]==e.stepMap[b].getResult()&&1>e.stepMap[b].getNErrors()&&
++a;return a};this.getErrorsOnly=function(){var a=e.initialErrorsOnly,b;for(b in e.stepMap)CTATStep.StepResult[1]==e.stepMap[b].getResult()&&1>e.stepMap[b].getNFirstHints()&&++a;return a};this.getUniqueSteps=function(){var a=0,b;for(b in e.stepMap)a++;return a};this.getRequiredSteps=function(){return e.requiredSteps==Number.MAX_VALUE?0:e.requiredSteps};this.setRequiredSteps=function(a){e.requiredSteps=a};this.getCorrect=function(){return e.correct};this.fromJSON=function(a){if(!a)return e;var b="",
c=null,f;for(f in a)if(a.hasOwnProperty(f)&&"function"!=typeof a[f])switch(f){case "stepMap":e[f]={};break;case "pSummarySkills":e[f]=CTATSkills.fromJSON(a[f]);b=f;break;case "pSummaryUpdates":c=a[f];break;default:e[f]=a[f]}b&&c&&e[b].restoreUpdates(c);return e};this.toJSON=function(a){if(!a)return e;var b=e.getSkills();switch(a){case "pSummarySkills":return b?b.getAllSkills():[];case "pSummaryUpdates":return b?b.getAllUpdates():[];default:return e[a]}};this.toJSONforTutorshop=function(){var a={};
a.problem_name=e.problemName;a.completion_status=e.completionStatus;e.showCounts&&(a.correct=e.correct,a.unique_correct=e.getUniqueCorrect(),a.unique_correct_unassisted=e.uniqueCorrectUnassisted,a.hints=e.hints,a.unique_hints=e.uniqueHints,a.hints_only=e.getHintsOnly(),a.errors=e.errors,a.unique_errors=e.getUniqueErrors(),a.errors_only=e.getErrorsOnly(),a.unique_steps=e.getUniqueSteps(),a.required_steps=e.getRequiredSteps());a.time_elapsed=e.timeElapsed;var b=e.getSkills();e.showCounts&&b?(a.skills=
b.getAllSkills(),a.skill_updates=b.getAllUpdates()):(a.skills=[],a.skill_updates=[]);return JSON.stringify(a)};this.toXML=function(a){var b,c="";b=""+(' ProblemName="'+e.problemName+'"');b+=' CompletionStatus="'+e.completionStatus+'"';e.showCounts&&(b+=' Correct="'+e.correct+'"',b+=' UniqueCorrect="'+e.getUniqueCorrect()+'"',b+=' UniqueCorrectUnassisted="'+e.uniqueCorrectUnassisted+'"',b+=' Hints="'+e.hints+'"',b+=' UniqueHints="'+e.uniqueHints+'"',b+=' HintsOnly="'+e.getHintsOnly()+'"',b+=' Errors="'+
e.errors+'"',b+=' UniqueErrors="'+e.getUniqueErrors()+'"',b+=' ErrorsOnly="'+e.getErrorsOnly()+'"',b+=' UniqueSteps="'+e.getUniqueSteps()+'"',b+=' RequiredSteps="'+e.getRequiredSteps()+'"');b+=' TimeElapsed="'+e.timeElapsed+'"';e.showCounts&&(c=e.getSkills()?e.getSkills().toXML(a):"");return a?"&lt;ProblemSummary"+b+"&gt;"+c+"&lt;/ProblemSummary&gt;":"<ProblemSummary"+b+">"+c+"</ProblemSummary>"};this.getSkills=function(){return e.pSummarySkills};this.setSkills=function(a){e.pSummarySkills=a};this.stopTimer=
function(){var a=new Date;e.timeElapsed+=a.getTime()-b.getTime();return a};this.restartTimer=function(){b=e.stopTimer();return e.timeElapsed};this.addHint=function(a){e.ctatdebug("addHint("+a+")");var b=e.stepMap[a];null!==b&&"undefined"!==typeof b?(1>b.getNFirstHints()&&++e.uniqueHints,b.incrementFirstHints()):(b=new CTATStep(a,CTATStep.StepResult[2]),e.stepMap[a]=b,e.uniqueHints++);e.hints++;b.setLastResult(CTATStep.StepResult[2]);e.ctatdebug("exiting addHint() hint count "+e.hints+", trial "+b)};
this.addError=function(a){e.ctatdebug("addError("+a+")");var b=e.stepMap[a];null!==b&&"undefined"!==typeof b?(1>b.getNCorrect()&&1>b.getNErrors()&&++e.uniqueErrors,b.incrementErrors()):(b=new CTATStep(a,CTATStep.StepResult[1]),e.stepMap[a]=b,e.uniqueErrors++);e.errors++;b.setLastResult(CTATStep.StepResult[1]);e.ctatdebug("exiting addError() error count "+e.errors+", trial "+b)};this.addCorrect=function(a){var b=e.stepMap[a];e.ctatdebug("entering addCorrect("+a+") trial "+b);b?(1>b.getNCorrect()&&
1>b.getNErrors()&&(++e.uniqueCorrect,1>b.getNFirstHints()&&e.uniqueCorrectUnassisted++),b.incrementNCorrect()):(e.ctatdebug("to call CTATStep("+a+", StepResult "+CTATStep.StepResult[3]),b=new CTATStep(a,CTATStep.StepResult[3]),e.stepMap[a]=b,e.uniqueCorrect++,e.uniqueCorrectUnassisted++);e.correct++;b.setLastResult(CTATStep.StepResult[3]);e.ctatdebug("exiting addCorrect() correct count "+e.correct+", trial "+b)};this.setShowCounts=function(a){e.showCounts=a};this.setCompletionStatus=function(a,b){e.ctatdebug("setCompletionStatus("+
a+", "+b+") old value "+e.completionStatus);if(!e.completionStatus.startsWith(CTATMsgType.CompletionValue[1])||b)e.completionStatus=a};this.getCompletionStatus=function(){return e.completionStatus}};CTATProblemSummary.prototype=Object.create(CTATBase.prototype);CTATProblemSummary.prototype.constructor=CTATProblemSummary;"undefined"!==typeof module&&(module.exports=CTATProblemSummary);var ProblemStateSaver=function(c){CTATBase.call(this,"ProblemStateSaver",c);this.tracer=c;var g=this,f=[],e=null,b="",a="",d=0;this.saveAsYouGo=function(e){g.ctatdebug("saveAsYouGo() curriculum_service_url "+b+", tracer "+c);if(c&&e){var h={};h.session_id=c.getSessionID();h.authenticity_token=a;h.summary="";h.problem_state=e?'{"summary":'+JSON.stringify(e)+',"state":'+ProblemStateSaver.xmlToJSON(f)+"}":ProblemStateSaver.xmlToJSON(f);++d;g.ctatdebug("saveAsYouGo["+d+"] to send problem_state length "+
h.problem_state.length);CTATLMS.saveProblemState&&CTATLMS.saveProblemState(h);CTATLMS.gradeStudent&&CTATLMS.gradeStudent(parseInt(e.getCorrect()),parseInt(e.getRequiredSteps()));CTATLMS.commit&&CTATLMS.commit()}else g.ctatdebug("Error: no tracer or no problem summary available, aborting save as you go")};this.setCurriculumServiceUrl=function(a){g.ctatdebug("ProblemStateSaver.setCurriculumServiceUrl() old "+b+", new "+a);b=a};this.setAuthenticityToken=function(b){g.ctatdebug("ProblemStateSaver.setAuthenticityToken() old "+
a+", new "+b);b&&(a=b)};this.getStepToIndexMap=function(){null===e&&(e=new Map);return e};this.getProblemState=function(){return f};this.getProblemStateLength=function(){return f.length}};ProblemStateSaver.prototype=Object.create(CTATBase.prototype);ProblemStateSaver.prototype.constructor=ProblemStateSaver;
ProblemStateSaver.prototype.replaceInProblemState=function(c,g,f,e){this.ctatdebug("PSS.replaceInProblemState("+CTATMsgType.getMessageType(c)+", "+f+", "+e+")");if(g.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(c))){g=this.getProblemState();c=this.editForProblemState(c);if(!e){f=ProblemStateSaver.makeStepKey(f);e=this.getStepToIndexMap();this.ctatdebug("PSS.replaceInProblemState() stepKey"+f+", index "+e.get(f)+")");if(e.has(f)){var b=e.get(f);g[b]=null}e.set(f,
g.length)}g.push(c)}};ProblemStateSaver.prototype.appendToProblemState=function(c,g,f){if(f||g.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(c)))g=this.getProblemState(),c=this.editForProblemState(c),g.push(c)};Object.defineProperty(ProblemStateSaver,"XML_PROLOGUE",{enumerable:!1,configurable:!1,writable:!1,value:/<\? *[xX][mM][lL][^?]*\?>/});Object.defineProperty(ProblemStateSaver,"LEADING_WHITE_SPACE",{enumerable:!1,configurable:!1,writable:!1,value:/^\s+</m});
Object.defineProperty(ProblemStateSaver,"MESSAGES_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"<messages>"});
ProblemStateSaver.prototype.editForProblemState=function(c){var g=c.split(ProblemStateSaver.XML_PROLOGUE),f=g[0],e;for(e=1;e<g.length;++e)f+=g[e];g=f.split(ProblemStateSaver.LEADING_WHITE_SPACE);f=g[0];for(e=1;e<g.length;++e)f.endsWith("\n")&&(f=f.slice(0,-1)),f.endsWith("\r")&&(f=f.slice(0,-1)),f+="<"+g[e];this.ctatdebug("ProblemStateSaver.editForProblemState("+c+")\n returns "+f);return f};ProblemStateSaver.omitFromRestore={init:!1};
ProblemStateSaver.mustSaveForRestore=function(c){ProblemStateSaver.omitFromRestore.init||(ProblemStateSaver.omitFromRestore[CTATMsgType.ASSOCIATED_RULES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.BUGGY_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.CORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INCORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INTERFACE_IDENTIFICATION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_RESTORE_END.toLowerCase()]=
!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_REQUEST.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_RESPONSE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SET_PREFERENCES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SHOW_HINTS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SUCCESS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore.init=!0);return c&&ProblemStateSaver.omitFromRestore[c.toLowerCase()]?
!1:!0};ProblemStateSaver.prototype.forwardToInterface=function(c,g,f){var e=CTATMsgType.getMessageType(c);this.ctatdebug("PSS.forwardToInterface("+e+") problemState.length "+this.getProblemState().length+", outputStatus "+f);if(f&&f.isOutputSuppressed())return!1;CTAT.ToolTutor.sendToInterface(c,g);f&&f.transition(CTATMsgType.getMessageType(c));return!0};ProblemStateSaver.prototype.processMessage=function(c){this.ctatdebug("ProblemStateSaver.processMessage("+c+")")};
ProblemStateSaver.makeStepKey=function(c){if(!c)return" ";var g=c.getSelection();c=c.getAction();g="string"!=typeof g||1>g.length?" ":g;c="string"!=typeof c||1>c.length?" ":c;return g+" "+c};
ProblemStateSaver.fromJSON=function(c){if("string"!=typeof c)return ProblemStateSaver.jsonToState(c);switch(c.charAt(0)){case "[":return ProblemStateSaver.jsonToState(c);case "{":break;default:return ProblemStateSaver.jsonToState(c)}var g={};try{g=JSON.parse(c)}catch(f){return console.log("ProblemStateSaver.fromJSON() error",f,"problemState",c),ProblemStateSaver.jsonToState(null)}g.summary&&(c=CTAT.ToolTutor.tutor.getProblemSummary().fromJSON(g.summary),c=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForAction(CTATMsgType.CORRECT_ACTION,
new CTATSAI("none","none","none"),CTATMsgType.DEFAULT_TOOL_ACTOR,new CTATSAI("none","none","none"),c.getSkills().getSkillBarVector(!1,!0),"0","T"+CTATGuid.guid(),""),CTAT.ToolTutor.sendToInterface(c));return g.state?ProblemStateSaver.jsonToXML(g.state):ProblemStateSaver.jsonToState(null)};ProblemStateSaver.jsonToState=function(c){if("string"!=typeof c||"["!=c.charAt(0))return[];var g=[];try{g=JSON.parse(c)}catch(f){return console.log("ProblemStateSaver.jsonToState() error",f,"problemState",c),[]}return ProblemStateSaver.jsonToXML(g)};
ProblemStateSaver.jsonToXML=function(c){var g=[];c.forEach(function(c,e){console.log("ProblemStateSaver.jsonToXML["+e+"] mo",c);var b=decodeURIComponent(c.i),b=0>b.indexOf("<![CDATA[")?"<![CDATA["+b+"]]\x3e":b,a;a="<message><verb>NotePropertySet</verb><properties><MessageType>"+("U"==c.m?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.INTERFACE_ACTION);a+="</MessageType><transaction_id>"+CTATMessage.makeTransactionId();a+="</transaction_id><Selection><value>"+c.s;a+="</value></Selection><Action><value>"+
c.a;g.push(a+("</value></Action><Input><value>"+b+"</value></Input></properties></message>"))});return g};
ProblemStateSaver.xmlToJSON=function(c){var g=[];c.forEach(function(c,e){ctatdebug("ProblemStateSaver.xmlToJSON["+e+"] msg\n  "+c);if(c){var b={},a=null;b.m=CTATMsgType.getMessageType(c)==CTATMsgType.UNTUTORED_ACTION?"U":"I";b.s=(a=CTATMsgType.getValue(CTATMsgType.getProperty(c,"Selection"),0))?a:"";b.a=(a=CTATMsgType.getValue(CTATMsgType.getProperty(c,"Action"),0))?a:"";a=CTATMsgType.getValue(CTATMsgType.getProperty(c,"Input"),0);a=a.replace(/^<!\[CDATA\[([^\]]*)\]\]>$/,"$1");b.i=encodeURIComponent(a);
ctatdebug("ProblemStateSaver.xmlToJSON["+e+"]  mo "+JSON.stringify(b));g.push(b)}});try{return JSON.stringify(g)}catch(f){return console.log("ProblemStateSaver.xmlToJSON() error",f,"toStringify",g),""}};"undefined"!==typeof module&&(module.exports=ProblemStateSaver);var ProblemStateRestorer=function(c){CTATBase.call(this,"ProblemStateRestorer",c);var g=this,f=null;this.getRestoreProblemUrl=function(){return f};this.setRestoreProblemUrl=function(c){f=c};this.toString=function(){return"["+f+": 0]"};this.retrieveMessages=function(e){console.log("retrieveMessages("+e+", ...)");e.mustRetrieveProblemState()?(c.stopWorking(1),CTATLMS.getProblemState&&CTATLMS.getProblemState(g.process)):console.log("Retrieval status indicates that we should not retrieve")};this.process=
function(e){c.getOutputStatus().transition(CTATMsgType.BEGIN_RESTORE);if("string"!=typeof e||""==e)console.log("ProblemStateRestorer.process("+e+") empty or not a string: ",typeof e),c.enqueueForRestore([]);else{if(!/^[[{]/.test(e)&&e.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG&&(console.log("ProblemStateRestorer.process() called with unrecognized string, to try htmlDecode(): ",e.slice(0,20)),e=(new DOMParser).parseFromString(e,"text/html").documentElement.textContent,
e.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG)){console.log("ProblemStateRestorer.process() called with unrecognized string: ",e.slice(0,20));c.enqueueForRestore([]);return}a:{var b=e;e=[];if("string"==typeof b){var a="";if(/^[[{]/.test(b))b=ProblemStateSaver.fromJSON(b);else{b=b.split(/<\/?messages>/);g.ctatdebug("msgsArr.length "+b.length+", msgsArr[1].length "+(b[1]?b[1].length:-1));if(2>b.length)break a;a="<message>";b=b[1].split(a)}g.ctatdebug("problemStateArr.length "+
b.length);for(var d=0,f=!1,l=0;l<b.length;++l)if(b[l]){var m=a+b[l],n=CTATMsgType.getMessageType(m);CTATMsgType.STATE_GRAPH==n?f=!0:CTATMsgType.START_STATE_END==n?f=!1:f?d++:CTATMsgType.INTERFACE_ACTION==n&&l==b.length-1&&CTATMsgType.isDoneMessage(m)&&c.getOutputStatus().isComplete()||(c.getProblemStateSaver().appendToProblemState(m,null,!0),e.push(m));g.ctatdebug("problemStateArr["+l+"] "+(f?"omit ":"keep ")+n+" omitted "+d+" kept "+e.length)}}}c.enqueueForRestore(e)}}};
ProblemStateRestorer.prototype=Object.create(CTATBase.prototype);ProblemStateRestorer.prototype.constructor=ProblemStateRestorer;var SCORMProblemSummary=function(){CTATBase.call(this,"SCORMProblemSummary","")};Object.defineProperty(SCORMProblemSummary,"LESSON_STATUS",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.lesson_status"});Object.defineProperty(SCORMProblemSummary,"RAW_SCORE",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.score.raw"});Object.defineProperty(SCORMProblemSummary,"EXIT",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.exit"});
Object.defineProperty(SCORMProblemSummary,"SESSION_TIME",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.session_time"});Object.defineProperty(SCORMProblemSummary,"ExitReason",{enumerable:!1,configurable:!1,writable:!1,value:{timeout:"time-out",suspend:"suspend",logout:"logout",done:" "}});
Object.defineProperty(SCORMProblemSummary,"LessonStatus",{enumerable:!1,configurable:!1,writable:!1,value:{passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed",notAttempted:"not attempted"}});SCORMProblemSummary.getLessonStatus=function(c){return CTATMsgType.CompletionValue[1]==c.getCompletionStatus()?SCORMProblemSummary.LessonStatus.completed:SCORMProblemSummary.LessonStatus.incomplete};
SCORMProblemSummary.getRawScore=function(c){var g=c.getUniqueSteps();return 0==g?0:parseInt(100*(c.getUniqueCorrectUnassisted()/g+.005))};SCORMProblemSummary.getExitReason=function(c){return SCORMProblemSummary.ExitReason.suspend};SCORMProblemSummary.getSessionTime=function(c){var g=c.getTimeElapsed();c=g%1E3;var g=(g-c)/1E3,f=g/60,e=f/60,g=g%60;9999<e&&(e=9999,f=g=99,c=990);return sprintf("%04d:%02d:%02d.%02d",e,f,g,c/10)};
SCORMProblemSummary.getProblemSummaryElements=function(c){var g=sprintf("<%s>%s</%s>",SCORMProblemSummary.LESSON_STATUS,SCORMProblemSummary.getLessonStatus(c),SCORMProblemSummary.LESSON_STATUS),f=sprintf("<%s>%d</%s>",SCORMProblemSummary.RAW_SCORE,SCORMProblemSummary.getRawScore(c),SCORMProblemSummary.RAW_SCORE),e=sprintf("<%s>%s</%s>",SCORMProblemSummary.EXIT,SCORMProblemSummary.getExitReason(c),SCORMProblemSummary.EXIT);c=sprintf("<%s>%s</%s>",SCORMProblemSummary.SESSION_TIME,SCORMProblemSummary.getSessionTime(c),
SCORMProblemSummary.SESSION_TIME);return g+f+e+c};CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=SCORMProblemSummary;"undefined"!==typeof module&&(module.exports=SCORMProblemSummary);var CTATExampleTracer=function(){function c(){return"example"===B&&C&&C.getModelInitialized()||"rule"===B&&A&&A.getModelInitialized()}function g(b,c){c?ea|=1<<b:(ea&=-65537>>16-b,a())}function f(a){if(v.isFeedbackSuppressed()){var b=new CTATSAI("hint","SetVisible","false"),b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage("dummyTransactionID",b);a.push(b)}}function e(){return"<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.INTERFACE_REBOOT+"</MessageType></properties></message>"}
function b(a){a.unshift(e());v.ctatdebug("sendStartStateMessageStrings(): "+a.length+" elts, "+O);v.sendBundle(a)}function a(){v.ctatdebug("workTheQueue() working "+ea+", workQueue.length "+W.length+", restoreQueue.length "+U.length);if(0==ea)for(;0!=(ea=0<W.length|(0<U.length)<<1);){var a,b=!1;0<U.length?(T=1,a=U.shift(),b=!0):(T=0,a=W.shift());if(!d(a,b)){v.ctatdebug("workTheQueue() suspending workQueue.length "+W.length+", restoreQueue.length "+U.length);v.stopWorking(b?1:0);break}v.ctatdebug("workTheQueue() bottom workQueue.length "+
W.length+", restoreQueue.length "+U.length)}}function d(a,b){v.lastMessageAsString=a;var d=v.lastMessageAsXML=(new CTATXML).parseXML(a),f=v.lastMessage=new CTATMessage(d),g=f.getMessageType();v.ctatdebug("CTATExampleTracer.handleMessageFromInterface(msgType "+g+")");switch(g){case CTATMsgType.SET_PREFERENCES:g=x;v.ctatdebug("handleSetPreferences ()");N=f.getProperty("problem_name");v.ctatdebug("SetPreferences.problem_name = "+N);f=g.getElementChildren(g.getElementChildren(d)[1]);for(d=0;d<f.length;d++){var h=
g.getElementName(f[d]);v.ctatdebug("SetPreferences eltName "+h);if(h)switch(h.toLowerCase()){case "source_id":P=g.getNodeTextValue(f[d]);break;case "question_file":E=g.getNodeTextValue(f[d]);break;case "skills":v.ctatdebug("parseSkills("+f[d]+")");v.getProblemSummary().setSkills(new CTATSkills(CTATSkills.parseSkills(f[d])),g);break;case "problem_state_status":O.transition(CTATMsgType.SET_PREFERENCES,g.getNodeTextValue(f[d]));R||(R=new ProblemStateRestorer(v));v.ctatdebug("SetPreferences problemStateRestorer "+
R);break;case "curriculum_service_url":CTATConfiguration.set("curriculum_service_url",g.getNodeTextValue(f[d]));break;case "restore_problem_url":R||(R=new ProblemStateRestorer(v));v.ctatdebug("SetPreferences problemStateRestorer "+R);CTATConfiguration.set("restoreProblemUrl",g.getNodeTextValue(f[d]));break;case "session_id":ja=g.getNodeTextValue(f[d]);break;case "authenticity_token":V.setAuthenticityToken(g.getNodeTextValue(f[d]))}}v.ctatdebug("questionFile "+E+", outputStatus "+O+", problemStateRestorer "+
R);f="undefined"!=typeof sessionStorage&&sessionStorage?sessionStorage.getItem("Go-To-State"):null;null!=f&&(sessionStorage.removeItem("Go-To-State"),f=Number(f),!Number.isSafeInteger(f)||0>=f||(ga=f,O.transition(CTATMsgType.BEGIN_GO_TO_STATE,null)));v.ctatdebug("outputStatus "+O+", problemStateRestorer "+R);pa.retrieveProblemFile(E,g,v);R&&R.retrieveMessages(O);return!1;case CTATMsgType.INTERFACE_IDENTIFICATION:return!0;case CTATMsgType.UNTUTORED_ACTION:return b&&v.sendBundle([a]),g=x,f=f.getTransactionID(),
v.ctatdebug("UntutoredAction ("+a+"), getTransactionID "+f),V.appendToProblemState(a,v.getOutputStatus(),!1),c()&&v.setVariablesFromSAI(d,g),!0;case CTATMsgType.INTERFACE_ACTION:b&&v.sendBundle([a]);v.ctatdebug("Interface action received.");g=f.getTransactionID();if(c())if(v.messageTank=new CTATMessageTank(v),v.ctatdebug("MessageTank "+v.messageTank),v.ctatdebug("InterfaceAction ("+a+"), getTransactionID "+g),h=f.getSelectionArray().slice(0),d=f.getActionArray().slice(0),v.ctatdebug("selectionArray "+
h+", message.getSelectionArray() "+f.getSelectionArray()),h[0]&&"_tutor"==h[0].toLowerCase())v.ctatdebug("handleInterfaceAction tutor cmd SAI "+f.getSAI()+";"),d[0]&&"function"===typeof v[d[0]]&&(g=f.getSAI().getInput(),v[d[0]](g)),g=!0;else if(!h[0]||"hint"!=h[0].toLowerCase()&&"help"!=h[0].toLowerCase())v.ctatdebug("calling doNewTrace("+B+", "+f.getSAI()+") sai.selectionArray "+f.getSAI().getSelectionArray()+" msg.selectionArray "+f.getSelectionArray()),g=r(B,[null,f.getSAI(),"student",!0,g,a]);
else{v.ctatdebug("handleInterfaceAction() hint request: hintPolicy "+I+", errorSAI "+G);I===CTATHintPolicyEnum.HINTS_UNBIASED?(1<h.length&&(h[1]=""),1<d.length&&(d[1]="")):I!==CTATHintPolicyEnum.HINTS_BIASED_BY_CURRENT_SELECTION_ONLY&&(I===CTATHintPolicyEnum.HINTS_BIASED_BY_PRIOR_ERROR_ONLY?G&&G.getSelection()?(h.splice(1,0,G.getSelection()),d.splice(1,0,"PreviousFocus")):(h[1]="",d[1]=""):I===CTATHintPolicyEnum.HINTS_BIASED_BY_ALL&&G&&G.getSelection()&&(h.splice(1,0,G.getSelection()),d[1]=CTATMsgType.PREVIOUS_FOCUS.toString()));
v.startSkillTransaction();v.ctatdebug("ExampleTracer.doHint, givenSelection = "+h);var l=f=null;if(d&&1<d.length&&d[1].toString()===CTATMsgType.PREVIOUS_FOCUS.toString()&&h&&1<h.length&&h[1]&&"null"!==h[1].toString()&&(f=h[1]!==h[0]?[h[1]]:null,2<d.length))for(v.ctatdebug("CTATExampleTracer --\x3e in doHint inner if condition"),l=[],h=2;h<d.length;h++)v.ctatdebug("CTATExampleTracer --\x3e in doHint for loop "+h),l.push(d[h]);v.ctatdebug("CTATExampleTracer --\x3e in doHint out of if condition");f=
new CTATSAI(f,l,null);d=new CTATExampleTracerEvent(v,f,"student");d.setHintRequest(!0);d.setWantReportableHints(!0);v.ctatdebug("CTATExampleTracerTracer --\x3e in doHint result: "+d);"example"===B?(f=C.doHint(d),g=p(d,g,f)):g=A.doHint(d,g,p)?d:null}else g=!1;return g;case CTATMsgType.PROBLEM_SUMMARY_REQUEST:return v.handleProblemSummaryRequest(v.getProblemSummary()),!0;case CTATMsgType.START_STATE_END:return O.transition(CTATMsgType.START_STATE_END),!0;case CTATMsgType.PROBLEM_RESTORE_END:return O.transition(CTATMsgType.PROBLEM_RESTORE_END),
g=v.getSkillBarVector(),f=[],d=new CTATTutorMessageBuilder,f.push(d.createMessage(CTATMsgType.PROBLEM_RESTORE_END,g?{Skills:g}:null)),v.sendBundle(f),!0;case CTATMsgType.GO_TO_STATE:return g=f.getProperty("nodeID"),0>g||!sessionStorage||!sessionStorage.setItem?g=!0:(sessionStorage.setItem("Go-To-State",String(g)),CTAT.ToolTutor.reboot("Go-To-State "+g+" from CTATExampleTracer")||(f=[],f.push(e()),v.ctatdebug("CTATET.handleGoToState() saved nodeID "+g+"; sending to interface\n"+f),v.sendBundle(f)),
g=!1),g;default:return console.log("CTATExampleTracer.handleMessageFromInterface(restoring "+b+") "+(b?"sending":"unprocessed")+" message, type "+g+"\n  "+a),b&&v.sendBundle([a]),!0}}function h(a,b,c){var d={tutorAdvice:null,msg:null,msgType:null};d.tutorAdvice=a.getSuccessOrBuggyMsg();d.tutorAdvice&&d.tutorAdvice.trim()?(d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage"):d.tutorAdvice=null;if(a.isBuggyResult())return d;v.ctatdebug("CTATET.createBuggyMessage() past getReportableLink()");
if(a.isDoneStepFailed())return d.tutorAdvice=CTATMsgType.NOT_DONE_MSG,d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage",d;v.ctatdebug("CTATET.createBuggyMessage() past isDoneStepFailed()");var e=b&&b.getTutorSAI()?b.getTutorSAI().getSelection():null,e=e&&""!==e.trim()?e:null,f=a.getStudentSAI()?a.getStudentSAI().getSelection():null,f=f&&""!==f.trim()?f:null;v.ctatdebug("CTATET.createBuggyMessage() past hintSelection0 "+e+", studentSelection0 "+f);if(a.getResult()==
CTATExampleTracerLink.NO_MODEL&&a.isOutOfOrder()&&e&&e!=f)return v.ctatdebug("CTATET.createBuggyMessage() to create out of order"),v.isHighlightRightSelection()?(d.tutorAdvice=v.getOutOfOrderMessage(),d.msg=c.createHighlightWidgetMessage(e,b.getTutorSAI().getAction(),d.tutorAdvice,a.getTransactionID()),d.msgType="HighlightMsg",v.ctatdebug("createBuggyMessage() out of order with highlight; rtn: "+d)):(d.tutorAdvice=CTATGlobals.languageManager.getString("OUTOFORDER"),d.msg=c.createBuggyMessage(a.getTransactionID,
d.tutorAdvice),d.msgType="BuggyMessage",v.ctatdebug("createBuggyMessage() out of order without highlight; rtn: "+d)),d;if(b="example"===B?H.getDefaultBuggyMsg():A.getDefaultBuggyMsg())return d.tutorAdvice=b,d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",v.ctatdebug("createBuggyMessage() default buggy msg: "+d),d;v.ctatdebug("createBuggyMessage() no buggy msg: "+d);return d}function l(a,b,c,d){v.ctatdebug("checkForTutorAction("+a+", "+b+", "+c+", "+d+")");var e=
[];e[0]=m(H.getNode(a),!0);e[1]=m(H.getNode(b),!1);v.ctatdebug("checkForTutorAction() links[0] "+e[0]+", links[1] "+e[1]+";");a=0;e[0]===e[1]?e[1]=null:e[0]||(a=1);b=null;v.messageTank||(v.messageTank=new CTATMessageTank(v,null));for(;a<e.length&&e[a];++a)if(b=CTATGuid.guid(),c){var f=e[a].getEvaluatedInput(c,d.getReportableVariableTable()),g=e[a].getDefaultSAI().clone();g.setInput(f);b=r("example",[e[a],g,e[a].getActor(),!0,b])}else b=r("example",[e[a],e[a].getDefaultSAI(),e[a].getActor(),!0,b]);
v.ctatdebug("checkForTutorAction() returning "+b+";");return b}function m(a,b){if(null===a||"undefined"===typeof a||1!==a.getCorrectOutDegree())return null;var c=null;a.getCorrectOutLinks().forEach(function(a){null===c&&a.isTutorPerformed(b)&&0<a.getMaxTraversals()&&(c=a)});return c}function n(a){for(var b=0;b<arguments.length;++b);for(var b={},c=0;c<arguments.length;++c){var d=arguments[c];"object"==typeof d?Object.assign(b,d):b["cf"+c]=d}return b}function p(a,b,c){c=a.getReportableHints();if(!c||
1>c.length)c=[],c.push(CTATGlobals.languageManager.getString("NO_HINT_AVAILABLE"));var d=a.getAssociatedSkills()||[],e=a.getStepID();v.updateSkills(CTATExampleTracerSkill.HINT,d,e,a.getActor());v.ctatdebug("Before building hint message: tutorSAI "+a.getTutorSAI()+", hints "+c+", edge # "+e);d=(new CTATTutorMessageBuilder).createHintMessage(c,a.getTutorSAI(),e,b);v.messageTank.addToMessageTank(CTATMsgType.SHOW_HINTS_MESSAGE,d,a,null);b=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForHint(c,
a.getTutorSAI(),q(CTATMsgType.DEFAULT_STUDENT_ACTOR),v.getSkillBarVector(!0),e,b,n(a.getCustomFields(),{rules:a.getAssociatedRules()}));v.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,b,a,null);b=v.getProblemSummary(a.getReportableInterpretation());v.messageTank.flushMessageTank(b,!0);v.ctatdebug("handleInterfaceAction() sent hint result "+a);G=null;v.restartWorking();return a}function r(a,b){v.ctatdebug("doNewTrace ( "+a+", "+b+" )");var c=b.shift(),d=b.shift(),e=b.shift(),f=b.shift(),
g=b.shift(),h=b.shift(),l=new CTATExampleTracerEvent(v,d,e),m=g;if(v.getOutputStatus().isComplete()&&d.isDone())return l.setResult(CTATExampleTracerLink.CORRECT_ACTION),l.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION),l.setTutorSAI(d),l.setTransactionID(m),c=y(l,d,e,!1),v.ctatdebug("doNewTrace("+d+", "+e+", "+f+", "+m+") returns "+c),c;v.startSkillTransaction();g=function(){l.setTransactionID(m);var c=l.getMsgToRestore();c&&(v.isFeedbackSuppressed()?V.replaceInProblemState(c,v.getOutputStatus(),
l.getStudentSAI(),H.getFeedbackPolicy()==CTATMsgType.HIDE_BUT_ENFORCE):l.getResult()!=CTATExampleTracerLink.CORRECT_ACTION&&l.getResult()!=CTATExampleTracerLink.FIREABLE_BUGGY_ACTION||V.appendToProblemState(c,v.getOutputStatus(),!1));c=y(l,d,e,f);v.ctatdebug("doNewTrace( "+a+", "+b+" ) returns "+c);v.restartWorking();return c};switch(a){case "example":return m=u(c,l,h,m),g();case "rule":return f=!1,w(l,h,g)}return null}function u(a,b,c,d){v.ctatdebug("doNewExampleTrace (link "+a+", result "+b+", origMsgTxt "+
c+", transactionID "+d);a&&b.addPreloadedLinkMatch(a);var e=C.evaluate(b);v.ctatdebug("Evaluate returned : "+e+", given link "+a+", result "+b);a?(v.ctatdebug("result.getTutorSelection() "+b.getTutorSelection()),v.ctatdebug("result.getTutorAction() "+b.getTutorAction()),v.ctatdebug("result.getTutorInput() "+b.getTutorInput()),v.ctatdebug("typeof(messageTank) "+typeof messageTank),a=b.getTutorSelection(),c=b.getTutorAction(),b=b.getTutorInput(),d=v.messageTank.enqueueToolActionToStudent(a,c,b,CTATTutorMessageBuilder.TUTOR_PERFORMED)):
b.setMsgToRestore(c);return d}function w(a,b,c){v.ctatdebug("DoNewRuleTrace( "+a+", "+b+" )");a.setMsgToRestore(b);return A.evaluate(a,c)}function q(a){return"undefined"!=typeof a&&a&&0<=a.toString().toLowerCase().indexOf("tutor")?"Tutor":"Student"}function y(a,b,c,d){v.ctatdebug("finishNewExampleTrace("+a+", "+b+", "+c+", "+d+")");var e=a.getStudentSAI(),f=a.getTutorSAI(),g=a.getTransactionID(),m=new CTATTutorMessageBuilder,p=a.getReportableLink()||null,r=null;b=a.getAssociatedSkills()||[];var u=
function(){v.lastResult=a;v.getTracer()&&"function"==typeof v.getTracer().saveLastReport&&v.getTracer().saveLastReport(a);var b=v.getProblemSummary(a.getReportableInterpretation());v.ctatdebug("finishNewExampleTrace() to flushMessageTank");v.messageTank.flushMessageTank(b,!0);v.ctatdebug("finishNewExampleTrace() sent result "+a.getResult()+",\n studentSAI "+e+",\n tutorSAI "+a.getTutorSAI()+",\n successOrBuggyMsg "+a.getSuccessOrBuggyMsg());return a};if(a.isSolverResult())return a.getResult(),u();
if(a.getResult()===CTATExampleTracerLink.CORRECT_ACTION){CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()!=c.toUpperCase()&&v.messageTank.addToMessageTank(CTATMsgType.CORRECT_ACTION,m.createCorrectActionMessage(g,f),a,f);v.updateSkills(CTATExampleTracerSkill.CORRECT,b,a.getStepID(),c);b=a.getSuccessOrBuggyMsg();var x=m.createAssociatedRulesMessageForAction(a.getResult(),f,q(c),e,v.getSkillBarVector(!0,c),p?p.getUniqueID():a.getStepID(),g,b,a.isOutOfOrder(),n(a.getCustomFields(),{rules:a.getAssociatedRules()}),
a.getTraceOutcome());v.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,x,a,f);v.ctatdebug("finishNewExampleTrace() successMsg "+b);b&&v.messageTank.addToMessageTank("SuccessMessage",m.createSuccessMessage(g,b),a,null);G=null;d&&(r=l(p?p.getNextNode():null,C.findCurrentState(!1,!1),v.lastMessage?v.lastMessage.getSAI():null,a))&&(a=r);return u()}v.messageTank.addToMessageTank(CTATMsgType.INCORRECT_ACTION,m.createInCorrectActionMessage(g,a.getInterpolatedSAI()),a,null);v.ctatdebug("about to do silent traceForHint("+
e+"), selectionArray "+e.getSelectionArray());var w=v.lastSilentHintResult=new CTATExampleTracerEvent(v,e,c);w.setHintRequest(!0);b=function(){var b=a.getAssociatedSkills()||[],n=a.getStepID()||"";v.updateSkills(CTATExampleTracerSkill.INCORRECT,b,n,c);f=a.getTutorSAI();b=h(a,w,m);v.ctatdebug("createBuggyMessage() tutorAdvice: "+b.tutorAdvice+";\n  msg "+b.msg);n=m.createAssociatedRulesMessageForAction(a.getResult(),f&&f.getSelection()?f:e,q(c),e,v.getSkillBarVector(!0,c),n,g,b.tutorAdvice,a.isOutOfOrder(),
a.getCustomFields(),a.getTraceOutcome());v.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,n,a,null);b.msg&&v.messageTank.addToMessageTank(b.msgType,b.msg,a);G=e;d&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION==a.getResult()?(r=l(p?p.getNextNode():null,C.findCurrentState(!1,!1),v.lastMessage?v.lastMessage.getSAI():null,a))&&(a=r):a.isDoneStepFailed()&&v.messageTank.flushDelayedFeedback();return u()};if("example"===B)return z(a,w),b();"rule"===B&&(a.setCustomFields(n(a.getCustomFields(),{rules:a.getAssociatedRules()})),
b())}function z(a,b){var c=C.traceForHint(b);v.ctatdebug("silent hint result: "+b+"; hintLink "+c);c||(c=C.getBestNextLink(!1,b),v.ctatdebug("getBestNextLink result: "+b+"; hintLink "+c));c&&((c=b.getTutorSAI())&&c.getSelection()&&a.setTutorSAI(c),a.setStepID(b.getStepID()),a.setAssociatedSkills(b.getAssociatedSkills()),a.setReportableInterpretation(b.getReportableInterpretation()))}CTATBase.call(this,"CTATExampleTracer","tracer");var B=null,v=this,E=null,C,A,F=null,K,H,x=new CTATXML;new XMLSerializer;
var G=null,I,S=!0,Q=!0,L=!1,D=null,N=null,P=null,V=new ProblemStateSaver(v);V.setAuthenticityToken(CTATCommLibrary.getAuthenticityToken());var R=null,T=1,O=new CTATProblemStateStatus,U=[],W=[],ea=0,ja="",ga=-1,da=null;v.ctatdebug("CTATExampleTracer constructor outputStatus="+O);this.messageTank=this.lastSilentHintResult=this.lastResult=this.lastMessage=this.lastMessageAsXML=this.lastMessageAsString=null;var pa=new CTATCommLibrary;this.receiveFromInterface=function(b){v.ctatdebug("CTATExampleTracer.receiveFromInterface() \n  "+
b);(/<MessageType>SetPreferences<.MessageType>/i.test(b)?U:W).push(b);a()};this.setVariablesFromSAI=function(a,b){var c=CTATMsgType.getSAIArraysFromElement(a,b);switch(B){case "example":v.getTracer()&&v.getTracer().addInterfaceVariables(c.selection,c.input);break;case "rule":A.handleUntutoredAction(c)}};this.traceLinks=function(a){for(var b=[],c=v.getTracer().getBestInterpretation(),d=0;d<a.length&&null!==a[d];++d)c.getTraversalCount(a[d])<a[d].getMinTraversals()&&(v.messageTank=new CTATMessageTank(v,
null),b.push(r("example",[a[d],a[d].getDefaultSAI(),a[d].getActor(),!1,null])),v.ctatdebug("traceLinks["+d+"] result "+b[d]));return b};this.enqueueForRestore=function(a){v.ctatdebug("enqueueForRestore() tracerReady "+c()+": got "+(a?a.length:-1)+" message elements");null==F&&null!=a&&(F=a);null!=F&&(U=U.concat(F),F=null,a=(new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null),U.push(a),T=1,c()&&v.startWorking())};this.restartWorking=function(){"rule"===B&&g(T,!1)};this.startWorking=
function(){g(T,!1)};this.stopWorking=function(a){g("undefined"!=typeof a?a:T,!0)};this.goToStartState=function(){var a=H.getStudentStartsHereNode()||H.getStartNode();a?v.goToState(a.getNodeName()):console.trace("goToStartState() did not find start node")};this.goToState=function(a){a=(a=H.findNode(a))?a.getNodeID():-1;0<a&&v.receiveFromInterface("<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.GO_TO_STATE+"</MessageType><nodeID>"+a+"</nodeID></properties></message>")};
this.processXML=function(a){if(null!=a){B="example";v.ctatdebug("processXML (), tutorType = "+B);v.ctatdebug("No of children"+x.getElementChildren(a).length);var c=new CTATGraphParser,d=c.parseGraph(a,v);H=d.gr;C=d.tracer;a=d.ssm;d=d.sgMsg;v.ctatdebug("sendStartStateMessages() nMsgs "+a.length+", outputStatus "+O);for(var e=[],g=new XMLSerializer,h=null,m=0;m<a.length;m++)if("message"==x.getElementName(a[m])){var n=g.serializeToString(a[m]),p=CTATMsgType.getMessageType(n);CTATMsgType.UNTUTORED_ACTION!=
p&&CTATMsgType.INTERFACE_ACTION!=p||v.setVariablesFromSAI(a[m],x);CTATMsgType.START_STATE_END==p?(f(e),h=n,e.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd()),e.push((new CTATTutorMessageBuilder).createLockWidgetMsg(c.getLockWidget()))):e.push(n)}e.unshift(d);b(e);c=h;a:{a=[];d=H.getStartNode();e=CTATMsgType.START_STATE_END;g=d.getNodeID();h=null;m=ga;ga=-1;0>m&&(m=(m=H?H.getStudentStartsHereNode():null)?m.getNodeID():g);console.log("CTATExampleTracer.resetGoToState to transition1 destNodeID",
m,"noopNodeID",g);m==g?O.transition(e,null):0<m&&((h=H.getNode(m))||console.log("CTATExampleTracer.resetGoToState to transition2 no destNode for destNodeID",m));v.ctatdebug("CTATET.resetGoToState("+e+", null, "+g+") returns "+h);e=h;if(null!==d&&null!==e&&d.getNodeID()!=e.getNodeID()){a=H.getBestSubpath(d,e);v.ctatdebug("advanceToStudentStartsHere() path "+a);if(!a)break a;a=a.getSortedLinks();a=v.traceLinks(a);v.ctatdebug("advanceToStudentStartsHere() results "+a)}e=d=null;0<a.length&&(e=a[a.length-
1],a=e.getReportableLink(),null!==a&&(d=a.getNextNode()));v.ctatdebug("advanceToStudentStartsHere() to check for TPA "+d+", "+e);l(d,C.findCurrentState(!1,!1),null,e)}a=[];c&&a.push(c);O.canRestore()||a.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));0<a.length&&v.sendBundle(a);C.setModelInitialized(!0)}v.startWorking()};this.processNools=function(a){var c=new CTATTutorMessageBuilder;B="rule";A=new CTATRuleTracer("nools",v);A.initEngine(a,function(a,d){v.ctatdebug("nools engine compiled");
var e;e=new CTATTutorMessageBuilder;var g=d.suppressStudentFeedback;if(null===g||void 0===g)g=CTATMsgType.SHOW_ALL_FEEDBACK;v.setFeedbackSuppressed(g);var h=d.highlightRightSelection;v.setHighlightRightSelection("false"!=h);var l=d.confirmDone;v.setConfirmDone("true"===l?!0:"false"===l?!1:g===CTATMsgType.HIDE_ALL_FEEDBACK);g=d.lockWidget;v.setHintPolicy(d.hintPolicy);v.setOutOfOrderMessage(d.outOfOrderMessage);e=e.createStateGraphMessage("false","false",g,v.isFeedbackSuppressed(),h,String(v.getConfirmDone()),
[]);h=[];f(a);a.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());a.push(c.createLockWidgetMsg(d.lockWidget));a.unshift(e);b(a);h.push("<message><verb>SendNoteProperty</verb><properties><MessageType>StartStateEnd</MessageType></properties></message>");O.canRestore()||h.push(c.createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));v.sendBundle(h);v.enqueueForRestore();v.startWorking()},function(a){console.log("error starting nools engine: "+a)},CTATConfiguration.get("use_backtracking"))};
this.handleProblemSummaryRequest=function(a){v.ctatdebug("CTATExampleTracer.ProblemSummaryRequest getProblemSummary() "+v.getProblemSummary());var b="<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.PROBLEM_SUMMARY_RESPONSE+"</MessageType>",b=b+SCORMProblemSummary.getProblemSummaryElements(a),b=b+("<ProblemSummary>"+a.toXML(!0)+"</ProblemSummary>"),b=b+("<ProblemSummaryJSON><![CDATA["+a.toJSONforTutorshop()+"]]\x3e</ProblemSummaryJSON>"),b=b+"<end_of_transaction>true</end_of_transaction></properties></message>",
c=[];c.push(b);v.sendBundle(c);O.transition(CTATMsgType.PROBLEM_SUMMARY_RESPONSE,a.getCompletionStatus());v.ctatdebug("CTATExampleTracer.handleProblemSummaryRequest() sent result '"+b+"';")};this.setConfirmDone=function(a){S=a};this.getConfirmDone=function(){return S};this.addGraphSkills=function(a){v.ctatdebug("adding graph skills: "+a.length);0<a.length&&(a=new CTATSkills(a),a.setExternallyDefined(!1),v.getProblemSummary().setSkills(a))};this.getGraphSkills=function(){var a=v.getProblemSummary().getSkills();
return a?a.getAllSkills():[]};this.sendBundle=function(a){v.ctatdebug("sending bundle #msgs = "+a.length+", outputStatus "+O);for(var b=0,c=0;c<a.length;c++){v.ctatdebug("Sending message #"+c);var d=a[c];0>=c&&(d='<?xml version="1.0" encoding="UTF-8"?>'+d);V.forwardToInterface(d,c>=a.length-1,O)&&++b}return 0<b};this.getHintPolicy=function(){return I};this.setHintPolicy=function(a){I=CTATHintPolicyEnum.lookup(a)};this.isHighlightRightSelection=function(){return Q};this.setHighlightRightSelection=
function(a){Q=a};this.updateSkills=function(a,b,c,d){var e=[];v.ctatdebug("in updateSkills("+b+") with step ID = "+c+", transaction result = "+a+", outputStatus "+v.getOutputStatus()+", actor "+d);if(!v.getOutputStatus().countForProblemSummary()||d&&!/^(student)?$/i.test(d))return e;var f=v.getProblemSummary().getSkills();if(!f)return e;b.forEach(function(b){(b=f.updateSkill(a,b,c))&&e.push(b)});return e};this.getSessionID=function(){return ja};this.getProblemSummary=function(a){v.ctatdebug("Entering getProblemSummary() problemSummary "+
D);if(null===D||"undefined"===typeof D){var b=v.getProblemName();D=null===b||"undefined"===typeof b||1>b.length?new CTATProblemSummary("NoProblemDefined",null,v.isFeedbackSuppressed()):new CTATProblemSummary(b,null,v.isFeedbackSuppressed())}a&&D.setRequiredSteps(a.countStepsForScore(H));return D};this.getProblemName=function(){return N};this.getSourceID=function(){return P};this.isSourceFlash=function(){return"string"==typeof P&&P.match(/flash/i)};this.isFeedbackSuppressed=function(){return L};this.setFeedbackSuppressed=
function(a){L="false"===a?!1:"true"===a?!0:a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;v.ctatdebug("setFeedbackSuppressed("+a+"): "+L);D&&D.setCountOnlyLastResults(L)};this.getSkillBarVector=function(a,b){var c=v.getProblemSummary().getSkills();return null===c||"undefined"===typeof c?null:"Student"!=q(b)?null:"undefined"!=typeof a&&a?c.getSkillBarVector(!1,!1):c.getSkillBarVector(!0,!0)};this.startSkillTransaction=
function(){var a=v.getProblemSummary().getSkills();a&&a.startTransaction()};this.getProblemStateSaver=function(){return V};this.isSendingSavedMsgsForRestore=function(){return v.getOutputStatus().isSendingSavedMsgsForRestore()};this.getOutputStatus=function(){return O};this.setOutputStatus=function(a){var b=O.getStatus();v.ctatdebug("setOutputStatus() old "+b+", new "+a);CTATProblemStateStatus[a]?O.setStatus(CTATProblemStateStatus[a]):(console.error("CTATExampleTracer.setOutputStatus() unexpected argument "+
a),O.setStatus(CTATProblemStateStatus.empty))};this.getFeedbackPolicy=function(){return H?H.getFeedbackPolicy():CTATMsgType.SHOW_ALL_FEEDBACK};this.getGraph=function(){return H};this.getTracer=function(){return C};this.getRuleTracer=function(){return A};this.getOutOfOrderMessage=function(){return K?K:CTATMsgType.DEFAULT_OUT_OF_ORDER_MESSAGE};this.setOutOfOrderMessage=function(a){K=a};this.getDelayedFeedback=function(){null==da&&(da={});return da};this.clearDelayedFeedback=function(){da=null};this.getQuestionFile=
function(a){if(!E||a)return E;a=E.split("/");return a[a.length-1]};this.addTPAToMessageTank=function(a,b,c,d){v.messageTank.enqueueToolActionToStudent(a,b,c,d)}};CTATExampleTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracer.prototype.constructor=CTATExampleTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracer);
